<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ForgetSou | Blog</title>
  
  <subtitle>â¤ æ­¦ç»Ÿå°æ¹¾ åˆ»ä¸å®¹ç¼“ â¤</subtitle>
  <link href="https://forgetsou.github.io/atom.xml" rel="self"/>
  
  <link href="https://forgetsou.github.io/"/>
  <updated>2021-12-03T08:21:24.000Z</updated>
  <id>https://forgetsou.github.io/</id>
  
  <author>
    <name>ForgetSou</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>äºŒåˆ†æŸ¥æ‰¾-ç®—æ³•</title>
    <link href="https://forgetsou.github.io/2021/12/03/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE-%E7%AE%97%E6%B3%95/"/>
    <id>https://forgetsou.github.io/2021/12/03/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE-%E7%AE%97%E6%B3%95/</id>
    <published>2021-12-03T08:21:24.000Z</published>
    <updated>2021-12-03T08:21:24.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€-ç®€è¿°"><a href="#ä¸€-ç®€è¿°" class="headerlink" title="ä¸€. ç®€è¿°"></a>ä¸€. ç®€è¿°</h2><figure class="highlight mathematica"><table><tr><td class="code"><pre><span class="line">å‡è®¾è¦åœ¨ç”µè¯ç°¿ä¸­æ‰¾ä¸€ä¸ªåå­—ä»¥<span class="built_in">K</span>æ‰“å¤´çš„äººï¼Œå¯ä»¥ä»å¤´å¼€å§‹ç¿»é¡µï¼Œç›´åˆ°è¿›å…¥ä»¥<span class="built_in">K</span>æ‰“å¤´çš„éƒ¨åˆ†ã€‚ä½†ä½ å¾ˆå¯èƒ½ä¸è¿™æ ·åšï¼Œè€Œæ˜¯ä»ä¸­é—´å¼€å§‹ï¼Œå› ä¸ºä½ çŸ¥é“ä»¥<span class="built_in">K</span>æ‰“å¤´çš„åå­—åœ¨ç”µè¯ç°¿ä¸­é—´ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="code"><pre><span class="line">å¯¹äºä¸Šè¿°æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ä¸€ç§ç®—æ³•æ¥è§£å†³é—®é¢˜ï¼Œè¿™ç§ç®—æ³•å°±æ˜¯äºŒåˆ†æŸ¥æ‰¾ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="code"><pre><span class="line">äºŒåˆ†æŸ¥æ‰¾åªé€‚åˆé¡ºåºæ’åˆ—çš„åˆ—è¡¨ä½¿ç”¨ã€‚</span><br></pre></td></tr></table></figure><hr><blockquote><p><strong>ä¸ªäººåšå®¢:</strong> ğŸ¡ <a href="https://forgetsou.github.io/">ForgetSou</a></p></blockquote><hr>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;ä¸€-ç®€è¿°&quot;&gt;&lt;a href=&quot;#ä¸€-ç®€è¿°&quot; class=&quot;headerlink&quot; title=&quot;ä¸€. ç®€è¿°&quot;&gt;&lt;/a&gt;ä¸€. ç®€è¿°&lt;/h2&gt;&lt;figure class=&quot;highlight mathematica&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;å‡è®¾è¦åœ¨ç”µè¯ç°¿ä¸­æ‰¾ä¸€ä¸ªåå­—ä»¥&lt;span class=&quot;built_in&quot;&gt;K&lt;/span&gt;æ‰“å¤´çš„äººï¼Œå¯ä»¥ä»å¤´å¼€å§‹ç¿»é¡µï¼Œç›´åˆ°è¿›å…¥ä»¥&lt;span class=&quot;built_in&quot;&gt;K&lt;/span&gt;æ‰“å¤´çš„éƒ¨åˆ†ã€‚ä½†ä½ å¾ˆå¯èƒ½ä¸è¿™æ ·åšï¼Œè€Œæ˜¯ä»ä¸­é—´å¼€å§‹ï¼Œå› ä¸ºä½ çŸ¥é“ä»¥&lt;span class=&quot;built_in&quot;&gt;K&lt;/span&gt;æ‰“å¤´çš„åå­—åœ¨ç”µè¯ç°¿ä¸­é—´ã€‚&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;


&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;å¯¹äºä¸Šè¿°æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ä¸€ç§ç®—æ³•æ¥è§£å†³é—®é¢˜ï¼Œè¿™ç§ç®—æ³•å°±æ˜¯äºŒåˆ†æŸ¥æ‰¾ã€‚&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;


&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;äºŒåˆ†æŸ¥æ‰¾åªé€‚åˆé¡ºåºæ’åˆ—çš„åˆ—è¡¨ä½¿ç”¨ã€‚&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ä¸ªäººåšå®¢:&lt;/strong&gt; ğŸ¡ &lt;a href=&quot;https://forgetsou.github.io/&quot;&gt;ForgetSou&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
</summary>
    
    
    
    <category term="ç®—æ³•" scheme="https://forgetsou.github.io/categories/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="ç®—æ³•" scheme="https://forgetsou.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>iOSå¼€å‘-MKMapViewè‹¹æœåŸç”Ÿåœ°å›¾ä¸Šç»˜åˆ¶ç®­å¤´çº¿-OC</title>
    <link href="https://forgetsou.github.io/2021/10/28/iOS%E5%BC%80%E5%8F%91-MKMapView%E8%8B%B9%E6%9E%9C%E5%8E%9F%E7%94%9F%E5%9C%B0%E5%9B%BE%E4%B8%8A%E7%BB%98%E5%88%B6%E7%AE%AD%E5%A4%B4%E7%BA%BF-OC/"/>
    <id>https://forgetsou.github.io/2021/10/28/iOS%E5%BC%80%E5%8F%91-MKMapView%E8%8B%B9%E6%9E%9C%E5%8E%9F%E7%94%9F%E5%9C%B0%E5%9B%BE%E4%B8%8A%E7%BB%98%E5%88%B6%E7%AE%AD%E5%A4%B4%E7%BA%BF-OC/</id>
    <published>2021-10-28T01:40:38.000Z</published>
    <updated>2021-10-28T01:40:38.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-æ•ˆæœå›¾"><a href="#1-æ•ˆæœå›¾" class="headerlink" title="1. æ•ˆæœå›¾"></a>1. æ•ˆæœå›¾</h2><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvusasse2wj30vg0l6wgi.jpg" alt="image-20211028094858937"></p><h2 id="2-å®ç°æ€è·¯"><a href="#2-å®ç°æ€è·¯" class="headerlink" title="2. å®ç°æ€è·¯"></a>2. å®ç°æ€è·¯</h2><h3 id="2-1-æœ€åˆæƒ³æ³•"><a href="#2-1-æœ€åˆæƒ³æ³•" class="headerlink" title="2.1. æœ€åˆæƒ³æ³•"></a>2.1. æœ€åˆæƒ³æ³•</h3><figure class="highlight"><table><tr><td class="code"><pre><span class="line">èµ·åˆæ€è·¯æ˜¯åœ¨</span><br></pre></td></tr></table></figure><p><code>MKMapView</code>ä¸Šç‚¹çš„ä¸‹æ–¹æ·»åŠ ä¸€ä¸ªç®­å¤´Viewæˆ–imageViewï¼Œé€šè¿‡ä¸¤ç‚¹è®¡ç®—è§’åº¦å¹¶æ§åˆ¶ç®­å¤´çš„æ—‹è½¬å®ç°å’Œçº¿é‡åˆï¼Œä¸€é¡¿æ“ä½œä¸‹æ¥å‘ç°è§’åº¦è®¡ç®—çš„å¹¶ä¸æ˜¯ç‰¹åˆ«çš„å‡†ç¡®ï¼Œè€Œä¸”åœ¨<code>MKMapview</code>æ—‹è½¬æ—¶ï¼Œç®­å¤´ä¹Ÿè·Ÿç€æ—‹è½¬ï¼Œæ— æ³•å’Œçº¿é‡åˆï¼Œæœ€ç»ˆä¹Ÿæ˜¯æ”¾å¼ƒäº†è¿™ä¸ªæ€è·¯ã€‚</p><h3 id="2-2-æ–°æ€è·¯"><a href="#2-2-æ–°æ€è·¯" class="headerlink" title="2.2. æ–°æ€è·¯"></a>2.2. æ–°æ€è·¯</h3><figure class="highlight"><table><tr><td class="code"><pre><span class="line">é€šè¿‡å®šä¹‰ä¸€ä¸ª</span><br></pre></td></tr></table></figure><p><code>MKPolylineRenderer</code>çš„å­ç±» <code>PVMTPolylineRenderer</code>ï¼Œé‡å†™çˆ¶ç±»çš„ <code>\- (void)drawMapRect:(MKMapRect)mapRect zoomScale:(MKZoomScale)zoomScale inContext:(CGContextRef)context</code> æ–¹æ³•è¿›è¡Œç®­å¤´ç»˜åˆ¶ã€‚</p><h2 id="3-å…·ä½“ä»£ç å®ç°"><a href="#3-å…·ä½“ä»£ç å®ç°" class="headerlink" title="3. å…·ä½“ä»£ç å®ç°"></a>3. å…·ä½“ä»£ç å®ç°</h2><p>3.1 åœ¨<code>iOS</code>ç³»ç»Ÿä¸­ï¼Œä½¿ç”¨<code>MKMapView</code>è¿›è¡Œåœ°å›¾å®šä½å¹¶ç»˜åˆ¶ï¼›</p><p>3.2 åœ¨åœ°å›¾ä¸Šæ ¹æ®å¤šä¸ªç‚¹çš„ç»çº¬åº¦ç»˜åˆ¶æ ‡æ³¨(ç‚¹)ï¼Œå¹¶æ ¹æ®è¿™äº›æ ‡æ³¨æ§åˆ¶åœ°å›¾ç”»å¸ƒå¤§å°å’Œç¼©æ”¾æ¯”ä¾‹ï¼›</p><p>3.3 ä½¿ç”¨<code>MKPolyline</code>åˆ›å»ºçº¿<code>MyMKPolyline</code>ï¼›</p><p>3.4 ä½¿ç”¨ä¸€ä¸ªç»§æ‰¿è‡ª<code>MKPolylineRenderer</code>çš„å¯¹è±¡<code>MyMKPolylineRenderer</code>å¯¹çº¿æ¡è¿›è¡Œæ ·å¼æ›´æ–°ã€‚</p><p>å…¶ä¸­ï¼Œ3.3æ­¥éª¤çš„å…·ä½“å®ç°æ–¹å¼å¦‚ä¸‹ï¼š</p><ol><li>3.3.1 åˆ›å»ºä¸€ä¸ªå¯¹è±¡<code>MyMKPolylineRenderer</code>ç»§æ‰¿è‡ª<code>MKPolylineRenderer</code>ï¼›</li><li>3.3.2 åœ¨<code>MyMKPolylineRenderer.h</code>ä¸­æ·»åŠ åœ°å›¾ç¼©æ”¾å› å­;</li><li>3.3.3 é‡å†™<code>MKPolylineRenderer</code>çš„<code>drawMapRect</code>æ–¹æ³•ï¼›</li><li>3.3.4 åœ¨<code>drawMapRect</code>æ–¹æ³•ä¸­è®¡ç®—å‡ºæ‰€éœ€ç”»ç®­å¤´çº¿çš„7ä¸ªç‚¹P1-P7çš„åæ ‡ï¼›</li><li>3.3.5 åœ¨<code>MKMapView</code>çš„ä»£ç†<code>regionDidChangeAnimated</code>å’Œ<code>mapViewDidChangeVisibleRegion</code>æ–¹æ³•ä¸­è®¡ç®—ç¼©æ”¾å› å­å¹¶å°†ç¼©æ”¾å› å­ä¼ å€¼ç»™<code>MyMKPolylineRenderer</code>ã€‚</li></ol><p><strong>è¯´æ˜</strong>ï¼šç¼©æ”¾å› å­ = mapView.bounds.size.width/mapView.visibleMapRect.size.width;</p><p>å…¶ä¸­3.3.3æ­¥éª¤çš„è®¡ç®—æ–¹å¼ä¸º:</p><ol><li><ol><li>é€šè¿‡<code>pointForMapPoint</code>è·å–<code>MyMKPolyline</code>çš„æ‰€æœ‰æ ‡æ³¨ï¼›</li></ol></li><li><ol><li>é€šè¿‡ä¸¤æ ‡æ³¨åæ ‡è®¡ç®—è§’åº¦ï¼›</li><li>åˆ†åˆ«è®¡ç®—P1-P7ç‚¹åæ ‡ï¼Œè®¡ç®—æ–¹å¼å¦‚å›¾2</li></ol></li></ol><p><strong>è¾…åŠ©è¯´æ˜å›¾</strong></p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gwvrxrdwtbj30fz0k875i.jpg" alt="æµç¨‹å›¾.png"></p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gwvs08vcx3j30ku0cgdgs.jpg" alt="ç®­å¤´çº¿åæ ‡è®¡ç®—æ–¹å¼è¾…åŠ©å›¾.png"></p><h3 id="3-1-åˆ›å»º-PVMTPolylineRenderer"><a href="#3-1-åˆ›å»º-PVMTPolylineRenderer" class="headerlink" title="3.1. åˆ›å»º PVMTPolylineRenderer"></a>3.1. åˆ›å»º <code>PVMTPolylineRenderer</code></h3><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;MapKit/MapKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NS_ASSUME_NONNULL_BEGIN</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">PVMTPolylineRenderer</span> : <span class="title">MKPolylineRenderer</span></span></span><br><span class="line">  </span><br><span class="line"><span class="comment">/// ç¼©æ”¾å› å­</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="keyword">double</span> zoomScale;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NS_ASSUME_NONNULL_END</span></span><br></pre></td></tr></table></figure><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&quot;PVMTPolylineRenderer.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">PVMTPolylineRenderer</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)drawMapRect:(<span class="built_in">MKMapRect</span>)mapRect zoomScale:(<span class="built_in">MKZoomScale</span>)zoomScale inContext:(<span class="built_in">CGContextRef</span>)context &#123;</span><br><span class="line">    [<span class="keyword">super</span> drawMapRect:mapRect zoomScale:zoomScale inContext:context];</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">double</span> lineWidth = <span class="number">1.5</span>/<span class="keyword">self</span>.zoomScale;  <span class="comment">// ç®­å¤´çº¿å®½</span></span><br><span class="line">    <span class="keyword">double</span> pointWidth = <span class="number">27</span>/<span class="keyword">self</span>.zoomScale;  <span class="comment">// ç‚¹å®½</span></span><br><span class="line">    <span class="keyword">double</span> arrowWidth = <span class="number">9.5</span>/<span class="keyword">self</span>.zoomScale; <span class="comment">// ç®­å¤´å®½ï¼ˆå®½é«˜ä¸€æ ·ï¼‰</span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">self</span>.polyline.pointCount; i++) &#123;</span><br><span class="line">            <span class="built_in">CGPoint</span> currentPoint = [<span class="keyword">self</span> pointForMapPoint:<span class="keyword">self</span>.polyline.points[i]];</span><br><span class="line">            <span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="built_in">CGPoint</span> lastPoint = [<span class="keyword">self</span> pointForMapPoint:<span class="keyword">self</span>.polyline.points[i - <span class="number">1</span>]];</span><br><span class="line">                <span class="keyword">double</span> angle = [<span class="keyword">self</span> getPointAngleWithLastPoint:lastPoint currentPoint:currentPoint];</span><br><span class="line">                <span class="comment">// è®¡ç®—ç®­å¤´7ä¸ªç‚¹åæ ‡ï¼Œä»¥ç®­å¤´å°–è§’ä¸ºèµ·ç‚¹</span></span><br><span class="line">                <span class="built_in">CGPoint</span> p1 = [<span class="keyword">self</span> calcCircleCoordinateWithCenter:currentPoint withAngle:angle withRadius:pointWidth/<span class="number">2.0</span>];</span><br><span class="line">              </span><br><span class="line">                <span class="built_in">CGPoint</span> p2 = <span class="built_in">CGPointMake</span>(p1.x + arrowWidth * cos([<span class="keyword">self</span> getRadio:<span class="number">30</span> + angle]), p1.y - arrowWidth * sin([<span class="keyword">self</span> getRadio:<span class="number">30</span> + angle]));</span><br><span class="line">              </span><br><span class="line">                <span class="built_in">CGPoint</span> p3 = <span class="built_in">CGPointMake</span>(p2.x + (arrowWidth/<span class="number">2</span> - lineWidth/<span class="number">2</span>)*sin([<span class="keyword">self</span> getRadio:angle]), p2.y + (arrowWidth/<span class="number">2</span> - lineWidth/<span class="number">2</span>)*cos([<span class="keyword">self</span> getRadio:angle]));</span><br><span class="line">              </span><br><span class="line">                <span class="built_in">CGPoint</span> p4 = <span class="built_in">CGPointMake</span>(lastPoint.x - lineWidth/<span class="number">2</span> * sin([<span class="keyword">self</span> getRadio:angle]), lastPoint.y - lineWidth/<span class="number">2</span> * cos([<span class="keyword">self</span> getRadio:angle]));</span><br><span class="line">              </span><br><span class="line">                <span class="built_in">CGPoint</span> p5 = <span class="built_in">CGPointMake</span>(lastPoint.x + lineWidth/<span class="number">2</span> * sin([<span class="keyword">self</span> getRadio:angle]), lastPoint.y + lineWidth/<span class="number">2</span> * cos([<span class="keyword">self</span> getRadio:angle]));</span><br><span class="line">              </span><br><span class="line">                <span class="built_in">CGPoint</span> p7 = <span class="built_in">CGPointMake</span>(p1.x + arrowWidth * cos([<span class="keyword">self</span> getRadio:<span class="number">30</span> - angle]), p1.y + arrowWidth * sin([<span class="keyword">self</span> getRadio:<span class="number">30</span> - angle]));</span><br><span class="line">              </span><br><span class="line">                <span class="built_in">CGPoint</span> p6 = <span class="built_in">CGPointMake</span>(p7.x - (arrowWidth/<span class="number">2</span> - lineWidth/<span class="number">2</span>)*sin([<span class="keyword">self</span> getRadio:angle]), p7.y - (arrowWidth/<span class="number">2</span> - lineWidth/<span class="number">2</span>)*cos([<span class="keyword">self</span> getRadio:angle]));</span><br><span class="line">              </span><br><span class="line">                <span class="comment">// å¼€å§‹ç»˜åˆ¶</span></span><br><span class="line">                <span class="built_in">CGContextMoveToPoint</span>(context, p1.x, p1.y);</span><br><span class="line">                <span class="built_in">CGContextAddLineToPoint</span>(context, p2.x, p2.y);</span><br><span class="line">                <span class="built_in">CGContextAddLineToPoint</span>(context, p3.x, p3.y);</span><br><span class="line">                <span class="built_in">CGContextAddLineToPoint</span>(context, p4.x, p4.y);</span><br><span class="line">                <span class="built_in">CGContextAddLineToPoint</span>(context, p5.x, p5.y);</span><br><span class="line">                <span class="built_in">CGContextAddLineToPoint</span>(context, p6.x, p6.y);</span><br><span class="line">                <span class="built_in">CGContextAddLineToPoint</span>(context, p7.x, p7.y);</span><br><span class="line">                <span class="built_in">CGContextClosePath</span>(context);</span><br><span class="line">                <span class="comment">// å¡«å……é¢œè‰²</span></span><br><span class="line">                <span class="built_in">CGContextSetRGBFillColor</span>(context, <span class="number">53</span>/<span class="number">255.0</span>, <span class="number">70</span>/<span class="number">255.0</span>, <span class="number">222</span>/<span class="number">255.0</span>, <span class="number">1</span>);</span><br><span class="line">                <span class="built_in">CGContextFillPath</span>(context);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// è®¡ç®—ä¸¤ä¸ªç‚¹ä¹‹é—´çš„è§’åº¦</span></span><br><span class="line"><span class="comment">/// @param lastPoint ä¸Šä¸ªç‚¹åæ ‡</span></span><br><span class="line"><span class="comment">/// @param currentPoint å½“å‰ç‚¹åæ ‡</span></span><br><span class="line">- (<span class="keyword">double</span>)getPointAngleWithLastPoint:(<span class="built_in">CGPoint</span>)lastPoint currentPoint:(<span class="built_in">CGPoint</span>)currentPoint &#123;</span><br><span class="line">    <span class="built_in">CGFloat</span> bearing = M_PI - atan2(currentPoint.y - lastPoint.y, currentPoint.x - lastPoint.x);</span><br><span class="line">    <span class="built_in">CGFloat</span> angle = bearing/M_PI * <span class="number">180</span>;</span><br><span class="line">    <span class="keyword">return</span> angle;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// è®¡ç®—åœ†è¾¹æ²¿åæ ‡</span></span><br><span class="line"><span class="comment">/// @param center åœ†ä¸­å¿ƒç‚¹</span></span><br><span class="line"><span class="comment">/// @param angle è§’åº¦</span></span><br><span class="line"><span class="comment">/// @param radius åŠå¾„</span></span><br><span class="line">- (<span class="built_in">CGPoint</span>)calcCircleCoordinateWithCenter:(<span class="built_in">CGPoint</span>)center withAngle:(<span class="keyword">double</span>)angle withRadius:(<span class="keyword">double</span>)radius &#123;</span><br><span class="line">    <span class="keyword">double</span> x2 = radius*cos([<span class="keyword">self</span> getRadio:angle]);</span><br><span class="line">    <span class="keyword">double</span> y2 = radius*sin([<span class="keyword">self</span> getRadio:angle]);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">CGPointMake</span>(center.x+x2, center.y-y2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// è§’åº¦è½¬æ¢</span></span><br><span class="line"><span class="comment">/// @param angle è§’åº¦</span></span><br><span class="line">- (<span class="keyword">double</span>)getRadio:(<span class="keyword">double</span>)angle &#123;</span><br><span class="line">    <span class="keyword">return</span> angle * M_PI / <span class="number">180</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-PVMTPolylineRendererçš„ä½¿ç”¨"><a href="#3-2-PVMTPolylineRendererçš„ä½¿ç”¨" class="headerlink" title="3.2. PVMTPolylineRendererçš„ä½¿ç”¨"></a>3.2. <code>PVMTPolylineRenderer</code>çš„ä½¿ç”¨</h3><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// PVMKMapView.h</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) PVMTPolylineRenderer *polylineRenderer;</span><br><span class="line"><span class="comment">// PVMKMapView.m</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> mark - MKMapViewDelegate</span></span><br><span class="line">- (<span class="built_in">MKOverlayRenderer</span> *)mapView:(<span class="built_in">MKMapView</span> *)mapView rendererForOverlay:(<span class="keyword">id</span>&lt;<span class="built_in">MKOverlay</span>&gt;)overlay &#123;</span><br><span class="line"><span class="keyword">if</span> ([overlay isKindOfClass:[PVMTRouteMKPloyline <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        PVMTPolylineRenderer *polylineRenderer = [[PVMTPolylineRenderer alloc] initWithOverlay:overlay];</span><br><span class="line">        <span class="keyword">self</span>.polylineRenderer = polylineRenderer;</span><br><span class="line">        <span class="keyword">return</span> polylineRenderer;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">if</span> ([overlay isKindOfClass:[<span class="built_in">MKPolyline</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">    <span class="comment">// å…¶ä»–çº¿</span></span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ([overlay isKindOfClass:[<span class="built_in">MKPolygon</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">    <span class="comment">// ä¸è§„åˆ™å›¾å½¢</span></span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)mapView:(<span class="built_in">MKMapView</span> *)mapView regionDidChangeAnimated:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line">    <span class="keyword">if</span> (@available(iOS <span class="number">11.0</span>, *))&#123;</span><br><span class="line">        <span class="comment">// mapViewDidChangeVisibleRegionå¤„ç†</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.frame.size.width &gt; <span class="number">300</span>) &#123;</span><br><span class="line">            <span class="keyword">double</span> zoomScale = mapView.bounds.size.width/mapView.visibleMapRect.size.width;</span><br><span class="line">            <span class="keyword">self</span>.polylineRenderer.zoomScale = zoomScale;</span><br><span class="line">            [<span class="keyword">self</span>.polylineRenderer setNeedsDisplay];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)mapViewDidChangeVisibleRegion:(<span class="built_in">MKMapView</span> *)mapView &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.frame.size.width &gt; <span class="number">300</span>) &#123;</span><br><span class="line">        <span class="keyword">double</span> zoomScale = mapView.bounds.size.width/mapView.visibleMapRect.size.width;</span><br><span class="line">        <span class="keyword">self</span>.polylineRenderer.zoomScale = zoomScale;</span><br><span class="line">        [<span class="keyword">self</span>.polylineRenderer setNeedsDisplay];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ç”»ç®­å¤´çº¿ç»“æŸã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gw0kofkc52j30u00u0tb0.jpg" alt="DBE00389714A8821"></p><p>ğŸ“¢æ³¨æ„ï¼š</p><p><code>zoomScale</code>ä¸ºæ‰‹åŠ¨è®¡ç®—çš„ï¼Œé€šè¿‡ <code>mapView.bounds.size.width/mapView.visibleMapRect.size.width</code> è®¡ç®—ï¼Œä¸èƒ½ä½¿ç”¨ <code>drawMapRect</code>æ–¹æ³•çš„ <code>zoomScale</code>ã€‚</p><p>å¦‚æœä½¿ç”¨ <code>drawMapRect</code>çš„ <code>zoomScale</code>ä¼šå¯¼è‡´åŒæŒ‡ç¼©æ”¾åœ°å›¾æ—¶ç®­å¤´åæ ‡è®¡ç®—é”™è¯¯ã€‚</p><hr><blockquote><p><strong>ä¸ªäººåšå®¢:</strong> ğŸ¡ <a href="https://forgetsou.github.io/">ForgetSou</a></p></blockquote><hr>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;1-æ•ˆæœå›¾&quot;&gt;&lt;a href=&quot;#1-æ•ˆæœå›¾&quot; class=&quot;headerlink&quot; title=&quot;1. æ•ˆæœå›¾&quot;&gt;&lt;/a&gt;1. æ•ˆæœå›¾&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/008i3skNly1gvusasse2wj30vg0l6wgi.jpg&quot; alt=&quot;image-20211028094858937&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;2-å®ç°æ€è·¯&quot;&gt;&lt;a href=&quot;#2-å®ç°æ€è·¯&quot; class=&quot;headerlink&quot; title=&quot;2. å®ç°æ€è·¯&quot;&gt;&lt;/a&gt;2. å®ç°æ€è·¯&lt;/h2&gt;&lt;h3 id=&quot;2-1-æœ€åˆæƒ³æ³•&quot;&gt;&lt;a href=&quot;#2-1-æœ€åˆæƒ³æ³•&quot; class=&quot;headerlink&quot; title=&quot;2.1. æœ€åˆæƒ³æ³•&quot;&gt;&lt;/a&gt;2.1. æœ€åˆæƒ³æ³•&lt;/h3&gt;&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;èµ·åˆæ€è·¯æ˜¯åœ¨&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;code&gt;MKMapView&lt;/code&gt;ä¸Šç‚¹çš„ä¸‹æ–¹æ·»åŠ ä¸€ä¸ªç®­å¤´Viewæˆ–imageViewï¼Œé€šè¿‡ä¸¤ç‚¹è®¡ç®—è§’åº¦å¹¶æ§åˆ¶ç®­å¤´çš„æ—‹è½¬å®ç°å’Œçº¿é‡åˆï¼Œä¸€é¡¿æ“ä½œä¸‹æ¥å‘ç°è§’åº¦è®¡ç®—çš„å¹¶ä¸æ˜¯ç‰¹åˆ«çš„å‡†ç¡®ï¼Œè€Œä¸”åœ¨&lt;code&gt;MKMapview&lt;/code&gt;æ—‹è½¬æ—¶ï¼Œç®­å¤´ä¹Ÿè·Ÿç€æ—‹è½¬ï¼Œæ— æ³•å’Œçº¿é‡åˆï¼Œæœ€ç»ˆä¹Ÿæ˜¯æ”¾å¼ƒäº†è¿™ä¸ªæ€è·¯ã€‚&lt;/p&gt;
&lt;h3 id=&quot;2-2-æ–°æ€è·¯&quot;&gt;&lt;a href=&quot;#2-2-æ–°æ€è·¯&quot; class=&quot;headerlink&quot; title=&quot;2.2. æ–°æ€è·¯&quot;&gt;&lt;/a&gt;2.2. æ–°æ€è·¯&lt;/h3&gt;&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;é€šè¿‡å®šä¹‰ä¸€ä¸ª&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;code&gt;MKPolylineRenderer&lt;/code&gt;çš„å­ç±» &lt;code&gt;PVMTPolylineRenderer&lt;/code&gt;ï¼Œé‡å†™çˆ¶ç±»çš„ &lt;code&gt;\- (void)drawMapRect:(MKMapRect)mapRect zoomScale:(MKZoomScale)zoomScale inContext:(CGContextRef)context&lt;/code&gt; æ–¹æ³•è¿›è¡Œç®­å¤´ç»˜åˆ¶ã€‚&lt;/p&gt;
&lt;h2 id=&quot;3-å…·ä½“ä»£ç å®ç°&quot;&gt;&lt;a href=&quot;#3-å…·ä½“ä»£ç å®ç°&quot; class=&quot;headerlink&quot; title=&quot;3. å…·ä½“ä»£ç å®ç°&quot;&gt;&lt;/a&gt;3. å…·ä½“ä»£ç å®ç°&lt;/h2&gt;</summary>
    
    
    
    <category term="OC" scheme="https://forgetsou.github.io/categories/OC/"/>
    
    
    <category term="OC" scheme="https://forgetsou.github.io/tags/OC/"/>
    
    <category term="MKMapView" scheme="https://forgetsou.github.io/tags/MKMapView/"/>
    
    <category term="CGContext" scheme="https://forgetsou.github.io/tags/CGContext/"/>
    
  </entry>
  
  <entry>
    <title>ğŸ“šã€Šé«˜æ€§èƒ½iOSåº”ç”¨å¼€å‘ã€‹-å†…å­˜ç®¡ç†</title>
    <link href="https://forgetsou.github.io/2021/09/06/%F0%9F%93%9A%E3%80%8A%E9%AB%98%E6%80%A7%E8%83%BDiOS%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E3%80%8B-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/"/>
    <id>https://forgetsou.github.io/2021/09/06/%F0%9F%93%9A%E3%80%8A%E9%AB%98%E6%80%A7%E8%83%BDiOS%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E3%80%8B-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/</id>
    <published>2021-09-06T06:49:42.000Z</published>
    <updated>2021-09-06T01:49:42.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gu6ymntbv1j60ku0kzmza02.jpg" alt="image.png"></p><h2 id="ä¸€-ç®€è¿°"><a href="#ä¸€-ç®€è¿°" class="headerlink" title="ä¸€. ç®€è¿°"></a>ä¸€. ç®€è¿°</h2><p>â€‹    æ‰‹æœºçš„å†…å­˜èµ„æºæ˜¯éå¸¸æœ‰é™çš„ï¼Œå¦‚æœä¸€ä¸ªåº”ç”¨çš„å†…å­˜ä½¿ç”¨é‡è¶…è¿‡äº†å•ä¸ªè¿›ç¨‹çš„ä¸Šé™ï¼Œå°±ä¼šè¢«æ“ä½œç³»ç»Ÿç»ˆæ­¢ä½¿ç”¨ï¼Œæ­£å¼è¿™ä¸ªåŸå› ï¼Œå†…å­˜ç®¡ç†åœ¨iOSä¸­æ‰®æ¼”ç€æ ¸å¿ƒçš„è§’è‰²ã€‚<br>â€‹    ä¸(åŸºäºåƒåœ¾å›æ”¶çš„)Java è¿è¡Œæ—¶ä¸åŒï¼ŒObjective-C å’Œ Swift çš„ iOS è¿è¡Œæ—¶ä½¿ç”¨å¼•ç”¨è®¡æ•°ã€‚ ä½¿ç”¨å¼•ç”¨è®¡æ•°çš„è´Ÿé¢å½±å“åœ¨äºï¼Œå¦‚æœå¼€å‘äººå‘˜ä¸å¤Ÿå°å¿ƒï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå‡ºç°é‡å¤çš„å†…å­˜é‡Šæ”¾ å’Œå¾ªç¯å¼•ç”¨çš„æƒ…å†µã€‚</p><h3 id="1-å†…å­˜æ¶ˆè€—"><a href="#1-å†…å­˜æ¶ˆè€—" class="headerlink" title="1.å†…å­˜æ¶ˆè€—"></a>1.å†…å­˜æ¶ˆè€—</h3><p>â€‹    å†…å­˜æ¶ˆè€—æŒ‡çš„æ˜¯åº”ç”¨æ¶ˆè€—çš„ RAMã€‚åº”ç”¨ä¸­çš„å†…å­˜æ¶ˆè€—åˆ†ä¸ºä¸¤éƒ¨åˆ†:æ ˆå¤§å°å’Œå †å¤§å°ã€‚</p><h4 id="1-1-æ ˆå¤§å°"><a href="#1-1-æ ˆå¤§å°" class="headerlink" title="1.1 æ ˆå¤§å°"></a>1.1 æ ˆå¤§å°</h4><p>â€‹    å¯è¢«é€’å½’è°ƒç”¨çš„æœ€å¤§æ–¹æ³•æ•°<br>â€‹    æ¯ä¸ªæ–¹æ³•éƒ½æœ‰å…¶è‡ªå·±çš„æ ˆå¸§ï¼Œå¹¶ä¼šæ¶ˆè€—æ•´ä½“çš„æ ˆç©ºé—´ã€‚å¦‚æœä½ è°ƒ ç”¨ mainï¼Œé‚£ä¹ˆ main å°†è°ƒç”¨ method1ï¼Œè€Œ method1 åˆå°†è°ƒç”¨ method2ï¼Œè¿™å°±å­˜åœ¨ä¸‰ä¸ªæ ˆå¸§ äº†ï¼Œä¸”æ¯ä¸ªæ ˆå¸§éƒ½ä¼šæ¶ˆè€—ä¸€å®šå­—èŠ‚çš„å†…å­˜ã€‚</p><p>â€‹    ä¸€ä¸ªæ–¹æ³•ä¸­æœ€å¤šå¯ä»¥ä½¿ç”¨çš„å˜é‡ä¸ªæ•°<br>â€‹    è§†å›¾å±‚çº§ä¸­å¯ä»¥åµŒå…¥çš„æœ€å¤§è§†å›¾æ·±åº¦<br>â€‹    æ¸²æŸ“å¤åˆè§†å›¾å°†åœ¨æ•´ä¸ªè§†å›¾å±‚çº§æ ‘ä¸­é€’å½’åœ°è°ƒç”¨ layoutSubViews å’Œ drawRect æ–¹æ³•ã€‚å¦‚ æœå±‚çº§è¿‡æ·±ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ ˆæº¢å‡ºã€‚</p><h4 id="1-2-å †å¤§å°"><a href="#1-2-å †å¤§å°" class="headerlink" title="1.2 å †å¤§å°"></a>1.2 å †å¤§å°</h4><p>â€‹    æ¯ä¸ªè¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹å…±äº«åŒä¸€ä¸ªå †ã€‚ä¸€ä¸ªåº”ç”¨å¯ä»¥ä½¿ç”¨çš„å †å¤§å°é€šå¸¸è¿œè¿œå°äºè®¾å¤‡çš„ RAM å€¼ã€‚ä¾‹å¦‚ï¼ŒiPhone 5S æ‹¥æœ‰å¤§çº¦ 1GB çš„ RAMï¼Œä½†åˆ†é…ç»™ä¸€ä¸ªåº”ç”¨çš„å †å¤§å°æœ€å¤šä¸åˆ° 512MBã€‚åº”ç”¨å¹¶ä¸èƒ½æ§åˆ¶åˆ†é…ç»™å®ƒçš„å †ã€‚åªæœ‰æ“ä½œç³»ç»Ÿæ‰èƒ½ç®¡ç†å †ã€‚<br>â€‹    ä½¿ç”¨ NSStringã€è½½å…¥å›¾ç‰‡ã€åˆ›å»ºæˆ–ä½¿ç”¨ JSON/XML æ•°æ®ã€ä½¿ç”¨è§†å›¾ç­‰éƒ½ä¼šæ¶ˆè€—å¤§é‡çš„å † å†…å­˜ã€‚å¦‚æœä½ çš„åº”ç”¨å¤§é‡ä½¿ç”¨å›¾ç‰‡(ä¸ Flickr å’Œ Instagram åº”ç”¨ç±»ä¼¼)ï¼Œé‚£ä¹ˆä½ éœ€è¦æ ¼å¤–å…³ æ³¨å¹³å‡å€¼å’Œå³°å€¼å†…å­˜ä½¿ç”¨çš„æœ€å°åŒ–ã€‚<br>â€‹    didReceiveMemoryWarning<br>â€‹    å»ºè®®ä½¿ç”¨é‡ä¸è¦è¶…è¿‡ 80%~85%ï¼Œè¦ç»™æ“ä½œç³»ç»Ÿçš„æ ¸ å¿ƒæœåŠ¡ç•™ä¸‹è¶³å¤Ÿå¤šçš„å†…å­˜ã€‚</p><h3 id="2-å†…å­˜ç®¡ç†æ¨¡å‹"><a href="#2-å†…å­˜ç®¡ç†æ¨¡å‹" class="headerlink" title="2.å†…å­˜ç®¡ç†æ¨¡å‹"></a>2.å†…å­˜ç®¡ç†æ¨¡å‹</h3><p>â€‹    å†…å­˜ç®¡ç†æ¨¡å‹åŸºäºæŒæœ‰å…³ç³»çš„æ¦‚å¿µã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡æ­£å¤„äºè¢«æŒæœ‰çŠ¶æ€ï¼Œé‚£å®ƒå ç”¨çš„å†…å­˜å°± ä¸èƒ½è¢«å›æ”¶ã€‚<br>â€‹    å½“ä¸€ä¸ªå¯¹è±¡åˆ›å»ºäºæŸä¸ªæ–¹æ³•çš„å†…éƒ¨æ—¶ï¼Œé‚£è¯¥æ–¹æ³•å°±æŒæœ‰è¿™ä¸ªå¯¹è±¡äº†ã€‚å¦‚æœè¿™ä¸ªå¯¹è±¡ä»æ–¹æ³• è¿”å›ï¼Œåˆ™è°ƒç”¨è€…å£°ç§°å»ºç«‹äº†æŒæœ‰å…³ç³»ã€‚è¿™ä¸ªå€¼å¯ä»¥èµ‹å€¼ç»™å…¶ä»–å˜é‡ï¼Œå¯¹åº”çš„å˜é‡åŒæ ·ä¼šå£°ç§°å»ºç«‹äº†æŒæœ‰å…³ç³»ã€‚<br>â€‹    ä¸€æ—¦ä¸æŸä¸ªå¯¹è±¡ç›¸å…³çš„ä»»åŠ¡å…¨éƒ¨å®Œæˆï¼Œé‚£ä¹ˆå°±æ˜¯æ”¾å¼ƒäº†æŒæœ‰å…³ç³»ã€‚è¿™ä¸€è¿‡ç¨‹æ²¡æœ‰è½¬ç§»æŒæœ‰å…³ç³»ï¼Œè€Œæ˜¯åˆ†åˆ«å¢åŠ æˆ–å‡å°‘äº†æŒæœ‰è€…çš„æ•°é‡ã€‚å½“æŒæœ‰è€…çš„æ•°é‡é™ä¸ºé›¶æ—¶ï¼Œå¯¹è±¡ä¼šè¢«é‡Šæ”¾ï¼Œ ç›¸ å…³ çš„ å†…å­˜ä¼šè¢«å›æ”¶ã€‚<br>â€‹    è¿™ç§æŒæœ‰å…³ç³»è®¡æ•°é€šå¸¸è¢«æ­£å¼ç§°ä¸ºå¼•ç”¨è®¡æ•°ã€‚å½“ä½ äº²è‡ªç®¡ç†æ—¶ï¼Œå®ƒè¢«ç§°ä¸ºæ‰‹åŠ¨å¼•ç”¨è®¡æ•° (manual reference countingï¼ŒMRC)ã€‚è™½ç„¶ç°åœ¨å·²ç»ååˆ†ç½•è§ï¼Œä½† MRC å¯¹ç†è§£é—®é¢˜å¾ˆæœ‰å¸®åŠ©ã€‚ç°å¦‚ä»Šçš„åº”ç”¨å¤§éƒ½ä½¿ç”¨è‡ªåŠ¨å¼•ç”¨è®¡æ•°(automatic reference counting ï¼ŒARC)ã€‚</p><h3 id="3-è‡ªåŠ¨é‡Šæ”¾å¯¹è±¡"><a href="#3-è‡ªåŠ¨é‡Šæ”¾å¯¹è±¡" class="headerlink" title="3.è‡ªåŠ¨é‡Šæ”¾å¯¹è±¡"></a>3.è‡ªåŠ¨é‡Šæ”¾å¯¹è±¡</h3><p>â€‹    è‡ªåŠ¨é‡Šæ”¾å¯¹è±¡è®©ä½ èƒ½å¤Ÿæ”¾å¼ƒå¯¹ä¸€ä¸ªå¯¹è±¡çš„æŒæœ‰å…³ç³»ï¼Œä½†å»¶åå¯¹å®ƒçš„é”€æ¯ã€‚å½“åœ¨æ–¹æ³•ä¸­åˆ›å»º ä¸€ä¸ªå¯¹è±¡å¹¶éœ€è¦å°†å…¶è¿”å›æ—¶ï¼Œè‡ªåŠ¨é‡Šæ”¾å°±æ˜¾å¾—éå¸¸æœ‰ç”¨ã€‚è‡ªåŠ¨é‡Šæ”¾å¯ä»¥å¸®åŠ©åœ¨ MRC ä¸­ç®¡ ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-(NSString *) address</span><br><span class="line">     &#123;</span><br><span class="line">         NSString *result = [[[NSString alloc]</span><br><span class="line">                 initWithFormat:@&quot;%@\n%@\n%@, %@&quot;,</span><br><span class="line">                 self.line1, self.line2, self.city, self.state]</span><br><span class="line">autorelease]; return result;</span><br><span class="line">&#125;</span><br><span class="line">(1) æŒæœ‰çš„å¯¹è±¡(åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­æ˜¯ NSString)æ˜¯ alloc æ–¹æ³•è¿”å›çš„ã€‚</span><br><span class="line">(2) ç¡®ä¿æ²¡æœ‰å†…å­˜æ³„æ¼ï¼Œä½ å¿…é¡»åœ¨å¤±å»å¼•ç”¨ä¹‹å‰æ”¾å¼ƒæŒæœ‰å…³ç³»ã€‚</span><br><span class="line">(3) ä½†æ˜¯ï¼Œå¦‚æœä½¿ç”¨äº† releaseï¼Œé‚£ä¹ˆå¯¹è±¡çš„é‡Šæ”¾å°†å‘ç”Ÿåœ¨è¿”å›ä¹‹å‰ï¼Œå› è€Œæ–¹æ³•å°†è¿”å›ä¸€ä¸ª</span><br><span class="line">æ— æ•ˆçš„å¼•ç”¨ã€‚</span><br><span class="line">(4) autorelease è¡¨æ˜ä½ æƒ³è¦æ”¾å¼ƒæŒæœ‰å…³ç³»ï¼ŒåŒæ—¶å…è®¸æ–¹æ³•çš„è°ƒç”¨è€…åœ¨å¯¹è±¡è¢«é‡Šæ”¾ä¹‹å‰ä½¿ç”¨</span><br><span class="line">å¯¹è±¡ã€‚</span><br></pre></td></tr></table></figure><p>â€‹    å½“åˆ›å»ºä¸€ä¸ªå¯¹è±¡å¹¶å°†å…¶ä»é alloc æ–¹æ³•è¿”å›æ—¶ï¼Œåº”ä½¿ç”¨ autoreleaseã€‚è¿™æ · å¯ä»¥ç¡®ä¿å¯¹è±¡å°†è¢«é‡Šæ”¾ï¼Œå¹¶å°½é‡åœ¨è°ƒç”¨æ–¹æ³•æ‰§è¡Œå®Œæˆæ—¶ç«‹å³é‡Šæ”¾ã€‚</p><h3 id="4-è‡ªåŠ¨é‡Šæ”¾æ± "><a href="#4-è‡ªåŠ¨é‡Šæ”¾æ± " class="headerlink" title="4.è‡ªåŠ¨é‡Šæ”¾æ± "></a>4.è‡ªåŠ¨é‡Šæ”¾æ± </h3><p>â€‹    è‡ªåŠ¨é‡Šæ”¾æ± å—æ˜¯å…è®¸ä½ æ”¾å¼ƒå¯¹ä¸€ä¸ªå¯¹è±¡çš„æŒæœ‰å…³ç³»ã€ä½†å¯é¿å…å®ƒç«‹å³è¢«å›æ”¶çš„ä¸€ä¸ªå·¥å…·ã€‚å½“ä»æ–¹æ³•è¿”å›å¯¹è±¡æ—¶ï¼Œè¿™ç§åŠŸèƒ½éå¸¸æœ‰ç”¨ã€‚</p><p>â€‹    å®ƒè¿˜èƒ½ç¡®ä¿åœ¨å—å†…åˆ›å»ºçš„å¯¹è±¡ä¼šåœ¨å—å®Œæˆæ—¶è¢«å›æ”¶ã€‚è¿™åœ¨åˆ›å»ºäº†å¤šä¸ªå¯¹è±¡çš„åœºæ™¯ä¸­éå¸¸æœ‰ ç”¨ã€‚æœ¬åœ°çš„å—å¯ä»¥ç”¨æ¥å°½æ—©åœ°é‡Šæ”¾å…¶ä¸­çš„å¯¹è±¡ï¼Œä»è€Œä½¿å†…å­˜ç”¨é‡ä¿æŒåœ¨è¾ƒä½çš„æ°´å¹³ã€‚</p><p>â€‹    è‡ªåŠ¨é‡Šæ”¾æ± å—ç”¨ @autoreleasepool è¡¨ç¤ºã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int main(int argc, char * argv[]) &#123;  </span><br><span class="line">    @autoreleasepool &#123;  </span><br><span class="line">  </span><br><span class="line">        return UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class]));</span><br><span class="line">    &#125;         </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><p>â€‹    å—ä¸­æ”¶åˆ°è¿‡ autorelease æ¶ˆæ¯çš„æ‰€æœ‰å¯¹è±¡éƒ½ä¼šåœ¨ autoreleasepool å—ç»“æŸæ—¶æ”¶åˆ° release æ¶ˆ æ¯ã€‚æ›´åŠ é‡è¦çš„æ˜¯ï¼Œæ¯ä¸ª autorelease è°ƒç”¨éƒ½ä¼šå‘é€ä¸€ä¸ª release æ¶ˆæ¯ã€‚è¿™æ„å‘³ç€å¦‚æœä¸€ ä¸ªå¯¹è±¡æ”¶åˆ°äº†ä¸æ­¢ä¸€æ¬¡çš„ autorelease æ¶ˆæ¯ï¼Œé‚£å®ƒä¹Ÿä¼šå¤šæ¬¡æ”¶åˆ° release æ¶ˆæ¯ã€‚è¿™ä¸€ç‚¹å¾ˆ æ£’ï¼Œå› ä¸ºè¿™èƒ½ä¿è¯å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸‹é™åˆ°ä½¿ç”¨ autoreleasepool å—ä¹‹å‰çš„å€¼ã€‚å¦‚æœè®¡æ•°ä¸º 0ï¼Œåˆ™å¯¹è±¡å°†è¢«å›æ”¶ï¼Œä»è€Œä¿æŒè¾ƒä½çš„å†…å­˜ä½¿ç”¨ç‡ã€‚</p><p>â€‹    çœ‹äº† main æ–¹æ³•çš„ä»£ç åï¼Œä½ ä¼šå‘ç°æ•´ä¸ªåº”ç”¨éƒ½åœ¨ä¸€ä¸ª autoreleasepool å—ä¸­ï¼Œè¿™æ„å‘³ç€æ‰€ æœ‰çš„ autorelease å¯¹è±¡æœ€åéƒ½ä¼šè¢«å›æ”¶ï¼Œä¸ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p><p>â€‹    Cocoa æ¡†æ¶å¸Œæœ›ä»£ç èƒ½åœ¨ autoreleasepool å—å†…æ‰§è¡Œï¼Œå¦åˆ™ autorelease å¯¹è±¡å°†æ— æ³•è¢« é‡Šæ”¾ï¼Œä»è€Œå¯¼è‡´åº”ç”¨å‘ç”Ÿå†…å­˜æ³„æ¼ã€‚</p><p>AppKit å’Œ UIKit æ¡†æ¶å°†äº‹ä»¶ - å¾ªç¯çš„è¿­ä»£æ”¾å…¥äº† autoreleasepool å—ä¸­ã€‚å› æ­¤ï¼Œé€šå¸¸ ä¸éœ€è¦ä½ è‡ªå·±å†åˆ›å»º autoreleasepool å—äº†ã€‚</p><p>â€‹    åœ¨ä¸€äº›ç‰¹å®šæƒ…å†µä¸‹ï¼Œä½ å¾ˆå¯èƒ½æƒ³åˆ›å»ºè‡ªå·±çš„ autoreleasepool å—ï¼Œä¾‹å¦‚ä»¥ä¸‹è¿™äº›æƒ…å†µã€‚</p><ul><li><p>å½“ä½ æœ‰ä¸€ä¸ªåˆ›å»ºäº†å¾ˆå¤šä¸´æ—¶å¯¹è±¡çš„å¾ªç¯æ—¶<br> åœ¨å¾ªç¯ä¸­ä½¿ç”¨ autoreleasepool å—å¯ä»¥ä¸ºæ¯ä¸ªè¿­ä»£é‡Šæ”¾å†…å­˜ã€‚è™½ç„¶è¿­ä»£å‰åæœ€ç»ˆçš„å†…å­˜ ä½¿ç”¨ç›¸åŒï¼Œä½†ä½ çš„åº”ç”¨çš„æœ€å¤§å†…å­˜éœ€æ±‚å¯ä»¥å¤§å¤§é™ä½ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">@autoreleasepool &#123;</span><br><span class="line">    NSUInteger *userCount = userDatabase.userCount;</span><br><span class="line">    for(NSUInteger *i = 0; i &lt; userCount;     i++) &#123;</span><br><span class="line">        @autoreleasepool &#123;</span><br><span class="line">            Person *p = [userDatabase userAtIndex:i];</span><br><span class="line">            NSString *fname = p.fname;</span><br><span class="line">            if(fname == nil) &#123;</span><br><span class="line">                fname = [self askUserForFirstName];</span><br><span class="line">            &#125;</span><br><span class="line">            NSString *lname = p.lname;</span><br><span class="line">            if(lname == nil) &#123;</span><br><span class="line">                lname = [self askUserForLastName];</span><br><span class="line">            &#125;</span><br><span class="line">//...</span><br><span class="line">            [userDatabase updateUser:p];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>å½“ä½ åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ—¶</p><p>æ¯ä¸ªçº¿ç¨‹éƒ½å°†æœ‰å®ƒè‡ªå·±çš„ autoreleasepool å—æ ˆã€‚ä¸»çº¿ç¨‹ç”¨è‡ªå·±çš„ autoreleasepool å¯ åŠ¨ï¼Œå› ä¸ºå®ƒæ¥è‡ªç»Ÿä¸€ç”Ÿæˆçš„ä»£ç ã€‚ç„¶è€Œï¼Œå¯¹äºä»»ä½•è‡ªå®šä¹‰çš„çº¿ç¨‹ï¼Œä½ å¿…é¡»åˆ›å»ºè‡ªå·±çš„ autoreleasepoolã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-(void)myThreadStart:(id)obj &#123; </span><br><span class="line">@autoreleasepool &#123;</span><br><span class="line">//æ–°çº¿ç¨‹çš„ä»£ç  </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">//å…¶ä»–åœ°æ–¹ </span><br><span class="line">&#123;</span><br><span class="line">NSThread *myThread = [[NSThread alloc] initWithTarget:self selector:@selector(myThreadStart:) object:nil];</span><br><span class="line">[myThread start];</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="5-è‡ªåŠ¨å¼•ç”¨è®¡æ•°"><a href="#5-è‡ªåŠ¨å¼•ç”¨è®¡æ•°" class="headerlink" title="5. è‡ªåŠ¨å¼•ç”¨è®¡æ•°"></a>5. è‡ªåŠ¨å¼•ç”¨è®¡æ•°</h3><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gup6bioptfj610u0ew0tx02.jpg" alt="image-20210922100020465"></p><ul><li><p>ä¸èƒ½å®ç°æˆ–è°ƒç”¨ retainã€releaseã€autorelease æˆ– retainCount æ–¹æ³•ã€‚è¿™ä¸€é™åˆ¶ä¸ä»…é’ˆ å¯¹å¯¹è±¡ï¼Œå¯¹é€‰æ‹©å™¨åŒæ ·æœ‰æ•ˆã€‚å› æ­¤ï¼Œ[obj release]æˆ–@selector(retain)æ˜¯ç¼–è¯‘æ—¶çš„é”™è¯¯ã€‚</p></li><li><p>å¯ä»¥å®ç° dealloc æ–¹æ³•ï¼Œä½†ä¸èƒ½è°ƒç”¨å®ƒä»¬ã€‚ä¸ä»…ä¸èƒ½è°ƒç”¨å…¶ä»–å¯¹è±¡çš„ dealloc æ–¹æ³•ï¼Œä¹Ÿ ä¸èƒ½è°ƒç”¨è¶…ç±»ã€‚[super dealloc] æ˜¯ç¼–è¯‘æ—¶çš„é”™è¯¯ã€‚<br> ä½†ä½ ä»ç„¶å¯ä»¥å¯¹ Core Foundation ç±»å‹çš„å¯¹è±¡è°ƒç”¨ CFRetainã€CFRelease ç­‰ç›¸å…³æ–¹æ³•ã€‚</p></li><li><p>ä¸èƒ½è°ƒç”¨ NSAllocateObject å’Œ NSDeallocateObject æ–¹æ³•ã€‚åº”ä½¿ç”¨ alloc æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼Œ è¿è¡Œæ—¶è´Ÿè´£å›æ”¶å¯¹è±¡ã€‚</p></li><li><p>ä¸èƒ½åœ¨ C è¯­è¨€çš„ç»“æ„ä½“å†…ä½¿ç”¨å¯¹è±¡æŒ‡é’ˆã€‚</p></li><li><p>ä¸èƒ½åœ¨ id ç±»å‹å’Œ void * ç±»å‹ä¹‹é—´è‡ªåŠ¨è½¬æ¢ã€‚å¦‚æœéœ€è¦ï¼Œé‚£ä¹ˆä½ å¿…é¡»åšæ˜¾ç¤ºè½¬æ¢ã€‚</p></li><li><p>ä¸èƒ½ä½¿ç”¨ NSAutoreleasePoolï¼Œè¦æ›¿æ¢ä½¿ç”¨ autoreleasepool å—ã€‚</p></li><li><p>ä¸èƒ½ä½¿ç”¨ NSZone å†…å­˜åŒºåŸŸã€‚</p></li><li><p>å±æ€§çš„è®¿é—®å™¨åç§°ä¸èƒ½ä»¥ new å¼€å¤´ï¼Œä»¥ç¡®ä¿ä¸ MRC çš„äº’æ“ä½œæ€§ã€‚</p></li><li><p>è™½ç„¶æ€»çš„æ¥è¯´éœ€è¦é¿å…è®¸å¤šäº‹æƒ…ï¼Œä½†ä»ç„¶å¯ä»¥æ··åˆä½¿ç”¨ ARC å’Œ MRC ä»£ç ã€‚</p></li></ul><h3 id="6-å¼•ç”¨ç±»å‹"><a href="#6-å¼•ç”¨ç±»å‹" class="headerlink" title="6. å¼•ç”¨ç±»å‹"></a>6. å¼•ç”¨ç±»å‹</h3><ul><li><p>å¼ºå¼•ç”¨ </p><p>å¼ºå¼•ç”¨æ˜¯é»˜è®¤çš„å¼•ç”¨ç±»å‹ã€‚è¢«å¼ºå¼•ç”¨æŒ‡å‘çš„å†…å­˜ä¸ä¼šè¢«é‡Šæ”¾ã€‚å¼ºå¼•ç”¨ä¼šå¯¹å¼•ç”¨è®¡æ•°åŠ  1ï¼Œä»è€Œæ‰©å±•å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚</p></li><li><p>å¼±å¼•ç”¨ </p><p>å¼±å¼•ç”¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„å¼•ç”¨ç±»å‹ã€‚å®ƒä¸ä¼šå¢åŠ å¼•ç”¨è®¡æ•°ï¼Œå› è€Œä¸ä¼šæ‰©å±•å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚ åœ¨å¯ç”¨äº† ARC çš„ Objective-C ç¼–ç¨‹ä¸­ï¼Œå¼±å¼•ç”¨æ ¼å¤–é‡è¦ã€‚</p></li></ul><h4 id="6-1-å˜é‡é™å®šç¬¦"><a href="#6-1-å˜é‡é™å®šç¬¦" class="headerlink" title="6.1 å˜é‡é™å®šç¬¦"></a>6.1 å˜é‡é™å®šç¬¦</h4><p>ARC ä¸ºå˜é‡ä¾›äº†å››ç§ç”Ÿå‘½å‘¨æœŸé™å®šç¬¦ã€‚</p><ul><li><p>__strong</p><p>è¿™æ˜¯é»˜è®¤çš„é™å®šç¬¦ï¼Œæ— éœ€æ˜¾ç¤ºå¼•å…¥ã€‚åªè¦æœ‰å¼ºå¼•ç”¨æŒ‡å‘ï¼Œå¯¹è±¡å°±ä¼šé•¿æ—¶é—´é©»ç•™åœ¨å†…å­˜ ä¸­ã€‚å¯ä»¥å°† __strong ç†è§£ä¸º retain è°ƒç”¨çš„ ARC ç‰ˆæœ¬ã€‚</p></li><li><p>__weak</p><p>è¿™è¡¨æ˜å¼•ç”¨ä¸ä¼šä¿æŒè¢«å¼•ç”¨å¯¹è±¡çš„å­˜æ´»ã€‚å½“æ²¡æœ‰å¼ºå¼•ç”¨æŒ‡å‘å¯¹è±¡æ—¶ï¼Œå¼±å¼•ç”¨ä¼šè¢«ç½®ä¸º nilã€‚å¯å°†__weak çœ‹ä½œæ˜¯ assign æ“ä½œç¬¦çš„ ARC ç‰ˆæœ¬ï¼Œåªæ˜¯å¯¹è±¡è¢«å›æ”¶æ—¶ï¼Œ__weak å…·æœ‰ å®‰å…¨æ€§â€”â€”æŒ‡é’ˆå°†è‡ªåŠ¨è¢«è®¾ç½®ä¸º nilã€‚</p></li><li><p>__unsafe_unretained</p><p>ä¸ __weak ç±»ä¼¼ï¼Œåªæ˜¯å½“æ²¡æœ‰å¼ºå¼•ç”¨æŒ‡å‘å¯¹è±¡æ—¶ï¼Œ__unsafe_unretained ä¸ä¼šè¢«ç½®ä¸º nilã€‚ å¯å°†å…¶çœ‹ä½œ assign æ“ä½œç¬¦çš„ ARC ç‰ˆæœ¬ã€‚</p></li><li><p>__autoreleasing</p><p>__autoreleasingç”¨äºç”±å¼•ç”¨ä½¿ç”¨id *ä¼ é€’çš„æ¶ˆæ¯å‚æ•°ã€‚å®ƒé¢„æœŸäº†autoreleaseæ–¹æ³•ä¼š åœ¨ä¼ é€’å‚æ•°çš„æ–¹æ³•ä¸­è¢«è°ƒç”¨ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// åˆ›å»ºå¯¹è±¡åå¼•ç”¨è®¡æ•°ä¸º 1ï¼Œå¹¶ä¸”å¯¹è±¡åœ¨ p1 å¼•ç”¨æœŸé—´ä¸ä¼šè¢«å›æ”¶ã€‚</span><br><span class="line">Person * __strong p1 = [[Person alloc] init]; </span><br><span class="line">// åˆ›å»ºå¯¹è±¡åå¼•ç”¨è®¡æ•°ä¸º 0ï¼Œå¯¹è±¡ä¼šè¢«ç«‹å³é‡Šæ”¾ï¼Œä¸” p2 å°†è¢«è®¾ç½®ä¸º nilã€‚</span><br><span class="line">Person * __weak p2 = [[Person alloc] init]; </span><br><span class="line">// åˆ›å»ºå¯¹è±¡åå¼•ç”¨è®¡æ•°ä¸º 1ï¼Œå¯¹è±¡ä¼šè¢«ç«‹å³é‡Šæ”¾ï¼Œä½† p3 ä¸ä¼šè¢«è®¾ç½®ä¸º nilã€‚</span><br><span class="line">Person * __unsafe_unretained p3 = [[Person alloc] init]; </span><br><span class="line">// åˆ›å»ºå¯¹è±¡åå¼•ç”¨è®¡æ•°ä¸º 1ï¼Œå½“æ–¹æ³•è¿”å›æ—¶å¯¹è±¡ä¼šè¢«ç«‹å³é‡Šæ”¾ã€‚</span><br><span class="line">Person * __autoreleasing p4 = [[Person alloc] init];</span><br></pre></td></tr></table></figure><h4 id="6-2-å±æ€§é™å®šç¬¦"><a href="#6-2-å±æ€§é™å®šç¬¦" class="headerlink" title="6.2 å±æ€§é™å®šç¬¦"></a>6.2 å±æ€§é™å®šç¬¦</h4><ul><li><p><code>strong</code></p><p>é»˜è®¤ç¬¦ï¼ŒæŒ‡å®šäº†__strongå…³ç³»</p></li><li><p><code>weak</code></p><p>æŒ‡å®šäº†__weakå…³ç³»</p></li><li><p><code>assign</code></p></li><li><p><code>copy</code></p><p>æš—æŒ‡äº† __strong å…³ç³»ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜æš—ç¤ºäº† setter ä¸­çš„å¤åˆ¶è¯­ä¹‰</p></li><li><p><code>retain</code></p><p>æŒ‡å®šäº† __strong å…³ç³»ã€‚</p></li><li><p><code>unsafe_unretained</code></p><p>æŒ‡å®šäº† __unsafe_unretained å…³ç³»ã€‚</p></li></ul><h3 id="7-åƒµå°¸å¯¹è±¡"><a href="#7-åƒµå°¸å¯¹è±¡" class="headerlink" title="7. åƒµå°¸å¯¹è±¡"></a>7. åƒµå°¸å¯¹è±¡</h3><p>â€‹    åƒµå°¸å¯¹è±¡æ˜¯ç”¨äºæ•æ‰å†…å­˜é”™è¯¯çš„è°ƒè¯•åŠŸèƒ½ã€‚</p><p>â€‹    é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“å¼•ç”¨è®¡æ•°é™ä¸º 0 æ—¶å¯¹è±¡ä¼šç«‹å³è¢«é‡Šæ”¾ï¼Œä½†è¿™ä½¿å¾—è°ƒè¯•å˜å¾—å›°éš¾ã€‚å¦‚æœå¼€å¯ äº†åƒµå°¸å¯¹è±¡ï¼Œé‚£ä¹ˆå¯¹è±¡å°±ä¸ä¼šç«‹å³é‡Šæ”¾å†…å­˜ï¼Œè€Œæ˜¯è¢«æ ‡è®°ä¸ºåƒµå°¸ã€‚ä»»ä½•è¯•å›¾å¯¹å…¶è¿›è¡Œè®¿ é—®çš„è¡Œä¸ºéƒ½ä¼šè¢«æ—¥å¿—è®°å½•ï¼Œå› è€Œä½ å¯ä»¥åœ¨å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸä¸­è·Ÿè¸ªå¯¹è±¡åœ¨ä»£ç ä¸­è¢«ä½¿ç”¨çš„ ä½ç½®ã€‚</p><p>â€‹    NSZombieEnabled æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œå¯ä»¥æ§åˆ¶ Core Foundation çš„è¿è¡Œæ—¶æ˜¯å¦å°†ä½¿ç”¨åƒµå°¸å¯¹ è±¡ã€‚ä¸åº”é•¿æœŸä¿ç•™ NSZombieEnabledï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹ä¸ä¼šæœ‰å¯¹è±¡è¢«çœŸæ­£ææ„ï¼Œè¿™ä¼šå¯¼è‡´åº” ç”¨ä½¿ç”¨å¤§é‡çš„å†…å­˜ã€‚ç‰¹åˆ«è¯´æ˜ä¸€ç‚¹ï¼Œåœ¨å‘å¸ƒçš„æ„å»ºåŒ…ä¸­ä¸€å®šè¦ç¦ç”¨ NSZombieEnabledã€‚</p><p>â€‹    è¦æƒ³è®¾ç½® NSZombieEnabled ç¯å¢ƒå˜é‡ï¼Œéœ€è¦è¿›å…¥ Product â†’ Scheme â†’ Edit Schemeã€‚é€‰æ‹© å·¦ä¾§çš„ Runï¼Œç„¶ååœ¨å³ä¾§é€‰å– Diagnostics æ ‡ç­¾é¡µã€‚é€‰ä¸­ Enable Zombie Objects é€‰é¡¹ã€‚</p></li></ul></li></ul><hr><blockquote><p><strong>ä¸ªäººåšå®¢:</strong> ğŸ¡ <a href="https://forgetsou.github.io/">ForgetSou</a></p></blockquote><hr>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/008i3skNly1gu6ymntbv1j60ku0kzmza02.jpg&quot; alt=&quot;image.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;ä¸€-ç®€è¿°&quot;&gt;&lt;a href=&quot;#ä¸€-ç®€è¿°&quot; class=&quot;headerlink&quot; title=&quot;ä¸€. ç®€è¿°&quot;&gt;&lt;/a&gt;ä¸€. ç®€è¿°&lt;/h2&gt;&lt;p&gt;â€‹    æ‰‹æœºçš„å†…å­˜èµ„æºæ˜¯éå¸¸æœ‰é™çš„ï¼Œå¦‚æœä¸€ä¸ªåº”ç”¨çš„å†…å­˜ä½¿ç”¨é‡è¶…è¿‡äº†å•ä¸ªè¿›ç¨‹çš„ä¸Šé™ï¼Œå°±ä¼šè¢«æ“ä½œç³»ç»Ÿç»ˆæ­¢ä½¿ç”¨ï¼Œæ­£å¼è¿™ä¸ªåŸå› ï¼Œå†…å­˜ç®¡ç†åœ¨iOSä¸­æ‰®æ¼”ç€æ ¸å¿ƒçš„è§’è‰²ã€‚&lt;br&gt;â€‹    ä¸(åŸºäºåƒåœ¾å›æ”¶çš„)Java è¿è¡Œæ—¶ä¸åŒï¼ŒObjective-C å’Œ Swift çš„ iOS è¿è¡Œæ—¶ä½¿ç”¨å¼•ç”¨è®¡æ•°ã€‚ ä½¿ç”¨å¼•ç”¨è®¡æ•°çš„è´Ÿé¢å½±å“åœ¨äºï¼Œå¦‚æœå¼€å‘äººå‘˜ä¸å¤Ÿå°å¿ƒï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå‡ºç°é‡å¤çš„å†…å­˜é‡Šæ”¾ å’Œå¾ªç¯å¼•ç”¨çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;h3 id=&quot;1-å†…å­˜æ¶ˆè€—&quot;&gt;&lt;a href=&quot;#1-å†…å­˜æ¶ˆè€—&quot; class=&quot;headerlink&quot; title=&quot;1.å†…å­˜æ¶ˆè€—&quot;&gt;&lt;/a&gt;1.å†…å­˜æ¶ˆè€—&lt;/h3&gt;&lt;p&gt;â€‹    å†…å­˜æ¶ˆè€—æŒ‡çš„æ˜¯åº”ç”¨æ¶ˆè€—çš„ RAMã€‚åº”ç”¨ä¸­çš„å†…å­˜æ¶ˆè€—åˆ†ä¸ºä¸¤éƒ¨åˆ†:æ ˆå¤§å°å’Œå †å¤§å°ã€‚&lt;/p&gt;
&lt;h4 id=&quot;1-1-æ ˆå¤§å°&quot;&gt;&lt;a href=&quot;#1-1-æ ˆå¤§å°&quot; class=&quot;headerlink&quot; title=&quot;1.1 æ ˆå¤§å°&quot;&gt;&lt;/a&gt;1.1 æ ˆå¤§å°&lt;/h4&gt;&lt;p&gt;â€‹    å¯è¢«é€’å½’è°ƒç”¨çš„æœ€å¤§æ–¹æ³•æ•°&lt;br&gt;â€‹    æ¯ä¸ªæ–¹æ³•éƒ½æœ‰å…¶è‡ªå·±çš„æ ˆå¸§ï¼Œå¹¶ä¼šæ¶ˆè€—æ•´ä½“çš„æ ˆç©ºé—´ã€‚å¦‚æœä½ è°ƒ ç”¨ mainï¼Œé‚£ä¹ˆ main å°†è°ƒç”¨ method1ï¼Œè€Œ method1 åˆå°†è°ƒç”¨ method2ï¼Œè¿™å°±å­˜åœ¨ä¸‰ä¸ªæ ˆå¸§ äº†ï¼Œä¸”æ¯ä¸ªæ ˆå¸§éƒ½ä¼šæ¶ˆè€—ä¸€å®šå­—èŠ‚çš„å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;â€‹    ä¸€ä¸ªæ–¹æ³•ä¸­æœ€å¤šå¯ä»¥ä½¿ç”¨çš„å˜é‡ä¸ªæ•°&lt;br&gt;â€‹    è§†å›¾å±‚çº§ä¸­å¯ä»¥åµŒå…¥çš„æœ€å¤§è§†å›¾æ·±åº¦&lt;br&gt;â€‹    æ¸²æŸ“å¤åˆè§†å›¾å°†åœ¨æ•´ä¸ªè§†å›¾å±‚çº§æ ‘ä¸­é€’å½’åœ°è°ƒç”¨ layoutSubViews å’Œ drawRect æ–¹æ³•ã€‚å¦‚ æœå±‚çº§è¿‡æ·±ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ ˆæº¢å‡ºã€‚&lt;/p&gt;
&lt;h4 id=&quot;1-2-å †å¤§å°&quot;&gt;&lt;a href=&quot;#1-2-å †å¤§å°&quot; class=&quot;headerlink&quot; title=&quot;1.2 å †å¤§å°&quot;&gt;&lt;/a&gt;1.2 å †å¤§å°&lt;/h4&gt;&lt;p&gt;â€‹    æ¯ä¸ªè¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹å…±äº«åŒä¸€ä¸ªå †ã€‚ä¸€ä¸ªåº”ç”¨å¯ä»¥ä½¿ç”¨çš„å †å¤§å°é€šå¸¸è¿œè¿œå°äºè®¾å¤‡çš„ RAM å€¼ã€‚ä¾‹å¦‚ï¼ŒiPhone 5S æ‹¥æœ‰å¤§çº¦ 1GB çš„ RAMï¼Œä½†åˆ†é…ç»™ä¸€ä¸ªåº”ç”¨çš„å †å¤§å°æœ€å¤šä¸åˆ° 512MBã€‚åº”ç”¨å¹¶ä¸èƒ½æ§åˆ¶åˆ†é…ç»™å®ƒçš„å †ã€‚åªæœ‰æ“ä½œç³»ç»Ÿæ‰èƒ½ç®¡ç†å †ã€‚&lt;br&gt;â€‹    ä½¿ç”¨ NSStringã€è½½å…¥å›¾ç‰‡ã€åˆ›å»ºæˆ–ä½¿ç”¨ JSON/XML æ•°æ®ã€ä½¿ç”¨è§†å›¾ç­‰éƒ½ä¼šæ¶ˆè€—å¤§é‡çš„å † å†…å­˜ã€‚å¦‚æœä½ çš„åº”ç”¨å¤§é‡ä½¿ç”¨å›¾ç‰‡(ä¸ Flickr å’Œ Instagram åº”ç”¨ç±»ä¼¼)ï¼Œé‚£ä¹ˆä½ éœ€è¦æ ¼å¤–å…³ æ³¨å¹³å‡å€¼å’Œå³°å€¼å†…å­˜ä½¿ç”¨çš„æœ€å°åŒ–ã€‚&lt;br&gt;â€‹    didReceiveMemoryWarning&lt;br&gt;â€‹    å»ºè®®ä½¿ç”¨é‡ä¸è¦è¶…è¿‡ 80%~85%ï¼Œè¦ç»™æ“ä½œç³»ç»Ÿçš„æ ¸ å¿ƒæœåŠ¡ç•™ä¸‹è¶³å¤Ÿå¤šçš„å†…å­˜ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="è¯»ä¹¦ç¬”è®°" scheme="https://forgetsou.github.io/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="è¯»ä¹¦ç¬”è®°" scheme="https://forgetsou.github.io/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
    <category term="ã€Šé«˜æ€§èƒ½iOSåº”ç”¨å¼€å‘ã€‹" scheme="https://forgetsou.github.io/tags/%E3%80%8A%E9%AB%98%E6%80%A7%E8%83%BDiOS%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E3%80%8B/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨Macç»ˆç«¯ä¸Šä½¿ç”¨Minicomè¿›è¡Œä¸²å£è°ƒè¯•</title>
    <link href="https://forgetsou.github.io/2021/08/19/%E5%9C%A8Mac%E7%BB%88%E7%AB%AF%E4%B8%8A%E4%BD%BF%E7%94%A8Minicom%E8%BF%9B%E8%A1%8C%E4%B8%B2%E5%8F%A3%E8%B0%83%E8%AF%95/"/>
    <id>https://forgetsou.github.io/2021/08/19/%E5%9C%A8Mac%E7%BB%88%E7%AB%AF%E4%B8%8A%E4%BD%BF%E7%94%A8Minicom%E8%BF%9B%E8%A1%8C%E4%B8%B2%E5%8F%A3%E8%B0%83%E8%AF%95/</id>
    <published>2021-08-19T05:40:35.000Z</published>
    <updated>2021-08-19T05:45:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>â€‹    æœ€è¿‘åœ¨å‡çº§é£æœºçš„<code>SDR</code>å›ºä»¶ï¼Œéœ€è¦ä½¿ç”¨<code>USB</code>ä¸²å£è¿›è¡Œå‡çº§ï¼Œå°±è®°å½•ä¸‹ä½¿ç”¨<code>Minicom</code> <code>USB</code>ä¸²å£å‡çº§å›ºä»¶çš„æ–¹å¼ã€‚</p><p>â€‹    minicomæ˜¯ä¸€ä¸ª<a href="https://baike.baidu.com/item/%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1/3775296">ä¸²å£é€šä¿¡</a>å·¥å…·ï¼Œå°±åƒWindowsä¸‹çš„<a href="https://baike.baidu.com/item/%E8%B6%85%E7%BA%A7%E7%BB%88%E7%AB%AF/1702227">è¶…çº§ç»ˆç«¯</a>ã€‚å¯ç”¨æ¥ä¸ä¸²å£è®¾å¤‡é€šä¿¡ï¼Œå¦‚è°ƒè¯•äº¤æ¢æœºå’ŒModemç­‰ã€‚å®ƒçš„<a href="https://baike.baidu.com/item/Debian/748667">Debian</a>è½¯ä»¶åŒ…çš„åç§°å°±å«minicomã€‚</p><h3 id="1-minicomçš„å®‰è£…"><a href="#1-minicomçš„å®‰è£…" class="headerlink" title="1. minicomçš„å®‰è£…"></a>1. <code>minicom</code>çš„å®‰è£…</h3><p><code>brew</code> å®‰è£…</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">$ brew install minicom</span><br></pre></td></tr></table></figure><p><em>åœ¨å®‰è£…è¿‡ç¨‹ä¸­æŠ¥é”™</em></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">Running Homebrew as root is extremely dangerous <span class="keyword">and</span> no longer supported.</span><br><span class="line">As Homebrew does <span class="keyword">not</span> drop privileges on installation you would be giving all</span><br><span class="line">build scripts full access to your system.</span><br></pre></td></tr></table></figure><p>â€‹    ä»¥æ ¹ç”¨æˆ·èº«ä»½è¿è¡Œè‡ªåˆ¶ç¨‹åºéå¸¸å±é™©ï¼Œä¸å†å—æ”¯æŒã€‚<br>â€‹    ç”±äºHomebrewä¸ä¼šæ”¾å¼ƒå®‰è£…æƒé™ï¼Œå› æ­¤æ‚¨å°†æˆäºˆæ‰€æœ‰ç”Ÿæˆè„šæœ¬å¯¹ç³»ç»Ÿçš„å®Œå…¨è®¿é—®æƒé™ã€‚</p><p>è§£å†³æ–¹æ¡ˆ:</p><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ sudo chown -R `whoami` <span class="regexp">/usr/</span>local<span class="regexp">/Homebrew/</span></span><br><span class="line">$ sudo chown -R $(whoami) $(brew --prefix)/*</span><br><span class="line">$ sudo mkdir <span class="regexp">/usr/</span>local/Frameworks</span><br><span class="line">$ sudo chown -R `whoami` <span class="regexp">/usr/</span>local<span class="regexp">/Frameworks/</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨ï¼š**</strong>ä¸è¦ä½¿ç”¨ <code>sudo brew install</code> å®‰è£…**</p><p>å®‰è£…å®Œ<code>minicom</code>åï¼Œä½¿ç”¨<code>minicom s</code>æ¥é…ç½®<code>minicom</code></p><h3 id="2-minicomçš„é…ç½®"><a href="#2-minicomçš„é…ç½®" class="headerlink" title="2. minicomçš„é…ç½®"></a>2. <code>minicom</code>çš„é…ç½®</h3><ul><li><p>è¿è¡Œ<code>minicom s</code></p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gtm70mpli0j60g20e2dgu02.jpg" alt="image-20210819164728129"></p></li><li><p>æŒ‰â†“é€‰æ‹©<code>Serial port setup</code>ï¼Œå¹¶æŒ‰Enterè¿›å…¥</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gtm71ofzp7j60um0jwdir02.jpg" alt="image-20210819164830836"></p></li><li><p>è¾“å…¥Aé€‰æ‹©<code>Serial Device</code>ä¿®æ”¹ä¸ºè‡ªå·±è¦è¿çš„<code>USB</code>åç§°ï¼ŒæŒ‰Enterå®Œæˆä¿®æ”¹</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gtm74cj61nj60uq0kgn0902.jpg" alt="image-20210819165104774"></p></li><li><p>æŒ‰Eå¯ä¿®æ”¹æ³¢ç‰¹ç‡ç­‰å‚æ•°</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gtm799gxjdj60ug0kujuq02.jpg" alt="image-20210819165548179"></p></li><li><p>å®Œæˆåï¼Œé€‰æ‹©<code>Save setup as dfl</code>ä¿å­˜é…ç½®ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gtm7an1s15j60dc0di0tq02.jpg" alt="image-20210819165707254"></p></li><li><p>ä¿å­˜åæŒ‰<code>Exit</code>é€€å‡ºå³å¯ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gtm7c1hzo9j60dc0d43zi02.jpg" alt="image-20210819165828821"></p></li><li><p>ä¸‹æ¬¡ä½¿ç”¨ç›´æ¥ä½¿ç”¨å‘½ä»¤<code>minicom</code>å³å¯ã€‚</p></li></ul><h3 id="3-minicomçš„ç®€å•ä½¿ç”¨"><a href="#3-minicomçš„ç®€å•ä½¿ç”¨" class="headerlink" title="3. minicomçš„ç®€å•ä½¿ç”¨"></a>3. <code>minicom</code>çš„ç®€å•ä½¿ç”¨</h3><p>ä½¿ç”¨ä¸²å£çº¿<code>USB</code>å£è¿æ¥<code>Mac</code>ï¼Œä¸€ç«¯è¿æ¥ç¡¬ä»¶ã€‚</p><p>åœ¨å‘½ä»¤è¡Œè¾“å…¥<code>sudo minicom</code>ï¼Œå›è½¦ï¼Œå¦‚æœå‡ºç°<code>minicom: cannot open /dev/tty.usbserial-1420: No such file or directory</code>è¯´æ˜<code>USB</code>æ²¡æœ‰è¿æ¥å¥½ã€‚</p><p>ä¹‹åè¾“å…¥å‘½ä»¤å‡çº§SDå¡ä¸­è¦å‡çº§çš„å›ºä»¶ï¼Œå¦‚ï¼š</p><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cp <span class="regexp">/tmp/</span>sd<span class="regexp">/usb_hotplugin ./</span>;chmod a+x usb_hotplugin;killall daemon.sh;killall usb_hotplugin;sleep <span class="number">2</span>;.<span class="regexp">/usb_hotplugin ar8020_usb_cmd 7-0 /</span>tmp<span class="regexp">/sd/</span>V1.<span class="number">0.0</span>.bin</span><br></pre></td></tr></table></figure><hr><blockquote><p><strong>ä¸ªäººåšå®¢:</strong> ğŸ¡ <a href="https://forgetsou.github.io/">ForgetSou</a></p></blockquote><hr>]]></content>
    
    
    <summary type="html">&lt;p&gt;â€‹    æœ€è¿‘åœ¨å‡çº§é£æœºçš„&lt;code&gt;SDR&lt;/code&gt;å›ºä»¶ï¼Œéœ€è¦ä½¿ç”¨&lt;code&gt;USB&lt;/code&gt;ä¸²å£è¿›è¡Œå‡çº§ï¼Œå°±è®°å½•ä¸‹ä½¿ç”¨&lt;code&gt;Minicom&lt;/code&gt; &lt;code&gt;USB&lt;/code&gt;ä¸²å£å‡çº§å›ºä»¶çš„æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;â€‹    minicomæ˜¯ä¸€ä¸ª&lt;a href=&quot;https://baike.baidu.com/item/%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1/3775296&quot;&gt;ä¸²å£é€šä¿¡&lt;/a&gt;å·¥å…·ï¼Œå°±åƒWindowsä¸‹çš„&lt;a href=&quot;https://baike.baidu.com/item/%E8%B6%85%E7%BA%A7%E7%BB%88%E7%AB%AF/1702227&quot;&gt;è¶…çº§ç»ˆç«¯&lt;/a&gt;ã€‚å¯ç”¨æ¥ä¸ä¸²å£è®¾å¤‡é€šä¿¡ï¼Œå¦‚è°ƒè¯•äº¤æ¢æœºå’ŒModemç­‰ã€‚å®ƒçš„&lt;a href=&quot;https://baike.baidu.com/item/Debian/748667&quot;&gt;Debian&lt;/a&gt;è½¯ä»¶åŒ…çš„åç§°å°±å«minicomã€‚&lt;/p&gt;
&lt;h3 id=&quot;1-minicomçš„å®‰è£…&quot;&gt;&lt;a href=&quot;#1-minicomçš„å®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;1. minicomçš„å®‰è£…&quot;&gt;&lt;/a&gt;1. &lt;code&gt;minicom&lt;/code&gt;çš„å®‰è£…&lt;/h3&gt;&lt;p&gt;&lt;code&gt;brew&lt;/code&gt; å®‰è£…&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ brew install minicom&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;em&gt;åœ¨å®‰è£…è¿‡ç¨‹ä¸­æŠ¥é”™&lt;/em&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Running Homebrew as root is extremely dangerous &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; no longer supported.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;As Homebrew does &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; drop privileges on installation you would be giving all&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;build scripts full access to your system.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;â€‹    ä»¥æ ¹ç”¨æˆ·èº«ä»½è¿è¡Œè‡ªåˆ¶ç¨‹åºéå¸¸å±é™©ï¼Œä¸å†å—æ”¯æŒã€‚&lt;br&gt;â€‹    ç”±äºHomebrewä¸ä¼šæ”¾å¼ƒå®‰è£…æƒé™ï¼Œå› æ­¤æ‚¨å°†æˆäºˆæ‰€æœ‰ç”Ÿæˆè„šæœ¬å¯¹ç³»ç»Ÿçš„å®Œå…¨è®¿é—®æƒé™ã€‚&lt;/p&gt;
&lt;p&gt;è§£å†³æ–¹æ¡ˆ:&lt;/p&gt;
&lt;figure class=&quot;highlight awk&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ sudo chown -R `whoami` &lt;span class=&quot;regexp&quot;&gt;/usr/&lt;/span&gt;local&lt;span class=&quot;regexp&quot;&gt;/Homebrew/&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ sudo chown -R $(whoami) $(brew --prefix)/*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ sudo mkdir &lt;span class=&quot;regexp&quot;&gt;/usr/&lt;/span&gt;local/Frameworks&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ sudo chown -R `whoami` &lt;span class=&quot;regexp&quot;&gt;/usr/&lt;/span&gt;local&lt;span class=&quot;regexp&quot;&gt;/Frameworks/&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="Other" scheme="https://forgetsou.github.io/categories/Other/"/>
    
    
    <category term="å·¥å…·" scheme="https://forgetsou.github.io/tags/%E5%B7%A5%E5%85%B7/"/>
    
    <category term="ä¸²å£" scheme="https://forgetsou.github.io/tags/%E4%B8%B2%E5%8F%A3/"/>
    
    <category term="Mac" scheme="https://forgetsou.github.io/tags/Mac/"/>
    
    <category term="å‘½ä»¤è¡Œ" scheme="https://forgetsou.github.io/tags/%E5%91%BD%E4%BB%A4%E8%A1%8C/"/>
    
  </entry>
  
  <entry>
    <title>ğŸ“šã€Šé«˜æ€§èƒ½iOSåº”ç”¨å¼€å‘ã€‹-ç§»åŠ¨ç«¯æ€§èƒ½</title>
    <link href="https://forgetsou.github.io/2021/08/11/%F0%9F%93%9A%E3%80%8A%E9%AB%98%E6%80%A7%E8%83%BDiOS%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E3%80%8B-%E7%A7%BB%E5%8A%A8%E7%AB%AF%E6%80%A7%E8%83%BD/"/>
    <id>https://forgetsou.github.io/2021/08/11/%F0%9F%93%9A%E3%80%8A%E9%AB%98%E6%80%A7%E8%83%BDiOS%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E3%80%8B-%E7%A7%BB%E5%8A%A8%E7%AB%AF%E6%80%A7%E8%83%BD/</id>
    <published>2021-08-11T09:49:42.000Z</published>
    <updated>2021-08-11T09:49:42.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1. ç®€ä»‹"></a>1. ç®€ä»‹</h1><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gtczx6o8frj60u00u742m02.jpg" alt="img"></p><h1 id="2-æ€§èƒ½æŒ‡æ ‡"><a href="#2-æ€§èƒ½æŒ‡æ ‡" class="headerlink" title="2. æ€§èƒ½æŒ‡æ ‡"></a>2. æ€§èƒ½æŒ‡æ ‡</h1><p>æ€§èƒ½æŒ‡æ ‡æ˜¯é¢å‘ç”¨æˆ·çš„å„ç§å±æ€§ã€‚æ¯ä¸ªæŒ‡æ ‡å¯èƒ½æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªå¯æµ‹é‡å·¥ç¨‹å‚æ•°çš„ä¸€ä¸ªè¦ç´ ã€‚</p><h3 id="2-1-å†…å­˜"><a href="#2-1-å†…å­˜" class="headerlink" title="2.1 å†…å­˜"></a>2.1 å†…å­˜</h3><p>å†…å­˜æ¶‰åŠè¿è¡Œåº”ç”¨æ‰€éœ€çš„ RAM æœ€å°å€¼ï¼Œä»¥åŠåº”ç”¨æ¶ˆè€—çš„å†…å­˜å¹³å‡å€¼å’Œå³°å€¼ã€‚æœ€å°å†…å­˜å€¼ï¼Œä¼šä¸¥é‡é™åˆ¶ç¡¬ä»¶ï¼Œè€Œæ›´é«˜çš„å†…å­˜å¹³å‡å€¼å’Œå³°å€¼æ„å‘³ç€æ›´å¤šçš„åå°åº”ç”¨ä¼šè¢«å¼ºåˆ¶å…³é—­ã€‚</p><p>åŒæ—¶è¿˜è¦ç¡®ä¿æ²¡æœ‰æ³„æ¼å†…å­˜ã€‚éšæ—¶é—´æµé€è€ŒæŒç»­å¢é•¿çš„å†…å­˜æ¶ˆè€—æ„å‘³ç€ï¼Œåº”ç”¨å¾ˆå¯èƒ½ä¼šå›  ä¸ºå†…å­˜ä¸è¶³çš„å¼‚å¸¸è€Œå´©æºƒã€‚ </p><h3 id="2-2-ç”µé‡æ¶ˆè€—"><a href="#2-2-ç”µé‡æ¶ˆè€—" class="headerlink" title="2.2 ç”µé‡æ¶ˆè€—"></a>2.2 ç”µé‡æ¶ˆè€—</h3><p>åœ¨ç¼–å†™é«˜æ€§èƒ½ä»£ç æ—¶ï¼Œç”µé‡æ¶ˆè€—æ˜¯ä¸€ä¸ªéœ€è¦é‡ç‚¹å¤„ç†çš„é‡è¦å› ç´ ã€‚å°±æ‰§è¡Œæ—¶é—´å’Œ CPU èµ„ æºçš„åˆ©ç”¨è€Œè¨€ï¼Œæˆ‘ä»¬ä¸ä»…è¦å®ç°é«˜æ•ˆçš„æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œè¿˜éœ€è¦è€ƒè™‘å…¶ä»–çš„å› ç´ ã€‚å¦‚æœæŸ ä¸ªåº”ç”¨æ˜¯ä¸ªç”µæ± é»‘æ´ï¼Œé‚£ä¹ˆä¸€å®šä¸ä¼šæœ‰äººå–œæ¬¢å®ƒã€‚ </p><p>ç”µé‡æ¶ˆè€—ä¸ä»…ä»…ä¸è®¡ç®— CPU å‘¨æœŸæœ‰å…³ï¼Œè¿˜åŒ…æ‹¬é«˜æ•ˆåœ°ä½¿ç”¨ç¡¬ä»¶ã€‚é™¤äº†è¦å®ç°ç”µé‡æ¶ˆè€—æœ€ å°åŒ–ï¼Œè¿˜è¦ç¡®ä¿ä¸ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚ </p><h3 id="2-3-åˆå§‹åŒ–æ—¶é—´"><a href="#2-3-åˆå§‹åŒ–æ—¶é—´" class="headerlink" title="2.3 åˆå§‹åŒ–æ—¶é—´"></a>2.3 åˆå§‹åŒ–æ—¶é—´</h3><p>åº”ç”¨åœ¨å¯åŠ¨æ—¶åº”æ‰§è¡Œåˆšå¥½å¤Ÿç”¨çš„ä»»åŠ¡ä»¥å®Œæˆåˆå§‹åŒ–ï¼Œä»è€Œæ»¡è¶³ç”¨æˆ·çš„ä½¿ç”¨éœ€æ±‚ã€‚æ‰§è¡Œè¿™äº› ä»»åŠ¡æ¶ˆè€—çš„æ—¶é—´å°±æ˜¯åº”ç”¨çš„åˆå§‹åŒ–æ—¶é—´ã€‚åˆšå¥½å¤Ÿç”¨æ˜¯ä¸€ä¸ªå¼€æ”¾å¼ç”¨è¯­â€”â€”æ­£ç¡®çš„å¹³è¡¡ç‚¹å– å†³äºåº”ç”¨çš„éœ€è¦ã€‚ </p><p>åœ¨é¦–æ¬¡ä½¿ç”¨åº”ç”¨æ—¶åˆ›å»ºå¯¹è±¡å¹¶è¿›è¡Œåˆå§‹åŒ–æ˜¯ä¸€ä¸ªåˆç†çš„é€‰æ‹©ï¼Œä¾‹å¦‚ï¼Œç›´åˆ°éœ€è¦ä½¿ç”¨å¯¹è±¡æ—¶ æ‰åˆ›å»ºå¯¹è±¡ã€‚è¿™ç§æ–¹å¼è¢«ç§°ä¸ºæƒ°æ€§åˆå§‹åŒ–ã€‚è¿™æ˜¯ä¸€ç§å¾ˆå¥½çš„ç­–ç•¥ï¼Œä½†ä¹Ÿè¦è€ƒè™‘ä¸èƒ½è®©ç”¨æˆ· æ€»æ˜¯åœ¨æ‰§è¡Œåç»­ä»»åŠ¡æ—¶ç­‰å¾…ã€‚ </p><p>ä¸‹é¢åˆ—ä¸¾äº†ä½ å¯èƒ½æƒ³åœ¨åº”ç”¨åˆå§‹åŒ–é˜¶æ®µæ‰§è¡Œçš„ä¸€äº›åŠ¨ä½œï¼Œæ’åä¸åˆ†å…ˆåã€‚             </p><ul><li><p>æ£€æŸ¥åº”ç”¨æ˜¯å¦ä¸ºé¦–æ¬¡å¯åŠ¨ã€‚</p></li><li><p>æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç»ç™»å½•ã€‚</p></li><li><p>å¦‚æœç”¨æˆ·å·²ç»ç™»å½•ï¼Œå°½å¯èƒ½åœ°è½½å…¥ä¹‹å‰çš„çŠ¶æ€ã€‚ </p></li><li><p>è¿æ¥æœåŠ¡å™¨ä»¥æ‹‰å–æœ€æ–°çš„å˜æ›´ã€‚ </p></li><li><p>æ£€æŸ¥åº”ç”¨æ˜¯å¦ç”±æŸä¸ªæ·±å±‚é“¾æ¥å”¤èµ·ã€‚å¦‚æœæ˜¯ï¼Œè¿˜éœ€è¦è½½å…¥æ·±å±‚é“¾æ¥ç›¸åº”çš„ UI å’ŒçŠ¶æ€ã€‚ </p></li><li><p>æ£€æŸ¥æ˜¯å¦å­˜åœ¨åº”ç”¨ä¸Šæ¬¡å¯åŠ¨æ—¶æŒ‚èµ·çš„ä»»åŠ¡ï¼Œéœ€è¦æ—¶æ¢å¤å®ƒä»¬ã€‚</p></li><li><p>åˆå§‹åŒ–åç»­éœ€è¦ä½¿ç”¨çš„å¯¹è±¡å’Œçº¿ç¨‹æ± ã€‚</p></li><li><p>åˆå§‹åŒ–ä¾èµ–é¡¹(å¦‚å¯¹è±¡å…³ç³»æ˜ å°„ã€å´©æºƒæŠ¥å‘Šç³»ç»Ÿå’Œç¼“å­˜)ã€‚ </p></li></ul><h3 id="2-4-æ‰§è¡Œé€Ÿåº¦"><a href="#2-4-æ‰§è¡Œé€Ÿåº¦" class="headerlink" title="2.4 æ‰§è¡Œé€Ÿåº¦"></a>2.4 æ‰§è¡Œé€Ÿåº¦</h3><p>ä¸€æ—¦å¯åŠ¨åº”ç”¨ï¼Œç”¨æˆ·æ€»æ˜¯å¸Œæœ›å®ƒå¯ä»¥å°½å¯èƒ½å¿«åœ°å·¥ä½œã€‚ä¸€åˆ‡å¿…è¦çš„å¤„ç†éƒ½åº”è¯¥åœ¨å°½å¯èƒ½çŸ­ çš„æ—¶é—´å†…å®Œæˆã€‚ </p><p>ä¾‹å¦‚ï¼Œåœ¨ç…§ç‰‡åº”ç”¨ä¸­ï¼Œç”¨æˆ·é€šå¸¸å¸Œæœ›çœ‹åˆ°è°ƒæ•´äº®åº¦æˆ–å¯¹æ¯”åº¦ç­‰ç®€å•æ•ˆæœçš„å®æ—¶é¢„è§ˆæ•ˆæœã€‚ å› æ­¤ï¼Œç›¸åº”çš„å¤„ç†éœ€è¦åœ¨å‡ æ¯«ç§’å†…å®Œæˆã€‚ </p><h3 id="2-5-å“åº”é€Ÿåº¦"><a href="#2-5-å“åº”é€Ÿåº¦" class="headerlink" title="2.5 å“åº”é€Ÿåº¦"></a>2.5 å“åº”é€Ÿåº¦</h3><p>æ¯ä¸ªåº”ç”¨éƒ½åº”è¯¥å¿«é€Ÿåœ°å“åº”ç”¨æˆ·äº¤äº’ã€‚åœ¨åº”ç”¨ä¸­æ‰€åšçš„ä¸€åˆ‡ä¼˜åŒ–å’Œæƒè¡¡æœ€ç»ˆéƒ½åº”è¯¥ä½“ç°åœ¨å“åº”é€Ÿåº¦ä¸Šã€‚</p><p>App Store ä¸­æœ‰è®¸å¤šåº”ç”¨å¯ä»¥å®Œæˆç›¸ä¼¼æˆ–ç›¸å…³çš„ä»»åŠ¡ã€‚è¿™ä¸ºç”¨æˆ·æä¾›äº†å¾ˆå¤§çš„é€‰æ‹©ç©ºé—´ï¼Œè€Œ ç”¨æˆ·åŸºæœ¬éƒ½ä¼šé€‰æ‹©å“åº”æœ€å¿«çš„åº”ç”¨ã€‚</p><h3 id="2-6-ç¼“å­˜"><a href="#2-6-ç¼“å­˜" class="headerlink" title="2.6 ç¼“å­˜"></a>2.6 ç¼“å­˜</h3><p>é’ˆå¯¹ä»»ä½•åœ¨æœåŠ¡å™¨ä¸Šå­˜å‚¨æ•°æ®æˆ–é€šè¿‡å¤–éƒ¨æ¥æºåˆ·æ–°æ•°æ®çš„åº”ç”¨ï¼Œå¼€å‘äººå‘˜åº”è¯¥å¯¹æœ¬åœ°å­˜å‚¨çš„ä½¿ç”¨æœ‰æ‰€è§„åˆ’ï¼Œä»¥ä¾¿åº”ç”¨å…·å¤‡ç¦»çº¿æµè§ˆçš„èƒ½åŠ›ã€‚</p><p>ä¾‹å¦‚ï¼Œç”¨æˆ·éƒ½å¸Œæœ›é‚®ä»¶åº”ç”¨èƒ½å¤Ÿåœ¨æ— ç½‘ç»œæˆ–è®¾å¤‡ç¦»çº¿çš„æƒ…å†µä¸‹æµè§ˆå†å²é‚®ä»¶ã€‚</p><p>åŒæ ·ï¼Œæ–°é—»åº”ç”¨ä¹Ÿåº”è¯¥å¯ä»¥åœ¨ç¦»çº¿æ¨¡å¼ä¸‹æ˜¾ç¤ºæœ€è¿‘æ›´æ–°çš„æ–°é—»ï¼Œå¹¶æ ‡è®°å‡ºæ¯æ¡æ–°é—»æ˜¯å¦å·²è¯»ã€‚</p><p>ç„¶è€Œï¼Œä»æœ¬åœ°å­˜å‚¨ä¸­è½½å…¥å’ŒåŒæ­¥æ•°æ®åº”è¯¥è¿…é€Ÿã€ä¾¿æ·ã€‚è¿™ä¸ä»…éœ€è¦é€‰æ‹©è¦åœ¨æœ¬åœ°ç¼“å­˜çš„æ•° æ®å’Œè¦ä¼˜åŒ–çš„æ•°æ®ç»“æ„ï¼Œè¿˜éœ€è¦æä¾›ä¸€ç³»åˆ—çš„é…ç½®é€‰é¡¹å¹¶ç¡®å®šæ•°æ®åŒæ­¥çš„é¢‘ç‡ã€‚</p><p>å¦‚æœä½ çš„åº”ç”¨ä½¿ç”¨äº†æœ¬åœ°å­˜å‚¨ï¼Œé‚£ä¹ˆè¯·æä¾›ä¸€ä¸ªæ¸…é™¤æ•°æ®çš„é€‰é¡¹ã€‚é—æ†¾çš„æ˜¯ï¼Œå¸‚åœºä¸Šçš„å¤§ éƒ¨åˆ†åº”ç”¨éƒ½æ²¡æœ‰æä¾›æ­¤é€‰é¡¹ã€‚æ›´è®©äººçƒ¦æ¼çš„æ˜¯ï¼Œä¸€äº›åº”ç”¨ç«Ÿç„¶ä¼šæ¶ˆè€—æ•°ç™¾å…†çš„å­˜å‚¨ç©ºé—´ã€‚ ç”¨æˆ·ä¼šé¢‘ç¹åœ°å¸è½½è¿™äº›åº”ç”¨æ¥å›æ”¶æœ¬åœ°å­˜å‚¨ã€‚è¿™ä¼šå¯¼è‡´ç³Ÿç³•çš„ç”¨æˆ·ä½“éªŒï¼Œä»è€Œå¨èƒåº”ç”¨çš„ æˆåŠŸã€‚</p><p>ä¸€å®šè¦å‘ç»ˆç«¯ç”¨æˆ·æä¾›æ¸…ç©ºæœ¬åœ°ç¼“å­˜çš„é€‰é¡¹ã€‚å¦‚æœç”¨æˆ·å¼€å¯äº† iCloud çš„å¤‡ä»½åŠŸèƒ½ï¼Œé‚£ä¹ˆåº”ç”¨çš„æ•°æ®å°†ä¼šæ¶ˆè€—ç”¨æˆ·çš„å­˜å‚¨é™ é¢ï¼Œè¯·è°¨æ…ä½¿ç”¨ã€‚</p><h3 id="2-7-äº’æ“ä½œæ€§"><a href="#2-7-äº’æ“ä½œæ€§" class="headerlink" title="2.7 äº’æ“ä½œæ€§"></a>2.7 äº’æ“ä½œæ€§</h3><p>ç”¨æˆ·å¯èƒ½ä¼šä½¿ç”¨å¤šä¸ªåº”ç”¨æ¥å®ŒæˆæŸä¸ªä»»åŠ¡ï¼Œè¿™å°±éœ€è¦è¿™äº›åº”ç”¨ç›´æ¥æä¾›äº’æ“ä½œçš„èƒ½åŠ›ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªç›¸å†Œå¯èƒ½éœ€è¦ä¸€ä¸ªå¹»ç¯ç‰‡åº”ç”¨æ¥å®ç°æœ€ä½³çš„æµè§ˆä½“éªŒï¼Œä½†éœ€è¦å¦ä¸€ä¸ªåº”ç”¨æ¥ç¼–è¾‘ ç…§ç‰‡ã€‚å…¶ä¸­æµè§ˆç…§ç‰‡çš„åº”ç”¨è¦èƒ½å¤Ÿå°†ç…§ç‰‡å‘é€åˆ°ç¼–è¾‘å™¨ï¼Œå¹¶æ¥æ”¶ç¼–è¾‘åçš„å›¾ç‰‡ã€‚iOS ä¸ºå®ç°åº”ç”¨é—´çš„äº’æ“ä½œå’Œæ•°æ®å…±äº«æä¾›äº†å¤šç§æœºåˆ¶ï¼Œå…¶ä¸­åŒ…æ‹¬ UIActivityViewControllerã€ æ·±å±‚é“¾æ¥ã€MultipeerConnectivity æ¡†æ¶ï¼Œç­‰ç­‰ã€‚</p><p>ä¸ºæ·±å±‚é“¾æ¥å®šä¹‰è‰¯å¥½çš„ URL ç»“æ„ä¸ç¼–å†™ä¼˜å¼‚çš„ä»£ç æ¥è§£æ URL åŒæ ·é‡è¦ã€‚ç±»ä¼¼åœ°ï¼Œä½¿ç”¨ å…±äº«å¯¹è¯æ¡†å…±äº«æ•°æ®æ—¶ï¼Œç²¾ç¡®è¯†åˆ«ç”¨äºåˆ†äº«çš„æ•°æ®éå¸¸é‡è¦ï¼ŒåŒæ—¶ï¼Œåœ¨å¤„ç†ä¸åŒæ•°æ®æºä¼  å…¥çš„æ•°æ®æ—¶è¿˜è¦æ³¨æ„å®‰å…¨éšæ‚£ã€‚</p><p>å¦‚æœæŸä¸ªåº”ç”¨å‘é™„è¿‘è®¾å¤‡å…±äº«æ•°æ®æ—¶éœ€è¦èŠ±è´¹å¾ˆé•¿æ—¶é—´å‡†å¤‡æ•°æ®ï¼Œé‚£ä¹ˆç”¨æˆ·ä½“éªŒå°±ä¼šéå¸¸ ç³Ÿç³•ã€‚</p><h3 id="2-8-ç½‘ç»œç¯å¢ƒ"><a href="#2-8-ç½‘ç»œç¯å¢ƒ" class="headerlink" title="2.8 ç½‘ç»œç¯å¢ƒ"></a>2.8 ç½‘ç»œç¯å¢ƒ</h3><p>ç§»åŠ¨è®¾å¤‡ä¼šåœ¨ä¸åŒç½‘ç»œç¯å¢ƒä¸‹ä½¿ç”¨ã€‚ä¸ºäº†ç¡®ä¿èƒ½å¤Ÿæä¾›æœ€å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œä½ çš„åº”ç”¨åº”å½“é€‚åº”å„ç§ç½‘ç»œæ¡ä»¶:</p><ul><li><p>é«˜å¸¦å®½ç¨³å®šç½‘ç»œ</p></li><li><p>ä½å¸¦å®½ç¨³å®šç½‘ç»œ</p></li><li><p>é«˜å¸¦å®½ä¸ç¨³å®šç½‘ç»œ </p></li><li><p>ä½å¸¦å®½ä¸ç¨³å®šç½‘ç»œ</p></li><li><p>æ— ç½‘ç»œ</p></li></ul><p>ä¸ºç”¨æˆ·æä¾›è¿›åº¦æŒ‡ç¤ºæˆ–é”™è¯¯ä¿¡æ¯æ˜¯ç›¸å¯¹åˆç†çš„æ–¹å¼ï¼Œæ— å°½çš„ç­‰å¾…æˆ–å´©æºƒåˆ™è®©äººæ— æ³•æ¥å—ã€‚</p><h3 id="2-9-æ•°æ®åˆ·æ–°"><a href="#2-9-æ•°æ®åˆ·æ–°" class="headerlink" title="2.9 æ•°æ®åˆ·æ–°"></a>2.9 æ•°æ®åˆ·æ–°</h3><p>å³ä½¿æ²¡æœ‰æä¾›ç¦»çº¿æµè§ˆèƒ½åŠ›ï¼Œä½ ä»ç„¶å¯ä»¥ä»æœåŠ¡å™¨ç«¯å‘¨æœŸæ€§åœ°åˆ·æ–°æ•°æ®ã€‚åˆ·æ–°çš„é¢‘ç‡å’Œæ¯ æ¬¡ä¼ è¾“çš„æ•°æ®é‡å°†å†³å®šæ•°æ®ä¼ è¾“çš„æ€»é‡ã€‚å¦‚æœä¼ è¾“çš„å­—èŠ‚æ•°è¿‡å¤§ï¼Œé‚£ç”¨æˆ·å¿…ç„¶ä¼šå¿«é€Ÿè€—å°½ è‡ªå·±çš„æµé‡è®¡åˆ’ã€‚å½“æµé‡æ¶ˆè€—å¤§åˆ°ä¸€å®šç¨‹åº¦æ—¶ï¼Œä½ çš„åº”ç”¨å¾ˆå¯èƒ½ä¼šæµå¤±ç”¨æˆ·ã€‚</p><p>åœ¨ iOS 6.x æˆ–æ›´ä½ç‰ˆæœ¬ä¸­ï¼Œåœ¨åå°è¿è¡Œçš„åº”ç”¨ä¸èƒ½åˆ·æ–°æ•°æ®ã€‚ä» iOS 7 å¼€å§‹ï¼Œåº”ç”¨å¯ä»¥åœ¨å å°å‘¨æœŸæ€§åœ°åˆ·æ–°æ•°æ®ã€‚å¯¹äºåœ¨çº¿èŠå¤©ç±»åº”ç”¨ï¼ŒæŒä¹…çš„ HTTP è¿æ¥æˆ–åŸç”Ÿ TCP è¿æ¥å¯èƒ½ä¼šé å¸¸æœ‰ç”¨ã€‚</p><h3 id="2-10-å¤šç”¨æˆ·æ”¯æŒ"><a href="#2-10-å¤šç”¨æˆ·æ”¯æŒ" class="headerlink" title="2.10 å¤šç”¨æˆ·æ”¯æŒ"></a>2.10 å¤šç”¨æˆ·æ”¯æŒ</h3><p>å®¶åº­æˆå‘˜é—´å¯èƒ½ä¼šå…±äº«ç§»åŠ¨è®¾å¤‡ï¼Œæˆ–è€…ä¸€ä¸ªç”¨æˆ·å¯èƒ½ä¼šæ‹¥æœ‰åŒä¸€åº”ç”¨çš„å¤šä¸ªè´¦å·ã€‚ä¾‹å¦‚ï¼Œ å…„å¼Ÿå§å¦¹é—´å¯èƒ½ä¼šå…±äº«ä¸€ä¸ª iPad æ¥ç©æ¸¸æˆã€‚å†æ¯”å¦‚ï¼Œå®¶åº­æˆå‘˜å¯èƒ½ä¼šåœ¨æ—…æ¸¸æ—¶é…ç½®ä¸€ä¸ªè®¾ å¤‡æ¥æŸ¥æ”¶å…¨å®¶äººçš„ç”µå­é‚®ä»¶ï¼Œä»¥å‡å°‘æ¼«æ¸¸è´¹ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨å¢ƒå¤–æ—…æ¸¸æ—¶ã€‚ç±»ä¼¼åœ°ï¼Œä¸€ä¸ªäººä¹Ÿ å¯èƒ½ä¼šé…ç½®å¤šä¸ªç”µå­é‚®ä»¶è´¦å·ã€‚</p><p>æ˜¯å¦æ”¯æŒå¤šä¸ªå¹¶å‘ç”¨æˆ·å–å†³äºäº§å“çš„éœ€è¦ã€‚ä¸€æ—¦å†³å®šæä¾›æ­¤ç±»åŠŸèƒ½ï¼Œè¯·å‚è€ƒä»¥ä¸‹å‡†åˆ™ã€‚</p><ul><li><p>æ·»åŠ æ–°ç”¨æˆ·åº”å°½å¯èƒ½é«˜æ•ˆã€‚</p></li><li><p>åœ¨ä¸åŒç”¨æˆ·ä¹‹é—´æ›´æ–°åº”å°½å¯èƒ½é«˜æ•ˆã€‚</p></li><li><p>åœ¨ä¸åŒç”¨æˆ·ä¹‹é—´åˆ‡æ¢åº”å°½å¯èƒ½é«˜æ•ˆã€‚</p></li><li><p>ç”¨æˆ·æ•°æ®çš„ç•Œé™åº”è¯¥ç®€æ´ä¸”æ²¡æœ‰ bugã€‚</p></li></ul><h3 id="2-11-å•ç‚¹ç™»å½•"><a href="#2-11-å•ç‚¹ç™»å½•" class="headerlink" title="2.11 å•ç‚¹ç™»å½•"></a>2.11 å•ç‚¹ç™»å½•</h3><p>å¦‚æœä½ å·²ç»åˆ›å»ºäº†å¤šä¸ªå…è®¸æˆ–éœ€è¦ç™»å½•çš„åº”ç”¨ï¼Œé‚£ä¹ˆæ”¯æŒå•ç‚¹ç™»å½•(single sign-onï¼ŒSSO) æ˜¯éå¸¸æ£’çš„é€‰æ‹©ã€‚å¦‚æœç”¨æˆ·ç™»å½•äº†ä¸€ä¸ªåº”ç”¨ï¼Œåªéœ€è¦ç‚¹å‡»ä¸€æ¬¡ï¼Œå°±å¯ä»¥ç™»å½•åˆ°å…¶ä»–çš„åº” ç”¨ä¸­ã€‚</p><p>è¿™ä¸ªè¿‡ç¨‹ä¸ä»…éœ€è¦æ”¯æŒè·¨åº”ç”¨çš„æ•°æ®å…±äº«ï¼Œè¿˜éœ€è¦åˆ†äº«çŠ¶æ€ã€è·¨åº”ç”¨åŒæ­¥ç­‰ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ ç”¨æˆ·æ³¨é”€äº†å…¶ä¸­æŸä¸ªåº”ç”¨ï¼Œåˆ™é€šè¿‡ SSO ç™»å½•çš„æ‰€æœ‰å…¶ä»–åº”ç”¨ä¹Ÿåº”èƒ½æ³¨é”€æ‰ã€‚</p><p>æ­¤å¤–ï¼Œåº”ç”¨ä¹‹é—´çš„åŒæ­¥åº”è¯¥æ˜¯å®‰å…¨çš„ã€‚</p><h3 id="2-12-å®‰å…¨"><a href="#2-12-å®‰å…¨" class="headerlink" title="2.12 å®‰å…¨"></a>2.12 å®‰å…¨</h3><p>å®‰å…¨å¯¹ç§»åŠ¨åº”ç”¨æ¥è¯´æ˜¯æœ€é‡è¦çš„ï¼Œå› ä¸ºæ•æ„Ÿä¿¡æ¯å¯èƒ½ä¼šåœ¨åº”ç”¨é—´å…±äº«ã€‚å› æ­¤ï¼Œå¯¹æ‰€æœ‰é€šä¿¡ä»¥åŠæœ¬åœ°æ•°æ®å’Œå…±äº«æ•°æ®è¿›è¡ŒåŠ å¯†å°±æ˜¾å¾—å°¤ä¸ºé‡è¦äº†ã€‚</p><p>å®ç°å®‰å…¨éœ€è¦æ›´å¤šçš„è®¡ç®—ã€å†…å­˜å’Œå­˜å‚¨ï¼Œä½†è¿™ä¸æœ€å¤§åŒ–è¿è¡Œé€Ÿåº¦ã€æœ€å°åŒ–å†…å­˜å’Œå­˜å‚¨ä½¿ç”¨ çš„ç›®æ ‡ç›¸å†²çªã€‚</p><p>å› æ­¤ï¼Œä½ éœ€è¦åœ¨å®‰å…¨å’Œå…¶ä»–å› ç´ ä¹‹é—´è¿›è¡Œæƒè¡¡ã€‚</p><p>å¼•å…¥å¤šä¸ªå®‰å…¨å±‚ä¼šå½±å“æ€§èƒ½ï¼Œå¹¶å¯¹ç”¨æˆ·ä½“éªŒé€ æˆå¯æ„ŸçŸ¥çš„è´Ÿé¢å½±å“ã€‚å¦‚ä½•è®¾å®šå®‰å…¨çš„åŸºçº¿ éœ€è¦å‚è€ƒå¯¹ç”¨æˆ·ç¾¤ä½“çš„ç»Ÿè®¡åˆ†æã€‚æ­¤å¤–ï¼Œç¡¬ä»¶åœ¨å…¶ä¸­æ‰®æ¼”äº†é‡è¦çš„è§’è‰²:é€‰æ‹©ä¼šå› ä¸ºä¸åŒ è®¾å¤‡çš„è®¡ç®—èƒ½åŠ›è€Œæœ‰æ‰€ä¸åŒã€‚</p><h3 id="2-13-å´©æºƒ"><a href="#2-13-å´©æºƒ" class="headerlink" title="2.13 å´©æºƒ"></a>2.13 å´©æºƒ</h3><p>åº”ç”¨å¯èƒ½ä¼šè€Œä¸”ç¡®å®ä¼šå´©æºƒã€‚è¿‡åº¦ä¼˜åŒ–ä¼šå¯¼è‡´å´©æºƒã€‚åŒæ ·ï¼Œä½¿ç”¨åŸå§‹ C ä»£ç ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´ å´©æºƒã€‚</p><p>é«˜æ€§èƒ½çš„åº”ç”¨ä¸ä»…åº”å°½å¯èƒ½åœ°é¿å…å´©æºƒï¼Œè¿˜åº”è¯¥åœ¨å´©æºƒå‘ç”Ÿæ—¶ä¼˜é›…åœ°æ¢å¤ï¼Œå°¤å…¶æ˜¯åœ¨è¿›è¡Œ æŸä¸ªæ“ä½œçš„è¿‡ç¨‹ä¸­å‘ç”Ÿå´©æºƒæ—¶ã€‚</p><h2 id="3-æ€§èƒ½åˆ†æ"><a href="#3-æ€§èƒ½åˆ†æ" class="headerlink" title="3. æ€§èƒ½åˆ†æ"></a>3. æ€§èƒ½åˆ†æ</h2><p>æˆ‘ä»¬åœ¨å‰é¢è®¨è®ºè¿‡ä¸€äº›å‚æ•°ï¼Œé€šè¿‡æµ‹é‡å®ƒä»¬æ¥åˆ†æåº”ç”¨çš„æ–¹å¼æœ‰ä¸¤ç§:é‡‡æ ·å’ŒåŸ‹ç‚¹ã€‚</p><h3 id="3-1-é‡‡æ ·"><a href="#3-1-é‡‡æ ·" class="headerlink" title="3.1 é‡‡æ ·"></a>3.1 é‡‡æ ·</h3><p>é¡¾åæ€ä¹‰ï¼Œé‡‡æ ·(æˆ–åŸºäºæ¢æµ‹ç‚¹çš„æ€§èƒ½åˆ†æ)æ˜¯æŒ‡ä»¥ä¸€å®šçš„å‘¨æœŸé—´éš”é‡‡é›†çŠ¶æ€ï¼Œè¿™é€šå¸¸éœ€ è¦å€ŸåŠ©å·¥å…·ã€‚ç”±äºä¸ä¼šå¹²æ‰°åº”ç”¨çš„æ‰§è¡Œï¼Œå› æ­¤é‡‡æ ·å¯ä»¥ å¾ˆå¥½åœ°æä¾›åº”ç”¨çš„å…¨æ™¯å›¾ã€‚é‡‡æ ·çš„ä¸è¶³ä¹‹å¤„åœ¨äºå®ƒä¸èƒ½è¿”å› 100% ç²¾ç¡®çš„ç»†èŠ‚ã€‚å¦‚æœé‡‡æ · çš„é¢‘ç‡æ˜¯ 10 æ¯«ç§’ï¼Œé‚£ä¹ˆä½ å°±æ— æ³•å¾—çŸ¥åœ¨æ¢æµ‹ç‚¹ä¹‹é—´çš„ 9.999 æ¯«ç§’å†…å‘ç”Ÿäº†ä»€ä¹ˆã€‚</p><p>é‡‡æ ·å¯ä»¥ä½œä¸ºåˆå§‹çš„æ€§èƒ½è°ƒç ”æ‰‹æ®µï¼Œå¹¶å¯ç”¨äºè·Ÿè¸ª CPU å’Œå†…å­˜çš„ä½¿ç”¨æƒ…å†µã€‚</p><h3 id="3-2åŸ‹ç‚¹"><a href="#3-2åŸ‹ç‚¹" class="headerlink" title="3.2åŸ‹ç‚¹"></a>3.2åŸ‹ç‚¹</h3><p>é€šè¿‡ä¿®æ”¹ä»£ç ï¼Œè®°å½•ç»†èŠ‚ä¿¡æ¯çš„åŸ‹ç‚¹èƒ½å¤Ÿæä¾›æ¯”é‡‡æ ·æ›´åŠ ç²¾ç¡®çš„ç»“æœã€‚ä½ æ—¢å¯ä»¥åœ¨å…³é”®éƒ¨ åˆ†ä¸»åŠ¨åŸ‹ç‚¹ï¼Œä¹Ÿå¯ä»¥åœ¨æ€§èƒ½åˆ†ææˆ–å¤„ç†ç”¨æˆ·åé¦ˆæ—¶æœ‰é’ˆå¯¹æ€§åœ°åŸ‹ç‚¹ï¼Œä»¥ä¾¿è§£å†³é—®é¢˜ã€‚</p><p>å› ä¸ºåŸ‹ç‚¹éœ€è¦æ³¨å…¥é¢å¤–ä»£ç ï¼Œæ‰€ä»¥å®ƒä¸€å®šä¼šå½±å“åº”ç”¨çš„æ€§èƒ½ï¼Œå¯¹å†…å­˜æˆ–é€Ÿåº¦(æˆ–åŒæ—¶å¯¹äºŒè€…)é€ æˆæŸå®³ã€‚</p><h2 id="4-æµ‹é‡"><a href="#4-æµ‹é‡" class="headerlink" title="4. æµ‹é‡"></a>4. æµ‹é‡</h2><p>é’ˆå¯¹å·¥ç¨‹é…ç½®ã€å®‰è£…å’Œä»£ç å®ç°å…±æœ‰ä¸‰ç±»ä»»åŠ¡ã€‚</p><p>â€¢ æ„å»ºä¸å‘å¸ƒ ç¡®ä¿èƒ½å¤Ÿè½»æ¾åœ°æ„å»ºå’Œå‘å¸ƒåº”ç”¨ã€‚</p><p>â€¢ å¯æµ‹è¯•æ€§ ç¡®ä¿ä½ çš„ä»£ç èƒ½å¤ŸåŒæ—¶åœ¨æ¨¡æ‹Ÿæ•°æ®å’ŒçœŸå®æ•°æ®ä¹‹ä¸Šå·¥ä½œï¼Œå…¶ä¸­åŒ…æ‹¬èƒ½å¤Ÿæ¨¡æ‹ŸçœŸå®åœºæ™¯çš„ éš”ç¦»ç¯å¢ƒã€‚</p><p>â€¢ å¯è·Ÿè¸ªæ€§ ç¡®ä¿ä½ èƒ½å¤Ÿé€šè¿‡æ˜ç¡®é—®é¢˜å‘ç”Ÿçš„ä½ç½®å’Œä»£ç è¡Œä¸ºæ¥å¤„ç†é”™è¯¯ã€‚</p><h3 id="4-1-è®¾ç½®å´©æºƒæŠ¥å‘Š"><a href="#4-1-è®¾ç½®å´©æºƒæŠ¥å‘Š" class="headerlink" title="4.1 è®¾ç½®å´©æºƒæŠ¥å‘Š"></a>4.1 è®¾ç½®å´©æºƒæŠ¥å‘Š</h3><p>å´©æºƒæŠ¥å‘Šç³»ç»Ÿæ”¶é›†ç”¨äºåˆ†æåº”ç”¨çš„è°ƒè¯•æ—¥å¿—ï¼Œè·å–å´©æºƒæ—¥å¿—çš„æ–¹å¼æœ‰å¾ˆå¤šã€‚</p><ul><li><p>æ‰‹æœºéšç§è®¾ç½®</p></li><li><p>Xcodeçš„Devices and Simulators</p></li><li><p>Xcodeçš„Organizerè·å–çº¿ä¸Šå¥”æºƒæ—¥å¿—</p></li><li><p>App Store Connects</p></li><li><p>Bugly</p></li><li><p>firebase</p></li><li><p>å‹ç›Ÿ</p></li><li><p>å¬äº‘</p></li><li><p>KSCrashç­‰å¼€æºç»„ä»¶</p></li></ul><h3 id="4-2-åº”ç”¨åŸ‹ç‚¹"><a href="#4-2-åº”ç”¨åŸ‹ç‚¹" class="headerlink" title="4.2 åº”ç”¨åŸ‹ç‚¹"></a>4.2 åº”ç”¨åŸ‹ç‚¹</h3><p>å¯¹åº”ç”¨è¿›è¡ŒåŸ‹ç‚¹æ˜¯äº†è§£ç”¨æˆ·è¡Œä¸ºçš„ä¸€ä¸ªé‡è¦æ­¥éª¤ï¼Œä½†æ›´é‡è¦çš„ç›®çš„æ˜¯è¯†åˆ«åº”ç”¨çš„å…³é”®è·¯å¾„ã€‚æ³¨å…¥ç‰¹å®šçš„ä»£ç ä»¥è®°å½•å…³é”®æŒ‡æ ‡æ˜¯æå‡åº”ç”¨æ€§èƒ½çš„é‡è¦æ­¥éª¤ã€‚</p><p>åŸ‹ç‚¹ä¸åº”è¯¥å–ä»£æ—¥å¿—ã€‚æ—¥å¿—å¯ä»¥éå¸¸è¯¦ç»†ã€‚ä½†å› ä¸ºå‘æœåŠ¡å™¨æŠ¥å‘Šæ—¶ä¼šæ¶ˆè€—ç½‘ ç»œèµ„æºï¼Œæ‰€ä»¥ä½ åº”è¯¥å°½å¯èƒ½å°‘åœ°åŸ‹ç‚¹ã€‚ å› æ­¤ï¼Œåªå¯¹ä½ å’Œå…¶ä»–å·¥ç¨‹æˆ–äº§å“å›¢é˜Ÿçš„æˆå‘˜æ„Ÿå…´è¶£çš„äº‹ä»¶è¿›è¡ŒåŸ‹ç‚¹æ˜¯éå¸¸é‡ è¦çš„ã€‚(è¿™äº›äº‹ä»¶è¦åŒ…å«è¶³å¤Ÿå¤šçš„æ•°æ®ä»¥æ»¡è¶³é‡è¦æŠ¥å‘Šçš„éœ€è¦ã€‚) åŸ‹ç‚¹å’Œè¿‡åº¦åŸ‹ç‚¹ä¹‹é—´å¹¶æ²¡æœ‰æ¸…æ™°çš„åˆ†ç•Œçº¿ã€‚ä¸€å¼€å§‹åº”ä»…å¯¹å°‘é‡æŠ¥å‘Šè¿›è¡ŒåŸ‹ ç‚¹ï¼Œç„¶åéšç€æ—¶é—´çš„æ¨è¿›é€æ­¥å¢åŠ åŸ‹ç‚¹çš„è¦†ç›–ç‡ã€‚</p><h3 id="4-3-æ—¥å¿—"><a href="#4-3-æ—¥å¿—" class="headerlink" title="4.3 æ—¥å¿—"></a>4.3 æ—¥å¿—</h3><p>æ—¥å¿—å’ŒåŸ‹ç‚¹ä¹‹é—´å­˜åœ¨ç€ç»†å¾®çš„å·®åˆ«ã€‚åŸ‹ç‚¹å¯ä»¥çœ‹ä½œæ—¥å¿—çš„å­é›†ã€‚è¢«åŸ‹ç‚¹çš„ä»»ä½•æ•°æ®éƒ½åº”è¯¥ è®°å½•åœ¨æ—¥å¿—ä¸­ã€‚åŸ‹ç‚¹æ‰¿æ‹…äº†ä¸ºèšåˆåˆ†æå‘å¸ƒå…³é”®æ€§èƒ½æ•°æ®çš„èŒè´£ï¼Œæ—¥å¿—åˆ™æä¾›äº†ç”¨äºåœ¨ä¸åŒçº§åˆ«è·Ÿè¸ªåº”ç”¨ çš„ç»†èŠ‚ä¿¡æ¯ï¼Œæ¯”å¦‚ debugã€Verboseã€infoã€warning å’Œ Errorã€‚æ—¥å¿—çš„è®°å½•ä¼šè´¯ç©¿åº”ç”¨çš„æ•´ ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œè€ŒåŸ‹ç‚¹åªåº”è¯¥ç”¨åœ¨å¼€å‘çš„ç‰¹å®šé˜¶æ®µã€‚</p><p>åŸ‹ç‚¹æ•°æ®ä¼šå‘é€åˆ°æœåŠ¡å™¨ï¼Œæ—¥å¿—æ˜¯è®°å½•åœ¨è®¾å¤‡æœ¬åœ°ã€‚</p><hr><blockquote><p><strong>ä¸ªäººåšå®¢:</strong> ğŸ¡ <a href="https://forgetsou.github.io/">ForgetSou</a></p></blockquote><hr>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;1-ç®€ä»‹&quot;&gt;&lt;a href=&quot;#1-ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;1. ç®€ä»‹&quot;&gt;&lt;/a&gt;1. ç®€ä»‹&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/008i3skNly1gtczx6o8frj60u00u742m02.jpg&quot; alt=&quot;img&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;2-æ€§èƒ½æŒ‡æ ‡&quot;&gt;&lt;a href=&quot;#2-æ€§èƒ½æŒ‡æ ‡&quot; class=&quot;headerlink&quot; title=&quot;2. æ€§èƒ½æŒ‡æ ‡&quot;&gt;&lt;/a&gt;2. æ€§èƒ½æŒ‡æ ‡&lt;/h1&gt;&lt;p&gt;æ€§èƒ½æŒ‡æ ‡æ˜¯é¢å‘ç”¨æˆ·çš„å„ç§å±æ€§ã€‚æ¯ä¸ªæŒ‡æ ‡å¯èƒ½æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªå¯æµ‹é‡å·¥ç¨‹å‚æ•°çš„ä¸€ä¸ªè¦ç´ ã€‚&lt;/p&gt;
&lt;h3 id=&quot;2-1-å†…å­˜&quot;&gt;&lt;a href=&quot;#2-1-å†…å­˜&quot; class=&quot;headerlink&quot; title=&quot;2.1 å†…å­˜&quot;&gt;&lt;/a&gt;2.1 å†…å­˜&lt;/h3&gt;&lt;p&gt;å†…å­˜æ¶‰åŠè¿è¡Œåº”ç”¨æ‰€éœ€çš„ RAM æœ€å°å€¼ï¼Œä»¥åŠåº”ç”¨æ¶ˆè€—çš„å†…å­˜å¹³å‡å€¼å’Œå³°å€¼ã€‚æœ€å°å†…å­˜å€¼ï¼Œä¼šä¸¥é‡é™åˆ¶ç¡¬ä»¶ï¼Œè€Œæ›´é«˜çš„å†…å­˜å¹³å‡å€¼å’Œå³°å€¼æ„å‘³ç€æ›´å¤šçš„åå°åº”ç”¨ä¼šè¢«å¼ºåˆ¶å…³é—­ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ—¶è¿˜è¦ç¡®ä¿æ²¡æœ‰æ³„æ¼å†…å­˜ã€‚éšæ—¶é—´æµé€è€ŒæŒç»­å¢é•¿çš„å†…å­˜æ¶ˆè€—æ„å‘³ç€ï¼Œåº”ç”¨å¾ˆå¯èƒ½ä¼šå›  ä¸ºå†…å­˜ä¸è¶³çš„å¼‚å¸¸è€Œå´©æºƒã€‚ &lt;/p&gt;
&lt;h3 id=&quot;2-2-ç”µé‡æ¶ˆè€—&quot;&gt;&lt;a href=&quot;#2-2-ç”µé‡æ¶ˆè€—&quot; class=&quot;headerlink&quot; title=&quot;2.2 ç”µé‡æ¶ˆè€—&quot;&gt;&lt;/a&gt;2.2 ç”µé‡æ¶ˆè€—&lt;/h3&gt;&lt;p&gt;åœ¨ç¼–å†™é«˜æ€§èƒ½ä»£ç æ—¶ï¼Œç”µé‡æ¶ˆè€—æ˜¯ä¸€ä¸ªéœ€è¦é‡ç‚¹å¤„ç†çš„é‡è¦å› ç´ ã€‚å°±æ‰§è¡Œæ—¶é—´å’Œ CPU èµ„ æºçš„åˆ©ç”¨è€Œè¨€ï¼Œæˆ‘ä»¬ä¸ä»…è¦å®ç°é«˜æ•ˆçš„æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œè¿˜éœ€è¦è€ƒè™‘å…¶ä»–çš„å› ç´ ã€‚å¦‚æœæŸ ä¸ªåº”ç”¨æ˜¯ä¸ªç”µæ± é»‘æ´ï¼Œé‚£ä¹ˆä¸€å®šä¸ä¼šæœ‰äººå–œæ¬¢å®ƒã€‚ &lt;/p&gt;
&lt;p&gt;ç”µé‡æ¶ˆè€—ä¸ä»…ä»…ä¸è®¡ç®— CPU å‘¨æœŸæœ‰å…³ï¼Œè¿˜åŒ…æ‹¬é«˜æ•ˆåœ°ä½¿ç”¨ç¡¬ä»¶ã€‚é™¤äº†è¦å®ç°ç”µé‡æ¶ˆè€—æœ€ å°åŒ–ï¼Œè¿˜è¦ç¡®ä¿ä¸ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚ &lt;/p&gt;</summary>
    
    
    
    <category term="è¯»ä¹¦ç¬”è®°" scheme="https://forgetsou.github.io/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="è¯»ä¹¦ç¬”è®°" scheme="https://forgetsou.github.io/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
    <category term="ã€Šé«˜æ€§èƒ½iOSåº”ç”¨å¼€å‘ã€‹" scheme="https://forgetsou.github.io/tags/%E3%80%8A%E9%AB%98%E6%80%A7%E8%83%BDiOS%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E3%80%8B/"/>
    
  </entry>
  
  <entry>
    <title>iOSå¼€å‘-AES/ECB/PKCS5PaddingåŠ è§£å¯†(OC)</title>
    <link href="https://forgetsou.github.io/2021/08/11/iOS%E5%BC%80%E5%8F%91-AES-ECB-PKCS5Padding%E5%8A%A0%E8%A7%A3%E5%AF%86-OC/"/>
    <id>https://forgetsou.github.io/2021/08/11/iOS%E5%BC%80%E5%8F%91-AES-ECB-PKCS5Padding%E5%8A%A0%E8%A7%A3%E5%AF%86-OC/</id>
    <published>2021-08-11T09:28:25.000Z</published>
    <updated>2021-08-11T09:28:25.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸€-ç®€è¿°"><a href="#ä¸€-ç®€è¿°" class="headerlink" title="ä¸€. ç®€è¿°"></a>ä¸€. ç®€è¿°</h1><h2 id="1-åŠ è§£å¯†æ–¹å¼æœ‰å¾ˆå¤šï¼ŒiOSå¸¸ç”¨çš„åŠ å¯†æ–¹å¼æœ‰"><a href="#1-åŠ è§£å¯†æ–¹å¼æœ‰å¾ˆå¤šï¼ŒiOSå¸¸ç”¨çš„åŠ å¯†æ–¹å¼æœ‰" class="headerlink" title="1. åŠ è§£å¯†æ–¹å¼æœ‰å¾ˆå¤šï¼ŒiOSå¸¸ç”¨çš„åŠ å¯†æ–¹å¼æœ‰:"></a>1. åŠ è§£å¯†æ–¹å¼æœ‰å¾ˆå¤šï¼Œ<code>iOS</code>å¸¸ç”¨çš„åŠ å¯†æ–¹å¼æœ‰:</h2><ul><li>å“ˆå¸Œç®—æ³•: MD5ã€SHA</li><li>å¯¹ç§°åŠ å¯†ç®—æ³•: DESã€3DESã€AES</li><li>éå¯¹ç§°åŠ å¯†ç®—æ³•: RSA</li></ul><p>æœ¬æ–‡ä¸»è¦è®²è¿°<code>AES/ECB/PKCS5Padding</code>åŠ è§£å¯†æ–¹å¼</p><h1 id="äºŒ-ç¤ºä¾‹"><a href="#äºŒ-ç¤ºä¾‹" class="headerlink" title="äºŒ. ç¤ºä¾‹"></a>äºŒ. ç¤ºä¾‹</h1><h2 id="1-åŠ å¯†"><a href="#1-åŠ å¯†" class="headerlink" title="1. åŠ å¯†"></a>1. åŠ å¯†</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> k_aesECBKey                         @<span class="meta-string">&quot;AAAAA&quot;</span><span class="comment">// AAAAAåªæ˜¯ç¤ºä¾‹ï¼Œæ¢æˆè‡ªå·±å–œæ¬¢çš„å­—ç¬¦ä¸²</span></span></span><br><span class="line"><span class="comment">// åŠ å¯†</span></span><br><span class="line">+ (<span class="built_in">NSString</span> *)encryptText:(<span class="built_in">NSString</span> *)text &#123;</span><br><span class="line">    CCCryptorStatus status = kCCSuccess;</span><br><span class="line">    <span class="built_in">NSData</span> *data = [text dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">    <span class="built_in">NSData</span> *result = [data dataEncryptedUsingAlgorithm:kCCAlgorithmAES128</span><br><span class="line">                                                   key:k_aesECBKey</span><br><span class="line">                                  initializationVector:<span class="literal">nil</span></span><br><span class="line">                                               options:(kCCOptionPKCS7Padding|kCCOptionECBMode)</span><br><span class="line">                                                 error:&amp;status];</span><br><span class="line">    <span class="keyword">if</span> (status != kCCSuccess) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="string">@&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> convertDataToHexStr:result];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> å°†åå…­è¿›åˆ¶dataè½¬ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> @param data åå…­è¿›åˆ¶data</span></span><br><span class="line"><span class="comment"> @return åå…­è¿›åˆ¶å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">+ (<span class="built_in">NSString</span> *)convertDataToHexStr:(<span class="built_in">NSData</span> *)data &#123;</span><br><span class="line"><span class="keyword">if</span> (!data || [data length] == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">@&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">NSMutableString</span> *string = [[<span class="built_in">NSMutableString</span> alloc] initWithCapacity:[data length]];</span><br><span class="line"></span><br><span class="line">[data enumerateByteRangesUsingBlock:^(<span class="keyword">const</span> <span class="keyword">void</span> *bytes, <span class="built_in">NSRange</span> byteRange, <span class="built_in">BOOL</span> *stop) &#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> *dataBytes = (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)bytes;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; byteRange.length; i++) &#123;</span><br><span class="line"><span class="built_in">NSString</span> *hexStr = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;%x&quot;</span>, (dataBytes[i]) &amp; <span class="number">0xff</span>];</span><br><span class="line"><span class="keyword">if</span> ([hexStr length] == <span class="number">2</span>) &#123;</span><br><span class="line">[string appendString:hexStr];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">[string appendFormat:<span class="string">@&quot;0%@&quot;</span>, hexStr];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;];</span><br><span class="line"><span class="keyword">return</span> string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-è§£å¯†"><a href="#2-è§£å¯†" class="headerlink" title="2. è§£å¯†"></a>2. è§£å¯†</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è§£å¯†</span></span><br><span class="line">+ (<span class="built_in">NSString</span> *)decryptHexStr:(<span class="built_in">NSString</span> *)hexStr &#123;</span><br><span class="line">    <span class="built_in">NSData</span> *data = [<span class="keyword">self</span> convertHexStrToData:hexStr];</span><br><span class="line">    CCCryptorStatus status = kCCSuccess;</span><br><span class="line">    <span class="built_in">NSData</span>* result = [data decryptedDataUsingAlgorithm:kCCAlgorithmAES128</span><br><span class="line">                                                   key:k_aesECBKey</span><br><span class="line">                                  initializationVector:<span class="literal">nil</span>   <span class="comment">// ECBè§£å¯†ä¸ä¼šç”¨åˆ°iv</span></span><br><span class="line">                                               options:(kCCOptionPKCS7Padding|kCCOptionECBMode)</span><br><span class="line">                                                 error:&amp;status];</span><br><span class="line">    <span class="keyword">if</span> (status != kCCSuccess) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="string">@&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="built_in">NSString</span> alloc] initWithData:result encoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">NSData</span> *)convertHexStrToData:(<span class="built_in">NSString</span> *)str &#123;</span><br><span class="line">    <span class="keyword">if</span> (!str || [str length] == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">NSMutableData</span> *hexData = [[<span class="built_in">NSMutableData</span> alloc] initWithCapacity:<span class="number">8</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSRange</span> range;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ([str length] % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        range = <span class="built_in">NSMakeRange</span>(<span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        range = <span class="built_in">NSMakeRange</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = range.location; i &lt; [str length]; i+= <span class="number">2</span>)&#123;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> anInt;</span><br><span class="line">        <span class="built_in">NSString</span>*hexCharStr= [str substringWithRange:range];</span><br><span class="line"></span><br><span class="line">        <span class="built_in">NSScanner</span>*scanner= [[<span class="built_in">NSScanner</span> alloc] initWithString:hexCharStr];</span><br><span class="line"> </span><br><span class="line">        [scanner scanHexInt:&amp;anInt];</span><br><span class="line"></span><br><span class="line">        <span class="built_in">NSData</span> *entity= [[<span class="built_in">NSData</span> alloc] initWithBytes:&amp;anInt length:<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        [hexData appendData:entity];</span><br><span class="line"></span><br><span class="line">        range.location+= range.length;</span><br><span class="line"></span><br><span class="line">        range.length= <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> hexData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>âš ï¸ <strong>NSData+CommonCrypto.h</strong></p><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/NSData.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/NSError.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;CommonCrypto/CommonCryptor.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;CommonCrypto/CommonHMAC.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="built_in">NSString</span> * <span class="keyword">const</span> kCommonCryptoErrorDomain;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSError</span> (<span class="title">CommonCryptoErrorDomain</span>)</span></span><br><span class="line">+ (<span class="built_in">NSError</span> *) errorWithCCCryptorStatus: (CCCryptorStatus) status;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSData</span> (<span class="title">CommonDigest</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) MD2Sum;</span><br><span class="line">- (<span class="built_in">NSData</span> *) MD4Sum;</span><br><span class="line">- (<span class="built_in">NSData</span> *) MD5Sum;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) SHA1Hash;</span><br><span class="line">- (<span class="built_in">NSData</span> *) SHA224Hash;</span><br><span class="line">- (<span class="built_in">NSData</span> *) SHA256Hash;</span><br><span class="line">- (<span class="built_in">NSData</span> *) SHA384Hash;</span><br><span class="line">- (<span class="built_in">NSData</span> *) SHA512Hash;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSData</span> (<span class="title">CommonCryptor</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) AES256EncryptedDataUsingKey: (<span class="keyword">id</span>) key error: (<span class="built_in">NSError</span> **) error;</span><br><span class="line">- (<span class="built_in">NSData</span> *) decryptedAES256DataUsingKey: (<span class="keyword">id</span>) key error: (<span class="built_in">NSError</span> **) error;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) DESEncryptedDataUsingKey: (<span class="keyword">id</span>) key error: (<span class="built_in">NSError</span> **) error;</span><br><span class="line">- (<span class="built_in">NSData</span> *) decryptedDESDataUsingKey: (<span class="keyword">id</span>) key error: (<span class="built_in">NSError</span> **) error;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) <span class="built_in">CASTEncryptedDataUsingKey</span>: (<span class="keyword">id</span>) key error: (<span class="built_in">NSError</span> **) error;</span><br><span class="line">- (<span class="built_in">NSData</span> *) decryptedCASTDataUsingKey: (<span class="keyword">id</span>) key error: (<span class="built_in">NSError</span> **) error;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSData</span> (<span class="title">LowLevelCommonCryptor</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) dataEncryptedUsingAlgorithm: (CCAlgorithm) algorithm</span><br><span class="line">                                     key: (<span class="keyword">id</span>) key<span class="comment">// data or string</span></span><br><span class="line">                                   error: (CCCryptorStatus *) error;</span><br><span class="line">- (<span class="built_in">NSData</span> *) dataEncryptedUsingAlgorithm: (CCAlgorithm) algorithm</span><br><span class="line">                                     key: (<span class="keyword">id</span>) key<span class="comment">// data or string</span></span><br><span class="line">                                 options: (CCOptions) options</span><br><span class="line">                                   error: (CCCryptorStatus *) error;</span><br><span class="line">- (<span class="built_in">NSData</span> *) dataEncryptedUsingAlgorithm: (CCAlgorithm) algorithm</span><br><span class="line">                                     key: (<span class="keyword">id</span>) key<span class="comment">// data or string</span></span><br><span class="line">                    initializationVector: (<span class="keyword">id</span>) iv<span class="comment">// data or string</span></span><br><span class="line">                                 options: (CCOptions) options</span><br><span class="line">                                   error: (CCCryptorStatus *) error;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) decryptedDataUsingAlgorithm: (CCAlgorithm) algorithm</span><br><span class="line">                                     key: (<span class="keyword">id</span>) key<span class="comment">// data or string</span></span><br><span class="line">                                   error: (CCCryptorStatus *) error;</span><br><span class="line">- (<span class="built_in">NSData</span> *) decryptedDataUsingAlgorithm: (CCAlgorithm) algorithm</span><br><span class="line">                                     key: (<span class="keyword">id</span>) key<span class="comment">// data or string</span></span><br><span class="line">                                 options: (CCOptions) options</span><br><span class="line">                                   error: (CCCryptorStatus *) error;</span><br><span class="line">- (<span class="built_in">NSData</span> *) decryptedDataUsingAlgorithm: (CCAlgorithm) algorithm</span><br><span class="line">                                     key: (<span class="keyword">id</span>) key<span class="comment">// data or string</span></span><br><span class="line">                    initializationVector: (<span class="keyword">id</span>) iv<span class="comment">// data or string</span></span><br><span class="line">                                 options: (CCOptions) options</span><br><span class="line">                                   error: (CCCryptorStatus *) error;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSData</span> (<span class="title">CommonHMAC</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) HMACWithAlgorithm: (CCHmacAlgorithm) algorithm;</span><br><span class="line">- (<span class="built_in">NSData</span> *) HMACWithAlgorithm: (CCHmacAlgorithm) algorithm key: (<span class="keyword">id</span>) key;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><p>âš ï¸ <strong>NSData+CommonCrypto.m</strong></p><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;NSData+CommonCrypto.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;CommonCrypto/CommonDigest.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;CommonCrypto/CommonCryptor.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;CommonCrypto/CommonHMAC.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> * <span class="keyword">const</span> kCommonCryptoErrorDomain = <span class="string">@&quot;CommonCryptoErrorDomain&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSError</span> (<span class="title">CommonCryptoErrorDomain</span>)</span></span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">NSError</span> *) errorWithCCCryptorStatus: (CCCryptorStatus) status</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">NSString</span> * description = <span class="literal">nil</span>, * reason = <span class="literal">nil</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> ( status )</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> kCCSuccess:</span><br><span class="line">description = <span class="built_in">NSLocalizedString</span>(<span class="string">@&quot;Success&quot;</span>, <span class="string">@&quot;Error description&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> kCCParamError:</span><br><span class="line">description = <span class="built_in">NSLocalizedString</span>(<span class="string">@&quot;Parameter Error&quot;</span>, <span class="string">@&quot;Error description&quot;</span>);</span><br><span class="line">reason = <span class="built_in">NSLocalizedString</span>(<span class="string">@&quot;Illegal parameter supplied to encryption/decryption algorithm&quot;</span>, <span class="string">@&quot;Error reason&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> kCCBufferTooSmall:</span><br><span class="line">description = <span class="built_in">NSLocalizedString</span>(<span class="string">@&quot;Buffer Too Small&quot;</span>, <span class="string">@&quot;Error description&quot;</span>);</span><br><span class="line">reason = <span class="built_in">NSLocalizedString</span>(<span class="string">@&quot;Insufficient buffer provided for specified operation&quot;</span>, <span class="string">@&quot;Error reason&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> kCCMemoryFailure:</span><br><span class="line">description = <span class="built_in">NSLocalizedString</span>(<span class="string">@&quot;Memory Failure&quot;</span>, <span class="string">@&quot;Error description&quot;</span>);</span><br><span class="line">reason = <span class="built_in">NSLocalizedString</span>(<span class="string">@&quot;Failed to allocate memory&quot;</span>, <span class="string">@&quot;Error reason&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> kCCAlignmentError:</span><br><span class="line">description = <span class="built_in">NSLocalizedString</span>(<span class="string">@&quot;Alignment Error&quot;</span>, <span class="string">@&quot;Error description&quot;</span>);</span><br><span class="line">reason = <span class="built_in">NSLocalizedString</span>(<span class="string">@&quot;Input size to encryption algorithm was not aligned correctly&quot;</span>, <span class="string">@&quot;Error reason&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> kCCDecodeError:</span><br><span class="line">description = <span class="built_in">NSLocalizedString</span>(<span class="string">@&quot;Decode Error&quot;</span>, <span class="string">@&quot;Error description&quot;</span>);</span><br><span class="line">reason = <span class="built_in">NSLocalizedString</span>(<span class="string">@&quot;Input data did not decode or decrypt correctly&quot;</span>, <span class="string">@&quot;Error reason&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> kCCUnimplemented:</span><br><span class="line">description = <span class="built_in">NSLocalizedString</span>(<span class="string">@&quot;Unimplemented Function&quot;</span>, <span class="string">@&quot;Error description&quot;</span>);</span><br><span class="line">reason = <span class="built_in">NSLocalizedString</span>(<span class="string">@&quot;Function not implemented for the current algorithm&quot;</span>, <span class="string">@&quot;Error reason&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">description = <span class="built_in">NSLocalizedString</span>(<span class="string">@&quot;Unknown Error&quot;</span>, <span class="string">@&quot;Error description&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSMutableDictionary</span> * userInfo = [[<span class="built_in">NSMutableDictionary</span> alloc] init];</span><br><span class="line">[userInfo setObject: description forKey: <span class="built_in">NSLocalizedDescriptionKey</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( reason != <span class="literal">nil</span> )</span><br><span class="line">[userInfo setObject: reason forKey: <span class="built_in">NSLocalizedFailureReasonErrorKey</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSError</span> * result = [<span class="built_in">NSError</span> errorWithDomain: kCommonCryptoErrorDomain code: status userInfo: userInfo];</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">if</span> !__has_feature(objc_arc)</span></span><br><span class="line">        [userInfo release];</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ( result );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> mark -</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSData</span> (<span class="title">CommonDigest</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) MD2Sum</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> hash[CC_MD2_DIGEST_LENGTH];</span><br><span class="line">(<span class="keyword">void</span>) CC_MD2( [<span class="keyword">self</span> bytes], (CC_LONG)[<span class="keyword">self</span> length], hash );</span><br><span class="line"><span class="keyword">return</span> ( [<span class="built_in">NSData</span> dataWithBytes: hash length: CC_MD2_DIGEST_LENGTH] );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) MD4Sum</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> hash[CC_MD4_DIGEST_LENGTH];</span><br><span class="line">(<span class="keyword">void</span>) CC_MD4( [<span class="keyword">self</span> bytes], (CC_LONG)[<span class="keyword">self</span> length], hash );</span><br><span class="line"><span class="keyword">return</span> ( [<span class="built_in">NSData</span> dataWithBytes: hash length: CC_MD4_DIGEST_LENGTH] );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) MD5Sum</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> hash[CC_MD5_DIGEST_LENGTH];</span><br><span class="line">(<span class="keyword">void</span>) CC_MD5( [<span class="keyword">self</span> bytes], (CC_LONG)[<span class="keyword">self</span> length], hash );</span><br><span class="line"><span class="keyword">return</span> ( [<span class="built_in">NSData</span> dataWithBytes: hash length: CC_MD5_DIGEST_LENGTH] );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) SHA1Hash</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> hash[CC_SHA1_DIGEST_LENGTH];</span><br><span class="line">(<span class="keyword">void</span>) CC_SHA1( [<span class="keyword">self</span> bytes], (CC_LONG)[<span class="keyword">self</span> length], hash );</span><br><span class="line"><span class="keyword">return</span> ( [<span class="built_in">NSData</span> dataWithBytes: hash length: CC_SHA1_DIGEST_LENGTH] );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) SHA224Hash</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> hash[CC_SHA224_DIGEST_LENGTH];</span><br><span class="line">(<span class="keyword">void</span>) CC_SHA224( [<span class="keyword">self</span> bytes], (CC_LONG)[<span class="keyword">self</span> length], hash );</span><br><span class="line"><span class="keyword">return</span> ( [<span class="built_in">NSData</span> dataWithBytes: hash length: CC_SHA224_DIGEST_LENGTH] );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) SHA256Hash</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> hash[CC_SHA256_DIGEST_LENGTH];</span><br><span class="line">(<span class="keyword">void</span>) CC_SHA256( [<span class="keyword">self</span> bytes], (CC_LONG)[<span class="keyword">self</span> length], hash );</span><br><span class="line"><span class="keyword">return</span> ( [<span class="built_in">NSData</span> dataWithBytes: hash length: CC_SHA256_DIGEST_LENGTH] );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) SHA384Hash</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> hash[CC_SHA384_DIGEST_LENGTH];</span><br><span class="line">(<span class="keyword">void</span>) CC_SHA384( [<span class="keyword">self</span> bytes], (CC_LONG)[<span class="keyword">self</span> length], hash );</span><br><span class="line"><span class="keyword">return</span> ( [<span class="built_in">NSData</span> dataWithBytes: hash length: CC_SHA384_DIGEST_LENGTH] );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) SHA512Hash</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> hash[CC_SHA512_DIGEST_LENGTH];</span><br><span class="line">(<span class="keyword">void</span>) CC_SHA512( [<span class="keyword">self</span> bytes], (CC_LONG)[<span class="keyword">self</span> length], hash );</span><br><span class="line"><span class="keyword">return</span> ( [<span class="built_in">NSData</span> dataWithBytes: hash length: CC_SHA512_DIGEST_LENGTH] );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSData</span> (<span class="title">CommonCryptor</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) AES256EncryptedDataUsingKey: (<span class="keyword">id</span>) key error: (<span class="built_in">NSError</span> **) error</span><br><span class="line">&#123;</span><br><span class="line">CCCryptorStatus status = kCCSuccess;</span><br><span class="line"><span class="built_in">NSData</span> * result = [<span class="keyword">self</span> dataEncryptedUsingAlgorithm: kCCAlgorithmAES128</span><br><span class="line">                                                  key: key</span><br><span class="line">                                              options: kCCOptionPKCS7Padding</span><br><span class="line">                                                error: &amp;status];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( result != <span class="literal">nil</span> )</span><br><span class="line"><span class="keyword">return</span> ( result );</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( error != <span class="literal">NULL</span> )</span><br><span class="line">*error = [<span class="built_in">NSError</span> errorWithCCCryptorStatus: status];</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ( <span class="literal">nil</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) decryptedAES256DataUsingKey: (<span class="keyword">id</span>) key error: (<span class="built_in">NSError</span> **) error</span><br><span class="line">&#123;</span><br><span class="line">CCCryptorStatus status = kCCSuccess;</span><br><span class="line"><span class="built_in">NSData</span> * result = [<span class="keyword">self</span> decryptedDataUsingAlgorithm: kCCAlgorithmAES128</span><br><span class="line">                                                  key: key</span><br><span class="line">                                              options: kCCOptionPKCS7Padding</span><br><span class="line">                                                error: &amp;status];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( result != <span class="literal">nil</span> )</span><br><span class="line"><span class="keyword">return</span> ( result );</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( error != <span class="literal">NULL</span> )</span><br><span class="line">*error = [<span class="built_in">NSError</span> errorWithCCCryptorStatus: status];</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ( <span class="literal">nil</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) DESEncryptedDataUsingKey: (<span class="keyword">id</span>) key error: (<span class="built_in">NSError</span> **) error</span><br><span class="line">&#123;</span><br><span class="line">CCCryptorStatus status = kCCSuccess;</span><br><span class="line"><span class="built_in">NSData</span> * result = [<span class="keyword">self</span> dataEncryptedUsingAlgorithm: kCCAlgorithmDES</span><br><span class="line">                                                  key: key</span><br><span class="line">                                              options: kCCOptionPKCS7Padding</span><br><span class="line">                                                error: &amp;status];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( result != <span class="literal">nil</span> )</span><br><span class="line"><span class="keyword">return</span> ( result );</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( error != <span class="literal">NULL</span> )</span><br><span class="line">*error = [<span class="built_in">NSError</span> errorWithCCCryptorStatus: status];</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ( <span class="literal">nil</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) decryptedDESDataUsingKey: (<span class="keyword">id</span>) key error: (<span class="built_in">NSError</span> **) error</span><br><span class="line">&#123;</span><br><span class="line">CCCryptorStatus status = kCCSuccess;</span><br><span class="line"><span class="built_in">NSData</span> * result = [<span class="keyword">self</span> decryptedDataUsingAlgorithm: kCCAlgorithmDES</span><br><span class="line">                                                  key: key</span><br><span class="line">                                              options: kCCOptionPKCS7Padding</span><br><span class="line">                                                error: &amp;status];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( result != <span class="literal">nil</span> )</span><br><span class="line"><span class="keyword">return</span> ( result );</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( error != <span class="literal">NULL</span> )</span><br><span class="line">*error = [<span class="built_in">NSError</span> errorWithCCCryptorStatus: status];</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ( <span class="literal">nil</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) <span class="built_in">CASTEncryptedDataUsingKey</span>: (<span class="keyword">id</span>) key error: (<span class="built_in">NSError</span> **) error</span><br><span class="line">&#123;</span><br><span class="line">CCCryptorStatus status = kCCSuccess;</span><br><span class="line"><span class="built_in">NSData</span> * result = [<span class="keyword">self</span> dataEncryptedUsingAlgorithm: kCCAlgorithmCAST</span><br><span class="line">                                                  key: key</span><br><span class="line">                                              options: kCCOptionPKCS7Padding</span><br><span class="line">                                                error: &amp;status];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( result != <span class="literal">nil</span> )</span><br><span class="line"><span class="keyword">return</span> ( result );</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( error != <span class="literal">NULL</span> )</span><br><span class="line">*error = [<span class="built_in">NSError</span> errorWithCCCryptorStatus: status];</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ( <span class="literal">nil</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) decryptedCASTDataUsingKey: (<span class="keyword">id</span>) key error: (<span class="built_in">NSError</span> **) error</span><br><span class="line">&#123;</span><br><span class="line">CCCryptorStatus status = kCCSuccess;</span><br><span class="line"><span class="built_in">NSData</span> * result = [<span class="keyword">self</span> decryptedDataUsingAlgorithm: kCCAlgorithmCAST</span><br><span class="line">                                                  key: key</span><br><span class="line">                                              options: kCCOptionPKCS7Padding</span><br><span class="line">                                                error: &amp;status];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( result != <span class="literal">nil</span> )</span><br><span class="line"><span class="keyword">return</span> ( result );</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( error != <span class="literal">NULL</span> )</span><br><span class="line">*error = [<span class="built_in">NSError</span> errorWithCCCryptorStatus: status];</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ( <span class="literal">nil</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> FixKeyLengths( CCAlgorithm algorithm, <span class="built_in">NSMutableData</span> * keyData, <span class="built_in">NSMutableData</span> * ivData )</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">NSUInteger</span> keyLength = [keyData length];</span><br><span class="line"><span class="keyword">switch</span> ( algorithm )</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> kCCAlgorithmAES128:</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> ( keyLength &lt; <span class="number">16</span> )</span><br><span class="line">&#123;</span><br><span class="line">[keyData setLength: <span class="number">16</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> ( keyLength &lt; <span class="number">24</span> )</span><br><span class="line">&#123;</span><br><span class="line">[keyData setLength: <span class="number">24</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">[keyData setLength: <span class="number">32</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> kCCAlgorithmDES:</span><br><span class="line">&#123;</span><br><span class="line">[keyData setLength: <span class="number">8</span>];</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> kCCAlgorithm3DES:</span><br><span class="line">&#123;</span><br><span class="line">[keyData setLength: <span class="number">24</span>];</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> kCCAlgorithmCAST:</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> ( keyLength &lt; <span class="number">5</span> )</span><br><span class="line">&#123;</span><br><span class="line">[keyData setLength: <span class="number">5</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> ( keyLength &gt; <span class="number">16</span> )</span><br><span class="line">&#123;</span><br><span class="line">[keyData setLength: <span class="number">16</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> kCCAlgorithmRC4:</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> ( keyLength &gt; <span class="number">512</span> )</span><br><span class="line">[keyData setLength: <span class="number">512</span>];</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[ivData setLength: [keyData length]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSData</span> (<span class="title">LowLevelCommonCryptor</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) _runCryptor: (CCCryptorRef) cryptor result: (CCCryptorStatus *) status</span><br><span class="line">&#123;</span><br><span class="line">size_t bufsize = CCCryptorGetOutputLength( cryptor, (size_t)[<span class="keyword">self</span> length], <span class="literal">true</span> );</span><br><span class="line"><span class="keyword">void</span> * buf = malloc( bufsize );</span><br><span class="line">size_t bufused = <span class="number">0</span>;</span><br><span class="line">  size_t bytesTotal = <span class="number">0</span>;</span><br><span class="line">*status = CCCryptorUpdate( cryptor, [<span class="keyword">self</span> bytes], (size_t)[<span class="keyword">self</span> length], </span><br><span class="line">                            buf, bufsize, &amp;bufused );</span><br><span class="line"><span class="keyword">if</span> ( *status != kCCSuccess )</span><br><span class="line">&#123;</span><br><span class="line">free( buf );</span><br><span class="line"><span class="keyword">return</span> ( <span class="literal">nil</span> );</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">  bytesTotal += bufused;</span><br><span class="line"></span><br><span class="line"><span class="comment">// From Brent Royal-Gordon (Twitter: architechies):</span></span><br><span class="line"><span class="comment">//  Need to update buf ptr past used bytes when calling CCCryptorFinal()</span></span><br><span class="line">*status = CCCryptorFinal( cryptor, buf + bufused, bufsize - bufused, &amp;bufused );</span><br><span class="line"><span class="keyword">if</span> ( *status != kCCSuccess )</span><br><span class="line">&#123;</span><br><span class="line">free( buf );</span><br><span class="line"><span class="keyword">return</span> ( <span class="literal">nil</span> );</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">  bytesTotal += bufused;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ( [<span class="built_in">NSData</span> dataWithBytesNoCopy: buf length: bytesTotal] );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) dataEncryptedUsingAlgorithm: (CCAlgorithm) algorithm</span><br><span class="line">                                     key: (<span class="keyword">id</span>) key</span><br><span class="line">                                   error: (CCCryptorStatus *) error</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> ( [<span class="keyword">self</span> dataEncryptedUsingAlgorithm: algorithm</span><br><span class="line">                                         key: key</span><br><span class="line">                        initializationVector: <span class="literal">nil</span></span><br><span class="line">                                     options: <span class="number">0</span></span><br><span class="line">                                       error: error] );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) dataEncryptedUsingAlgorithm: (CCAlgorithm) algorithm</span><br><span class="line">                                     key: (<span class="keyword">id</span>) key</span><br><span class="line">                                 options: (CCOptions) options</span><br><span class="line">                                   error: (CCCryptorStatus *) error</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> ( [<span class="keyword">self</span> dataEncryptedUsingAlgorithm: algorithm</span><br><span class="line">                                         key: key</span><br><span class="line">                        initializationVector: <span class="literal">nil</span></span><br><span class="line">                                     options: options</span><br><span class="line">                                       error: error] );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) dataEncryptedUsingAlgorithm: (CCAlgorithm) algorithm</span><br><span class="line">                                     key: (<span class="keyword">id</span>) key</span><br><span class="line">                    initializationVector: (<span class="keyword">id</span>) iv</span><br><span class="line">                                 options: (CCOptions) options</span><br><span class="line">                                   error: (CCCryptorStatus *) error</span><br><span class="line">&#123;</span><br><span class="line">CCCryptorRef cryptor = <span class="literal">NULL</span>;</span><br><span class="line">CCCryptorStatus status = kCCSuccess;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSParameterAssert</span>([key isKindOfClass: [<span class="built_in">NSData</span> <span class="keyword">class</span>]] || [key isKindOfClass: [<span class="built_in">NSString</span> <span class="keyword">class</span>]]);</span><br><span class="line"><span class="built_in">NSParameterAssert</span>(iv == <span class="literal">nil</span> || [iv isKindOfClass: [<span class="built_in">NSData</span> <span class="keyword">class</span>]] || [iv isKindOfClass: [<span class="built_in">NSString</span> <span class="keyword">class</span>]]);</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSMutableData</span> * keyData, * ivData;</span><br><span class="line"><span class="keyword">if</span> ( [key isKindOfClass: [<span class="built_in">NSData</span> <span class="keyword">class</span>]] )</span><br><span class="line">keyData = (<span class="built_in">NSMutableData</span> *) [key mutableCopy];</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">keyData = [[key dataUsingEncoding: <span class="built_in">NSUTF8StringEncoding</span>] mutableCopy];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( [iv isKindOfClass: [<span class="built_in">NSString</span> <span class="keyword">class</span>]] )</span><br><span class="line">ivData = [[iv dataUsingEncoding: <span class="built_in">NSUTF8StringEncoding</span>] mutableCopy];</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">ivData = (<span class="built_in">NSMutableData</span> *) [iv mutableCopy];<span class="comment">// data or nil</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">if</span> !__has_feature(objc_arc)</span></span><br><span class="line">        [keyData autorelease];</span><br><span class="line">        [ivData autorelease];</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="comment">// ensure correct lengths for key and iv data, based on algorithms</span></span><br><span class="line">FixKeyLengths( algorithm, keyData, ivData );</span><br><span class="line"></span><br><span class="line">status = CCCryptorCreate( kCCEncrypt, algorithm, options,</span><br><span class="line">                           [keyData bytes], [keyData length], [ivData bytes],</span><br><span class="line">                           &amp;cryptor );</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( status != kCCSuccess )</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> ( error != <span class="literal">NULL</span> )</span><br><span class="line">*error = status;</span><br><span class="line"><span class="keyword">return</span> ( <span class="literal">nil</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSData</span> * result = [<span class="keyword">self</span> _runCryptor: cryptor result: &amp;status];</span><br><span class="line"><span class="keyword">if</span> ( (result == <span class="literal">nil</span>) &amp;&amp; (error != <span class="literal">NULL</span>) )</span><br><span class="line">*error = status;</span><br><span class="line"></span><br><span class="line">CCCryptorRelease( cryptor );</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ( result );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) decryptedDataUsingAlgorithm: (CCAlgorithm) algorithm</span><br><span class="line">                                     key: (<span class="keyword">id</span>) key<span class="comment">// data or string</span></span><br><span class="line">                                   error: (CCCryptorStatus *) error</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> ( [<span class="keyword">self</span> decryptedDataUsingAlgorithm: algorithm</span><br><span class="line">                                         key: key</span><br><span class="line">                        initializationVector: <span class="literal">nil</span></span><br><span class="line">                                     options: <span class="number">0</span></span><br><span class="line">                                       error: error] );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) decryptedDataUsingAlgorithm: (CCAlgorithm) algorithm</span><br><span class="line">                                     key: (<span class="keyword">id</span>) key<span class="comment">// data or string</span></span><br><span class="line">                                 options: (CCOptions) options</span><br><span class="line">                                   error: (CCCryptorStatus *) error</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> ( [<span class="keyword">self</span> decryptedDataUsingAlgorithm: algorithm</span><br><span class="line">                                         key: key</span><br><span class="line">                        initializationVector: <span class="literal">nil</span></span><br><span class="line">                                     options: options</span><br><span class="line">                                       error: error] );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) decryptedDataUsingAlgorithm: (CCAlgorithm) algorithm</span><br><span class="line">                                     key: (<span class="keyword">id</span>) key<span class="comment">// data or string</span></span><br><span class="line">                    initializationVector: (<span class="keyword">id</span>) iv<span class="comment">// data or string</span></span><br><span class="line">                                 options: (CCOptions) options</span><br><span class="line">                                   error: (CCCryptorStatus *) error</span><br><span class="line">&#123;</span><br><span class="line">CCCryptorRef cryptor = <span class="literal">NULL</span>;</span><br><span class="line">CCCryptorStatus status = kCCSuccess;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSParameterAssert</span>([key isKindOfClass: [<span class="built_in">NSData</span> <span class="keyword">class</span>]] || [key isKindOfClass: [<span class="built_in">NSString</span> <span class="keyword">class</span>]]);</span><br><span class="line"><span class="built_in">NSParameterAssert</span>(iv == <span class="literal">nil</span> || [iv isKindOfClass: [<span class="built_in">NSData</span> <span class="keyword">class</span>]] || [iv isKindOfClass: [<span class="built_in">NSString</span> <span class="keyword">class</span>]]);</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSMutableData</span> * keyData, * ivData;</span><br><span class="line"><span class="keyword">if</span> ( [key isKindOfClass: [<span class="built_in">NSData</span> <span class="keyword">class</span>]] )</span><br><span class="line">keyData = (<span class="built_in">NSMutableData</span> *) [key mutableCopy];</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">keyData = [[key dataUsingEncoding: <span class="built_in">NSUTF8StringEncoding</span>] mutableCopy];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( [iv isKindOfClass: [<span class="built_in">NSString</span> <span class="keyword">class</span>]] )</span><br><span class="line">ivData = [[iv dataUsingEncoding: <span class="built_in">NSUTF8StringEncoding</span>] mutableCopy];</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">ivData = (<span class="built_in">NSMutableData</span> *) [iv mutableCopy];<span class="comment">// data or nil</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">if</span> !__has_feature(objc_arc)</span></span><br><span class="line">        [keyData autorelease];</span><br><span class="line">        [ivData autorelease];</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ensure correct lengths for key and iv data, based on algorithms</span></span><br><span class="line">FixKeyLengths( algorithm, keyData, ivData );</span><br><span class="line"></span><br><span class="line">status = CCCryptorCreate( kCCDecrypt, algorithm, options,</span><br><span class="line">                           [keyData bytes], [keyData length], [ivData bytes],</span><br><span class="line">                           &amp;cryptor );</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( status != kCCSuccess )</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> ( error != <span class="literal">NULL</span> )</span><br><span class="line">*error = status;</span><br><span class="line"><span class="keyword">return</span> ( <span class="literal">nil</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSData</span> * result = [<span class="keyword">self</span> _runCryptor: cryptor result: &amp;status];</span><br><span class="line"><span class="keyword">if</span> ( (result == <span class="literal">nil</span>) &amp;&amp; (error != <span class="literal">NULL</span>) )</span><br><span class="line">*error = status;</span><br><span class="line"></span><br><span class="line">CCCryptorRelease( cryptor );</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ( result );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSData</span> (<span class="title">CommonHMAC</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) HMACWithAlgorithm: (CCHmacAlgorithm) algorithm</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> ( [<span class="keyword">self</span> HMACWithAlgorithm: algorithm key: <span class="literal">nil</span>] );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *) HMACWithAlgorithm: (CCHmacAlgorithm) algorithm key: (<span class="keyword">id</span>) key</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">NSParameterAssert</span>(key == <span class="literal">nil</span> || [key isKindOfClass: [<span class="built_in">NSData</span> <span class="keyword">class</span>]] || [key isKindOfClass: [<span class="built_in">NSString</span> <span class="keyword">class</span>]]);</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSData</span> * keyData = <span class="literal">nil</span>;</span><br><span class="line"><span class="keyword">if</span> ( [key isKindOfClass: [<span class="built_in">NSString</span> <span class="keyword">class</span>]] )</span><br><span class="line">keyData = [key dataUsingEncoding: <span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">keyData = (<span class="built_in">NSData</span> *) key;</span><br><span class="line"></span><br><span class="line"><span class="comment">// this could be either CC_SHA1_DIGEST_LENGTH or CC_MD5_DIGEST_LENGTH. SHA1 is larger.</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> buf[CC_SHA1_DIGEST_LENGTH];</span><br><span class="line">CCHmac( algorithm, [keyData bytes], [keyData length], [<span class="keyword">self</span> bytes], [<span class="keyword">self</span> length], buf );</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ( [<span class="built_in">NSData</span> dataWithBytes: buf length: (algorithm == kCCHmacAlgMD5 ? CC_MD5_DIGEST_LENGTH : CC_SHA1_DIGEST_LENGTH)] );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><hr><blockquote><p><strong>ä¸ªäººåšå®¢:</strong> ğŸ¡ <a href="https://forgetsou.github.io/">ForgetSou</a></p></blockquote><hr>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;ä¸€-ç®€è¿°&quot;&gt;&lt;a href=&quot;#ä¸€-ç®€è¿°&quot; class=&quot;headerlink&quot; title=&quot;ä¸€. ç®€è¿°&quot;&gt;&lt;/a&gt;ä¸€. ç®€è¿°&lt;/h1&gt;&lt;h2 id=&quot;1-åŠ è§£å¯†æ–¹å¼æœ‰å¾ˆå¤šï¼ŒiOSå¸¸ç”¨çš„åŠ å¯†æ–¹å¼æœ‰&quot;&gt;&lt;a href=&quot;#1-åŠ è§£å¯†æ–¹å¼æœ‰å¾ˆå¤šï¼ŒiOSå¸¸ç”¨çš„åŠ å¯†æ–¹å¼æœ‰&quot; class=&quot;headerlink&quot; title=&quot;1. åŠ è§£å¯†æ–¹å¼æœ‰å¾ˆå¤šï¼ŒiOSå¸¸ç”¨çš„åŠ å¯†æ–¹å¼æœ‰:&quot;&gt;&lt;/a&gt;1. åŠ è§£å¯†æ–¹å¼æœ‰å¾ˆå¤šï¼Œ&lt;code&gt;iOS&lt;/code&gt;å¸¸ç”¨çš„åŠ å¯†æ–¹å¼æœ‰:&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å“ˆå¸Œç®—æ³•: MD5ã€SHA&lt;/li&gt;
&lt;li&gt;å¯¹ç§°åŠ å¯†ç®—æ³•: DESã€3DESã€AES&lt;/li&gt;
&lt;li&gt;éå¯¹ç§°åŠ å¯†ç®—æ³•: RSA&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ¬æ–‡ä¸»è¦è®²è¿°&lt;code&gt;AES/ECB/PKCS5Padding&lt;/code&gt;åŠ è§£å¯†æ–¹å¼&lt;/p&gt;
&lt;h1 id=&quot;äºŒ-ç¤ºä¾‹&quot;&gt;&lt;a href=&quot;#äºŒ-ç¤ºä¾‹&quot; class=&quot;headerlink&quot; title=&quot;äºŒ. ç¤ºä¾‹&quot;&gt;&lt;/a&gt;äºŒ. ç¤ºä¾‹&lt;/h1&gt;&lt;h2 id=&quot;1-åŠ å¯†&quot;&gt;&lt;a href=&quot;#1-åŠ å¯†&quot; class=&quot;headerlink&quot; title=&quot;1. åŠ å¯†&quot;&gt;&lt;/a&gt;1. åŠ å¯†&lt;/h2&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; k_aesECBKey                         @&lt;span class=&quot;meta-string&quot;&gt;&amp;quot;AAAAA&amp;quot;&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;// AAAAAåªæ˜¯ç¤ºä¾‹ï¼Œæ¢æˆè‡ªå·±å–œæ¬¢çš„å­—ç¬¦ä¸²&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// åŠ å¯†&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ (&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)encryptText:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)text &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    CCCryptorStatus status = kCCSuccess;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; *data = [text dataUsingEncoding:&lt;span class=&quot;built_in&quot;&gt;NSUTF8StringEncoding&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; *result = [data dataEncryptedUsingAlgorithm:kCCAlgorithmAES128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                   key:k_aesECBKey&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                  initializationVector:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                               options:(kCCOptionPKCS7Padding|kCCOptionECBMode)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                 error:&amp;amp;status];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (status != kCCSuccess) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;@&amp;quot;&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; convertDataToHexStr:result];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; å°†åå…­è¿›åˆ¶dataè½¬ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; @param data åå…­è¿›åˆ¶data&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; @return åå…­è¿›åˆ¶å­—ç¬¦ä¸²&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ (&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)convertDataToHexStr:(&lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; *)data &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!data || [data length] == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;@&amp;quot;&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;built_in&quot;&gt;NSMutableString&lt;/span&gt; *string = [[&lt;span class=&quot;built_in&quot;&gt;NSMutableString&lt;/span&gt; alloc] initWithCapacity:[data length]];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	[data enumerateByteRangesUsingBlock:^(&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; *bytes, &lt;span class=&quot;built_in&quot;&gt;NSRange&lt;/span&gt; byteRange, &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; *stop) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; *dataBytes = (&lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;*)bytes;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; byteRange.length; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *hexStr = [&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; stringWithFormat:&lt;span class=&quot;string&quot;&gt;@&amp;quot;%x&amp;quot;&lt;/span&gt;, (dataBytes[i]) &amp;amp; &lt;span class=&quot;number&quot;&gt;0xff&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([hexStr length] == &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				[string appendString:hexStr];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				[string appendFormat:&lt;span class=&quot;string&quot;&gt;@&amp;quot;0%@&amp;quot;&lt;/span&gt;, hexStr];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; string;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;2-è§£å¯†&quot;&gt;&lt;a href=&quot;#2-è§£å¯†&quot; class=&quot;headerlink&quot; title=&quot;2. è§£å¯†&quot;&gt;&lt;/a&gt;2. è§£å¯†&lt;/h2&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// è§£å¯†&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ (&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)decryptHexStr:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)hexStr &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; *data = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; convertHexStrToData:hexStr];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    CCCryptorStatus status = kCCSuccess;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt;* result = [data decryptedDataUsingAlgorithm:kCCAlgorithmAES128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                   key:k_aesECBKey&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                  initializationVector:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;   &lt;span class=&quot;comment&quot;&gt;// ECBè§£å¯†ä¸ä¼šç”¨åˆ°iv&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                               options:(kCCOptionPKCS7Padding|kCCOptionECBMode)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                 error:&amp;amp;status];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (status != kCCSuccess) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;@&amp;quot;&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [[&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; alloc] initWithData:result encoding:&lt;span class=&quot;built_in&quot;&gt;NSUTF8StringEncoding&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ (&lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; *)convertHexStrToData:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)str &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!str || [str length] == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSMutableData&lt;/span&gt; *hexData = [[&lt;span class=&quot;built_in&quot;&gt;NSMutableData&lt;/span&gt; alloc] initWithCapacity:&lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSRange&lt;/span&gt; range;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([str length] % &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        range = &lt;span class=&quot;built_in&quot;&gt;NSMakeRange&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        range = &lt;span class=&quot;built_in&quot;&gt;NSMakeRange&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt; i = range.location; i &amp;lt; [str length]; i+= &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; anInt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt;*hexCharStr= [str substringWithRange:range];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSScanner&lt;/span&gt;*scanner= [[&lt;span class=&quot;built_in&quot;&gt;NSScanner&lt;/span&gt; alloc] initWithString:hexCharStr];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [scanner scanHexInt:&amp;amp;anInt];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; *entity= [[&lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; alloc] initWithBytes:&amp;amp;anInt length:&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [hexData appendData:entity];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        range.location+= range.length;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        range.length= &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; hexData;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;âš ï¸ &lt;strong&gt;NSData+CommonCrypto.h&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="OC" scheme="https://forgetsou.github.io/categories/OC/"/>
    
    
    <category term="OC" scheme="https://forgetsou.github.io/tags/OC/"/>
    
    <category term="åŠ å¯†" scheme="https://forgetsou.github.io/tags/%E5%8A%A0%E5%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>iOSå¼€å‘-åˆ¤æ–­å¹³é¢ä¸Šä¸€ä¸ªç‚¹æ˜¯å¦åœ¨ä¸è§„åˆ™çš„å°é—­åŒºåŸŸå†…ï¼ˆOCï¼‰</title>
    <link href="https://forgetsou.github.io/2021/07/17/iOS%E5%BC%80%E5%8F%91-%E5%88%A4%E6%96%AD%E5%B9%B3%E9%9D%A2%E4%B8%8A%E4%B8%80%E4%B8%AA%E7%82%B9%E6%98%AF%E5%90%A6%E5%9C%A8%E4%B8%8D%E8%A7%84%E5%88%99%E7%9A%84%E5%B0%81%E9%97%AD%E5%8C%BA%E5%9F%9F%E5%86%85%EF%BC%88OC%EF%BC%89/"/>
    <id>https://forgetsou.github.io/2021/07/17/iOS%E5%BC%80%E5%8F%91-%E5%88%A4%E6%96%AD%E5%B9%B3%E9%9D%A2%E4%B8%8A%E4%B8%80%E4%B8%AA%E7%82%B9%E6%98%AF%E5%90%A6%E5%9C%A8%E4%B8%8D%E8%A7%84%E5%88%99%E7%9A%84%E5%B0%81%E9%97%AD%E5%8C%BA%E5%9F%9F%E5%86%85%EF%BC%88OC%EF%BC%89/</id>
    <published>2021-07-17T06:44:55.000Z</published>
    <updated>2021-07-17T06:44:55.000Z</updated>
    
    <content type="html"><![CDATA[<img src="https://tva1.sinaimg.cn/large/008i3skNgy1gsjy35qbfzj30d205zq32.jpg" alt="image.png" style="zoom:150%;" /><h2 id="1-åœ¨äºŒç»´ç©ºé—´åˆ›å»ºä¸è§„åˆ™å°é—­åŒºåŸŸ"><a href="#1-åœ¨äºŒç»´ç©ºé—´åˆ›å»ºä¸è§„åˆ™å°é—­åŒºåŸŸ" class="headerlink" title="1. åœ¨äºŒç»´ç©ºé—´åˆ›å»ºä¸è§„åˆ™å°é—­åŒºåŸŸ"></a>1. åœ¨äºŒç»´ç©ºé—´åˆ›å»ºä¸è§„åˆ™å°é—­åŒºåŸŸ</h2><h3 id="1-1-è·¯å¾„ç»˜å›¾"><a href="#1-1-è·¯å¾„ç»˜å›¾" class="headerlink" title="1.1 è·¯å¾„ç»˜å›¾"></a>1.1 è·¯å¾„ç»˜å›¾</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CGMutablePathRef pathRef = CGPathCreateMutable();</span><br></pre></td></tr></table></figure><h3 id="1-2-è·¯å¾„è¿çº¿"><a href="#1-2-è·¯å¾„è¿çº¿" class="headerlink" title="1.2 è·¯å¾„è¿çº¿"></a>1.2 è·¯å¾„è¿çº¿</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CGPathMoveToPoint(pathRef, NULL, 83.277656, -169.938307);</span><br><span class="line"></span><br><span class="line">CGPathAddLineToPoint(pathRef, NULL, 21.083895, -169.938307);</span><br><span class="line"></span><br><span class="line">CGPathAddLineToPoint(pathRef, NULL, 21.083895, -36.617291);</span><br><span class="line"></span><br><span class="line">CGPathAddLineToPoint(pathRef, NULL, 83.877837, -35.508388);</span><br><span class="line"></span><br><span class="line">CGPathAddLineToPoint(pathRef, NULL, 83.277656, -169.938307);</span><br></pre></td></tr></table></figure><h3 id="1-3-å…³é—­ç»˜å›¾"><a href="#1-3-å…³é—­ç»˜å›¾" class="headerlink" title="1.3 å…³é—­ç»˜å›¾"></a>1.3 å…³é—­ç»˜å›¾</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CGPathCloseSubpath(pathRef);</span><br></pre></td></tr></table></figure><h2 id="2-åˆ¤æ–­ä»»æ„ç‚¹æ˜¯å¦åœ¨æ­¤åŒºåŸŸå†…"><a href="#2-åˆ¤æ–­ä»»æ„ç‚¹æ˜¯å¦åœ¨æ­¤åŒºåŸŸå†…" class="headerlink" title="2. åˆ¤æ–­ä»»æ„ç‚¹æ˜¯å¦åœ¨æ­¤åŒºåŸŸå†…"></a>2. åˆ¤æ–­ä»»æ„ç‚¹æ˜¯å¦åœ¨æ­¤åŒºåŸŸå†…</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CGPoint point= CGPointMake(aircraftLocation.latitude, aircraftLocation.longitude);</span><br><span class="line"></span><br><span class="line">BOOL containsPoint = (CGPathContainsPoint(pathRef, NULL, point, NO));</span><br></pre></td></tr></table></figure><hr><blockquote><p><strong>ä¸ªäººåšå®¢:</strong> ğŸ¡ <a href="https://forgetsou.github.io/">ForgetSou</a></p></blockquote><hr>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;https://tva1.sinaimg.cn/large/008i3skNgy1gsjy35qbfzj30d205zq32.jpg&quot; alt=&quot;image.png&quot; style=&quot;zoom:150%;&quot;&gt;

&lt;h2 id=&quot;1-åœ¨äºŒç»´ç©ºé—´åˆ›å»ºä¸è§„åˆ™å°é—­åŒºåŸŸ&quot;&gt;&lt;a href=&quot;#1-åœ¨äºŒç»´ç©ºé—´åˆ›å»ºä¸è§„åˆ™å°é—­åŒºåŸŸ&quot; class=&quot;headerlink&quot; title=&quot;1. åœ¨äºŒç»´ç©ºé—´åˆ›å»ºä¸è§„åˆ™å°é—­åŒºåŸŸ&quot;&gt;&lt;/a&gt;1. åœ¨äºŒç»´ç©ºé—´åˆ›å»ºä¸è§„åˆ™å°é—­åŒºåŸŸ&lt;/h2&gt;&lt;h3 id=&quot;1-1-è·¯å¾„ç»˜å›¾&quot;&gt;&lt;a href=&quot;#1-1-è·¯å¾„ç»˜å›¾&quot; class=&quot;headerlink&quot; title=&quot;1.1 è·¯å¾„ç»˜å›¾&quot;&gt;&lt;/a&gt;1.1 è·¯å¾„ç»˜å›¾&lt;/h3&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;CGMutablePathRef pathRef = CGPathCreateMutable();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;1-2-è·¯å¾„è¿çº¿&quot;&gt;&lt;a href=&quot;#1-2-è·¯å¾„è¿çº¿&quot; class=&quot;headerlink&quot; title=&quot;1.2 è·¯å¾„è¿çº¿&quot;&gt;&lt;/a&gt;1.2 è·¯å¾„è¿çº¿&lt;/h3&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;CGPathMoveToPoint(pathRef, NULL, 83.277656, -169.938307);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CGPathAddLineToPoint(pathRef, NULL, 21.083895, -169.938307);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CGPathAddLineToPoint(pathRef, NULL, 21.083895, -36.617291);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CGPathAddLineToPoint(pathRef, NULL, 83.877837, -35.508388);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CGPathAddLineToPoint(pathRef, NULL, 83.277656, -169.938307);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;1-3-å…³é—­ç»˜å›¾&quot;&gt;&lt;a href=&quot;#1-3-å…³é—­ç»˜å›¾&quot; class=&quot;headerlink&quot; title=&quot;1.3 å…³é—­ç»˜å›¾&quot;&gt;&lt;/a&gt;1.3 å…³é—­ç»˜å›¾&lt;/h3&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;CGPathCloseSubpath(pathRef);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;2-åˆ¤æ–­ä»»æ„ç‚¹æ˜¯å¦åœ¨æ­¤åŒºåŸŸå†…&quot;&gt;&lt;a href=&quot;#2-åˆ¤æ–­ä»»æ„ç‚¹æ˜¯å¦åœ¨æ­¤åŒºåŸŸå†…&quot; class=&quot;headerlink&quot; title=&quot;2. åˆ¤æ–­ä»»æ„ç‚¹æ˜¯å¦åœ¨æ­¤åŒºåŸŸå†…&quot;&gt;&lt;/a&gt;2. åˆ¤æ–­ä»»æ„ç‚¹æ˜¯å¦åœ¨æ­¤åŒºåŸŸå†…&lt;/h2&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;CGPoint point= CGPointMake(aircraftLocation.latitude, aircraftLocation.longitude);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;BOOL containsPoint = (CGPathContainsPoint(pathRef, NULL, point, NO));&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="OC" scheme="https://forgetsou.github.io/categories/OC/"/>
    
    
    <category term="OC" scheme="https://forgetsou.github.io/tags/OC/"/>
    
    <category term="iOS" scheme="https://forgetsou.github.io/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>Appæ¶æ„-ç¼–ç¨‹è¯­è¨€ã€é¢å‘å¯¹è±¡æ€æƒ³</title>
    <link href="https://forgetsou.github.io/2021/07/17/App%E6%9E%B6%E6%9E%84-%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E6%80%9D%E6%83%B3/"/>
    <id>https://forgetsou.github.io/2021/07/17/App%E6%9E%B6%E6%9E%84-%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E6%80%9D%E6%83%B3/</id>
    <published>2021-07-17T06:28:08.000Z</published>
    <updated>2021-07-17T06:28:08.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Appæ¶æ„-ç¼–ç¨‹è¯­è¨€ã€é¢å‘å¯¹è±¡æ€æƒ³"><a href="#Appæ¶æ„-ç¼–ç¨‹è¯­è¨€ã€é¢å‘å¯¹è±¡æ€æƒ³" class="headerlink" title="Appæ¶æ„-ç¼–ç¨‹è¯­è¨€ã€é¢å‘å¯¹è±¡æ€æƒ³"></a>Appæ¶æ„-ç¼–ç¨‹è¯­è¨€ã€é¢å‘å¯¹è±¡æ€æƒ³</h2><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gsjxrmlihyj30yq0k0419.jpg" alt="Soul&amp;Sword"></p><p>å¦‚æœåªä¼šä¸€é—¨ç¼–ç¨‹è¯­è¨€ï¼Œæ— è®ºå¤šä¹ˆç²¾é€šï¼Œä»ç„¶æ˜¾å¾—ä¸å¤Ÿä¼˜ç§€ã€‚</p><p>åœ¨æˆ‘ä»¬è¿›è¡ŒAPPå¼€å‘è¿‡ç¨‹ä¸­è¦æŠŠæ¡å¥½ä»¥ä¸‹å‡ ç‚¹ï¼šæŠ“ä¸­å¿ƒã€çœ‹æœ¬è´¨ã€é‡æ€æƒ³ã€‚</p><h2 id="2-1-ç¼–ç¨‹è¯­è¨€"><a href="#2-1-ç¼–ç¨‹è¯­è¨€" class="headerlink" title="2.1 ç¼–ç¨‹è¯­è¨€"></a>2.1 ç¼–ç¨‹è¯­è¨€</h2><h3 id="2-1-1-Swift"><a href="#2-1-1-Swift" class="headerlink" title="2.1.1 Swift"></a>2.1.1 Swift</h3><p>Swiftæ˜¯Apple 2014å¹´ç¼–ç¨‹çš„ç¼–ç¨‹è¯­è¨€ï¼Œå·²æ”¯æŒ Android NDKã€‚</p><p>ä¸‹å›¾æ˜¯javaå’Œswiftå¯¹æ¯”ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gsjxrs0h6kj310q0u0dkf.jpg" alt="img"></p><h3 id="2-1-2-Optional"><a href="#2-1-2-Optional" class="headerlink" title="2.1.2 Optional"></a>2.1.2 Optional</h3><p>Swiftä¸­å¼•ç”¨äº†Optionalï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ç§æ–°çš„ç±»å‹ï¼Œå¾ˆå¥½åœ°è§£å†³äº†OCçš„â€œnil or not nilâ€é—®é¢˜ï¼ŒJava 8ä¹Ÿç”¨äº†Optionalã€‚Optionalçš„æ ¸å¿ƒæ€æƒ³æ˜¯é‡‡ç”¨<strong>å¥‘çº¦å¼</strong>ç¼–ç¨‹æ€æƒ³ï¼ˆå¦‚æ–­è¨€ï¼‰ï¼Œå°†é—®é¢˜æ˜¾æ€§çš„å‘ˆç°å‡ºæ¥ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹æºç ï¼Œäº†è§£Swift Optionalçš„å®šä¹‰ï¼ˆSwift/Stdlib/Public/Core/Optional.Swiftï¼‰ï¼Œå…¶æœ¬è´¨æ˜¯ä¸€ä¸ªæšä¸¾ï¼ŒåŒ…å«noneå’Œsomeï¼ˆWappedï¼‰ä¸¤ä¸ªcaseï¼Œåˆ†åˆ«ä»£è¡¨å¯é€‰ç±»å‹â€œæœ‰å€¼â€å’Œâ€œæ— å€¼â€ä¸¤ç§æƒ…å†µã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@frozen</span> <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Optional</span>  : <span class="title">ExpressibleByNilLiteral</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// The absence of a value.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// In code, the absence of a value is typically written using the `nil`</span></span><br><span class="line">    <span class="comment">/// literal rather than the explicit `.none` enumeration case.</span></span><br><span class="line">    <span class="keyword">case</span> none</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The presence of a value, stored as `Wrapped`.</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">some</span>(<span class="type">Wrapped</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Creates an instance that stores the given value.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">some</span>: <span class="type">Wrapped</span>)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Evaluates the given closure when this `Optional` instance is not `nil`,</span></span><br><span class="line">    <span class="comment">/// passing the unwrapped value as a parameter.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// Use the `map` method with a closure that returns a non-optional value.</span></span><br><span class="line">    <span class="comment">/// This example performs an arithmetic operation on an</span></span><br><span class="line">    <span class="comment">/// optional integer.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">///     let possibleNumber: Int? = Int(&quot;42&quot;)</span></span><br><span class="line">    <span class="comment">///     let possibleSquare = possibleNumber.map &#123; $0 * $0 &#125;</span></span><br><span class="line">    <span class="comment">///     print(possibleSquare)</span></span><br><span class="line">    <span class="comment">///     // Prints &quot;Optional(1764)&quot;</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">///     let noNumber: Int? = nil</span></span><br><span class="line">    <span class="comment">///     let noSquare = noNumber.map &#123; $0 * $0 &#125;</span></span><br><span class="line">    <span class="comment">///     print(noSquare)</span></span><br><span class="line">    <span class="comment">///     // Prints &quot;nil&quot;</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameter transform: A closure that takes the unwrapped value</span></span><br><span class="line">    <span class="comment">///   of the instance.</span></span><br><span class="line">    <span class="comment">/// - Returns: The result of the given closure. If this instance is `nil`,</span></span><br><span class="line">    <span class="comment">///   returns `nil`.</span></span><br><span class="line">    <span class="keyword">@inlinable</span> <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">map</span>&lt;<span class="type">U</span>&gt;(<span class="keyword">_</span> <span class="params">transform</span>: (<span class="type">Wrapped</span>) <span class="keyword">throws</span> -&gt; <span class="type">U</span>)</span> <span class="keyword">rethrows</span> -&gt; <span class="type">U</span>?</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Evaluates the given closure when this `Optional` instance is not `nil`,</span></span><br><span class="line">    <span class="comment">/// passing the unwrapped value as a parameter.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// Use the `flatMap` method with a closure that returns an optional value.</span></span><br><span class="line">    <span class="comment">/// This example performs an arithmetic operation with an optional result on</span></span><br><span class="line">    <span class="comment">/// an optional integer.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">///     let possibleNumber: Int? = Int(&quot;42&quot;)</span></span><br><span class="line">    <span class="comment">///     let nonOverflowingSquare = possibleNumber.flatMap &#123; x -&gt; Int? in</span></span><br><span class="line">    <span class="comment">///         let (result, overflowed) = x.multipliedReportingOverflow(by: x)</span></span><br><span class="line">    <span class="comment">///         return overflowed ? nil : result</span></span><br><span class="line">    <span class="comment">///     &#125;</span></span><br><span class="line">    <span class="comment">///     print(nonOverflowingSquare)</span></span><br><span class="line">    <span class="comment">///     // Prints &quot;Optional(1764)&quot;</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameter transform: A closure that takes the unwrapped value</span></span><br><span class="line">    <span class="comment">///   of the instance.  </span></span><br><span class="line">    <span class="comment">/// - Returns: The result of the given closure. If this instance is `nil`,</span></span><br><span class="line">    <span class="comment">///   returns `nil`.</span></span><br><span class="line">    <span class="keyword">@inlinable</span> <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">flatMap</span>&lt;<span class="type">U</span>&gt;(<span class="keyword">_</span> <span class="params">transform</span>: (<span class="type">Wrapped</span>) <span class="keyword">throws</span> -&gt; <span class="type">U</span>?)</span> <span class="keyword">rethrows</span> -&gt; <span class="type">U</span>?</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Creates an instance initialized with `nil`.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// Do not call this initializer directly. It is used by the compiler when you</span></span><br><span class="line">    <span class="comment">/// initialize an `Optional` instance with a `nil` literal. For example:</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">///     var i: Index? = nil</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// In this example, the assignment to the `i` variable calls this</span></span><br><span class="line">    <span class="comment">/// initializer behind the scenes.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">init</span>(<span class="params">nilLiteral</span>: ())</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The wrapped value of this instance, unwrapped without checking whether</span></span><br><span class="line">    <span class="comment">/// the instance is `nil`.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// The `unsafelyUnwrapped` property provides the same value as the forced</span></span><br><span class="line">    <span class="comment">/// unwrap operator (postfix `!`). However, in optimized builds (`-O`), no</span></span><br><span class="line">    <span class="comment">/// check is performed to ensure that the current instance actually has a</span></span><br><span class="line">    <span class="comment">/// value. Accessing this property in the case of a `nil` value is a serious</span></span><br><span class="line">    <span class="comment">/// programming error and could lead to undefined behavior or a runtime</span></span><br><span class="line">    <span class="comment">/// error.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// In debug builds (`-Onone`), the `unsafelyUnwrapped` property has the same</span></span><br><span class="line">    <span class="comment">/// behavior as using the postfix `!` operator and triggers a runtime error</span></span><br><span class="line">    <span class="comment">/// if the instance is `nil`.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// The `unsafelyUnwrapped` property is recommended over calling the</span></span><br><span class="line">    <span class="comment">/// `unsafeBitCast(_:)` function because the property is more restrictive</span></span><br><span class="line">    <span class="comment">/// and because accessing the property still performs checking in debug</span></span><br><span class="line">    <span class="comment">/// builds.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Warning: This property trades safety for performance.  Use</span></span><br><span class="line">    <span class="comment">///   `unsafelyUnwrapped` only when you are confident that this instance</span></span><br><span class="line">    <span class="comment">///   will never be equal to `nil` and only after you&#x27;ve tried using the</span></span><br><span class="line">    <span class="comment">///   postfix `!` operator.</span></span><br><span class="line">    <span class="keyword">@inlinable</span> <span class="keyword">public</span> <span class="keyword">var</span> unsafelyUnwrapped: <span class="type">Wrapped</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Returns a Boolean value indicating whether an argument matches `nil`.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// You can use the pattern-matching operator (`~=`) to test whether an</span></span><br><span class="line">    <span class="comment">/// optional instance is `nil` even when the wrapped value&#x27;s type does not</span></span><br><span class="line">    <span class="comment">/// conform to the `Equatable` protocol. The pattern-matching operator is used</span></span><br><span class="line">    <span class="comment">/// internally in `case` statements for pattern matching.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// The following example declares the `stream` variable as an optional</span></span><br><span class="line">    <span class="comment">/// instance of a hypothetical `DataStream` type, and then uses a `switch`</span></span><br><span class="line">    <span class="comment">/// statement to determine whether the stream is `nil` or has a configured</span></span><br><span class="line">    <span class="comment">/// value. When evaluating the `nil` case of the `switch` statement, this</span></span><br><span class="line">    <span class="comment">/// operator is called behind the scenes.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">///     var stream: DataStream? = nil</span></span><br><span class="line">    <span class="comment">///     switch stream &#123;</span></span><br><span class="line">    <span class="comment">///     case nil:</span></span><br><span class="line">    <span class="comment">///         print(&quot;No data stream is configured.&quot;)</span></span><br><span class="line">    <span class="comment">///     case let x?:</span></span><br><span class="line">    <span class="comment">///         print(&quot;The data stream has \(x.availableBytes) bytes available.&quot;)</span></span><br><span class="line">    <span class="comment">///     &#125;</span></span><br><span class="line">    <span class="comment">///     // Prints &quot;No data stream is configured.&quot;</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Note: To test whether an instance is `nil` in an `if` statement, use the</span></span><br><span class="line">    <span class="comment">///   equal-to operator (`==`) instead of the pattern-matching operator. The</span></span><br><span class="line">    <span class="comment">///   pattern-matching operator is primarily intended to enable `case`</span></span><br><span class="line">    <span class="comment">///   statement pattern matching.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameters:</span></span><br><span class="line">    <span class="comment">///   - lhs: A `nil` literal.</span></span><br><span class="line">    <span class="comment">///   - rhs: A value to match against `nil`.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">~=</span> (<span class="params">lhs</span>: _OptionalNilComparisonType, <span class="params">rhs</span>: <span class="type">Wrapped</span>?)</span> -&gt; <span class="type">Bool</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Returns a Boolean value indicating whether the left-hand-side argument is</span></span><br><span class="line">    <span class="comment">/// `nil`.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// You can use this equal-to operator (`==`) to test whether an optional</span></span><br><span class="line">    <span class="comment">/// instance is `nil` even when the wrapped value&#x27;s type does not conform to</span></span><br><span class="line">    <span class="comment">/// the `Equatable` protocol.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// The following example declares the `stream` variable as an optional</span></span><br><span class="line">    <span class="comment">/// instance of a hypothetical `DataStream` type. Although `DataStream` is not</span></span><br><span class="line">    <span class="comment">/// an `Equatable` type, this operator allows checking whether `stream` is</span></span><br><span class="line">    <span class="comment">/// `nil`.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">///     var stream: DataStream? = nil</span></span><br><span class="line">    <span class="comment">///     if stream == nil &#123;</span></span><br><span class="line">    <span class="comment">///         print(&quot;No data stream is configured.&quot;)</span></span><br><span class="line">    <span class="comment">///     &#125;</span></span><br><span class="line">    <span class="comment">///     // Prints &quot;No data stream is configured.&quot;</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameters:</span></span><br><span class="line">    <span class="comment">///   - lhs: A value to compare to `nil`.</span></span><br><span class="line">    <span class="comment">///   - rhs: A `nil` literal.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">==</span> (<span class="params">lhs</span>: <span class="type">Wrapped</span>?, <span class="params">rhs</span>: _OptionalNilComparisonType)</span> -&gt; <span class="type">Bool</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Returns a Boolean value indicating whether the left-hand-side argument is</span></span><br><span class="line">    <span class="comment">/// not `nil`.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// You can use this not-equal-to operator (`!=`) to test whether an optional</span></span><br><span class="line">    <span class="comment">/// instance is not `nil` even when the wrapped value&#x27;s type does not conform</span></span><br><span class="line">    <span class="comment">/// to the `Equatable` protocol.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// The following example declares the `stream` variable as an optional</span></span><br><span class="line">    <span class="comment">/// instance of a hypothetical `DataStream` type. Although `DataStream` is not</span></span><br><span class="line">    <span class="comment">/// an `Equatable` type, this operator allows checking whether `stream` wraps</span></span><br><span class="line">    <span class="comment">/// a value and is therefore not `nil`.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">///     var stream: DataStream? = fetchDataStream()</span></span><br><span class="line">    <span class="comment">///     if stream != nil &#123;</span></span><br><span class="line">    <span class="comment">///         print(&quot;The data stream has been configured.&quot;)</span></span><br><span class="line">    <span class="comment">///     &#125;</span></span><br><span class="line">    <span class="comment">///     // Prints &quot;The data stream has been configured.&quot;</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameters:</span></span><br><span class="line">    <span class="comment">///   - lhs: A value to compare to `nil`.</span></span><br><span class="line">    <span class="comment">///   - rhs: A `nil` literal.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">!=</span> (<span class="params">lhs</span>: <span class="type">Wrapped</span>?, <span class="params">rhs</span>: _OptionalNilComparisonType)</span> -&gt; <span class="type">Bool</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Returns a Boolean value indicating whether the right-hand-side argument is</span></span><br><span class="line">    <span class="comment">/// `nil`.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// You can use this equal-to operator (`==`) to test whether an optional</span></span><br><span class="line">    <span class="comment">/// instance is `nil` even when the wrapped value&#x27;s type does not conform to</span></span><br><span class="line">    <span class="comment">/// the `Equatable` protocol.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// The following example declares the `stream` variable as an optional</span></span><br><span class="line">    <span class="comment">/// instance of a hypothetical `DataStream` type. Although `DataStream` is not</span></span><br><span class="line">    <span class="comment">/// an `Equatable` type, this operator allows checking whether `stream` is</span></span><br><span class="line">    <span class="comment">/// `nil`.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">///     var stream: DataStream? = nil</span></span><br><span class="line">    <span class="comment">///     if nil == stream &#123;</span></span><br><span class="line">    <span class="comment">///         print(&quot;No data stream is configured.&quot;)</span></span><br><span class="line">    <span class="comment">///     &#125;</span></span><br><span class="line">    <span class="comment">///     // Prints &quot;No data stream is configured.&quot;</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameters:</span></span><br><span class="line">    <span class="comment">///   - lhs: A `nil` literal.</span></span><br><span class="line">    <span class="comment">///   - rhs: A value to compare to `nil`.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">==</span> (<span class="params">lhs</span>: _OptionalNilComparisonType, <span class="params">rhs</span>: <span class="type">Wrapped</span>?)</span> -&gt; <span class="type">Bool</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Returns a Boolean value indicating whether the right-hand-side argument is</span></span><br><span class="line">    <span class="comment">/// not `nil`.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// You can use this not-equal-to operator (`!=`) to test whether an optional</span></span><br><span class="line">    <span class="comment">/// instance is not `nil` even when the wrapped value&#x27;s type does not conform</span></span><br><span class="line">    <span class="comment">/// to the `Equatable` protocol.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// The following example declares the `stream` variable as an optional</span></span><br><span class="line">    <span class="comment">/// instance of a hypothetical `DataStream` type. Although `DataStream` is not</span></span><br><span class="line">    <span class="comment">/// an `Equatable` type, this operator allows checking whether `stream` wraps</span></span><br><span class="line">    <span class="comment">/// a value and is therefore not `nil`.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">///     var stream: DataStream? = fetchDataStream()</span></span><br><span class="line">    <span class="comment">///     if nil != stream &#123;</span></span><br><span class="line">    <span class="comment">///         print(&quot;The data stream has been configured.&quot;)</span></span><br><span class="line">    <span class="comment">///     &#125;</span></span><br><span class="line">    <span class="comment">///     // Prints &quot;The data stream has been configured.&quot;</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameters:</span></span><br><span class="line">    <span class="comment">///   - lhs: A `nil` literal.</span></span><br><span class="line">    <span class="comment">///   - rhs: A value to compare to `nil`.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">!=</span> (<span class="params">lhs</span>: _OptionalNilComparisonType, <span class="params">rhs</span>: <span class="type">Wrapped</span>?)</span> -&gt; <span class="type">Bool</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-1-3-Java-å’Œ-Swiftæ ¸å¿ƒè¯­æ³•å¯¹æ¯”"><a href="#2-1-3-Java-å’Œ-Swiftæ ¸å¿ƒè¯­æ³•å¯¹æ¯”" class="headerlink" title="2.1.3 Java å’Œ Swiftæ ¸å¿ƒè¯­æ³•å¯¹æ¯”"></a>2.1.3 Java å’Œ Swiftæ ¸å¿ƒè¯­æ³•å¯¹æ¯”</h3><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gsjxryu9ycj30zg0u045i.jpg" alt="img"></p><p>ä¸‹é¢æˆ‘ä»¬å¯¹æ¯”ä¸‹Java/Guavaå’ŒSwiftä¸­å¯¹Optionalçš„ä½¿ç”¨ï¼Œæœ€ç»ˆå‘ç°Javaå’ŒGuavaéå¸¸ç›¸ä¼¼ã€‚</p><ul><li>åˆå§‹åŒ–</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Optional xx= Optional.empty(); <span class="comment">// java8</span></span><br><span class="line"></span><br><span class="line">Optional xx= Optional.absent(); <span class="comment">// guava </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xx: XX?; <span class="comment">// guava</span></span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºå¯¹è±¡</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// java8</span></span><br><span class="line">Optional&lt;Integer&gt; xx = Optional.of (<span class="number">12</span>);Optional&lt;Integer&gt; xx = Optional.ofNullable(<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// guava</span></span><br><span class="line">Optional&lt;Integer&gt; = Optional.of(<span class="number">12</span>);</span><br><span class="line"></span><br><span class="line">Optional&lt;Integer&gt;  = Optional.fromNullable(<span class="keyword">null</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Swift</span></span><br><span class="line"><span class="keyword">var</span> xx: <span class="type">Int</span>? <span class="operator">=</span> <span class="number">12</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xx: <span class="type">Int</span>?</span><br></pre></td></tr></table></figure><ul><li>æ˜¯å¦å­˜åœ¨</li></ul><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  java</span></span><br><span class="line"><span class="keyword">if</span> (xx.isPresent()) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// guava</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (xx.isPresent()) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// swift</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> xx<span class="operator">=</span> xx &#123;)</span><br></pre></td></tr></table></figure><h2 id="2-2-é¢å‘å¯¹è±¡æ€æƒ³"><a href="#2-2-é¢å‘å¯¹è±¡æ€æƒ³" class="headerlink" title="2.2 é¢å‘å¯¹è±¡æ€æƒ³"></a>2.2 é¢å‘å¯¹è±¡æ€æƒ³</h2><h3 id="2-2-1-ç¼–ç¨‹èŒƒå¼-Programming-Paradigm"><a href="#2-2-1-ç¼–ç¨‹èŒƒå¼-Programming-Paradigm" class="headerlink" title="2.2.1 ç¼–ç¨‹èŒƒå¼(Programming Paradigm)"></a>2.2.1 ç¼–ç¨‹èŒƒå¼(Programming Paradigm)</h3><p>ç¼–ç¨‹èŒƒå¼æ˜¯ç¼–ç¨‹è¯­è¨€çš„ä¸€ç§åˆ†ç±»ï¼Œå¹¶ä¸æ˜¯é’ˆå¯¹å“ªç§å…·ä½“ç¼–ç¨‹è¯­è¨€ï¼Œä¸€ç§è¯­è¨€ä¹Ÿå¯ä»¥é€‚ç”¨å¤šç§ç¼–ç¨‹èŒƒå¼ã€‚</p><p>ç¼–ç¨‹èŒƒå¼/ç¼–ç¨‹èŒƒå‹ï¼Œæ˜¯æŒ‡ä»äº‹è½¯ä»¶å·¥ç¨‹çš„ä¸€ç§å…¸å‹çš„ç¼–ç¨‹é£æ ¼ï¼ˆå¯ä»¥å¯¹ç…§æ–¹æ³•å­¦ï¼‰ï¼Œä¾‹å¦‚ï¼Œå‡½æ•°å¼ç¼–ç¨‹ã€é¢å‘å¯¹è±¡ç¼–ç¨‹ç­‰ä¸ºä¸åŒçš„ç¼–ç¨‹èŒƒå¼ã€‚</p><p>å¸¸è§çš„ç¼–ç¨‹èŒƒå¼æœ‰è¿‡ç¨‹åŒ–ï¼ˆå‘½ä»¤åŒ–ï¼‰ç¼–ç¨‹ã€äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ã€é¢å‘å¯¹è±¡ç¼–ç¨‹åŠå‡½æ•°å¼ç¼–ç¨‹ç­‰ã€‚</p><ul><li><p>è¿‡ç¨‹åŒ–ï¼ˆå‘½ä»¤å¼ï¼‰ç¼–ç¨‹ã€‚å¦‚å°†æœºå™¨/æ±‡ç¼–è¯­è¨€ã€BASICã€Cã€ForTRANç­‰æ”¯æŒè¿‡ç¨‹åŒ–çš„ç¼–ç¨‹èŒƒå¼çš„ç¼–ç¨‹è¯­è¨€å½’çº³ä¸ºè¿‡ç¨‹æ˜¯ç¼–ç¨‹è¯­è¨€ï¼Œç‰¹åˆ«é€‚åˆè§£å†³ç°è¡Œçš„ç®—æ³•é—®é¢˜ï¼Œå±äºå…¸å‹çš„ç¨‹åºæµç¨‹æ€æƒ³ã€‚</p></li><li><p>äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ã€‚ç»“åˆå›¾å½¢ç”¨æˆ·ç•Œé¢ï¼ˆGUIï¼‰ç¼–ç¨‹åº”ç”¨ã€‚</p></li><li><p>é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰ã€‚é¢å‘å¯¹è±¡çš„åŸºæœ¬æ¦‚å¿µâ€“å°è£…ã€ç»§æ‰¿ã€å¤šæ€ï¼Œé€šè¿‡ç±»ã€æ–¹æ³•ã€å¯¹è±¡å’Œæ¶ˆæ¯ä¼ é€’ï¼Œæ¥æ”¯æŒé¢å‘å¯¹è±¡çš„ç¨‹åºè®¾è®¡èŒƒå¼ï¼ŒJavaå’ŒC++éƒ½æ˜¯é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ã€‚</p></li><li><p>å‡½æ•°ç¼–ç¨‹ã€‚å‡½æ•°ç¼–ç¨‹æ˜¯ä¸€ç§ç»“æ„åŒ–ç¼–ç¨‹ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯æŠŠè¿ç®—è¿‡ç¨‹å°½é‡æºç¨‹ä¸€äº›åˆ—åµŒå¥—çš„å‡½æ•°è°ƒç”¨ï¼Œåœ¨ä»£ç å»ºè§£è¯»ã€ä»£ç ç®¡ç†ã€å¹¶å‘ç¼–ç¨‹ä¸Šæ›´åŠ ä¾¿æ·ï¼Œè¿™æ˜¯ç»§OOä¹‹åè¶Šæ¥è¶Šç«çƒ­çš„ä¸€ç§ç¼–ç¨‹èŒƒå¼ã€‚</p></li><li><p>é¢å‘åˆ‡å‘ç¼–ç¨‹ï¼ˆAOPï¼‰ã€‚AOPå¯ä»¥è®¤ä¸ºæ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€ç§è¡ç”ŸèŒƒå‹ï¼Œåˆ©ç”¨AOPå¯ä»¥å¯¹ä¸šåŠ¡é€»è¾‘çš„å„ä¸ªéƒ¨åˆ†è¿›è¡Œéš”ç¦»ï¼Œä½¿å¾—ä¸šåŠ¡é€»è¾‘å„éƒ¨åˆ†ä¹‹é—´çš„è€¦åˆåº¦é™ä½ï¼Œæé«˜ç¨‹åºçš„å¯é‡ç”¨æ€§ï¼Œä»è€Œæé«˜å¼€å‘æ•ˆç‡ã€‚</p></li></ul><h3 id="2-2-2-å°è£…ã€ç»§æ‰¿å’Œå¤šæ€"><a href="#2-2-2-å°è£…ã€ç»§æ‰¿å’Œå¤šæ€" class="headerlink" title="2.2.2 å°è£…ã€ç»§æ‰¿å’Œå¤šæ€"></a>2.2.2 å°è£…ã€ç»§æ‰¿å’Œå¤šæ€</h3><p>OO</p><hr><blockquote><p><strong>ä¸ªäººåšå®¢:</strong> ğŸ¡ <a href="https://forgetsou.github.io/">ForgetSou</a></p></blockquote><hr>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Appæ¶æ„-ç¼–ç¨‹è¯­è¨€ã€é¢å‘å¯¹è±¡æ€æƒ³&quot;&gt;&lt;a href=&quot;#Appæ¶æ„-ç¼–ç¨‹è¯­è¨€ã€é¢å‘å¯¹è±¡æ€æƒ³&quot; class=&quot;headerlink&quot; title=&quot;Appæ¶æ„-ç¼–ç¨‹è¯­è¨€ã€é¢å‘å¯¹è±¡æ€æƒ³&quot;&gt;&lt;/a&gt;Appæ¶æ„-ç¼–ç¨‹è¯­è¨€ã€é¢å‘å¯¹è±¡æ€æƒ³&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/008i3skNgy1gsjxrmlihyj30yq0k0419.jpg&quot; alt=&quot;Soul&amp;amp;Sword&quot;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœåªä¼šä¸€é—¨ç¼–ç¨‹è¯­è¨€ï¼Œæ— è®ºå¤šä¹ˆç²¾é€šï¼Œä»ç„¶æ˜¾å¾—ä¸å¤Ÿä¼˜ç§€ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬è¿›è¡ŒAPPå¼€å‘è¿‡ç¨‹ä¸­è¦æŠŠæ¡å¥½ä»¥ä¸‹å‡ ç‚¹ï¼šæŠ“ä¸­å¿ƒã€çœ‹æœ¬è´¨ã€é‡æ€æƒ³ã€‚&lt;/p&gt;
&lt;h2 id=&quot;2-1-ç¼–ç¨‹è¯­è¨€&quot;&gt;&lt;a href=&quot;#2-1-ç¼–ç¨‹è¯­è¨€&quot; class=&quot;headerlink&quot; title=&quot;2.1 ç¼–ç¨‹è¯­è¨€&quot;&gt;&lt;/a&gt;2.1 ç¼–ç¨‹è¯­è¨€&lt;/h2&gt;&lt;h3 id=&quot;2-1-1-Swift&quot;&gt;&lt;a href=&quot;#2-1-1-Swift&quot; class=&quot;headerlink&quot; title=&quot;2.1.1 Swift&quot;&gt;&lt;/a&gt;2.1.1 Swift&lt;/h3&gt;&lt;p&gt;Swiftæ˜¯Apple 2014å¹´ç¼–ç¨‹çš„ç¼–ç¨‹è¯­è¨€ï¼Œå·²æ”¯æŒ Android NDKã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾æ˜¯javaå’Œswiftå¯¹æ¯”ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/008i3skNgy1gsjxrs0h6kj310q0u0dkf.jpg&quot; alt=&quot;img&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;2-1-2-Optional&quot;&gt;&lt;a href=&quot;#2-1-2-Optional&quot; class=&quot;headerlink&quot; title=&quot;2.1.2 Optional&quot;&gt;&lt;/a&gt;2.1.2 Optional&lt;/h3&gt;</summary>
    
    
    
    <category term="Other" scheme="https://forgetsou.github.io/categories/Other/"/>
    
    
    <category term="Appæ¶æ„" scheme="https://forgetsou.github.io/tags/App%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>Flutter-åˆ›å»ºåº•éƒ¨å¯¼èˆªæ </title>
    <link href="https://forgetsou.github.io/2020/12/25/Flutter-%E5%88%9B%E5%BB%BA%E5%BA%95%E9%83%A8%E5%AF%BC%E8%88%AA%E6%A0%8F/"/>
    <id>https://forgetsou.github.io/2020/12/25/Flutter-%E5%88%9B%E5%BB%BA%E5%BA%95%E9%83%A8%E5%AF%BC%E8%88%AA%E6%A0%8F/</id>
    <published>2020-12-25T06:47:48.000Z</published>
    <updated>2020-12-26T07:50:48.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>åº•éƒ¨å¯¼èˆªæ æ˜¯æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ç»å¸¸ç”¨åˆ°çš„å¯¼èˆªå·¥å…·ï¼Œç”¨äºåˆ‡æ¢åˆ°ä¸åŒçš„å±•ç¤ºé¡µï¼Œæ¯”å¦‚å¾®ä¿¡ã€æ”¯ä»˜å®ã€æ·˜å®ç­‰å¤§å‚APPéƒ½æ˜¯ä½¿ç”¨åº•éƒ¨å¯¼èˆªæ è®¾è®¡ï¼Œæ­¤è®¾è®¡ä¹Ÿç¬¦åˆç”¨æˆ·çš„ä½¿ç”¨ä¹ æƒ¯ï¼Œä¸‹é¢æˆ‘ä»¬ä½¿ç”¨<code>flutter</code>åˆ›å»ºä¸€ä¸ªç®€å•çš„åº•éƒ¨å·¥å…·æ ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gm04gvhc81j30u01sxtb1.jpg" alt="æ•ˆæœå›¾"></p><hr><h1 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h1><p>åœ¨fluuterå¼€å‘ä¸­ï¼Œä¸‡ç‰©çš†æ˜¯<code>Wdiget</code>, <code>flutter</code>å®˜æ–¹æä¾›çš„ä¸€ä¸ªåº•éƒ¨å¯¼èˆªç»„ä»¶<code>BottomNavigationBar</code>ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨<code>BottomNavigationBar</code>åˆ›å»ºã€‚</p><h2 id="æ–¹å¼ä¸€"><a href="#æ–¹å¼ä¸€" class="headerlink" title="æ–¹å¼ä¸€"></a><strong>æ–¹å¼ä¸€</strong></h2><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/foundation.dart&#x27;</span> <span class="keyword">show</span> SynchronousFuture;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_localizations/flutter_localizations.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() =&gt; runApp(<span class="keyword">new</span> MyApp());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ZDLocalizations</span> </span>&#123;</span><br><span class="line">  ZDLocalizations(<span class="keyword">this</span>.locale);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> Locale locale;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> ZDLocalizations of(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Localizations.of&lt;ZDLocalizations&gt;(context, ZDLocalizations);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">String</span>&gt;&gt; _localizedValues = &#123;</span><br><span class="line">    <span class="string">&#x27;en&#x27;</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;List View&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;zh&#x27;</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;åˆ—è¡¨è§†å›¾&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">String</span> <span class="keyword">get</span> title &#123;</span><br><span class="line">    <span class="keyword">return</span> _localizedValues[locale.languageCode][<span class="string">&#x27;title&#x27;</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DemoLocalizationsDelegate</span> <span class="keyword">extends</span> <span class="title">LocalizationsDelegate</span>&lt;<span class="title">ZDLocalizations</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> DemoLocalizationsDelegate();</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">bool</span> isSupported(Locale locale) =&gt; [<span class="string">&#x27;en&#x27;</span>, <span class="string">&#x27;zh&#x27;</span>].contains(locale.languageCode);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Future&lt;ZDLocalizations&gt; load(Locale locale) &#123;</span><br><span class="line">    <span class="comment">// Returning a SynchronousFuture here because an async &quot;load&quot; operation</span></span><br><span class="line">    <span class="comment">// isn&#x27;t needed to produce an instance of DemoLocalizations.</span></span><br><span class="line">    <span class="keyword">return</span> SynchronousFuture&lt;ZDLocalizations&gt;(ZDLocalizations(locale));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">bool</span> shouldReload(DemoLocalizationsDelegate old) =&gt; <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é™æ€ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">// final wordPair = new WordPair.random();</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MaterialApp(</span><br><span class="line">      debugShowCheckedModeBanner: <span class="keyword">false</span>,</span><br><span class="line">      home: <span class="keyword">new</span> CreateHome(),</span><br><span class="line">      theme: <span class="keyword">new</span> ThemeData(</span><br><span class="line">        primaryColor: Colors.orange,</span><br><span class="line">      ),</span><br><span class="line">      <span class="comment">// å›½é™…åŒ–</span></span><br><span class="line">      localizationsDelegates: [</span><br><span class="line">        <span class="keyword">const</span> DemoLocalizationsDelegate(),</span><br><span class="line">        GlobalMaterialLocalizations.delegate,</span><br><span class="line">        GlobalWidgetsLocalizations.delegate,</span><br><span class="line">      ],</span><br><span class="line">      supportedLocales: [<span class="keyword">const</span> Locale(<span class="string">&#x27;en&#x27;</span>, <span class="string">&#x27;&#x27;</span>), <span class="keyword">const</span> Locale(<span class="string">&#x27;zh&#x27;</span>, <span class="string">&#x27;&#x27;</span>)],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ¨æ€ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CreateHome</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  CreateHomeState createState() =&gt; CreateHomeState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CreateHomeState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">CreateHome</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">int</span> _currentIndex = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">final</span> _bodyOptions = [</span><br><span class="line">    Text(<span class="string">&#x27;ä¸»é¡µ&#x27;</span>),</span><br><span class="line">    Text(<span class="string">&#x27;å•†åŸ&#x27;</span>),</span><br><span class="line">    Text(<span class="string">&#x27;æ¶ˆæ¯&#x27;</span>),</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// IBAction</span></span><br><span class="line">  <span class="keyword">void</span> backOnPressed() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> menuOnPressed() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> onTabBarItemTapped(<span class="built_in">int</span> idx) &#123;</span><br><span class="line">    setState(() &#123;</span><br><span class="line">      _currentIndex = idx;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: _createAppBar(),</span><br><span class="line">      body: Center(child: _bodyOptions.elementAt(_currentIndex)),</span><br><span class="line">      bottomNavigationBar: _createTabBar(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Widget _createAppBar() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> AppBar(</span><br><span class="line">      brightness: Brightness.dark,</span><br><span class="line">      elevation: <span class="number">0.5</span>,</span><br><span class="line">      iconTheme: IconThemeData(color: Colors.white),</span><br><span class="line">      title: Text(</span><br><span class="line">        ZDLocalizations.of(context).title,</span><br><span class="line">        style: TextStyle(color: Colors.white),</span><br><span class="line">      ),</span><br><span class="line">      actions: [</span><br><span class="line">        IconButton(</span><br><span class="line">          icon: Icon(Icons.menu),</span><br><span class="line">          onPressed: menuOnPressed,</span><br><span class="line">        ),</span><br><span class="line">      ],</span><br><span class="line">      leading: IconButton(</span><br><span class="line">        icon: Icon(</span><br><span class="line">          Icons.arrow_back_ios,</span><br><span class="line">        ),</span><br><span class="line">        onPressed: backOnPressed,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Widget _createTabBar() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> BottomNavigationBar(</span><br><span class="line">      fixedColor: Colors.blue,</span><br><span class="line">      backgroundColor: Colors.orange,</span><br><span class="line">      currentIndex: _currentIndex,</span><br><span class="line">      onTap: onTabBarItemTapped,</span><br><span class="line">      items: [</span><br><span class="line">        BottomNavigationBarItem(icon: Icon(Icons.home), label: <span class="string">&#x27;ä¸»é¡µ&#x27;</span>),</span><br><span class="line">        BottomNavigationBarItem(icon: Icon(Icons.shop), label: <span class="string">&#x27;å•†åŸ&#x27;</span>),</span><br><span class="line">        BottomNavigationBarItem(icon: Icon(Icons.message), label: <span class="string">&#x27;æ¶ˆæ¯&#x27;</span>)</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜ï¼š</strong></p><p><strong><em>ä»¥ä¸Šä»£ç æœ‰å›½é™…åŒ–ç¤ºä¾‹éƒ¨åˆ†ï¼Œæœ¬åšä¸»æ¯”è¾ƒæ‡’ï¼Œå›½é™…åŒ–çš„å†…å®¹æ²¡åˆ é™¤ï¼Œç›´æ¥ä»å·¥ç¨‹é‡ŒCopyå‡ºæ¥çš„ã€‚</em></strong></p><h2 id="æ–¹å¼äºŒ"><a href="#æ–¹å¼äºŒ" class="headerlink" title="æ–¹å¼äºŒ"></a><strong>æ–¹å¼äºŒ</strong></h2><h3 id="åˆ›å»ºæ¨¡å—"><a href="#åˆ›å»ºæ¨¡å—" class="headerlink" title="åˆ›å»ºæ¨¡å—"></a>åˆ›å»ºæ¨¡å—</h3><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gm13sxt56lj306n035aa4.jpg" alt="æ¨¡å—åˆ’åˆ†"></p><blockquote><p>home_page           é¦–é¡µ<br>dialogue_page       å¯¹è¯<br>record_page          å½•éŸ³<br>mine_page             æˆ‘çš„</p></blockquote><p>åœ¨<code>home_page.dart</code>å†…æ·»åŠ æ¨¡å—ç»„ä»¶</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">        body: Container(</span><br><span class="line">      margin: EdgeInsets.only(top: <span class="number">0</span>, left: <span class="number">0</span>, bottom: <span class="number">0</span>, right: <span class="number">0</span>),</span><br><span class="line">      color: Colors.white,</span><br><span class="line">    ));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä»–æ¨¡å—åŒä¸Šï¼Œå…·ä½“æ¨¡å—çš„<code>Scaffold</code>å†…å®¹æ ¹æ®å…·ä½“ä¸šåŠ¡æ¥å®ç°ï¼Œæœ¬æ–‡ç›´æ¥å¤åˆ¶<code>home_page.dart</code>çš„å†…å®¹ï¼Œç•¥å¾®ä¿®æ”¹<code>Container</code>çš„é¢œè‰²ä»¥åŒºåˆ†æ¨¡å—ã€‚</p><h3 id="åˆ›å»ºç»„ä»¶æ§åˆ¶dart"><a href="#åˆ›å»ºç»„ä»¶æ§åˆ¶dart" class="headerlink" title="åˆ›å»ºç»„ä»¶æ§åˆ¶dart"></a>åˆ›å»ºç»„ä»¶æ§åˆ¶dart</h3><ol><li><p>å¯¼å…¥æ¨¡å—dart</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;pages/home_page.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;pages/dialogue_page.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;pages/record_page.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;pages/mine_page.dart&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li><p>æ·»åŠ åº•éƒ¨å¯¼èˆªæŒ‰é’®åŠç‚¹å‡»æ§åˆ¶</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexPage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _IndexPageState createState() =&gt; _IndexPageState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_IndexPageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">IndexPage</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// åº•éƒ¨å¯¼èˆªæŒ‰é’®æ•°ç»„</span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;BottomNavigationBarItem&gt; bottomTabs = [</span><br><span class="line">    BottomNavigationBarItem(</span><br><span class="line">      <span class="comment">// ä½¿ç”¨assetå›¾ç‰‡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç³»ç»Ÿæä¾›çš„å›¾ç‰‡ï¼Œå¦‚Icons.homeç­‰</span></span><br><span class="line">        icon: Image.asset(</span><br><span class="line">          <span class="string">&#x27;images/home_unselected.png&#x27;</span>,</span><br><span class="line">          width: <span class="number">18</span>,</span><br><span class="line">          height: <span class="number">18</span>,</span><br><span class="line">        ),</span><br><span class="line">        activeIcon: Image.asset(</span><br><span class="line">          <span class="string">&#x27;images/home_selected.png&#x27;</span>,</span><br><span class="line">          width: <span class="number">18</span>,</span><br><span class="line">          height: <span class="number">18</span>,</span><br><span class="line">        ),</span><br><span class="line">        label: <span class="string">&#x27;é¦–é¡µ&#x27;</span>),</span><br><span class="line">    BottomNavigationBarItem(</span><br><span class="line">        icon: Image.asset(</span><br><span class="line">          <span class="string">&#x27;images/dialogue_unselected.png&#x27;</span>,</span><br><span class="line">          width: <span class="number">18</span>,</span><br><span class="line">          height: <span class="number">18</span>,</span><br><span class="line">        ),</span><br><span class="line">        activeIcon: Image.asset(</span><br><span class="line">          <span class="string">&#x27;images/dialogue_selected.png&#x27;</span>,</span><br><span class="line">          width: <span class="number">18</span>,</span><br><span class="line">          height: <span class="number">18</span>,</span><br><span class="line">        ),</span><br><span class="line">        label: <span class="string">&#x27;å¯¹è¯ç¿»è¯‘&#x27;</span>),</span><br><span class="line">    BottomNavigationBarItem(</span><br><span class="line">        icon: Image.asset(</span><br><span class="line">          <span class="string">&#x27;images/record_unselected.png&#x27;</span>,</span><br><span class="line">          width: <span class="number">18</span>,</span><br><span class="line">          height: <span class="number">18</span>,</span><br><span class="line">        ),</span><br><span class="line">        activeIcon: Image.asset(</span><br><span class="line">          <span class="string">&#x27;images/record_selected.png&#x27;</span>,</span><br><span class="line">          width: <span class="number">18</span>,</span><br><span class="line">          height: <span class="number">18</span>,</span><br><span class="line">        ),</span><br><span class="line">        label: <span class="string">&#x27;å½•éŸ³ç¿»è¯‘&#x27;</span>),</span><br><span class="line">    BottomNavigationBarItem(</span><br><span class="line">        icon: Image.asset(</span><br><span class="line">          <span class="string">&#x27;images/mine_unselected.png&#x27;</span>,</span><br><span class="line">          width: <span class="number">18</span>,</span><br><span class="line">          height: <span class="number">18</span>,</span><br><span class="line">        ),</span><br><span class="line">        activeIcon: Image.asset(</span><br><span class="line">          <span class="string">&#x27;images/mine_selected.png&#x27;</span>,</span><br><span class="line">          width: <span class="number">18</span>,</span><br><span class="line">          height: <span class="number">18</span>,</span><br><span class="line">        ),</span><br><span class="line">        label: <span class="string">&#x27;æˆ‘çš„&#x27;</span>)</span><br><span class="line">  ];</span><br><span class="line">  <span class="comment">// æ¨¡å—å®¹å™¨æ•°ç»„</span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span> tabPages = [HomePage(), DialoguePage(), RecordPage(), MinePage()];</span><br><span class="line">  <span class="comment">// å½“å‰é€‰æ‹©index</span></span><br><span class="line">  <span class="built_in">int</span> currentIndex = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// å½“å‰é¡µ</span></span><br><span class="line">  <span class="keyword">var</span> currentPage;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    currentPage = tabPages[currentIndex];</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      bottomNavigationBar: BottomNavigationBar(</span><br><span class="line">        currentIndex: currentIndex,</span><br><span class="line">        backgroundColor: Colors.lightGreen,</span><br><span class="line">        type: BottomNavigationBarType.fixed,</span><br><span class="line">        <span class="comment">// elevation: 0,</span></span><br><span class="line">        items: bottomTabs,</span><br><span class="line">        onTap: (idx) &#123;</span><br><span class="line">          <span class="comment">// å¿…é¡»å®ç°setStateæ–¹æ³•</span></span><br><span class="line">          setState(() &#123;</span><br><span class="line">            currentIndex = idx;</span><br><span class="line">            currentPage = tabPages[idx];</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">      ),</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        backgroundColor: Colors.lightGreen,</span><br><span class="line">        title: Text(</span><br><span class="line">          bottomTabs[currentIndex].label,</span><br><span class="line">          style: TextStyle(color: Colors.orange),</span><br><span class="line">        ),</span><br><span class="line">        elevation: <span class="number">.5</span>,</span><br><span class="line">      ),</span><br><span class="line">      body: currentPage,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="å®ç°main-dart"><a href="#å®ç°main-dart" class="headerlink" title="å®ç°main.dart"></a>å®ç°main.dart</h3><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="comment">// 1.å¯¼å…¥index_page.dart</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index_page.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. è°ƒç”¨runApp</span></span><br><span class="line"><span class="keyword">void</span> main() =&gt; runApp(<span class="keyword">new</span> MyApp());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. å®ç°é™æ€ç»„ä»¶</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MaterialApp(</span><br><span class="line">      debugShowCheckedModeBanner: <span class="keyword">false</span>,</span><br><span class="line">      <span class="comment">// 4. è°ƒç”¨IndexPage()æ–¹æ³•ï¼Œå¡«å……ç»„ä»¶</span></span><br><span class="line">      home: IndexPage(),</span><br><span class="line">      theme: <span class="keyword">new</span> ThemeData(</span><br><span class="line">        primaryColor: Colors.orange,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç‰¹æ®Šæ•ˆæœ"><a href="#ç‰¹æ®Šæ•ˆæœ" class="headerlink" title="ç‰¹æ®Šæ•ˆæœ"></a>ç‰¹æ®Šæ•ˆæœ</h1><ol><li><strong>å‡¸å‡ºæ•ˆæœ</strong></li></ol><p>åœ¨æˆ‘ä»¬å¹³æ—¶å¼€å‘è¿‡ç¨‹ä¸­ä¸ä¸€å®šéƒ½æ˜¯è¿™ç§è§„åˆ™çš„åº•éƒ¨å¯¼èˆªï¼Œæœ‰æ—¶éœ€è¦æˆ‘ä»¬åšå‡ºä¸€äº›ç‰¹æ®Šå¤„ç†ï¼Œæ¯”å¦‚ä¸­é—´çš„itemå•å…ƒå‡¸å‡ºæ˜¾ç¤ºã€‚</p><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gm17uins7yj30km06eaao.jpg" alt="åº•éƒ¨å¯¼èˆªItemå•å…ƒå‡¸å‡ºæ˜¾ç¤º"></p><p>åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>Scaffold</code>ä¸­çš„<code>floatingActionButton</code>å±æ€§æ¥å®ç°è¿™ä¸ªæ•ˆæœ</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line">Widget build(BuildContext context) &#123;</span><br><span class="line">  <span class="keyword">return</span> Scaffold(</span><br><span class="line">    bottomNavigationBar: BottomNavigationBar(</span><br><span class="line">      currentIndex: currentIndex,</span><br><span class="line">      backgroundColor: Colors.white,</span><br><span class="line">      type: BottomNavigationBarType.fixed,</span><br><span class="line">      <span class="comment">// elevation: 0,</span></span><br><span class="line">      items: bottomTabs,</span><br><span class="line">      onTap: (idx) &#123;</span><br><span class="line">        setState(() &#123;</span><br><span class="line">          currentIndex = idx;</span><br><span class="line">          currentPage = tabPages[idx];</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">    ),</span><br><span class="line">    floatingActionButton: FloatingActionButton(</span><br><span class="line">      child: Icon(</span><br><span class="line">        Icons.add,</span><br><span class="line">        size: <span class="number">30</span>,</span><br><span class="line">      ),</span><br><span class="line">      onPressed: () &#123;</span><br><span class="line">        setState(() &#123;</span><br><span class="line">          currentIndex = <span class="number">2</span>;</span><br><span class="line">          currentPage = tabPages[<span class="number">2</span>];</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">      backgroundColor: Colors.orange,</span><br><span class="line">      foregroundColor: Colors.black,</span><br><span class="line">      elevation: <span class="number">5</span>,</span><br><span class="line">    ),</span><br><span class="line">    floatingActionButtonLocation: FloatingActionButtonLocation.centerDocked,</span><br><span class="line">    appBar: AppBar(</span><br><span class="line">      backgroundColor: Colors.lightGreen,</span><br><span class="line">      title: Text(</span><br><span class="line">        bottomTabs[currentIndex].label,</span><br><span class="line">        style: TextStyle(color: Colors.orange),</span><br><span class="line">      ),</span><br><span class="line">      elevation: <span class="number">0.5</span>,</span><br><span class="line">    ),</span><br><span class="line">    body: currentPage,</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li><p>å¤–å¼§æ•ˆæœ</p><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gm1esov26sj30kg06iwez.jpg" alt="åº•éƒ¨å¯¼èˆªå¤–å¼§æ˜¾ç¤º"></p></li></ol><p>åœ¨å‡¸å‡ºæ•ˆæœä»£ç åŸºç¡€ä¸Šåšä¿®æ”¹ï¼Œæ‰“å¼€<code>index_page.dart</code>ï¼Œä¿®æ”¹ä¸ºä»¥ä¸‹ä»£ç ï¼Œ</p><p><strong>æ³¨é‡Šæ‰å‡¸å‡ºæ•ˆæœçš„Stateä»£ç </strong></p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_OuterArcState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">IndexPage</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="comment">///<span class="markdown">åˆå§‹åŒ–ï¼Œè¿™ä¸ªå‡½æ•°åœ¨ç”Ÿå‘½å‘¨æœŸä¸­åªè°ƒç”¨ä¸€æ¬¡</span></span></span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">//æ„å»ºé¡µé¢</span></span><br><span class="line">    <span class="keyword">return</span> buildBottomTabScaffold();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//å½“å‰æ˜¾ç¤ºé¡µé¢çš„</span></span><br><span class="line">  <span class="built_in">int</span> currentIndex = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">//ç‚¹å‡»å¯¼èˆªé¡¹æ˜¯è¦æ˜¾ç¤ºçš„é¡µé¢</span></span><br><span class="line">  <span class="keyword">final</span> pages = [HomePage(), DialoguePage(), RecordPage(), MinePage()];</span><br><span class="line"></span><br><span class="line">  Widget buildBottomTabScaffold() &#123;</span><br><span class="line">    <span class="keyword">return</span> SizedBox(</span><br><span class="line">        height: <span class="number">100</span>,</span><br><span class="line">        child: Scaffold(</span><br><span class="line">          <span class="comment">//å¯¹åº”çš„é¡µé¢</span></span><br><span class="line">          body: pages[currentIndex],</span><br><span class="line">          <span class="comment">//appBar: AppBar(title: const Text(&#x27;Bottom App Bar&#x27;)),</span></span><br><span class="line">          <span class="comment">//æ‚¬æµ®æŒ‰é’®çš„ä½ç½®</span></span><br><span class="line">          floatingActionButtonLocation:</span><br><span class="line">              FloatingActionButtonLocation.centerDocked,</span><br><span class="line">          <span class="comment">//æ‚¬æµ®æŒ‰é’®</span></span><br><span class="line">          floatingActionButton: FloatingActionButton(</span><br><span class="line">            child: <span class="keyword">const</span> Icon(Icons.add),</span><br><span class="line">            onPressed: () &#123;&#125;,</span><br><span class="line">          ),</span><br><span class="line">          <span class="comment">//å…¶ä»–èœå•æ </span></span><br><span class="line">          bottomNavigationBar: BottomAppBar(</span><br><span class="line">            shape: CircularNotchedRectangle(),</span><br><span class="line">            notchMargin: <span class="number">6.0</span>,</span><br><span class="line">            color: Colors.white,</span><br><span class="line">            child: Row(</span><br><span class="line">              mainAxisSize: MainAxisSize.max,</span><br><span class="line">              mainAxisAlignment: MainAxisAlignment.spaceAround,</span><br><span class="line">              children: &lt;Widget&gt;[</span><br><span class="line">                buildBotomItem(currentIndex, <span class="number">0</span>, Icons.home, <span class="string">&quot;é¦–é¡µ&quot;</span>),</span><br><span class="line">                buildBotomItem(currentIndex, <span class="number">1</span>, Icons.chat, <span class="string">&quot;å¯¹è¯&quot;</span>),</span><br><span class="line">                buildBotomItem(currentIndex, <span class="number">-1</span>, <span class="keyword">null</span>, <span class="string">&quot;å•†åŸ&quot;</span>),</span><br><span class="line">                buildBotomItem(currentIndex, <span class="number">2</span>, Icons.mic, <span class="string">&quot;å½•éŸ³&quot;</span>),</span><br><span class="line">                buildBotomItem(currentIndex, <span class="number">3</span>, Icons.person, <span class="string">&quot;æˆ‘çš„&quot;</span>),</span><br><span class="line">              ],</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  buildBotomItem(<span class="built_in">int</span> selectIndex, <span class="built_in">int</span> index, IconData iconData, <span class="built_in">String</span> title) &#123;</span><br><span class="line">    <span class="comment">//æœªé€‰ä¸­çŠ¶æ€çš„æ ·å¼</span></span><br><span class="line">    TextStyle textStyle = TextStyle(fontSize: <span class="number">12.0</span>, color: Colors.grey);</span><br><span class="line">    MaterialColor iconColor = Colors.grey;</span><br><span class="line">    <span class="built_in">double</span> iconSize = <span class="number">20</span>;</span><br><span class="line">    EdgeInsetsGeometry padding = EdgeInsets.only(top: <span class="number">8.0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (selectIndex == index) &#123;</span><br><span class="line">      <span class="comment">//é€‰ä¸­çŠ¶æ€çš„æ–‡å­—æ ·å¼</span></span><br><span class="line">      textStyle = TextStyle(fontSize: <span class="number">13.0</span>, color: Colors.blue);</span><br><span class="line">      <span class="comment">//é€‰ä¸­çŠ¶æ€çš„æŒ‰é’®æ ·å¼</span></span><br><span class="line">      iconColor = Colors.blue;</span><br><span class="line">      iconSize = <span class="number">25</span>;</span><br><span class="line">      padding = EdgeInsets.only(top: <span class="number">6.0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    Widget padItem = SizedBox();</span><br><span class="line">    <span class="keyword">if</span> (iconData != <span class="keyword">null</span>) &#123;</span><br><span class="line">      padItem = Padding(</span><br><span class="line">        padding: padding,</span><br><span class="line">        child: Container(</span><br><span class="line">          color: Colors.white,</span><br><span class="line">          child: Center(</span><br><span class="line">            child: Column(</span><br><span class="line">              children: &lt;Widget&gt;[</span><br><span class="line">                Icon(</span><br><span class="line">                  iconData,</span><br><span class="line">                  color: iconColor,</span><br><span class="line">                  size: iconSize,</span><br><span class="line">                ),</span><br><span class="line">                Text(</span><br><span class="line">                  title,</span><br><span class="line">                  style: textStyle,</span><br><span class="line">                )</span><br><span class="line">              ],</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    Widget item = Expanded(</span><br><span class="line">      flex: <span class="number">1</span>,</span><br><span class="line">      child: <span class="keyword">new</span> GestureDetector(</span><br><span class="line">        onTap: () &#123;</span><br><span class="line">          <span class="keyword">if</span> (index != currentIndex) &#123;</span><br><span class="line">            setState(() &#123;</span><br><span class="line">              currentIndex = index;</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        child: SizedBox(</span><br><span class="line">          height: <span class="number">52</span>,</span><br><span class="line">          child: padItem,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> item;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>#Demo</p><p><a href="https://github.com/ForgetSou/FSFlutterDemo.git">GitHub ~ FSFlutterDemo</a></p><hr><blockquote><p><strong>ä¸ªäººåšå®¢:</strong> ğŸ¡ <a href="https://forgetsou.github.io/">ForgetSou</a></p></blockquote><hr>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;ç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç®€ä»‹&quot;&gt;&lt;/a&gt;ç®€ä»‹&lt;/h1&gt;&lt;p&gt;åº•éƒ¨å¯¼èˆªæ æ˜¯æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ç»å¸¸ç”¨åˆ°çš„å¯¼èˆªå·¥å…·ï¼Œç”¨äºåˆ‡æ¢åˆ°ä¸åŒçš„å±•ç¤ºé¡µï¼Œæ¯”å¦‚å¾®ä¿¡ã€æ”¯ä»˜å®ã€æ·˜å®ç­‰å¤§å‚APPéƒ½æ˜¯ä½¿ç”¨åº•éƒ¨å¯¼èˆªæ è®¾è®¡ï¼Œæ­¤è®¾è®¡ä¹Ÿç¬¦åˆç”¨æˆ·çš„ä½¿ç”¨ä¹ æƒ¯ï¼Œä¸‹é¢æˆ‘ä»¬ä½¿ç”¨&lt;code&gt;flutter&lt;/code&gt;åˆ›å»ºä¸€ä¸ªç®€å•çš„åº•éƒ¨å·¥å…·æ ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/0081Kckwly1gm04gvhc81j30u01sxtb1.jpg&quot; alt=&quot;æ•ˆæœå›¾&quot;&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&quot;ç¤ºä¾‹&quot;&gt;&lt;a href=&quot;#ç¤ºä¾‹&quot; class=&quot;headerlink&quot; title=&quot;ç¤ºä¾‹&quot;&gt;&lt;/a&gt;ç¤ºä¾‹&lt;/h1&gt;&lt;p&gt;åœ¨fluuterå¼€å‘ä¸­ï¼Œä¸‡ç‰©çš†æ˜¯&lt;code&gt;Wdiget&lt;/code&gt;, &lt;code&gt;flutter&lt;/code&gt;å®˜æ–¹æä¾›çš„ä¸€ä¸ªåº•éƒ¨å¯¼èˆªç»„ä»¶&lt;code&gt;BottomNavigationBar&lt;/code&gt;ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨&lt;code&gt;BottomNavigationBar&lt;/code&gt;åˆ›å»ºã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ–¹å¼ä¸€&quot;&gt;&lt;a href=&quot;#æ–¹å¼ä¸€&quot; class=&quot;headerlink&quot; title=&quot;æ–¹å¼ä¸€&quot;&gt;&lt;/a&gt;&lt;strong&gt;æ–¹å¼ä¸€&lt;/strong&gt;&lt;/h2&gt;&lt;figure class=&quot;highlight dart&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;package:flutter/material.dart&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;package:flutter/foundation.dart&amp;#x27;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;show&lt;/span&gt; SynchronousFuture;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;package:flutter_localizations/flutter_localizations.dart&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; main() =&amp;gt; runApp(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MyApp());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ZDLocalizations&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ZDLocalizations(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.locale);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Locale locale;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; ZDLocalizations of(BuildContext context) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; Localizations.of&amp;lt;ZDLocalizations&amp;gt;(context, ZDLocalizations);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;Map&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;Map&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;String&lt;/span&gt;&amp;gt;&amp;gt; _localizedValues = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&amp;#x27;en&amp;#x27;&lt;/span&gt;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;string&quot;&gt;&amp;#x27;title&amp;#x27;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;List View&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&amp;#x27;zh&amp;#x27;&lt;/span&gt;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;string&quot;&gt;&amp;#x27;title&amp;#x27;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;åˆ—è¡¨è§†å›¾&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;get&lt;/span&gt; title &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; _localizedValues[locale.languageCode][&lt;span class=&quot;string&quot;&gt;&amp;#x27;title&amp;#x27;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;DemoLocalizationsDelegate&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;LocalizationsDelegate&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;ZDLocalizations&lt;/span&gt;&amp;gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; DemoLocalizationsDelegate();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;meta&quot;&gt;@override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;bool&lt;/span&gt; isSupported(Locale locale) =&amp;gt; [&lt;span class=&quot;string&quot;&gt;&amp;#x27;en&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;zh&amp;#x27;&lt;/span&gt;].contains(locale.languageCode);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;meta&quot;&gt;@override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Future&amp;lt;ZDLocalizations&amp;gt; load(Locale locale) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// Returning a SynchronousFuture here because an async &amp;quot;load&amp;quot; operation&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// isn&amp;#x27;t needed to produce an instance of DemoLocalizations.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; SynchronousFuture&amp;lt;ZDLocalizations&amp;gt;(ZDLocalizations(locale));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;meta&quot;&gt;@override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;bool&lt;/span&gt; shouldReload(DemoLocalizationsDelegate old) =&amp;gt; &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// é™æ€ç±»&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MyApp&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;StatelessWidget&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;meta&quot;&gt;@override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Widget build(BuildContext context) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// final wordPair = new WordPair.random();&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MaterialApp(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      debugShowCheckedModeBanner: &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      home: &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; CreateHome(),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      theme: &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ThemeData(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        primaryColor: Colors.orange,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      ),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// å›½é™…åŒ–&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      localizationsDelegates: [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; DemoLocalizationsDelegate(),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        GlobalMaterialLocalizations.delegate,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        GlobalWidgetsLocalizations.delegate,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      ],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      supportedLocales: [&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; Locale(&lt;span class=&quot;string&quot;&gt;&amp;#x27;en&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;&amp;#x27;&lt;/span&gt;), &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; Locale(&lt;span class=&quot;string&quot;&gt;&amp;#x27;zh&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;&amp;#x27;&lt;/span&gt;)],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// åŠ¨æ€ç±»&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;CreateHome&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;StatefulWidget&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;meta&quot;&gt;@override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  CreateHomeState createState() =&amp;gt; CreateHomeState();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;CreateHomeState&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;State&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;CreateHome&lt;/span&gt;&amp;gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;int&lt;/span&gt; _currentIndex = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; _bodyOptions = [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Text(&lt;span class=&quot;string&quot;&gt;&amp;#x27;ä¸»é¡µ&amp;#x27;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Text(&lt;span class=&quot;string&quot;&gt;&amp;#x27;å•†åŸ&amp;#x27;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Text(&lt;span class=&quot;string&quot;&gt;&amp;#x27;æ¶ˆæ¯&amp;#x27;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// IBAction&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; backOnPressed() &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; menuOnPressed() &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; onTabBarItemTapped(&lt;span class=&quot;built_in&quot;&gt;int&lt;/span&gt; idx) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    setState(() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      _currentIndex = idx;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;meta&quot;&gt;@override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Widget build(BuildContext context) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; Scaffold(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      appBar: _createAppBar(),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      body: Center(child: _bodyOptions.elementAt(_currentIndex)),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      bottomNavigationBar: _createTabBar(),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Widget _createAppBar() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; AppBar(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      brightness: Brightness.dark,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      elevation: &lt;span class=&quot;number&quot;&gt;0.5&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      iconTheme: IconThemeData(color: Colors.white),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      title: Text(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ZDLocalizations.of(context).title,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        style: TextStyle(color: Colors.white),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      ),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      actions: [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        IconButton(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          icon: Icon(Icons.menu),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          onPressed: menuOnPressed,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      ],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      leading: IconButton(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        icon: Icon(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          Icons.arrow_back_ios,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        onPressed: backOnPressed,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      ),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Widget _createTabBar() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; BottomNavigationBar(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      fixedColor: Colors.blue,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      backgroundColor: Colors.orange,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      currentIndex: _currentIndex,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      onTap: onTabBarItemTapped,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      items: [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        BottomNavigationBarItem(icon: Icon(Icons.home), label: &lt;span class=&quot;string&quot;&gt;&amp;#x27;ä¸»é¡µ&amp;#x27;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        BottomNavigationBarItem(icon: Icon(Icons.shop), label: &lt;span class=&quot;string&quot;&gt;&amp;#x27;å•†åŸ&amp;#x27;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        BottomNavigationBarItem(icon: Icon(Icons.message), label: &lt;span class=&quot;string&quot;&gt;&amp;#x27;æ¶ˆæ¯&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      ],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;è¯´æ˜ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;ä»¥ä¸Šä»£ç æœ‰å›½é™…åŒ–ç¤ºä¾‹éƒ¨åˆ†ï¼Œæœ¬åšä¸»æ¯”è¾ƒæ‡’ï¼Œå›½é™…åŒ–çš„å†…å®¹æ²¡åˆ é™¤ï¼Œç›´æ¥ä»å·¥ç¨‹é‡ŒCopyå‡ºæ¥çš„ã€‚&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Flutters" scheme="https://forgetsou.github.io/categories/Flutters/"/>
    
    
    <category term="Flutter" scheme="https://forgetsou.github.io/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®åº“-RealmSwiftçš„ä½¿ç”¨/æ•°æ®è¿ç§»</title>
    <link href="https://forgetsou.github.io/2020/12/04/%E6%95%B0%E6%8D%AE%E5%BA%93-RealmSwift%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"/>
    <id>https://forgetsou.github.io/2020/12/04/%E6%95%B0%E6%8D%AE%E5%BA%93-RealmSwift%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</id>
    <published>2020-12-04T03:05:57.000Z</published>
    <updated>2020-12-04T03:05:57.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸€-ç®€è¿°"><a href="#ä¸€-ç®€è¿°" class="headerlink" title="ä¸€. ç®€è¿°"></a>ä¸€. ç®€è¿°</h1><p><img src="https://raw.githubusercontent.com/realm/realm-cocoa/master/logo.png" alt="img">æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„ç§»åŠ¨æ•°æ®åº“å¼•æ“ã€‚</p><p><a href="https://realm.io/cn/docs/swift/latest/">Realm ä¸­æ–‡æ–‡æ¡£</a></p><blockquote><p>Realmå¹³å°æ˜¯åŸºäºnoSQLçš„æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ç»„ä»¶çš„ç»„åˆï¼Œè¯¥ç»„ä»¶é€šè¿‡å¿«é€Ÿé«˜æ•ˆçš„åŒæ­¥åè®®è¿›è¡Œè¿æ¥ï¼Œä»¥å®ç°å®æ—¶ï¼Œè¿æ¥çš„åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ï¼Œæ— è®ºç½‘ç»œçŠ¶æ€å¦‚ä½•ï¼Œå®ƒä»¬éƒ½å…·æœ‰å“åº”èƒ½åŠ›å’Œæ€§èƒ½ã€‚Realmå¹³å°å…·æœ‰ä¸¤ä¸ªä¸»è¦ç»„ä»¶ï¼šRealmæ•°æ®åº“å’ŒRealmå¯¹è±¡æœåŠ¡å™¨ã€‚è¿™ä¸¤ä¸ªç»„ä»¶ååŒå·¥ä½œä»¥è‡ªåŠ¨åŒæ­¥æ•°æ®ï¼Œä»è€Œå®ç°å¤§é‡ç”¨ä¾‹ï¼Œä»ç¦»çº¿ä¼˜å…ˆåº”ç”¨ç¨‹åºï¼Œç°åœºæœåŠ¡å’Œæ•°æ®æ”¶é›†åº”ç”¨ç¨‹åºï¼Œä»¥æ•°æ®å¯ç”¨æ€§å’Œç”¨æˆ·å“åº”èƒ½åŠ›ä¸ºå…³é”®çš„ç§»åŠ¨æœåŠ¡å¼€å§‹ã€‚æ­¤å¤–ï¼Œé€šè¿‡ä¸ç°æœ‰åç«¯ï¼ˆSQLï¼ŒKafkaç­‰ï¼‰çš„é›†æˆåŠŸèƒ½ï¼ŒRealm Platformæ˜¯ä¸€ç§åœ¨åˆ©ç”¨ç°æœ‰ï¼ˆæœ‰æ—¶æ˜¯ä¼ ç»Ÿï¼‰ç³»ç»Ÿå’Œæ•°æ®æºçš„åŒæ—¶æ„å»ºç°ä»£å®æ—¶æœåŠ¡ä½“éªŒçš„ç»ä½³æ–¹æ³•ã€‚</p></blockquote><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1glbnizdrg1j31is0u0ain.jpg" alt="é¢†åŸŸå¹³å°çš„é«˜çº§ç¤ºæ„å›¾"></p><blockquote><p>Realmæ•°æ®åº“åµŒå…¥åœ¨å®¢æˆ·ç«¯ä¸Šï¼Œæ˜¯ä¸€ä¸ªåŠŸèƒ½é½å…¨çš„ï¼Œé¢å‘å¯¹è±¡çš„è·¨å¹³å°æ•°æ®åº“ï¼Œå¯å°†æ•°æ®æœ¬åœ°å­˜å‚¨åœ¨è®¾å¤‡ä¸Šã€‚å®ƒé€‚ç”¨äºä¸»è¦çš„ç§»åŠ¨è¯­è¨€ï¼Œä¾‹å¦‚Swiftå’ŒObjective-Cï¼ˆiOSï¼‰ï¼ŒJavaï¼ˆAndroidï¼‰ï¼ŒCï¼ƒï¼ˆXamarinï¼Œ.NETï¼‰å’ŒJavaScriptï¼ˆReact Nativeå’ŒNode.jsï¼‰ã€‚</p><p>Realmæ•°æ®åº“æ˜¯è½»é‡çº§ä¸”é«˜æ€§èƒ½çš„ï¼Œèƒ½å¤Ÿå¤„ç†éå¸¸å¤§çš„æ•°æ®è´Ÿè½½å¹¶åœ¨å‡ åˆ†ä¹‹ä¸€ç§’å†…è¿è¡ŒæŸ¥è¯¢ã€‚å®ƒåŸºäºå…±äº«çš„æ´»åŠ¨å¯¹è±¡ï¼Œæ— éœ€ç¼–å†™ç½‘ç»œï¼Œåºåˆ—åŒ–æˆ–å¯¹è±¡å…³ç³»æ˜ å°„ä»£ç ï¼Œå³å¯ä¸Realm Object Serverå®æ—¶æ— ç¼åŒæ­¥æ•°æ®ã€‚</p></blockquote><p>Realm æ€§èƒ½ä¼˜äº FMDB å’Œ Core Dataï¼Œæ”¯æŒ OC å’Œ Swift è¯­è¨€å¼€å‘ï¼Œä½¿ç”¨æ›´åŠ ç®€å•ã€æ–¹ä¾¿ã€‚</p><p>ä¸‹é¢ä¸»è¦è¯´ä¸‹Swiftè¯­è¨€ä¸‹çš„ Realm æ•°æ®åº“çš„ä½¿ç”¨å’Œ RealmSwift æ•°æ®è¿ç§»</p><h1 id="äºŒ-Cocopods-å®‰è£…"><a href="#äºŒ-Cocopods-å®‰è£…" class="headerlink" title="äºŒ. Cocopods å®‰è£…"></a>äºŒ. <code>Cocopods</code> å®‰è£…</h1><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">pod <span class="string">&#x27;RealmSwift&#x27;</span></span><br></pre></td></tr></table></figure><h1 id="ä¸‰-æ•°æ®æ¨¡å‹"><a href="#ä¸‰-æ•°æ®æ¨¡å‹" class="headerlink" title="ä¸‰. æ•°æ®æ¨¡å‹"></a>ä¸‰. æ•°æ®æ¨¡å‹</h1><p>ä¸å†è¯¦è¿°äº†ï¼Œå…·ä½“å¯å‚è€ƒ<a href="https://realm.io/cn/docs/swift/latest/">ä¸­æ–‡å®˜æ–¹æ–‡æ¡£</a></p><p><a href="https://realm.io/cn/docs/swift/latest/#models">ä¸­æ–‡å®˜æ–¹æ–‡æ¡£-æ•°æ®æ¨¡å‹</a></p><p><strong>Realm æ”¯æŒçš„å±æ€§</strong></p><table><thead><tr><th align="left">ç±»å‹</th><th align="left">éå¯ç©ºå€¼å½¢å¼</th><th align="left">å¯ç©ºå€¼å½¢å¼</th></tr></thead><tbody><tr><td align="left">Bool</td><td align="left"><code>@objc dynamic var value = false</code></td><td align="left"><code>let value = RealmOptional&lt;Bool&gt;()</code></td></tr><tr><td align="left">Int</td><td align="left"><code>@objc dynamic var value = 0</code></td><td align="left"><code>let value = RealmOptional&lt;Int&gt;()</code></td></tr><tr><td align="left">Float</td><td align="left"><code>@objc dynamic var value: Float = 0.0</code></td><td align="left"><code>let value = RealmOptional&lt;Float&gt;()</code></td></tr><tr><td align="left">Double</td><td align="left"><code>@objc dynamic var value: Double = 0.0</code></td><td align="left"><code>let value = RealmOptional&lt;Double&gt;()</code></td></tr><tr><td align="left">String</td><td align="left"><code>@objc dynamic var value = &quot;&quot;</code></td><td align="left"><code>@objc dynamic var value: String? = nil</code></td></tr><tr><td align="left">Data</td><td align="left"><code>@objc dynamic var value = Data()</code></td><td align="left"><code>@objc dynamic var value: Data? = nil</code></td></tr><tr><td align="left">Date</td><td align="left"><code>@objc dynamic var value = Date()</code></td><td align="left"><code>@objc dynamic var value: Date? = nil</code></td></tr><tr><td align="left">Object</td><td align="left">ä¸å­˜åœ¨ï¼šå¿…é¡»æ˜¯å¯ç©ºå€¼</td><td align="left"><code>@objc dynamic var value: Class?</code></td></tr><tr><td align="left">List</td><td align="left"><code>let value = List&lt;Type&gt;()</code></td><td align="left">ä¸å­˜åœ¨ï¼šå¿…é¡»æ˜¯éå¯ç©ºå€¼</td></tr><tr><td align="left">LinkingObjects</td><td align="left"><code>let value = LinkingObjects(fromType: Class.self, property: &quot;property&quot;)</code></td><td align="left">ä¸å­˜åœ¨ï¼šå¿…é¡»æ˜¯éå¯ç©ºå€¼</td></tr></tbody></table><h1 id="å››-æ•°æ®è¿ç§»"><a href="#å››-æ•°æ®è¿ç§»" class="headerlink" title="å››. æ•°æ®è¿ç§»"></a>å››. æ•°æ®è¿ç§»</h1><p>å½“æ‚¨ä½¿ç”¨ä»»æ„ä¸€ä¸ªæ•°æ®åº“æ—¶ï¼Œæ‚¨éšæ—¶éƒ½å¯èƒ½æ‰“ç®—ä¿®æ”¹æ‚¨çš„æ•°æ®æ¨¡å‹ã€‚ç”±äº Realm çš„æ•°æ®æ¨¡å‹æ˜¯ä»¥æ ‡å‡†çš„ Swift ç±»æ¥å®šä¹‰çš„ï¼Œè¿™ä½¿å¾—ä¿®æ”¹æ¨¡å‹å°±åƒä¿®æ”¹å…¶ä»–çš„ Swift ç±»ä¸€æ ·æ–¹ä¾¿ã€‚</p><p>ä¾‹å¦‚åœ¨1.0.1ç‰ˆæœ¬å®šä¹‰çš„ <code>Person</code>ï¼Œç°åœ¨éœ€è¦åœ¨1.0.2ç‰ˆæœ¬ä¸­æ·»åŠ ä¸€ä¸ª email çš„å±æ€§ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1.0.1ç‰ˆæœ¬å®šä¹‰çš„Person</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>: <span class="title">Object</span> </span>&#123;</span><br><span class="line">    <span class="keyword">@objc</span> <span class="keyword">dynamic</span> <span class="keyword">var</span> name <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">@objc</span> <span class="keyword">dynamic</span> <span class="keyword">var</span> age <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1.0.2ç‰ˆæœ¬æ–°å¢emailå±æ€§</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>: <span class="title">Object</span> </span>&#123;</span><br><span class="line">    <span class="keyword">@objc</span> <span class="keyword">dynamic</span> <span class="keyword">var</span> name <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">@objc</span> <span class="keyword">dynamic</span> <span class="keyword">var</span> age <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">  <span class="keyword">@objc</span> <span class="keyword">dynamic</span> <span class="keyword">var</span> email <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸‹æ˜¯å…·ä½“å¤„ç†è¿™ç±»é—®é¢˜çš„å®ç°æ–¹å¼</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Swift æ•°æ®åº“ç®¡ç†å™¨ä¸­çš„init()æ–¹æ³•ä¸­åšæ•°æ®è¿ç§»</span></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">init</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> realmName <span class="operator">=</span> <span class="string">&quot;demo.realm&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> defaultUrl <span class="operator">=</span> <span class="type">FileManager</span>.default.urls(for: <span class="type">FileManager</span>.<span class="type">SearchPathDirectory</span>.documentDirectory, in: <span class="type">FileManager</span>.<span class="type">SearchPathDomainMask</span>.userDomainMask).first</span><br><span class="line">        <span class="keyword">let</span> configCompact <span class="operator">=</span> <span class="type">Realm</span>.<span class="type">Configuration</span>(</span><br><span class="line">            fileURL: defaultUrl<span class="operator">?</span>.appendingPathComponent(<span class="string">&quot;<span class="subst">\(realmName)</span>&quot;</span>),</span><br><span class="line">            shouldCompactOnLaunch: &#123; totalBytes, usedBytes <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">let</span> oneHundredMB <span class="operator">=</span> <span class="number">100</span> <span class="operator">*</span> <span class="number">1024</span> <span class="operator">*</span> <span class="number">1024</span></span><br><span class="line">            <span class="keyword">return</span> (totalBytes <span class="operator">&gt;</span> oneHundredMB) <span class="operator">&amp;&amp;</span> (<span class="type">Double</span>(usedBytes) <span class="operator">/</span> <span class="type">Double</span>(totalBytes)) <span class="operator">&lt;</span> <span class="number">0.5</span></span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœæ»¡è¶³é…ç½®å—æ¡ä»¶ï¼Œåˆ™åœ¨ç¬¬ä¸€æ¬¡æ‰“å¼€æ—¶å‹ç¼© Realm</span></span><br><span class="line">            <span class="keyword">_</span> <span class="operator">=</span> <span class="keyword">try</span> <span class="type">Realm</span>(configuration: configCompact)</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="comment">// å¤„ç†å‹ç¼©æˆ–æ‰“å¼€ Realm çš„é”™è¯¯</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> currentVersion : <span class="type">String</span> <span class="operator">=</span> <span class="type">Bundle</span>.main.infoDictionary<span class="operator">!</span>[<span class="string">&quot;CFBundleShortVersionString&quot;</span>] <span class="keyword">as!</span> <span class="type">String</span></span><br><span class="line">        <span class="keyword">let</span> currentVersions <span class="operator">=</span> currentVersion.components(separatedBy: <span class="string">&quot;.&quot;</span>)</span><br><span class="line">        <span class="keyword">let</span> currentVersionStr <span class="operator">=</span> <span class="type">NSMutableString</span>()</span><br><span class="line">        <span class="keyword">for</span> subVersion <span class="keyword">in</span> currentVersions &#123;</span><br><span class="line">            <span class="keyword">let</span> subs <span class="operator">=</span> <span class="type">String</span>(format: <span class="string">&quot;%02d&quot;</span>, (subVersion <span class="keyword">as</span> <span class="type">NSString</span>).integerValue)</span><br><span class="line">            currentVersionStr.append(subs)</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">/*!</span></span><br><span class="line"><span class="comment">         * å½“å‰ç‰ˆæœ¬çš„UInt64ç‰ˆæœ¬å·</span></span><br><span class="line"><span class="comment">         * å¦‚currentVersion = &quot;1.0.1&quot;ï¼ŒschemaVersion = 010001; currentVersion = 10.12.25, schemaVersion = 101225</span></span><br><span class="line"><span class="comment">         * !!! æ³¨æ„ !!!</span></span><br><span class="line"><span class="comment">         * åœ¨æ‰“åŒ…å®šä¹‰ç‰ˆæœ¬çš„æ—¶å€™ï¼Œç‰ˆæœ¬è§„åˆ™:</span></span><br><span class="line"><span class="comment">         * 1.ç‰ˆæœ¬å·åªèƒ½æ˜¯ä¸‰ä½ï¼Œå¦‚1.12.18,ä¸­é—´åªèƒ½ä¸¤ä¸ªå°æ•°ç‚¹ï¼›ç›¸å1.12.18.2æˆ–è€…1.22ç­‰ç¦ç”¨çš„ã€‚</span></span><br><span class="line"><span class="comment">         * 2.ç‰ˆæœ¬å·ä¸èƒ½è¶…è¿‡100ï¼Œå¦‚å®šä¹‰åˆ°1.0.99æˆ–è€…1.99.1æ—¶ï¼Œä¹‹åçš„ä¸‹ä¸ªç‰ˆæœ¬ä¸èƒ½å®šä¹‰1.0.100æˆ–1.100.0</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">let</span> schemaVersion : <span class="type">UInt64</span> <span class="operator">=</span> <span class="type">UInt64</span>(currentVersionStr <span class="keyword">as</span> <span class="type">String</span>)<span class="operator">!</span></span><br><span class="line">        <span class="keyword">let</span> config <span class="operator">=</span> <span class="type">Realm</span>.<span class="type">Configuration</span>(</span><br><span class="line">            fileURL: defaultUrl<span class="operator">?</span>.appendingPathComponent(<span class="string">&quot;<span class="subst">\(realmName)</span>&quot;</span>),</span><br><span class="line">            schemaVersion: schemaVersion,</span><br><span class="line">            migrationBlock: &#123; migration, oldSchemaVersion <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">if</span> (oldSchemaVersion <span class="operator">&lt;</span> schemaVersion) &#123;</span><br><span class="line">                    migration.enumerateObjects(ofType: <span class="type">Person</span>.className()) &#123; (oldObject, newObject) <span class="keyword">in</span></span><br><span class="line"> <span class="comment">// æ–°å¢å­—æ®µ</span></span><br><span class="line">                         newObject<span class="operator">!</span>[<span class="string">&quot;email&quot;</span>] <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    migration.enumerateObjects(ofType: <span class="type">Student</span>.className()) &#123; (oldObject, newObject) <span class="keyword">in</span></span><br><span class="line"> <span class="comment">// æ”¹å­—æ®µ</span></span><br><span class="line">                         <span class="keyword">let</span> firstName <span class="operator">=</span> oldObject<span class="operator">!</span>[<span class="string">&quot;firstName&quot;</span>] <span class="keyword">as!</span> <span class="type">String</span></span><br><span class="line">                         <span class="keyword">let</span> lastName <span class="operator">=</span> oldObject<span class="operator">!</span>[<span class="string">&quot;lastName&quot;</span>] <span class="keyword">as!</span> <span class="type">String</span></span><br><span class="line">                         newObject<span class="operator">!</span>[<span class="string">&quot;fullName&quot;</span>] <span class="operator">=</span> <span class="string">&quot;<span class="subst">\(firstName)</span> <span class="subst">\(lastName)</span>&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="type">Realm</span>.<span class="type">Configuration</span>.defaultConfiguration <span class="operator">=</span> config</span><br><span class="line">        <span class="keyword">_</span> <span class="operator">=</span> <span class="keyword">try!</span> <span class="type">Realm</span>()</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><hr><blockquote><p><strong>ä¸ªäººåšå®¢:</strong> ğŸ¡ <a href="https://forgetsou.github.io/">ForgetSou</a></p></blockquote><hr>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;ä¸€-ç®€è¿°&quot;&gt;&lt;a href=&quot;#ä¸€-ç®€è¿°&quot; class=&quot;headerlink&quot; title=&quot;ä¸€. ç®€è¿°&quot;&gt;&lt;/a&gt;ä¸€. ç®€è¿°&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/realm/realm-cocoa/master/logo.png&quot; alt=&quot;img&quot;&gt;æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„ç§»åŠ¨æ•°æ®åº“å¼•æ“ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://realm.io/cn/docs/swift/latest/&quot;&gt;Realm ä¸­æ–‡æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Realmå¹³å°æ˜¯åŸºäºnoSQLçš„æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ç»„ä»¶çš„ç»„åˆï¼Œè¯¥ç»„ä»¶é€šè¿‡å¿«é€Ÿé«˜æ•ˆçš„åŒæ­¥åè®®è¿›è¡Œè¿æ¥ï¼Œä»¥å®ç°å®æ—¶ï¼Œè¿æ¥çš„åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ï¼Œæ— è®ºç½‘ç»œçŠ¶æ€å¦‚ä½•ï¼Œå®ƒä»¬éƒ½å…·æœ‰å“åº”èƒ½åŠ›å’Œæ€§èƒ½ã€‚Realmå¹³å°å…·æœ‰ä¸¤ä¸ªä¸»è¦ç»„ä»¶ï¼šRealmæ•°æ®åº“å’ŒRealmå¯¹è±¡æœåŠ¡å™¨ã€‚è¿™ä¸¤ä¸ªç»„ä»¶ååŒå·¥ä½œä»¥è‡ªåŠ¨åŒæ­¥æ•°æ®ï¼Œä»è€Œå®ç°å¤§é‡ç”¨ä¾‹ï¼Œä»ç¦»çº¿ä¼˜å…ˆåº”ç”¨ç¨‹åºï¼Œç°åœºæœåŠ¡å’Œæ•°æ®æ”¶é›†åº”ç”¨ç¨‹åºï¼Œä»¥æ•°æ®å¯ç”¨æ€§å’Œç”¨æˆ·å“åº”èƒ½åŠ›ä¸ºå…³é”®çš„ç§»åŠ¨æœåŠ¡å¼€å§‹ã€‚æ­¤å¤–ï¼Œé€šè¿‡ä¸ç°æœ‰åç«¯ï¼ˆSQLï¼ŒKafkaç­‰ï¼‰çš„é›†æˆåŠŸèƒ½ï¼ŒRealm Platformæ˜¯ä¸€ç§åœ¨åˆ©ç”¨ç°æœ‰ï¼ˆæœ‰æ—¶æ˜¯ä¼ ç»Ÿï¼‰ç³»ç»Ÿå’Œæ•°æ®æºçš„åŒæ—¶æ„å»ºç°ä»£å®æ—¶æœåŠ¡ä½“éªŒçš„ç»ä½³æ–¹æ³•ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/0081Kckwly1glbnizdrg1j31is0u0ain.jpg&quot; alt=&quot;é¢†åŸŸå¹³å°çš„é«˜çº§ç¤ºæ„å›¾&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Realmæ•°æ®åº“åµŒå…¥åœ¨å®¢æˆ·ç«¯ä¸Šï¼Œæ˜¯ä¸€ä¸ªåŠŸèƒ½é½å…¨çš„ï¼Œé¢å‘å¯¹è±¡çš„è·¨å¹³å°æ•°æ®åº“ï¼Œå¯å°†æ•°æ®æœ¬åœ°å­˜å‚¨åœ¨è®¾å¤‡ä¸Šã€‚å®ƒé€‚ç”¨äºä¸»è¦çš„ç§»åŠ¨è¯­è¨€ï¼Œä¾‹å¦‚Swiftå’ŒObjective-Cï¼ˆiOSï¼‰ï¼ŒJavaï¼ˆAndroidï¼‰ï¼ŒCï¼ƒï¼ˆXamarinï¼Œ.NETï¼‰å’ŒJavaScriptï¼ˆReact Nativeå’ŒNode.jsï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;Realmæ•°æ®åº“æ˜¯è½»é‡çº§ä¸”é«˜æ€§èƒ½çš„ï¼Œèƒ½å¤Ÿå¤„ç†éå¸¸å¤§çš„æ•°æ®è´Ÿè½½å¹¶åœ¨å‡ åˆ†ä¹‹ä¸€ç§’å†…è¿è¡ŒæŸ¥è¯¢ã€‚å®ƒåŸºäºå…±äº«çš„æ´»åŠ¨å¯¹è±¡ï¼Œæ— éœ€ç¼–å†™ç½‘ç»œï¼Œåºåˆ—åŒ–æˆ–å¯¹è±¡å…³ç³»æ˜ å°„ä»£ç ï¼Œå³å¯ä¸Realm Object Serverå®æ—¶æ— ç¼åŒæ­¥æ•°æ®ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Realm æ€§èƒ½ä¼˜äº FMDB å’Œ Core Dataï¼Œæ”¯æŒ OC å’Œ Swift è¯­è¨€å¼€å‘ï¼Œä½¿ç”¨æ›´åŠ ç®€å•ã€æ–¹ä¾¿ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢ä¸»è¦è¯´ä¸‹Swiftè¯­è¨€ä¸‹çš„ Realm æ•°æ®åº“çš„ä½¿ç”¨å’Œ RealmSwift æ•°æ®è¿ç§»&lt;/p&gt;
&lt;h1 id=&quot;äºŒ-Cocopods-å®‰è£…&quot;&gt;&lt;a href=&quot;#äºŒ-Cocopods-å®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;äºŒ. Cocopods å®‰è£…&quot;&gt;&lt;/a&gt;äºŒ. &lt;code&gt;Cocopods&lt;/code&gt; å®‰è£…&lt;/h1&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;pod &lt;span class=&quot;string&quot;&gt;&amp;#x27;RealmSwift&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="Swift" scheme="https://forgetsou.github.io/categories/Swift/"/>
    
    
    <category term="æ•°æ®åº“" scheme="https://forgetsou.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="RealmSwift" scheme="https://forgetsou.github.io/tags/RealmSwift/"/>
    
    <category term="Swift" scheme="https://forgetsou.github.io/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>æ—¥å¸¸å¼€å‘å°çŸ¥è¯†ç‚¹æ”¶é›†</title>
    <link href="https://forgetsou.github.io/2020/11/12/%E6%97%A5%E5%B8%B8%E5%BC%80%E5%8F%91%E5%B0%8F%E7%9F%A5%E8%AF%86%E7%82%B9%E6%94%B6%E9%9B%86/"/>
    <id>https://forgetsou.github.io/2020/11/12/%E6%97%A5%E5%B8%B8%E5%BC%80%E5%8F%91%E5%B0%8F%E7%9F%A5%E8%AF%86%E7%82%B9%E6%94%B6%E9%9B%86/</id>
    <published>2020-11-12T06:17:08.000Z</published>
    <updated>2020-11-12T06:17:08.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-åˆ é™¤ToolBarä¸‹é¢çš„åˆ†å‰²çº¿"><a href="#1-åˆ é™¤ToolBarä¸‹é¢çš„åˆ†å‰²çº¿" class="headerlink" title="1.åˆ é™¤ToolBarä¸‹é¢çš„åˆ†å‰²çº¿"></a>1.åˆ é™¤ToolBarä¸‹é¢çš„åˆ†å‰²çº¿</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">toolbar.showsBaselineSeparator = <span class="literal">NO</span>;</span><br></pre></td></tr></table></figure><h2 id="2-ä¿®æ”¹TextFieldçš„è“è‰²æˆ–æ©™è‰²è¾¹æ¡†"><a href="#2-ä¿®æ”¹TextFieldçš„è“è‰²æˆ–æ©™è‰²è¾¹æ¡†" class="headerlink" title="2.ä¿®æ”¹TextFieldçš„è“è‰²æˆ–æ©™è‰²è¾¹æ¡†"></a>2.ä¿®æ”¹TextFieldçš„è“è‰²æˆ–æ©™è‰²è¾¹æ¡†</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="keyword">self</span>.textField.focusRingType = <span class="built_in">NSFocusRingTypeNone</span>;</span><br></pre></td></tr></table></figure><h2 id="3-æ‰“å¼€å·²å®‰è£…çš„å…¶ä»–è½¯ä»¶"><a href="#3-æ‰“å¼€å·²å®‰è£…çš„å…¶ä»–è½¯ä»¶" class="headerlink" title="3.æ‰“å¼€å·²å®‰è£…çš„å…¶ä»–è½¯ä»¶"></a>3.æ‰“å¼€å·²å®‰è£…çš„å…¶ä»–è½¯ä»¶</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="built_in">NSString</span> *appPath = <span class="string">@&quot;/Applications/Foxmail.app&quot;</span>;</span><br><span class="line">[[<span class="built_in">NSWorkspace</span> sharedWorkspace] openFile:appPath];</span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line">[[<span class="built_in">NSWorkspace</span> sharedWorkspace] launchApplication:<span class="string">@&quot;Foxmail&quot;</span>];</span><br></pre></td></tr></table></figure><h2 id="4-æ‰“å¼€ç½‘é¡µ"><a href="#4-æ‰“å¼€ç½‘é¡µ" class="headerlink" title="4.æ‰“å¼€ç½‘é¡µ"></a>4.æ‰“å¼€ç½‘é¡µ</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">[[<span class="built_in">NSWorkspace</span> sharedWorkspace] openURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@&quot;https://www.baidu.com&quot;</span>]];</span><br></pre></td></tr></table></figure><h2 id="5-Colorç”Ÿæˆçº¯è‰²å›¾ç‰‡ï¼ˆiOSï¼‰"><a href="#5-Colorç”Ÿæˆçº¯è‰²å›¾ç‰‡ï¼ˆiOSï¼‰" class="headerlink" title="5.Colorç”Ÿæˆçº¯è‰²å›¾ç‰‡ï¼ˆiOSï¼‰"></a>5.Colorç”Ÿæˆçº¯è‰²å›¾ç‰‡ï¼ˆiOSï¼‰</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç”Ÿæˆçº¯è‰²å›¾ç‰‡</span></span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">UIImage</span> *)pureColorImageWithColor:(<span class="built_in">UIColor</span> *)color &#123;</span><br><span class="line">  <span class="built_in">CGSize</span> imageSize = <span class="built_in">CGSizeMake</span>(<span class="number">1.0</span>f, <span class="number">1.0</span>f);</span><br><span class="line">  <span class="built_in">UIGraphicsBeginImageContextWithOptions</span>(imageSize, <span class="literal">NO</span>, <span class="number">0.0</span>f);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">CGContextRef</span> theContext = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">  <span class="built_in">CGContextSetFillColorWithColor</span>(theContext, color.CGColor);</span><br><span class="line">  <span class="built_in">CGContextFillRect</span>(theContext, <span class="built_in">CGRectMake</span>(<span class="number">0.0</span>f, <span class="number">0.0</span>f, imageSize.width, imageSize.height));</span><br><span class="line"></span><br><span class="line">  <span class="built_in">CGImageRef</span> theCGImage = <span class="built_in">CGBitmapContextCreateImage</span>(theContext);</span><br><span class="line">  <span class="built_in">UIImage</span> *theImage;</span><br><span class="line">  <span class="keyword">if</span> ([[<span class="built_in">UIImage</span> <span class="keyword">class</span>] respondsToSelector:<span class="keyword">@selector</span>(imageWithCGImage:scale:orientation:)]) &#123;</span><br><span class="line">      theImage = [<span class="built_in">UIImage</span> imageWithCGImage:theCGImage scale:[<span class="built_in">UIScreen</span> mainScreen].scale orientation:<span class="built_in">UIImageOrientationUp</span>];</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      theImage = [<span class="built_in">UIImage</span> imageWithCGImage:theCGImage];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">CGImageRelease</span>(theCGImage);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> theImage;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç”Ÿæˆçº¯è‰²åœ†è§’å›¾ç‰‡</span></span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">UIImage</span> *)pureColorImageWithSize:(<span class="built_in">CGSize</span>)size</span><br><span class="line">      color:(<span class="built_in">UIColor</span> *)color</span><br><span class="line">  cornRadius:(<span class="built_in">CGFloat</span>)radius &#123;</span><br><span class="line">  <span class="built_in">UIGraphicsBeginImageContextWithOptions</span>(size, <span class="literal">NO</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">CGContextRef</span> cxt = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line"></span><br><span class="line">  <span class="built_in">CGContextSetFillColorWithColor</span>(cxt, color.CGColor);</span><br><span class="line">  <span class="built_in">CGContextSetStrokeColorWithColor</span>(cxt, color.CGColor);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">CGContextMoveToPoint</span>(cxt, size.width, size.height-radius);</span><br><span class="line">  <span class="built_in">CGContextAddArcToPoint</span>(cxt, size.width, size.height, size.width-radius, size.height, radius);<span class="comment">//å³ä¸‹è§’</span></span><br><span class="line">  <span class="built_in">CGContextAddArcToPoint</span>(cxt, <span class="number">0</span>, size.height, <span class="number">0</span>, size.height-radius, radius);<span class="comment">//å·¦ä¸‹è§’</span></span><br><span class="line">  <span class="built_in">CGContextAddArcToPoint</span>(cxt, <span class="number">0</span>, <span class="number">0</span>, radius, <span class="number">0</span>, radius);<span class="comment">//å·¦ä¸Šè§’</span></span><br><span class="line">  <span class="built_in">CGContextAddArcToPoint</span>(cxt, size.width, <span class="number">0</span>, size.width, radius, radius);<span class="comment">//å³ä¸Šè§’</span></span><br><span class="line">  <span class="built_in">CGContextClosePath</span>(cxt);</span><br><span class="line">  <span class="built_in">CGContextDrawPath</span>(cxt, kCGPathFillStroke);</span><br><span class="line">  <span class="built_in">UIImage</span> *image = <span class="built_in">UIGraphicsGetImageFromCurrentImageContext</span>();</span><br><span class="line">  <span class="built_in">UIGraphicsEndImageContext</span>();</span><br><span class="line">  <span class="keyword">return</span> image;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="6-æ—¶é—´æ ¼å¼è½¬æ¢"><a href="#6-æ—¶é—´æ ¼å¼è½¬æ¢" class="headerlink" title="6.æ—¶é—´æ ¼å¼è½¬æ¢"></a>6.æ—¶é—´æ ¼å¼è½¬æ¢</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// æ ¹æ®æ ¼å¼ç”Ÿæˆæ—¶é—´å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">/// @param date æ—¶é—´NSDate</span></span><br><span class="line"><span class="comment">/// @param formatStr æ—¶é—´æ ¼å¼ eg:&quot;YYYY-MM-dd HH:mm:ss&quot;</span></span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">NSString</span> *)stringFromDate:(<span class="built_in">NSDate</span> *)date formatStr:(<span class="built_in">NSString</span> *)formatStr &#123;</span><br><span class="line">  <span class="built_in">NSDateFormatter</span> *formatter = [[<span class="built_in">NSDateFormatter</span> alloc] init];</span><br><span class="line">  [formatter setDateFormat:formatStr];</span><br><span class="line">  <span class="keyword">return</span> [formatter stringFromDate:date];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/// æ ¹æ®æ ¼å¼ç”ŸæˆNSDate</span></span><br><span class="line">  <span class="comment">/// @param dateString æ—¶é—´</span></span><br><span class="line">  <span class="comment">/// @param formatStr æ—¶é—´æ ¼å¼ eg:&quot;YYYY-MM-dd HH:mm:ss&quot;</span></span><br><span class="line">+ (<span class="built_in">NSDate</span> *)dateFromString:(<span class="built_in">NSString</span> *)dateString formatStr:(<span class="built_in">NSString</span> *)formatStr &#123;</span><br><span class="line">  <span class="built_in">NSDateFormatter</span> *formatter = [[<span class="built_in">NSDateFormatter</span> alloc] init];</span><br><span class="line">  [formatter setDateFormat:formatStr];</span><br><span class="line">  <span class="keyword">return</span> [formatter dateFromString:dateString];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/// è·å–å½“å‰æ—¶é—´æˆ³(ç§’)</span></span><br><span class="line">+ (<span class="built_in">NSNumber</span> *)getCurrentTimeStampSec &#123;</span><br><span class="line">  <span class="built_in">NSDate</span> *date = [<span class="built_in">NSDate</span> dateWithTimeIntervalSinceNow:<span class="number">0</span>];</span><br><span class="line">  <span class="built_in">NSTimeInterval</span> timeInterval = [date timeIntervalSince1970];</span><br><span class="line">  <span class="built_in">NSNumber</span> *u = [<span class="built_in">NSNumber</span> numberWithInteger:timeInterval];</span><br><span class="line">  <span class="keyword">return</span> u;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/// è·å–å½“å‰æ—¶é—´æˆ³(æ¯«ç§’)</span></span><br><span class="line">+ (<span class="built_in">NSNumber</span> *)getCurrentTimeStampMilliSec &#123;</span><br><span class="line">  <span class="built_in">NSDate</span> *date = [<span class="built_in">NSDate</span> dateWithTimeIntervalSinceNow:<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">long</span> <span class="keyword">long</span> timeInterval = [date timeIntervalSince1970] * <span class="number">1000</span>;</span><br><span class="line">  <span class="built_in">NSNumber</span> *u = [<span class="built_in">NSNumber</span> numberWithLongLong:timeInterval];</span><br><span class="line">  <span class="keyword">return</span> u;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="7-åˆæ³•æ€§"><a href="#7-åˆæ³•æ€§" class="headerlink" title="7.åˆæ³•æ€§"></a>7.åˆæ³•æ€§</h2><ul><li>æ‰‹æœºå·æ˜¯å¦åˆæ³•</li></ul><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">+ (<span class="built_in">BOOL</span>)isValidMobile:(<span class="built_in">NSString</span> *)mobile &#123;</span><br><span class="line">    <span class="built_in">BOOL</span> isValid = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (!kStringIsEmpty(mobile) &amp;&amp; mobile.length == <span class="number">11</span>) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *<span class="built_in">CM_NUM</span> = <span class="string">@&quot;^((13[0-9])|(14[5-9])|(15([0-3]|[5-9]))|(16[6-7])|(17[1-8])|(18[0-9])|(19[1|3])|(19[5|6])|(19[8|9]))\\d&#123;8&#125;$&quot;</span>;</span><br><span class="line">        <span class="built_in">NSPredicate</span> *pred = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@&quot;SELF MATCHES %@&quot;</span>, <span class="built_in">CM_NUM</span>];</span><br><span class="line">        <span class="built_in">BOOL</span> isMatch = [pred evaluateWithObject:mobile];</span><br><span class="line">        <span class="keyword">if</span> (isMatch) &#123;</span><br><span class="line">            isValid = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> isValid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Urlæ˜¯å¦åˆæ³•</li></ul><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">+ (<span class="built_in">BOOL</span>)isValidUrl:(<span class="built_in">NSString</span> *)urlStr &#123;</span><br><span class="line">  <span class="built_in">NSString</span> *regex =<span class="string">@&quot;[a-zA-z]+://[^\\s]*&quot;</span>;</span><br><span class="line">  <span class="built_in">NSPredicate</span> *urlTest = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@&quot;SELF MATCHES %@&quot;</span>,regex];</span><br><span class="line">  <span class="keyword">return</span> [urlTest evaluateWithObject:urlStr];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é“¶è¡Œå¡æ˜¯å¦åˆæ³•</li></ul><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">+ (<span class="built_in">BOOL</span>)isValidCardNo:(<span class="built_in">NSString</span> *)cardNumber &#123;</span><br><span class="line"><span class="keyword">int</span> oddSum = <span class="number">0</span>;    <span class="comment">// å¥‡æ•°å’Œ</span></span><br><span class="line"><span class="keyword">int</span> evenSum = <span class="number">0</span>;    <span class="comment">// å¶æ•°å’Œ</span></span><br><span class="line"><span class="keyword">int</span> allSum =<span class="number">0</span>;    <span class="comment">// æ€»å’Œ</span></span><br><span class="line">    <span class="comment">// å¾ªç¯åŠ å’Œ</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">NSInteger</span> i = <span class="number">1</span>; i &lt;= cardNumber.length; i++) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *theNumber = [cardNumber substringWithRange:<span class="built_in">NSMakeRange</span>(cardNumber.length-i,<span class="number">1</span>)];</span><br><span class="line">        <span class="keyword">int</span> lastNumber = [theNumber intValue];</span><br><span class="line">        <span class="keyword">if</span>(i%<span class="number">2</span>==<span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// å¶æ•°ä½</span></span><br><span class="line">            lastNumber *=<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span>(lastNumber &gt;<span class="number">9</span>) &#123;</span><br><span class="line">                lastNumber -=<span class="number">9</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            evenSum += lastNumber;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å¥‡æ•°ä½</span></span><br><span class="line">            oddSum += lastNumber;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    allSum = oddSum + evenSum;</span><br><span class="line">    <span class="comment">// æ˜¯å¦åˆæ³•</span></span><br><span class="line">    <span class="keyword">if</span>(allSum%<span class="number">10</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ¤æ–­é‚®ç®±æ˜¯å¦åˆæ³•<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">+ (<span class="built_in">BOOL</span>)isValidEmail:(<span class="built_in">NSString</span> *)email &#123;</span><br><span class="line">    <span class="keyword">if</span> ([CCUtility checkEmptyString:email]) <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSString</span> *emailRegex = <span class="string">@&quot;^(([a-zA-Z0-9_-]+)|([a-zA-Z0-9_-]+(\\.[a-zA-Z0-9_-]+)))@[a-zA-Z0-9_-]+(\\.[a-zA-Z0-9_-]+)+$&quot;</span>;</span><br><span class="line">    <span class="built_in">NSPredicate</span> *emailTest = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@&quot;SELF MATCHES %@&quot;</span>, emailRegex];</span><br><span class="line">    <span class="keyword">return</span> [emailTest evaluateWithObject:email];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">BOOL</span>)isValidUrl:(<span class="built_in">NSString</span> *)urlStr &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *regex =<span class="string">@&quot;[a-zA-z]+://[^\\s]*&quot;</span>;</span><br><span class="line">    <span class="built_in">NSPredicate</span> *urlTest = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@&quot;SELF MATCHES %@&quot;</span>,regex];</span><br><span class="line">    <span class="keyword">return</span> [urlTest evaluateWithObject:urlStr];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>åˆ¤æ–­èº«ä»½è¯(ä¸­å›½å¤§é™†)èº«ä»½è¯æ˜¯å¦åˆæ³•</li></ul><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">+ (<span class="built_in">BOOL</span>)isValidIDCardNo:(<span class="built_in">NSString</span> *)value &#123;</span><br><span class="line">value = [value stringByTrimmingCharactersInSet:[<span class="built_in">NSCharacterSet</span> whitespaceAndNewlineCharacterSet]];</span><br><span class="line"><span class="built_in">NSInteger</span> length =<span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (!value) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    length = value.length;</span><br><span class="line">    <span class="comment">//ä¸æ»¡è¶³15ä½å’Œ18ä½ï¼Œå³èº«ä»½è¯é”™è¯¯</span></span><br><span class="line">    <span class="keyword">if</span> (length !=<span class="number">15</span> &amp;&amp; length !=<span class="number">18</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// çœä»½ä»£ç </span></span><br><span class="line"><span class="built_in">NSArray</span> *areasArray = @[<span class="string">@&quot;11&quot;</span>,<span class="string">@&quot;12&quot;</span>, <span class="string">@&quot;13&quot;</span>,<span class="string">@&quot;14&quot;</span>, <span class="string">@&quot;15&quot;</span>,<span class="string">@&quot;21&quot;</span>, <span class="string">@&quot;22&quot;</span>,<span class="string">@&quot;23&quot;</span>, <span class="string">@&quot;31&quot;</span>,<span class="string">@&quot;32&quot;</span>, <span class="string">@&quot;33&quot;</span>,<span class="string">@&quot;34&quot;</span>, <span class="string">@&quot;35&quot;</span>,<span class="string">@&quot;36&quot;</span>, <span class="string">@&quot;37&quot;</span>,<span class="string">@&quot;41&quot;</span>, <span class="string">@&quot;42&quot;</span>,<span class="string">@&quot;43&quot;</span>, <span class="string">@&quot;44&quot;</span>,<span class="string">@&quot;45&quot;</span>, <span class="string">@&quot;46&quot;</span>,<span class="string">@&quot;50&quot;</span>, <span class="string">@&quot;51&quot;</span>,<span class="string">@&quot;52&quot;</span>, <span class="string">@&quot;53&quot;</span>,<span class="string">@&quot;54&quot;</span>, <span class="string">@&quot;61&quot;</span>,<span class="string">@&quot;62&quot;</span>, <span class="string">@&quot;63&quot;</span>,<span class="string">@&quot;64&quot;</span>, <span class="string">@&quot;65&quot;</span>,<span class="string">@&quot;71&quot;</span>, <span class="string">@&quot;81&quot;</span>,<span class="string">@&quot;82&quot;</span>, <span class="string">@&quot;91&quot;</span>];</span><br><span class="line"><span class="comment">// æ£€æµ‹çœä»½èº«ä»½è¡Œæ”¿åŒºä»£ç </span></span><br><span class="line"><span class="built_in">NSString</span> *valueStart2 = [value substringToIndex:<span class="number">2</span>];</span><br><span class="line"><span class="built_in">BOOL</span> areaFlag =<span class="literal">NO</span>; <span class="comment">//æ ‡è¯†çœä»½ä»£ç æ˜¯å¦æ­£ç¡®</span></span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSString</span> *areaCode <span class="keyword">in</span> areasArray) &#123;</span><br><span class="line">    <span class="keyword">if</span> ([areaCode isEqualToString:valueStart2]) &#123;</span><br><span class="line">        areaFlag =<span class="literal">YES</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!areaFlag) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSRegularExpression</span> *regularExpression;</span><br><span class="line"><span class="built_in">NSUInteger</span> numberofMatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> year =<span class="number">0</span>;</span><br><span class="line"><span class="comment">//åˆ†ä¸º15ä½ã€18ä½èº«ä»½è¯è¿›è¡Œæ ¡éªŒ</span></span><br><span class="line"><span class="keyword">switch</span> (length) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">15</span>:</span><br><span class="line">        <span class="comment">//è·å–å¹´ä»½å¯¹åº”çš„æ•°å­—</span></span><br><span class="line">        year = [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">6</span>,<span class="number">2</span>)].intValue +<span class="number">1900</span>;</span><br><span class="line">    <span class="keyword">if</span> (year %<span class="number">4</span> ==<span class="number">0</span> || (year %<span class="number">100</span> ==<span class="number">0</span> &amp;&amp; year %<span class="number">4</span> ==<span class="number">0</span>)) &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼ NSRegularExpressionCaseInsensitiveï¼šä¸åŒºåˆ†å­—æ¯å¤§å°å†™çš„æ¨¡å¼</span></span><br><span class="line">        regularExpression = [[<span class="built_in">NSRegularExpression</span> alloc]initWithPattern:<span class="string">@&quot;^[1-9][0-9]&#123;5&#125;[0-9]&#123;2&#125;((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]&#123;3&#125;$&quot;</span> options:<span class="built_in">NSRegularExpressionCaseInsensitive</span> error:<span class="literal">nil</span>];<span class="comment">//æµ‹è¯•å‡ºç”Ÿæ—¥æœŸçš„åˆæ³•æ€§</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        regularExpression = [[<span class="built_in">NSRegularExpression</span> alloc]initWithPattern:<span class="string">@&quot;^[1-9][0-9]&#123;5&#125;[0-9]&#123;2&#125;((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]&#123;3&#125;$&quot;</span> options:<span class="built_in">NSRegularExpressionCaseInsensitive</span> error:<span class="literal">nil</span>];<span class="comment">//æµ‹è¯•å‡ºç”Ÿæ—¥æœŸçš„åˆæ³•æ€§</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å­—ç¬¦ä¸² NSMatchingReportProgress:æ‰¾åˆ°æœ€é•¿çš„åŒ¹é…å­—ç¬¦ä¸²åè°ƒç”¨blockå›è°ƒ</span></span><br><span class="line">    numberofMatch = [regularExpression numberOfMatchesInString:value options:<span class="built_in">NSMatchingReportProgress</span> range:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, value.length)];</span><br><span class="line">    <span class="keyword">if</span>(numberofMatch &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">case</span> <span class="number">18</span>:</span><br><span class="line">    year = [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">6</span>,<span class="number">4</span>)].intValue;</span><br><span class="line">    <span class="keyword">if</span> (year %<span class="number">4</span> ==<span class="number">0</span> || (year %<span class="number">100</span> ==<span class="number">0</span> &amp;&amp; year %<span class="number">4</span> ==<span class="number">0</span>)) &#123;</span><br><span class="line">        regularExpression = [[<span class="built_in">NSRegularExpression</span> alloc]initWithPattern:<span class="string">@&quot;^((1[1-5])|(2[1-3])|(3[1-7])|(4[1-6])|(5[0-4])|(6[1-5])|71|(8[12])|91)\\d&#123;4&#125;(((19|20)\\d&#123;2&#125;(0[13-9]|1[012])(0[1-9]|[12]\\d|30))|((19|20)\\d&#123;2&#125;(0[13578]|1[02])31)|((19|20)\\d&#123;2&#125;02(0[1-9]|1\\d|2[0-8]))|((19|20)([13579][26]|[2468][048]|0[048])0229))\\d&#123;3&#125;(\\d|X|x)?$&quot;</span> options:<span class="built_in">NSRegularExpressionCaseInsensitive</span> error:<span class="literal">nil</span>];<span class="comment">//æµ‹è¯•å‡ºç”Ÿæ—¥æœŸçš„åˆæ³•æ€§</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        regularExpression = [[<span class="built_in">NSRegularExpression</span> alloc]initWithPattern:<span class="string">@&quot;^((1[1-5])|(2[1-3])|(3[1-7])|(4[1-6])|(5[0-4])|(6[1-5])|71|(8[12])|91)\\d&#123;4&#125;(((19|20)\\d&#123;2&#125;(0[13-9]|1[012])(0[1-9]|[12]\\d|30))|((19|20)\\d&#123;2&#125;(0[13578]|1[02])31)|((19|20)\\d&#123;2&#125;02(0[1-9]|1\\d|2[0-8]))|((19|20)([13579][26]|[2468][048]|0[048])0229))\\d&#123;3&#125;(\\d|X|x)?$&quot;</span> options:<span class="built_in">NSRegularExpressionCaseInsensitive</span> error:<span class="literal">nil</span>];<span class="comment">//æµ‹è¯•å‡ºç”Ÿæ—¥æœŸçš„åˆæ³•æ€§</span></span><br><span class="line">    &#125;</span><br><span class="line">    numberofMatch = [regularExpression numberOfMatchesInString:value options:<span class="built_in">NSMatchingReportProgress</span> range:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, value.length)];</span><br><span class="line">    <span class="keyword">if</span>(numberofMatch &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">//1ï¼šæ ¡éªŒç çš„è®¡ç®—æ–¹æ³• èº«ä»½è¯å·ç 17ä½æ•°åˆ†åˆ«ä¹˜ä»¥ä¸åŒçš„ç³»æ•°ã€‚ä»ç¬¬ä¸€ä½åˆ°ç¬¬åä¸ƒä½çš„ç³»æ•°åˆ†åˆ«ä¸ºï¼š7ï¼9ï¼10ï¼5ï¼8ï¼4ï¼2ï¼1ï¼6ï¼3ï¼7ï¼9ï¼10ï¼5ï¼8ï¼4ï¼2ã€‚å°†è¿™17ä½æ•°å­—å’Œç³»æ•°ç›¸ä¹˜çš„ç»“æœç›¸åŠ ã€‚</span></span><br><span class="line">        <span class="keyword">int</span> S = [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>,<span class="number">1</span>)].intValue*<span class="number">7</span> + [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">10</span>,<span class="number">1</span>)].intValue *<span class="number">7</span> + [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">1</span>,<span class="number">1</span>)].intValue*<span class="number">9</span> + [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">11</span>,<span class="number">1</span>)].intValue *<span class="number">9</span> + [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">2</span>,<span class="number">1</span>)].intValue*<span class="number">10</span> + [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">12</span>,<span class="number">1</span>)].intValue *<span class="number">10</span> + [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">3</span>,<span class="number">1</span>)].intValue*<span class="number">5</span> + [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">13</span>,<span class="number">1</span>)].intValue *<span class="number">5</span> + [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">4</span>,<span class="number">1</span>)].intValue*<span class="number">8</span> + [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">14</span>,<span class="number">1</span>)].intValue *<span class="number">8</span> + [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">5</span>,<span class="number">1</span>)].intValue*<span class="number">4</span> + [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">15</span>,<span class="number">1</span>)].intValue *<span class="number">4</span> + [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">6</span>,<span class="number">1</span>)].intValue*<span class="number">2</span> + [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">16</span>,<span class="number">1</span>)].intValue *<span class="number">2</span> + [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">7</span>,<span class="number">1</span>)].intValue *<span class="number">1</span> + [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">8</span>,<span class="number">1</span>)].intValue *<span class="number">6</span> + [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">9</span>,<span class="number">1</span>)].intValue *<span class="number">3</span>;</span><br><span class="line">        <span class="comment">//2ï¼šç”¨åŠ å‡ºæ¥å’Œé™¤ä»¥11ï¼Œçœ‹ä½™æ•°æ˜¯å¤šå°‘ï¼Ÿä½™æ•°åªå¯èƒ½æœ‰0ï¼1ï¼2ï¼3ï¼4ï¼5ï¼6ï¼7ï¼8ï¼9ï¼10è¿™11ä¸ªæ•°å­—</span></span><br><span class="line">        <span class="keyword">int</span> Y = S %<span class="number">11</span>;</span><br><span class="line">        <span class="built_in">NSString</span> *M =<span class="string">@&quot;F&quot;</span>;</span><br><span class="line">        <span class="built_in">NSString</span> *JYM =<span class="string">@&quot;10X98765432&quot;</span>;</span><br><span class="line">        M = [JYM substringWithRange:<span class="built_in">NSMakeRange</span>(Y,<span class="number">1</span>)];<span class="comment">// 3ï¼šè·å–æ ¡éªŒä½</span></span><br><span class="line">        <span class="built_in">NSString</span> *lastStr = [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">17</span>,<span class="number">1</span>)];</span><br><span class="line">        <span class="comment">//4ï¼šæ£€æµ‹IDçš„æ ¡éªŒä½</span></span><br><span class="line">        <span class="keyword">if</span> ([lastStr isEqualToString:<span class="string">@&quot;x&quot;</span>]) &#123;</span><br><span class="line">            <span class="keyword">if</span> ([M isEqualToString:<span class="string">@&quot;X&quot;</span>]) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> ([M isEqualToString:[value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">17</span>,<span class="number">1</span>)]]) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="8-å¼ºå¼±å¼•ç”¨"><a href="#8-å¼ºå¼±å¼•ç”¨" class="headerlink" title="8.å¼ºå¼±å¼•ç”¨"></a>8.å¼ºå¼±å¼•ç”¨</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¨èä½¿ç”¨ï¼ˆæ‘˜è‡ªYYKitï¼‰</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> Synthsize a weak or strong reference.</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> Example:</span></span><br><span class="line"><span class="comment"> @weakify(self)</span></span><br><span class="line"><span class="comment"> [self doSomething^&#123;</span></span><br><span class="line"><span class="comment"> @strongify(self)</span></span><br><span class="line"><span class="comment"> if (!self) return;</span></span><br><span class="line"><span class="comment"> ...</span></span><br><span class="line"><span class="comment"> &#125;];</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> weakify</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> DEBUG</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> __has_feature(objc_arc)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> weakify(object) autoreleasepool&#123;&#125; __weak __typeof__(object) weak##_##object = object;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> weakify(object) autoreleasepool&#123;&#125; __block __typeof__(object) block##_##object = object;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> __has_feature(objc_arc)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> weakify(object) try&#123;&#125; @finally&#123;&#125; &#123;&#125; __weak __typeof__(object) weak##_##object = object;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> weakify(object) try&#123;&#125; @finally&#123;&#125; &#123;&#125; __block __typeof__(object) block##_##object = object;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> strongify</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> DEBUG</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> __has_feature(objc_arc)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> strongify(object) autoreleasepool&#123;&#125; __typeof__(object) object = weak##_##object;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> strongify(object) autoreleasepool&#123;&#125; __typeof__(object) object = block##_##object;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> __has_feature(objc_arc)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> strongify(object) try&#123;&#125; @finally&#123;&#125; __typeof__(object) object = weak##_##object;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> strongify(object) try&#123;&#125; @finally&#123;&#125; __typeof__(object) object = block##_##object;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><h2 id="9-NSLogçš„å®å®šä¹‰"><a href="#9-NSLogçš„å®å®šä¹‰" class="headerlink" title="9.NSLogçš„å®å®šä¹‰"></a>9.NSLogçš„å®å®šä¹‰</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> DEBUG</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NSLog(format,...) printf(<span class="meta-string">&quot;\n[%s] %s [ç¬¬%dè¡Œ] %s\n&quot;</span>,__TIME__,__FUNCTION__,__LINE__,[[NSString stringWithFormat:format,## __VA_ARGS__] UTF8String]);</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NSLog(format, ...)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><h2 id="10-åˆ¤æ–­æ˜¯å¦ä¸ºç©º"><a href="#10-åˆ¤æ–­æ˜¯å¦ä¸ºç©º" class="headerlink" title="10.åˆ¤æ–­æ˜¯å¦ä¸ºç©º"></a>10.åˆ¤æ–­æ˜¯å¦ä¸ºç©º</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> kStringIsEmpty(string)              (string == NULL || [string isKindOfClass:[NSNull class]] || string == nil || [string length] &lt; 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> kArrayIsEmpty(array)                (array == nil || [array isKindOfClass:[NSNull class]] || array.count == 0)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> kDictionaryIsEmpty(dictionary)      (dictionary == nil || [dictionary isKindOfClass:[NSNull class]] || dictionary.allKeys.count == 0)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> kObjectIsEmpty(object)              (object == nil||[object isKindOfClass:[NSNull class]]||([object respondsToSelector:@selector(length)] &amp;&amp; [(NSData *)object length] == 0)|| ([object respondsToSelector:@selector(count)] &amp;&amp; [(NSArray *)object count] == 0))</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="11-ä½¿ç”¨xibåˆ›å»ºè‡ªå®šä¹‰Viewå¹¶åœ¨èƒŒæ™¯æ·»åŠ ç‚¹å‡»äº‹ä»¶"><a href="#11-ä½¿ç”¨xibåˆ›å»ºè‡ªå®šä¹‰Viewå¹¶åœ¨èƒŒæ™¯æ·»åŠ ç‚¹å‡»äº‹ä»¶" class="headerlink" title="11.ä½¿ç”¨xibåˆ›å»ºè‡ªå®šä¹‰Viewå¹¶åœ¨èƒŒæ™¯æ·»åŠ ç‚¹å‡»äº‹ä»¶"></a>11.ä½¿ç”¨<code>xib</code>åˆ›å»ºè‡ªå®šä¹‰Viewå¹¶åœ¨èƒŒæ™¯æ·»åŠ ç‚¹å‡»äº‹ä»¶</h2><p><strong>è¯´æ˜ï¼š</strong><br><code>xib</code>åˆ›å»ºçš„è‡ªå®šä¹‰è§†å›¾ï¼Œæ·»åŠ çš„èƒŒæ™¯ç‚¹å‡»åŠ¨ä½œä¸ä¼šè§¦å‘ç‚¹å‡»äº‹ä»¶ï¼Œå› æ­¤éœ€è¦å•ç‹¬æ·»åŠ ä¸€ä¸ª<code>xibView</code>ï¼Œæ·»åŠ åˆ°è‡ªå®šä¹‰è§†å›¾ä¸Šï¼Œç‚¹å‡»åŠ¨ä½œæ·»åŠ åˆ°<code>xibView</code>ä¸Šå°±å¯ä»¥è§¦å‘ç‚¹å‡»äº‹ä»¶äº†ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>åˆ›å»ºè‡ªå®šä¹‰<code>FSCommonView</code>ã€åˆ›å»º<code>FSCommonView.xib</code>ã€å…³è”åˆ°è‡ªå®šä¹‰çš„<code>FSCommonView</code>ã€‚<br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1glbkbvf4xaj30740bcdgc.jpg" alt="å…³è”è‡ªå®šä¹‰è§†å›¾"></li><li>å°†xibæ·»åŠ åˆ°<code>FSCommonView</code>ä¸­<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">FSCommonView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;FSCommonView.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">FSCommonView</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UIView</span> *xibView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.xibView = [<span class="keyword">self</span> loadViewFromNib];</span><br><span class="line">        [<span class="keyword">self</span> settingUI];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithCoder:(<span class="built_in">NSCoder</span> *)coder &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> initWithCoder:coder];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.xibView = [<span class="keyword">self</span> loadViewFromNib];</span><br><span class="line">        [<span class="keyword">self</span> settingUI];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UIView</span> *)loadViewFromNib &#123;</span><br><span class="line">    <span class="built_in">UIView</span> *xibView = [[<span class="built_in">NSBundle</span> mainBundle] loadNibNamed:<span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span> <span class="keyword">class</span>]) owner:<span class="keyword">self</span> options:<span class="literal">nil</span>].firstObject;</span><br><span class="line">    xibView.frame = <span class="keyword">self</span>.bounds;</span><br><span class="line">    [xibView addGestureRecognizer:[[<span class="built_in">UITapGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(xibBgViewClick)]];</span><br><span class="line">    [<span class="keyword">self</span> addSubview:xibView];</span><br><span class="line">    <span class="keyword">return</span> xibView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)settingUI &#123;</span><br><span class="line">  <span class="comment">// è®¾ç½®èƒŒæ™¯è‰²ã€åœ†è§’ã€è¾¹æ¡†ã€è‡ªå®šä¹‰å­è§†å›¾ç­‰ã€‚</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)xibBgViewClick &#123;</span><br><span class="line">  <span class="comment">// èƒŒæ™¯ç‚¹å‡»äº‹ä»¶</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><h2 id="12-å•„å¹•é¸Ÿ"><a href="#12-å•„å¹•é¸Ÿ" class="headerlink" title="12.å•„å¹•é¸Ÿ"></a>12.å•„å¹•é¸Ÿ</h2></li></ul><blockquote><p>å•„å¹•é¸Ÿï¼Œé˜¿é‡Œå¼€æºé¡¹ç›®ï¼Œå³æ‰‹æœºå±å¹•ä¸Šçš„å•„æœ¨é¸Ÿï¼Œä¸“æŠ“Appé‡Œçš„Bugã€‚å•„å¹•é¸Ÿé›†åˆäº†UIæ£€æŸ¥ã€å¯¹è±¡æŸ¥çœ‹ã€æ–¹æ³•ç›‘å¬ç­‰å¤šç§å¼€å‘å·¥å…·ï¼Œé€šè¿‡æ‹¾å–UIæ§ä»¶ã€æŸ¥çœ‹å¯¹è±¡å±æ€§ã€ç›‘å¬æ–¹æ³•è°ƒç”¨ã€Appå†…æŠ“åŒ…ç­‰ï¼Œä¸ä¾èµ–ç”µè„‘è”è°ƒï¼Œç›´æ¥è·å–è¿è¡Œæ—¶æ•°æ®ï¼Œå¿«é€Ÿå®šä½Bugï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚</p></blockquote><p><strong>åŠŸèƒ½ç®€ä»‹</strong></p><blockquote><ol><li>UIæ£€æŸ¥ï¼šå¿«é€ŸæŸ¥çœ‹é¡µé¢å¸ƒå±€ã€UIæ§ä»¶é—´è·ã€å­—ä½“é¢œè‰²ã€UIæ§ä»¶ç±»åã€å¯¹è±¡å±æ€§/æˆå‘˜å˜é‡ã€å›¾ç‰‡URLç­‰ã€‚</li><li>JSONæŠ“åŒ…ï¼šä¾¿æ·JSONæŠ“åŒ…å·¥å…·ï¼Œé€šè¿‡ç›‘å¬ç³»ç»Ÿjsonè§£ææŠ“åŒ…ã€‚</li><li>æ–¹æ³•ç›‘å¬ï¼šBugå¬è¯Šå™¨ï¼Œå¯ç›‘å¬Appä¸­ä»»æ„OCæ–¹æ³•çš„è°ƒç”¨ï¼Œè¾“å‡ºè°ƒç”¨å‚æ•°ã€è¿”å›å€¼ç­‰ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡å±å¹•æ—¥å¿—è¾“å…¥ç›‘å¬ã€KVCå–å€¼ç­‰å‘½ä»¤ï¼Œæ”¯æŒåå°é…ç½®å‘½ä»¤ã€‚</li><li>poå‘½ä»¤ï¼šæ‰§è¡Œç±»ä¼¼LLDBçš„poå‘½ä»¤ï¼Œåœ¨Appè¿è¡Œæ—¶æ‰§è¡Œpoå‘½ä»¤ï¼Œè°ƒç”¨ä»»æ„æ–¹æ³•ã€‚</li><li>ç³»ç»Ÿä¿¡æ¯ï¼šæŸ¥çœ‹å„ç§ç³»ç»Ÿåç§°ã€ç‰ˆæœ¬ã€å±å¹•ã€UAç­‰ä¿¡æ¯ï¼Œæ”¯æŒå¤–éƒ¨æ·»åŠ ä¿¡æ¯ã€‚</li><li>SandBoxï¼šæŸ¥çœ‹æ²™ç›’æ–‡ä»¶ï¼Œå¯¼å‡ºæ–‡ä»¶ç­‰ã€‚</li><li>Bundleï¼šæŸ¥çœ‹ã€å¯¼å‡ºBundleç›®å½•ä¸­çš„å†…å®¹ã€‚</li><li>Crashï¼šæŸ¥çœ‹Crashæ—¥å¿—ï¼Œéœ€å…ˆæ‰“å¼€ä¸€æ¬¡Crashæ’ä»¶ä»¥å¼€å¯Crashç›‘æ§ã€‚</li><li>Defaultsï¼šæŸ¥çœ‹ã€æ–°å¢ã€åˆ é™¤User Defaultsã€‚</li><li>æ¸…é™¤æ•°æ®ï¼šæ¸…é™¤æ‰€æœ‰æ²™ç›’æ•°æ®ã€User Defaultã€‚</li><li>è§¦ç‚¹æ˜¾ç¤ºï¼šæ˜¾ç¤ºæ‰‹æŒ‡è§¦æ§ã€‚</li><li>UIå¯¹æ¯”ï¼šæ”¯æŒå°†è®¾è®¡å›¾å¯¼å…¥åˆ°Appä¸­è¿›è¡Œå¯¹æ¯”ï¼Œå¹¶å¯ç”»çº¿ã€æ ‡æ³¨éœ€ä¿®æ”¹çš„åœ°æ–¹ï¼Œæ–¹ä¾¿UIèµ°æŸ¥ã€‚</li><li>æŸ¥çœ‹å›¾ç‰‡èµ„æºï¼šæŸ¥çœ‹ã€å¯¼å‡ºAppä¸­çš„èµ„æºå›¾ç‰‡ã€‚</li><li>CPUï¼šæŸ¥çœ‹CPUå ç”¨ã€‚</li><li>å†…å­˜ï¼šæŸ¥çœ‹å†…å­˜å ç”¨ã€‚</li><li>FPSï¼šæŸ¥çœ‹Appå¸§ç‡ã€‚</li><li>ç½‘ç»œæµé‡ï¼šæŸ¥çœ‹å‘é€ã€æ¥æ”¶ç½‘ç»œæµé‡ã€‚</li></ol></blockquote><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">pod</span> <span class="string">&#x27;YKWoodpecker&#x27;</span></span><br></pre></td></tr></table></figure><p>å®˜æ–¹githubåœ°å€ï¼š<a href="https://github.com/alibaba/youku-sdk-tool-woodpecker.git">YKWoodpecker</a></p><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1glbk60pl6aj30u01hc47q.jpg" alt="å•„å¹•é¸Ÿ"></p><p><strong>ä½¿ç”¨</strong></p><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ˜¾ç¤ºå•„å¹•é¸Ÿï¼Œå¯åŠ¨é»˜è®¤æ‰“å¼€UIæ£€æŸ¥æ’ä»¶</span></span><br><span class="line">[[YKWoodpeckerManager sharedInstance] show];</span><br></pre></td></tr></table></figure><h2 id="13-ViewControllerçš„ç”Ÿå‘½å‘¨æœŸã€æ‰§è¡Œé¡ºåº"><a href="#13-ViewControllerçš„ç”Ÿå‘½å‘¨æœŸã€æ‰§è¡Œé¡ºåº" class="headerlink" title="13.ViewControllerçš„ç”Ÿå‘½å‘¨æœŸã€æ‰§è¡Œé¡ºåº"></a>13.ViewControllerçš„ç”Ÿå‘½å‘¨æœŸã€æ‰§è¡Œé¡ºåº</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> initWithCoderï¼šé€šè¿‡nibæ–‡ä»¶åˆå§‹åŒ–æ—¶è§¦å‘ã€‚</span><br><span class="line"><span class="number">2.</span> awakeFromNibï¼šnibæ–‡ä»¶è¢«åŠ è½½çš„æ—¶å€™ï¼Œä¼šå‘ç”Ÿä¸€ä¸ªawakeFromNibçš„æ¶ˆæ¯åˆ°nibæ–‡ä»¶ä¸­çš„æ¯ä¸ªå¯¹è±¡ã€‚      </span><br><span class="line"><span class="number">3.</span> loadViewï¼šå¼€å§‹åŠ è½½è§†å›¾æ§åˆ¶å™¨è‡ªå¸¦çš„viewã€‚</span><br><span class="line"><span class="number">4.</span> viewDidLoadï¼šè§†å›¾æ§åˆ¶å™¨çš„viewè¢«åŠ è½½å®Œæˆã€‚  </span><br><span class="line"><span class="number">5.</span> viewWillAppearï¼šè§†å›¾æ§åˆ¶å™¨çš„viewå°†è¦æ˜¾ç¤ºåœ¨windowä¸Šã€‚</span><br><span class="line"><span class="number">6.</span> updateViewConstraintsï¼šè§†å›¾æ§åˆ¶å™¨çš„viewå¼€å§‹æ›´æ–°AutoLayoutçº¦æŸã€‚</span><br><span class="line"><span class="number">7.</span> viewWillLayoutSubviewsï¼šè§†å›¾æ§åˆ¶å™¨çš„viewå°†è¦æ›´æ–°å†…å®¹è§†å›¾çš„ä½ç½®ã€‚</span><br><span class="line"><span class="number">8.</span> viewDidLayoutSubviewsï¼šè§†å›¾æ§åˆ¶å™¨çš„viewå·²ç»æ›´æ–°è§†å›¾çš„ä½ç½®ã€‚</span><br><span class="line"><span class="number">9.</span> viewDidAppearï¼šè§†å›¾æ§åˆ¶å™¨çš„viewå·²ç»å±•ç¤ºåˆ°windowä¸Šã€‚ </span><br><span class="line"><span class="number">10.</span> viewWillDisappearï¼šè§†å›¾æ§åˆ¶å™¨çš„viewå°†è¦ä»windowä¸Šæ¶ˆå¤±ã€‚</span><br><span class="line"><span class="number">11.</span> viewDidDisappearï¼šè§†å›¾æ§åˆ¶å™¨çš„viewå·²ç»ä»windowä¸Šæ¶ˆå¤±ã€‚</span><br></pre></td></tr></table></figure><h2 id="14-å»é™¤Cocopodsç¬¬ä¸‰æ–¹åº“éƒ¨åˆ†è­¦å‘Šå’ŒMobileCoreServices-frameworkè¿‡æœŸçš„é—®é¢˜"><a href="#14-å»é™¤Cocopodsç¬¬ä¸‰æ–¹åº“éƒ¨åˆ†è­¦å‘Šå’ŒMobileCoreServices-frameworkè¿‡æœŸçš„é—®é¢˜" class="headerlink" title="14. å»é™¤Cocopodsç¬¬ä¸‰æ–¹åº“éƒ¨åˆ†è­¦å‘Šå’ŒMobileCoreServices.frameworkè¿‡æœŸçš„é—®é¢˜"></a>14. å»é™¤<code>Cocopods</code>ç¬¬ä¸‰æ–¹åº“éƒ¨åˆ†è­¦å‘Šå’Œ<code>MobileCoreServices.framework</code>è¿‡æœŸçš„é—®é¢˜</h2><p>åœ¨<code>Podfile</code>çš„æœ«å°¾å¤„æ·»åŠ å¦‚ä¸‹ä»£ç ï¼Œå† <code>pod install</code></p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">post_install <span class="keyword">do</span> <span class="operator">|</span>pi<span class="operator">|</span></span><br><span class="line">    # å»é™¤<span class="type">Podsç‰ˆæœ¬è­¦å‘Š</span></span><br><span class="line">    pi.pods_project.targets.each <span class="keyword">do</span> <span class="operator">|</span>t<span class="operator">|</span></span><br><span class="line">      t.build_configurations.each <span class="keyword">do</span> <span class="operator">|</span>config<span class="operator">|</span></span><br><span class="line">        config.build_settings[&#x27;<span class="type">IPHONEOS_DEPLOYMENT_TARGET</span>&#x27;] <span class="operator">=</span> &#x27;<span class="number">9.0</span>&#x27;</span><br><span class="line">      end</span><br><span class="line">    end</span><br><span class="line">    # æ›¿æ¢<span class="type">Podså¼•ç”¨çš„ä¸å†ä½¿ç”¨çš„é™æ€åº“MobileCoreServices</span>.framework</span><br><span class="line">    framework <span class="operator">=</span> pi.pods_project.frameworks_group[<span class="string">&quot;iOS&quot;</span>][<span class="string">&quot;MobileCoreServices.framework&quot;</span>]</span><br><span class="line">    framework.referrers.each <span class="keyword">do</span> <span class="operator">|</span>ref<span class="operator">|</span></span><br><span class="line">        <span class="keyword">if</span> ref.isa <span class="operator">==</span> <span class="string">&quot;PBXBuildFile&quot;</span></span><br><span class="line">            ref.remove_from_project</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">    framework.remove_from_project</span><br><span class="line">end</span><br></pre></td></tr></table></figure><h2 id="15-è§£å†³NSTimerå¾ªç¯å¼•ç”¨çš„é—®é¢˜"><a href="#15-è§£å†³NSTimerå¾ªç¯å¼•ç”¨çš„é—®é¢˜" class="headerlink" title="15. è§£å†³NSTimerå¾ªç¯å¼•ç”¨çš„é—®é¢˜"></a>15. è§£å†³<code>NSTimer</code>å¾ªç¯å¼•ç”¨çš„é—®é¢˜</h2><p>è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š</p><ol><li><p>æ–¹å¼ä¸€</p><ul><li>timeræ”¹ä¸ºå¼±å¼•ç”¨</li></ul><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSTimer</span> *timer;</span><br></pre></td></tr></table></figure><ul><li>åœ¨é€‚å½“çš„æ—¶æœºé”€æ¯timer</li></ul><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>) viewWillDisappear:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewWillDisappear:animated];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.timer) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.timer invalidate];</span><br><span class="line">        <span class="keyword">self</span>.timer = <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>å¦‚æœæ§åˆ¶å™¨<code>push</code>åˆ°ä¸‹ä¸ªæ§åˆ¶å™¨ï¼Œ<code>viewDidDisappear</code>æ‰§è¡Œåï¼Œtimerè¢«é”€æ¯ï¼Œä¸‹æ¬¡è¿›å…¥APPçš„æ—¶å€™è¿˜è¦é‡æ–°åˆ›å»º</em></p><ul><li>åœ¨<code>viewWillAppear</code>å¼€å¯å®šæ—¶å™¨</li></ul><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)viewWillAppear:(<span class="built_in">BOOL</span>)animated&#123;</span><br><span class="line">    [<span class="keyword">super</span> viewWillAppear:animated];</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>.timer) &#123;</span><br><span class="line">        <span class="keyword">self</span>.timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">1</span> target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(showMsg) userInfo:<span class="literal">nil</span> repeats:<span class="literal">YES</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ–¹å¼äºŒ</p><p>ä¸º<code>self</code>æ·»åŠ <code>proxy</code></p></li></ol><ol start="3"><li>æ–¹å¼ä¸‰</li></ol><h2 id="16-lldbï¼ˆgdbï¼‰å¸¸ç”¨çš„æ§åˆ¶å°è°ƒè¯•å‘½ä»¤ï¼Ÿ"><a href="#16-lldbï¼ˆgdbï¼‰å¸¸ç”¨çš„æ§åˆ¶å°è°ƒè¯•å‘½ä»¤ï¼Ÿ" class="headerlink" title="16. lldbï¼ˆgdbï¼‰å¸¸ç”¨çš„æ§åˆ¶å°è°ƒè¯•å‘½ä»¤ï¼Ÿ"></a>16. lldbï¼ˆgdbï¼‰å¸¸ç”¨çš„æ§åˆ¶å°è°ƒè¯•å‘½ä»¤ï¼Ÿ</h2><blockquote><ol><li>p è¾“å‡ºåŸºæœ¬ç±»å‹ã€‚æ˜¯æ‰“å°å‘½ä»¤ï¼Œéœ€è¦æŒ‡å®šç±»å‹ã€‚æ˜¯printçš„ç®€å†™<pre><code>p (int)[[[self view] subviews] count]</code></pre></li><li>po æ‰“å°å¯¹è±¡ï¼Œä¼šè°ƒç”¨å¯¹è±¡descriptionæ–¹æ³•ã€‚æ˜¯print-objectçš„ç®€å†™<pre><code>po [self view]</code></pre></li><li>expr å¯ä»¥åœ¨è°ƒè¯•æ—¶åŠ¨æ€æ‰§è¡ŒæŒ‡å®šè¡¨è¾¾å¼ï¼Œå¹¶å°†ç»“æœæ‰“å°å‡ºæ¥ã€‚å¸¸ç”¨äºåœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ä¿®æ”¹å˜é‡çš„å€¼ã€‚</li><li>btï¼šæ‰“å°è°ƒç”¨å †æ ˆï¼Œæ˜¯thread backtraceçš„ç®€å†™ï¼ŒåŠ allå¯æ‰“å°æ‰€æœ‰threadçš„å †æ ˆ</li><li>br lï¼šæ˜¯breakpoint listçš„ç®€å†™</li></ol></blockquote><h2 id="17-iOSçš„æ²™ç›’ç›®å½•ç»“æ„"><a href="#17-iOSçš„æ²™ç›’ç›®å½•ç»“æ„" class="headerlink" title="17. iOSçš„æ²™ç›’ç›®å½•ç»“æ„"></a>17. iOSçš„æ²™ç›’ç›®å½•ç»“æ„</h2><blockquote><p>1). Applicationï¼šå­˜æ”¾ç¨‹åºæºæ–‡ä»¶ï¼Œä¸Šæ¶å‰ç»è¿‡æ•°å­—ç­¾åï¼Œä¸Šæ¶åä¸å¯ä¿®æ”¹ã€‚<br>2). Documentsï¼šå¸¸ç”¨ç›®å½•ï¼ŒiCloudå¤‡ä»½ç›®å½•ï¼Œå­˜æ”¾æ•°æ®ã€‚ï¼ˆè¿™é‡Œä¸èƒ½å­˜ç¼“å­˜æ–‡ä»¶ï¼Œå¦åˆ™ä¸Šæ¶ä¸è¢«é€šè¿‡ï¼‰<br>3). Libraryï¼š<br>     Cachesï¼šå­˜æ”¾ä½“ç§¯å¤§åˆä¸éœ€è¦å¤‡ä»½çš„æ•°æ®ã€‚(å¸¸ç”¨çš„ç¼“å­˜è·¯å¾„)<br>     Preferenceï¼šè®¾ç½®ç›®å½•ï¼ŒiCloudä¼šå¤‡ä»½è®¾ç½®ä¿¡æ¯ã€‚<br>4). tmpï¼šå­˜æ”¾ä¸´æ—¶æ–‡ä»¶ï¼Œä¸ä¼šè¢«å¤‡ä»½ï¼Œè€Œä¸”è¿™ä¸ªæ–‡ä»¶ä¸‹çš„æ•°æ®æœ‰å¯èƒ½éšæ—¶è¢«æ¸…é™¤çš„å¯èƒ½ã€‚</p></blockquote><h2 id="18-å®‰è£…åŒ…ä¼˜åŒ–"><a href="#18-å®‰è£…åŒ…ä¼˜åŒ–" class="headerlink" title="18. å®‰è£…åŒ…ä¼˜åŒ–"></a>18. å®‰è£…åŒ…ä¼˜åŒ–</h2><h3 id="1-1-å®‰è£…åŒ…çš„æ„æˆ"><a href="#1-1-å®‰è£…åŒ…çš„æ„æˆ" class="headerlink" title="1.1 å®‰è£…åŒ…çš„æ„æˆ"></a>1.1 å®‰è£…åŒ…çš„æ„æˆ</h3><p>åŒ…å«èµ„æºå’Œå¯æ‰§è¡Œæ–‡ä»¶ Mach-o ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­èµ„æºåŒ…æ‹¬ Assets.car æ–‡ä»¶å’Œå…¶ä»–èµ„æº</p><h4 id="1-1-1-Mach-o"><a href="#1-1-1-Mach-o" class="headerlink" title="1.1.1 Mach-o"></a>1.1.1 Mach-o</h4><p>Mach-oæ˜¯iOSä¸Šçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ˜¯ç”±ä»£ç æºæ–‡ä»¶ç»è¿‡ç¼–è¯‘å’Œé™æ€é“¾æ¥è·å–çš„ã€‚ç»è¿‡App Slicingä¹‹åçš„Mach-oæ–‡ä»¶å¾€å¾€åªåŒ…å«å•ä¸ªæ¶æ„ã€‚</p><h4 id="1-1-2-Assets-car"><a href="#1-1-2-Assets-car" class="headerlink" title="1.1.2 Assets.car"></a>1.1.2 Assets.car</h4><p>Assets.car æ˜¯Asset catalog çš„æ„å»ºäº§ç‰©ã€‚Xcodeä¸­çš„actoolè´Ÿè´£æ„å»ºAssets.car ã€‚åœ¨æ„å»ºAssets.carçš„è¿‡ç¨‹ä¸­actoolä¼šæŒ‰ç…§ä¸€å®šçš„ç­–ç•¥ç¼–ç ç®—æ³•ï¼Œå¯¹pngå›¾ç‰‡è¿›è¡Œç¼–ç ã€‚</p><h3 id="1-2-èµ„æºå¤§å°ä¼˜åŒ–"><a href="#1-2-èµ„æºå¤§å°ä¼˜åŒ–" class="headerlink" title="1.2 èµ„æºå¤§å°ä¼˜åŒ–"></a>1.2 èµ„æºå¤§å°ä¼˜åŒ–</h3><h4 id="1-2-1-ä½¿ç”¨åˆé€‚çš„èµ„æºå‹ç¼©é…ç½®"><a href="#1-2-1-ä½¿ç”¨åˆé€‚çš„èµ„æºå‹ç¼©é…ç½®" class="headerlink" title="1.2.1 ä½¿ç”¨åˆé€‚çš„èµ„æºå‹ç¼©é…ç½®"></a>1.2.1 ä½¿ç”¨åˆé€‚çš„èµ„æºå‹ç¼©é…ç½®</h4><h4 id="1-2-2-ä½¿ç”¨-RGB-with-palette-å‹ç¼©å›¾ç‰‡"><a href="#1-2-2-ä½¿ç”¨-RGB-with-palette-å‹ç¼©å›¾ç‰‡" class="headerlink" title="1.2.2 ä½¿ç”¨ RGB with palette å‹ç¼©å›¾ç‰‡"></a>1.2.2 ä½¿ç”¨ RGB with palette å‹ç¼©å›¾ç‰‡</h4><h2 id="19-UITableViewé”®ç›˜éšè—çš„é—®é¢˜"><a href="#19-UITableViewé”®ç›˜éšè—çš„é—®é¢˜" class="headerlink" title="19. UITableViewé”®ç›˜éšè—çš„é—®é¢˜"></a>19. UITableViewé”®ç›˜éšè—çš„é—®é¢˜</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UITableView</span> *tableView;</span><br><span class="line">- (<span class="built_in">UITableView</span> *)tableView &#123;</span><br><span class="line">    <span class="keyword">if</span> (!_tableView) &#123;</span><br><span class="line">        _tableView = [[<span class="built_in">UITableView</span> alloc] init];</span><br><span class="line">      <span class="comment">// æ§åˆ¶é”®ç›˜éšè—</span></span><br><span class="line">        <span class="built_in">UITableViewController</span> *tvc = [[<span class="built_in">UITableViewController</span> alloc] initWithStyle:<span class="built_in">UITableViewStyleGrouped</span>];</span><br><span class="line">        [<span class="keyword">self</span> addChildViewController:tvc];</span><br><span class="line">        _tableView = tvc.tableView;</span><br><span class="line">      </span><br><span class="line">        _tableView.delegate = <span class="keyword">self</span>;</span><br><span class="line">        _tableView.dataSource = <span class="keyword">self</span>;</span><br><span class="line">      <span class="comment">// éšè—é”®ç›˜</span></span><br><span class="line">        _tableView.separatorStyle = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _tableView;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="20-æ•°ç»„å»é‡"><a href="#20-æ•°ç»„å»é‡" class="headerlink" title="20. æ•°ç»„å»é‡"></a>20. æ•°ç»„å»é‡</h2><ul><li><p>NSOrderedSetå»é‡</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">- (NSArray *)removeDuplicateArr:(NSArray *)arr &#123;</span><br><span class="line">    NSOrderedSet *orderSet = [NSOrderedSet orderedSetWithArray:arr];</span><br><span class="line">    return orderSet.array;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ValueForKeyPathå»é‡</p><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">- (<span class="built_in">NSArray</span> *)removeDuplicateArr:(<span class="built_in">NSArray</span> *)arr &#123;</span><br><span class="line">    arr = [arr valueForKeyPath:<span class="string">@&quot;@distinctUnionOfObjects.self&quot;</span>];</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å…¶ä»–</p><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">- (<span class="built_in">NSArray</span> *)removeDuplicateArr3:(<span class="built_in">NSArray</span> *)arr &#123;</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *mArr = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:arr.count];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSString</span> *str <span class="keyword">in</span> arr) &#123;</span><br><span class="line">        <span class="keyword">if</span> (![mArr containsObject:str]) &#123;</span><br><span class="line">            [mArr addObject:str];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mArr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSArray</span> *)removeDuplicateArr4:(<span class="built_in">NSArray</span> *)arr &#123;</span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *mDict = [<span class="built_in">NSMutableDictionary</span> dictionaryWithCapacity:<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSString</span> *str <span class="keyword">in</span> arr) &#123;</span><br><span class="line">        [mDict setObject:str forKey:str];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mDict.allKeys;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSArray</span> *)removeDuplicateArr5:(<span class="built_in">NSArray</span> *)arr &#123;</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *mArr = [<span class="built_in">NSMutableArray</span> arrayWithArray:arr];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSString</span> *str <span class="keyword">in</span> arr) &#123;</span><br><span class="line">        <span class="keyword">if</span> ([mArr containsObject:str]) &#123;</span><br><span class="line">            [mArr removeObject:str];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mArr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="21-iOS-åˆ¤æ–­å¹³é¢ä¸Šä¸€ä¸ªç‚¹æ˜¯å¦åœ¨ä¸è§„åˆ™çš„å°é—­åŒºåŸŸå†…"><a href="#21-iOS-åˆ¤æ–­å¹³é¢ä¸Šä¸€ä¸ªç‚¹æ˜¯å¦åœ¨ä¸è§„åˆ™çš„å°é—­åŒºåŸŸå†…" class="headerlink" title="21. iOS åˆ¤æ–­å¹³é¢ä¸Šä¸€ä¸ªç‚¹æ˜¯å¦åœ¨ä¸è§„åˆ™çš„å°é—­åŒºåŸŸå†…"></a>21. iOS åˆ¤æ–­å¹³é¢ä¸Šä¸€ä¸ªç‚¹æ˜¯å¦åœ¨ä¸è§„åˆ™çš„å°é—­åŒºåŸŸå†…</h2><h3 id="1-åœ¨äºŒç»´ç©ºé—´åˆ›å»ºä¸è§„åˆ™å°é—­åŒºåŸŸ"><a href="#1-åœ¨äºŒç»´ç©ºé—´åˆ›å»ºä¸è§„åˆ™å°é—­åŒºåŸŸ" class="headerlink" title="1. åœ¨äºŒç»´ç©ºé—´åˆ›å»ºä¸è§„åˆ™å°é—­åŒºåŸŸ"></a>1. åœ¨äºŒç»´ç©ºé—´åˆ›å»ºä¸è§„åˆ™å°é—­åŒºåŸŸ</h3><h4 id="1-1-è·¯å¾„ç»˜å›¾"><a href="#1-1-è·¯å¾„ç»˜å›¾" class="headerlink" title="1.1 è·¯å¾„ç»˜å›¾"></a>1.1 è·¯å¾„ç»˜å›¾</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CGMutablePathRef pathRef = CGPathCreateMutable();</span><br></pre></td></tr></table></figure><h4 id="1-2-è·¯å¾„è¿çº¿"><a href="#1-2-è·¯å¾„è¿çº¿" class="headerlink" title="1.2 è·¯å¾„è¿çº¿"></a>1.2 è·¯å¾„è¿çº¿</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CGPathMoveToPoint(pathRef, NULL, 83.277656, -169.938307);</span><br><span class="line"></span><br><span class="line">CGPathAddLineToPoint(pathRef, NULL, 21.083895, -169.938307);</span><br><span class="line"></span><br><span class="line">CGPathAddLineToPoint(pathRef, NULL, 21.083895, -36.617291);</span><br><span class="line"></span><br><span class="line">CGPathAddLineToPoint(pathRef, NULL, 83.877837, -35.508388);</span><br><span class="line"></span><br><span class="line">CGPathAddLineToPoint(pathRef, NULL, 83.277656, -169.938307);</span><br></pre></td></tr></table></figure><h4 id="1-3-å…³é—­ç»˜å›¾"><a href="#1-3-å…³é—­ç»˜å›¾" class="headerlink" title="1.3 å…³é—­ç»˜å›¾"></a>1.3 å…³é—­ç»˜å›¾</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CGPathCloseSubpath(pathRef);</span><br></pre></td></tr></table></figure><h3 id="2-åˆ¤æ–­ä»»æ„ç‚¹æ˜¯å¦åœ¨æ­¤åŒºåŸŸå†…"><a href="#2-åˆ¤æ–­ä»»æ„ç‚¹æ˜¯å¦åœ¨æ­¤åŒºåŸŸå†…" class="headerlink" title="2. åˆ¤æ–­ä»»æ„ç‚¹æ˜¯å¦åœ¨æ­¤åŒºåŸŸå†…"></a>2. åˆ¤æ–­ä»»æ„ç‚¹æ˜¯å¦åœ¨æ­¤åŒºåŸŸå†…</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CGPoint point= CGPointMake(aircraftLocation.latitude, aircraftLocation.longitude);</span><br><span class="line"></span><br><span class="line">BOOL containsPoint = (CGPathContainsPoint(pathRef, NULL, point, NO));</span><br></pre></td></tr></table></figure></li></ul><hr><blockquote><p><strong>ä¸ªäººåšå®¢:</strong> ğŸ¡ <a href="https://forgetsou.github.io/">ForgetSou</a></p></blockquote><hr>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;1-åˆ é™¤ToolBarä¸‹é¢çš„åˆ†å‰²çº¿&quot;&gt;&lt;a href=&quot;#1-åˆ é™¤ToolBarä¸‹é¢çš„åˆ†å‰²çº¿&quot; class=&quot;headerlink&quot; title=&quot;1.åˆ é™¤ToolBarä¸‹é¢çš„åˆ†å‰²çº¿&quot;&gt;&lt;/a&gt;1.åˆ é™¤ToolBarä¸‹é¢çš„åˆ†å‰²çº¿&lt;/h2&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;toolbar.showsBaselineSeparator = &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;2-ä¿®æ”¹TextFieldçš„è“è‰²æˆ–æ©™è‰²è¾¹æ¡†&quot;&gt;&lt;a href=&quot;#2-ä¿®æ”¹TextFieldçš„è“è‰²æˆ–æ©™è‰²è¾¹æ¡†&quot; class=&quot;headerlink&quot; title=&quot;2.ä¿®æ”¹TextFieldçš„è“è‰²æˆ–æ©™è‰²è¾¹æ¡†&quot;&gt;&lt;/a&gt;2.ä¿®æ”¹TextFieldçš„è“è‰²æˆ–æ©™è‰²è¾¹æ¡†&lt;/h2&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.textField.focusRingType = &lt;span class=&quot;built_in&quot;&gt;NSFocusRingTypeNone&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;3-æ‰“å¼€å·²å®‰è£…çš„å…¶ä»–è½¯ä»¶&quot;&gt;&lt;a href=&quot;#3-æ‰“å¼€å·²å®‰è£…çš„å…¶ä»–è½¯ä»¶&quot; class=&quot;headerlink&quot; title=&quot;3.æ‰“å¼€å·²å®‰è£…çš„å…¶ä»–è½¯ä»¶&quot;&gt;&lt;/a&gt;3.æ‰“å¼€å·²å®‰è£…çš„å…¶ä»–è½¯ä»¶&lt;/h2&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *appPath = &lt;span class=&quot;string&quot;&gt;@&amp;quot;/Applications/Foxmail.app&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[[&lt;span class=&quot;built_in&quot;&gt;NSWorkspace&lt;/span&gt; sharedWorkspace] openFile:appPath];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[[&lt;span class=&quot;built_in&quot;&gt;NSWorkspace&lt;/span&gt; sharedWorkspace] launchApplication:&lt;span class=&quot;string&quot;&gt;@&amp;quot;Foxmail&amp;quot;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;4-æ‰“å¼€ç½‘é¡µ&quot;&gt;&lt;a href=&quot;#4-æ‰“å¼€ç½‘é¡µ&quot; class=&quot;headerlink&quot; title=&quot;4.æ‰“å¼€ç½‘é¡µ&quot;&gt;&lt;/a&gt;4.æ‰“å¼€ç½‘é¡µ&lt;/h2&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[[&lt;span class=&quot;built_in&quot;&gt;NSWorkspace&lt;/span&gt; sharedWorkspace] openURL:[&lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt; URLWithString:&lt;span class=&quot;string&quot;&gt;@&amp;quot;https://www.baidu.com&amp;quot;&lt;/span&gt;]];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;5-Colorç”Ÿæˆçº¯è‰²å›¾ç‰‡ï¼ˆiOSï¼‰&quot;&gt;&lt;a href=&quot;#5-Colorç”Ÿæˆçº¯è‰²å›¾ç‰‡ï¼ˆiOSï¼‰&quot; class=&quot;headerlink&quot; title=&quot;5.Colorç”Ÿæˆçº¯è‰²å›¾ç‰‡ï¼ˆiOSï¼‰&quot;&gt;&lt;/a&gt;5.Colorç”Ÿæˆçº¯è‰²å›¾ç‰‡ï¼ˆiOSï¼‰&lt;/h2&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// ç”Ÿæˆçº¯è‰²å›¾ç‰‡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ (&lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; *)pureColorImageWithColor:(&lt;span class=&quot;built_in&quot;&gt;UIColor&lt;/span&gt; *)color &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;CGSize&lt;/span&gt; imageSize = &lt;span class=&quot;built_in&quot;&gt;CGSizeMake&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;f, &lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;f);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;UIGraphicsBeginImageContextWithOptions&lt;/span&gt;(imageSize, &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0.0&lt;/span&gt;f);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;CGContextRef&lt;/span&gt; theContext = &lt;span class=&quot;built_in&quot;&gt;UIGraphicsGetCurrentContext&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;CGContextSetFillColorWithColor&lt;/span&gt;(theContext, color.CGColor);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;CGContextFillRect&lt;/span&gt;(theContext, &lt;span class=&quot;built_in&quot;&gt;CGRectMake&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;0.0&lt;/span&gt;f, &lt;span class=&quot;number&quot;&gt;0.0&lt;/span&gt;f, imageSize.width, imageSize.height));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;CGImageRef&lt;/span&gt; theCGImage = &lt;span class=&quot;built_in&quot;&gt;CGBitmapContextCreateImage&lt;/span&gt;(theContext);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; *theImage;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([[&lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt;] respondsToSelector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(imageWithCGImage:scale:orientation:)]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      theImage = [&lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; imageWithCGImage:theCGImage scale:[&lt;span class=&quot;built_in&quot;&gt;UIScreen&lt;/span&gt; mainScreen].scale orientation:&lt;span class=&quot;built_in&quot;&gt;UIImageOrientationUp&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      theImage = [&lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; imageWithCGImage:theCGImage];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;CGImageRelease&lt;/span&gt;(theCGImage);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; theImage;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// ç”Ÿæˆçº¯è‰²åœ†è§’å›¾ç‰‡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ (&lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; *)pureColorImageWithSize:(&lt;span class=&quot;built_in&quot;&gt;CGSize&lt;/span&gt;)size&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      color:(&lt;span class=&quot;built_in&quot;&gt;UIColor&lt;/span&gt; *)color&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  cornRadius:(&lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt;)radius &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;UIGraphicsBeginImageContextWithOptions&lt;/span&gt;(size, &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;CGContextRef&lt;/span&gt; cxt = &lt;span class=&quot;built_in&quot;&gt;UIGraphicsGetCurrentContext&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;CGContextSetFillColorWithColor&lt;/span&gt;(cxt, color.CGColor);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;CGContextSetStrokeColorWithColor&lt;/span&gt;(cxt, color.CGColor);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;CGContextMoveToPoint&lt;/span&gt;(cxt, size.width, size.height-radius);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;CGContextAddArcToPoint&lt;/span&gt;(cxt, size.width, size.height, size.width-radius, size.height, radius);&lt;span class=&quot;comment&quot;&gt;//å³ä¸‹è§’&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;CGContextAddArcToPoint&lt;/span&gt;(cxt, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, size.height, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, size.height-radius, radius);&lt;span class=&quot;comment&quot;&gt;//å·¦ä¸‹è§’&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;CGContextAddArcToPoint&lt;/span&gt;(cxt, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, radius, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, radius);&lt;span class=&quot;comment&quot;&gt;//å·¦ä¸Šè§’&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;CGContextAddArcToPoint&lt;/span&gt;(cxt, size.width, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, size.width, radius, radius);&lt;span class=&quot;comment&quot;&gt;//å³ä¸Šè§’&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;CGContextClosePath&lt;/span&gt;(cxt);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;CGContextDrawPath&lt;/span&gt;(cxt, kCGPathFillStroke);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; *image = &lt;span class=&quot;built_in&quot;&gt;UIGraphicsGetImageFromCurrentImageContext&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;UIGraphicsEndImageContext&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; image;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="OC" scheme="https://forgetsou.github.io/categories/OC/"/>
    
    
    <category term="OC" scheme="https://forgetsou.github.io/tags/OC/"/>
    
    <category term="æ—¥å¸¸æ”¶é›†" scheme="https://forgetsou.github.io/tags/%E6%97%A5%E5%B8%B8%E6%94%B6%E9%9B%86/"/>
    
  </entry>
  
  <entry>
    <title>æ—¥å¸¸æŠ¥é”™æ”¶é›†è®°å½•</title>
    <link href="https://forgetsou.github.io/2020/11/12/%E6%97%A5%E5%B8%B8%E6%8A%A5%E9%94%99%E6%94%B6%E9%9B%86%E8%AE%B0%E5%BD%95/"/>
    <id>https://forgetsou.github.io/2020/11/12/%E6%97%A5%E5%B8%B8%E6%8A%A5%E9%94%99%E6%94%B6%E9%9B%86%E8%AE%B0%E5%BD%95/</id>
    <published>2020-11-12T06:12:13.000Z</published>
    <updated>2020-12-07T06:12:13.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-LGAlertViewåº“viewWillTransitionToSizeå´©æºƒ"><a href="#1-LGAlertViewåº“viewWillTransitionToSizeå´©æºƒ" class="headerlink" title="1.LGAlertViewåº“viewWillTransitionToSizeå´©æºƒ"></a>1.LGAlertViewåº“viewWillTransitionToSizeå´©æºƒ</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewWillTransitionToSize:(<span class="built_in">CGSize</span>)size withTransitionCoordinator:(<span class="keyword">id</span>&lt;<span class="built_in">UIViewControllerTransitionCoordinator</span>&gt;)coordinator &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewWillTransitionToSize:size withTransitionCoordinator:coordinator];</span><br><span class="line"></span><br><span class="line">      __<span class="keyword">weak</span> <span class="keyword">typeof</span>(<span class="keyword">self</span>) weakSelf = <span class="keyword">self</span>;</span><br><span class="line">   dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">0.0</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:coordinator.transitionDuration animations:^&#123;</span><br><span class="line">            [<span class="keyword">self</span> setNeedsStatusBarAppearanceUpdate];</span><br><span class="line">            [<span class="keyword">self</span>.alertView layoutValidateWithSize:size];</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>-[_UIViewControllerOneToOneTransitionContext _duration]: message sent to deallocated instance</code></p><p><code>po coordinator.transitionDuration</code>è¾“å‡º <code>error: property &#39;transitionDuration&#39; not found on object of type &#39;id&#39;</code></p><p><strong>è§£å†³æ–¹æ³•ï¼š</strong></p><p>ä½¿ç”¨ç¡¬ç¼–ç çš„æŒç»­æ—¶é—´ï¼Œ<code>pod &#39;LGAlertView&#39;</code>æ›´æ”¹ä¸ºvovnitçš„æ´¾ç”Ÿåº“</p><p><code>pod &#39;LGAlertView&#39;, :git =&gt; &#39;https://github.com/vovnit/LGAlertView.git&#39;</code></p><p><strong>vovnitçš„æ´¾ç”Ÿåº“çš„å…·ä½“è§£å†³æ–¹æ¡ˆ</strong></p><p>@vovnitçš„å…·ä½“è§£å†³æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewWillTransitionToSize:(<span class="built_in">CGSize</span>)size withTransitionCoordinator:(<span class="keyword">id</span>&lt;<span class="built_in">UIViewControllerTransitionCoordinator</span>&gt;)coordinator &#123;</span><br><span class="line">    <span class="keyword">if</span> (coordinator) &#123;</span><br><span class="line">        [<span class="keyword">super</span> viewWillTransitionToSize:size withTransitionCoordinator:coordinator];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">@try</span> &#123;</span><br><span class="line">        [[<span class="built_in">NSOperationQueue</span> mainQueue] addOperationWithBlock:^&#123;</span><br><span class="line">            __<span class="keyword">weak</span> <span class="keyword">typeof</span>(<span class="keyword">self</span>) weakSelf = <span class="keyword">self</span>;</span><br><span class="line">            [<span class="built_in">UIView</span> animateWithDuration:<span class="number">0.5</span> animations:^&#123;</span><br><span class="line">                <span class="keyword">if</span> (weakSelf) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ([weakSelf respondsToSelector:<span class="keyword">@selector</span>(setNeedsStatusBarAppearanceUpdate)]) &#123;</span><br><span class="line">                        [weakSelf setNeedsStatusBarAppearanceUpdate];</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (weakSelf.alertView) &#123;</span><br><span class="line">                        [weakSelf.alertView layoutValidateWithSize:size];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;];</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125; <span class="keyword">@catch</span> (<span class="built_in">NSException</span> *exception) &#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125; <span class="keyword">@finally</span> &#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-Name-types-using-UpperCamelCase"><a href="#2-Name-types-using-UpperCamelCase" class="headerlink" title="2. Name types using UpperCamelCase."></a>2. Name types using UpperCamelCase.</h2><p>éª†é©¼æ‹¼å†™æ³•</p><p>åœ¨å•æ¬¡åº•éƒ¨æœ‰æ³¢æµªçº¿æç¤º<code>Typo: In word &#39;&#39;</code>æ—¶ï¼Œæ˜¯ç”±äºæœªæŒ‰ç…§éª†é©¼æ‹¼å†™æ³•è¿›è¡Œå®šä¹‰ï¼Œä¸€èˆ¬æ˜¯å•è¯æ‹¼å†™é”™è¯¯äº†ã€‚å¦‚ï¼š</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RandowWords</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">final</span> wordPair = <span class="keyword">new</span> WordPair.random();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Padding(</span><br><span class="line">        padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">8.0</span>),</span><br><span class="line">      child: <span class="keyword">new</span> Text(<span class="string">&#x27;éšæœºå­—ç¬¦ä¸²ï¼š<span class="subst">$&#123;wordPair.toString()&#125;</span>&#x27;</span>),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>RandowWordsåº•éƒ¨ä¼šæç¤º<code>Typo:In word &#39;Randow&#39;</code>ï¼›æ­¤æ—¶æ˜¯ç”±äºâ€œéšæœºâ€å•è¯æ‹¼å†™é”™è¯¯ï¼Œä¿®æ”¹ä¸ºRandomå°±å¯ä»¥äº†ã€‚</p><h2 id="3-hexo-æŠ¥é”™"><a href="#3-hexo-æŠ¥é”™" class="headerlink" title="3. hexo æŠ¥é”™"></a>3. hexo æŠ¥é”™</h2><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">hexo s</span><br><span class="line"><span class="type">ERROR</span> <span class="type">Cannot</span> find module &#x27;hexo&#x27; from &#x27;<span class="operator">/</span><span class="type">Users</span><span class="operator">/</span>pv<span class="operator">/</span>myBlog<span class="operator">/</span>blog&#x27;</span><br><span class="line"><span class="type">ERROR</span> <span class="type">Local</span> hexo loading failed <span class="keyword">in</span> <span class="operator">~/</span>myBlog<span class="operator">/</span>blog</span><br><span class="line"><span class="type">ERROR</span> <span class="type">Try</span> running: &#x27;rm <span class="operator">-</span>rf node_modules <span class="operator">&amp;&amp;</span> npm install <span class="operator">--</span>force&#x27;</span><br></pre></td></tr></table></figure><p>åªéœ€è¦è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ä¸‹å°±å¯ä»¥äº†</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">npm install hexo<span class="operator">-</span>util <span class="operator">--</span>save</span><br></pre></td></tr></table></figure><hr><blockquote><p><strong>ä¸ªäººåšå®¢:</strong> ğŸ¡ <a href="https://forgetsou.github.io/">ForgetSou</a></p></blockquote><hr>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;1-LGAlertViewåº“viewWillTransitionToSizeå´©æºƒ&quot;&gt;&lt;a href=&quot;#1-LGAlertViewåº“viewWillTransitionToSizeå´©æºƒ&quot; class=&quot;headerlink&quot; title=&quot;1.LGAlertViewåº“viewWillTransitionToSizeå´©æºƒ&quot;&gt;&lt;/a&gt;1.LGAlertViewåº“viewWillTransitionToSizeå´©æºƒ&lt;/h2&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)viewWillTransitionToSize:(&lt;span class=&quot;built_in&quot;&gt;CGSize&lt;/span&gt;)size withTransitionCoordinator:(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;UIViewControllerTransitionCoordinator&lt;/span&gt;&amp;gt;)coordinator &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; viewWillTransitionToSize:size withTransitionCoordinator:coordinator];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      __&lt;span class=&quot;keyword&quot;&gt;weak&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;typeof&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;) weakSelf = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(&lt;span class=&quot;number&quot;&gt;0.0&lt;/span&gt; * &lt;span class=&quot;built_in&quot;&gt;NSEC_PER_SEC&lt;/span&gt;)), dispatch_get_main_queue(), ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [&lt;span class=&quot;built_in&quot;&gt;UIView&lt;/span&gt; animateWithDuration:coordinator.transitionDuration animations:^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; setNeedsStatusBarAppearanceUpdate];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.alertView layoutValidateWithSize:size];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;code&gt;-[_UIViewControllerOneToOneTransitionContext _duration]: message sent to deallocated instance&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;po coordinator.transitionDuration&lt;/code&gt;è¾“å‡º &lt;code&gt;error: property &amp;#39;transitionDuration&amp;#39; not found on object of type &amp;#39;id&amp;#39;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è§£å†³æ–¹æ³•ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ç¡¬ç¼–ç çš„æŒç»­æ—¶é—´ï¼Œ&lt;code&gt;pod &amp;#39;LGAlertView&amp;#39;&lt;/code&gt;æ›´æ”¹ä¸ºvovnitçš„æ´¾ç”Ÿåº“&lt;/p&gt;
&lt;p&gt;&lt;code&gt;pod &amp;#39;LGAlertView&amp;#39;, :git =&amp;gt; &amp;#39;https://github.com/vovnit/LGAlertView.git&amp;#39;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;vovnitçš„æ´¾ç”Ÿåº“çš„å…·ä½“è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;@vovnitçš„å…·ä½“è§£å†³æ–¹å¼å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)viewWillTransitionToSize:(&lt;span class=&quot;built_in&quot;&gt;CGSize&lt;/span&gt;)size withTransitionCoordinator:(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;UIViewControllerTransitionCoordinator&lt;/span&gt;&amp;gt;)coordinator &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (coordinator) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; viewWillTransitionToSize:size withTransitionCoordinator:coordinator];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;@try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [[&lt;span class=&quot;built_in&quot;&gt;NSOperationQueue&lt;/span&gt; mainQueue] addOperationWithBlock:^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            __&lt;span class=&quot;keyword&quot;&gt;weak&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;typeof&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;) weakSelf = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            [&lt;span class=&quot;built_in&quot;&gt;UIView&lt;/span&gt; animateWithDuration:&lt;span class=&quot;number&quot;&gt;0.5&lt;/span&gt; animations:^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (weakSelf) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([weakSelf respondsToSelector:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(setNeedsStatusBarAppearanceUpdate)]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        [weakSelf setNeedsStatusBarAppearanceUpdate];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (weakSelf.alertView) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        [weakSelf.alertView layoutValidateWithSize:size];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;@catch&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;NSException&lt;/span&gt; *exception) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;@finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="Other" scheme="https://forgetsou.github.io/categories/Other/"/>
    
    
    <category term="æ—¥å¸¸æ”¶é›†" scheme="https://forgetsou.github.io/tags/%E6%97%A5%E5%B8%B8%E6%94%B6%E9%9B%86/"/>
    
  </entry>
  
  <entry>
    <title>iOSå¼€å‘-iOS14ç”»ä¸­ç”»(OC)</title>
    <link href="https://forgetsou.github.io/2020/11/11/iOS%E5%BC%80%E5%8F%91-iOS14%E7%94%BB%E4%B8%AD%E7%94%BB-OC/"/>
    <id>https://forgetsou.github.io/2020/11/11/iOS%E5%BC%80%E5%8F%91-iOS14%E7%94%BB%E4%B8%AD%E7%94%BB-OC/</id>
    <published>2020-11-11T07:53:35.000Z</published>
    <updated>2020-11-11T07:53:35.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸€-ç®€è¿°"><a href="#ä¸€-ç®€è¿°" class="headerlink" title="ä¸€ ç®€è¿°"></a>ä¸€ ç®€è¿°</h1><p>ä¸€ç§æ§åˆ¶å™¨ï¼Œç”¨äºåœ¨æµ®åŠ¨çš„å¯è°ƒæ•´å¤§å°çš„çª—å£ä¸­å“åº”ç”¨æˆ·å¯åŠ¨çš„ç”»ä¸­ç”»è§†é¢‘æ’­æ”¾ã€‚</p><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">API_AVAILABLE(ios(<span class="number">9.0</span>), macos(<span class="number">10.15</span>), tvos(<span class="number">14.0</span>)) API_UNAVAILABLE(watchos)</span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AVPictureInPictureController</span> : <span class="title">NSObject</span></span></span><br></pre></td></tr></table></figure><blockquote><p><strong>æ³¨æ„</strong></p><p>ç”»ä¸­ç”»ï¼ˆPiPï¼‰æ˜¯Appleå¸Œæœ›å§‹ç»ˆåœ¨ç”¨æˆ·æ§åˆ¶ä¸‹çš„ä¸€é¡¹ç”¨æˆ·åŠŸèƒ½ã€‚ä»…åœ¨å“åº”ç”¨æˆ·çš„æ˜ç¡®è¯·æ±‚æ—¶æ‰è°ƒç”¨PiPã€‚å¦‚æœæŸä¸ªåº”ç”¨ä»¥éç”¨æˆ·ç›´æ¥æŒ‡å¯¼çš„æ–¹å¼è°ƒç”¨PiPï¼Œåˆ™App Storeå®¡æ ¸å°ç»„å°†æ‹’ç»å®ƒã€‚</p></blockquote><p>è¦åœ¨iOSä¸­ä½¿ç”¨ç”»ä¸­ç”»ï¼Œè¦åœ¨Xcodeä¸­æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li>æ‰“å¼€åå°æ¨¡å¼å¼€å¯ Audio, AirPlay, and Picture in Picture</li></ol><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gklbwh7jzpj30no07d3z7.jpg" alt="image-20201111164716519"></p><ol start="2"><li>ä¸ºéŸ³é¢‘ä¼šè¯é…ç½®åˆé€‚çš„ç±»åˆ«ï¼Œå¦‚<code>AVAudioSessionCategoryPlayback</code> ã€<code>AVAudioSessionCategoryPlayAndRecord</code>ç­‰</li></ol><blockquote><p>é‡è¦</p><p>ä¸æ”¯æŒå­ç±»åŒ–å’Œé‡å†™å…¶æ–¹æ³•ï¼Œè¿™ä¼šå¯¼è‡´æœªå®šä¹‰çš„è¡Œä¸ºã€‚</p></blockquote><h1 id="äºŒ-å®˜æ–¹å±æ€§æ–¹æ³•"><a href="#äºŒ-å®˜æ–¹å±æ€§æ–¹æ³•" class="headerlink" title="äºŒ å®˜æ–¹å±æ€§æ–¹æ³•"></a>äºŒ å®˜æ–¹å±æ€§æ–¹æ³•</h1><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å½“å‰è®¾å¤‡æ˜¯å¦æ”¯æŒç”»ä¸­ç”»</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)isPictureInPictureSupported;</span><br><span class="line"><span class="comment">// åˆ›å»ºç”»ä¸­ç”»æ§åˆ¶å™¨</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="keyword">instancetype</span>)initWithPlayerLayer:(<span class="built_in">AVPlayerLayer</span> *)playerLayer <span class="built_in">NS_DESIGNATED_INITIALIZER</span>;</span><br><span class="line"><span class="comment">// è¦æ’­æ”¾åª’ä½“çš„æ’­æ”¾å™¨å±‚</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">AVPlayerLayer</span> *playerLayer;</span><br><span class="line"><span class="comment">// æ˜¯å¦å…è®¸ç”¨æˆ·è·³è¿‡åª’ä½“å†…å®¹</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">BOOL</span> requiresLinearPlayback API_AVAILABLE(ios(<span class="number">14.0</span>), macos(<span class="number">11.0</span>), tvos(<span class="number">14.0</span>)) API_UNAVAILABLE(watchos);</span><br><span class="line"><span class="comment">// å§”æ‰˜å¯¹è±¡</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>, <span class="keyword">nullable</span>) <span class="keyword">id</span> &lt;<span class="built_in">AVPictureInPictureControllerDelegate</span>&gt; delegate;</span><br><span class="line"><span class="comment">// å½“å‰æ˜¯å¦å¯ä»¥è¿›è¡Œç”»ä¸­ç”»å›æ”¾</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">getter</span> = isPictureInPicturePossible) <span class="built_in">BOOL</span> pictureInPicturePossible;</span><br><span class="line"><span class="comment">// æ§åˆ¶å™¨çš„ç”»ä¸­ç”»çª—å£æ˜¯å¦åœ¨å±å¹•ä¸Š</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">getter</span> = isPictureInPictureActive) <span class="built_in">BOOL</span> pictureInPictureActive;</span><br><span class="line"><span class="comment">// ç³»ç»Ÿæ˜¯å¦æŒ‚èµ·æ§åˆ¶å™¨çš„ç”»ä¸­ç”»çª—å£</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">getter</span> = isPictureInPictureSuspended) <span class="built_in">BOOL</span> pictureInPictureSuspended;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼€å§‹æ’­æ”¾</span></span><br><span class="line">- (<span class="keyword">void</span>)startPictureInPicture;</span><br><span class="line"><span class="comment">// åœæ­¢æ’­æ”¾(å¦‚æœå½“å‰å¤„äºæ´»è·ƒçŠ¶æ€)</span></span><br><span class="line">- (<span class="keyword">void</span>)stopPictureInPicture;</span><br><span class="line"><span class="comment">// æ˜¯å¦å¤„äºæ´»è·ƒçŠ¶æ€å¹¶ä¸”å¯ä»¥å…³é—­</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">BOOL</span> canStopPictureInPicture API_AVAILABLE(tvos(<span class="number">14.0</span>)) API_UNAVAILABLE(ios, macos, watchos);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç³»ç»Ÿé»˜è®¤çš„â€œç”»ä¸­ç”»â€å¼€å§‹æ¨¡æ¿å›¾åƒï¼Œç”¨äºåº”ç”¨ç¨‹åºçš„â€œç”»ä¸­ç”»â€æŒ‰é’®ã€‚</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">class</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">UIImage</span> *pictureInPictureButtonStartImage API_AVAILABLE(ios(<span class="number">13.0</span>), tvos(<span class="number">14.0</span>));</span><br><span class="line"><span class="comment">// ç³»ç»Ÿé»˜è®¤çš„ç”»ä¸­ç”»åœæ­¢æ¨¡æ¿å›¾åƒï¼Œç”¨äºåº”ç”¨ç¨‹åºçš„ç”»ä¸­ç”»æŒ‰é’®ã€‚</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">class</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">UIImage</span> *pictureInPictureButtonStopImage API_AVAILABLE(ios(<span class="number">13.0</span>), tvos(<span class="number">14.0</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘Šè¯‰å§”æ‰˜äººç”»ä¸­ç”»å³å°†åœæ­¢çš„æ—¶é—´ï¼Œä½¿æ‚¨çš„åº”ç”¨æœ‰æœºä¼šæ¢å¤å…¶è§†é¢‘æ’­æ”¾ç”¨æˆ·ç•Œé¢ã€‚</span></span><br><span class="line">- (<span class="keyword">void</span>)pictureInPictureController:(<span class="built_in">AVPictureInPictureController</span> *)pictureInPictureController restoreUserInterfaceForPictureInPictureStopWithCompletionHandler:(<span class="keyword">void</span> (^)(<span class="built_in">BOOL</span> restored))completionHandler;</span><br><span class="line"><span class="comment">// å½“ç”»ä¸­ç”»å³å°†å¼€å§‹æ—¶</span></span><br><span class="line">- (<span class="keyword">void</span>)pictureInPictureControllerWillStartPictureInPicture:(<span class="built_in">AVPictureInPictureController</span> *)pictureInPictureController;</span><br><span class="line"><span class="comment">// è¯¥ç”»ä¸­ç”»å›æ”¾å·²ç»å¼€å§‹</span></span><br><span class="line">- (<span class="keyword">void</span>)pictureInPictureControllerDidStartPictureInPicture:(<span class="built_in">AVPictureInPictureController</span> *)pictureInPictureController;</span><br><span class="line"><span class="comment">// ç”»ä¸­ç”»æ— æ³•å¯åŠ¨</span></span><br><span class="line">- (<span class="keyword">void</span>)pictureInPictureController:(<span class="built_in">AVPictureInPictureController</span> *)pictureInPictureController failedToStartPictureInPictureWithError:(<span class="built_in">NSError</span> *)error;</span><br><span class="line"><span class="comment">// ç”»ä¸­ç”»å³å°†åœæ­¢</span></span><br><span class="line">- (<span class="keyword">void</span>)pictureInPictureControllerWillStopPictureInPicture:(<span class="built_in">AVPictureInPictureController</span> *)pictureInPictureController;</span><br><span class="line"><span class="comment">// ç”»ä¸­ç”»åœæ­¢</span></span><br><span class="line">- (<span class="keyword">void</span>)pictureInPictureControllerDidStopPictureInPicture:(<span class="built_in">AVPictureInPictureController</span> *)pictureInPictureController;</span><br></pre></td></tr></table></figure><h1 id="ä¸‰-ç®€å•ç¤ºä¾‹"><a href="#ä¸‰-ç®€å•ç¤ºä¾‹" class="headerlink" title="ä¸‰ ç®€å•ç¤ºä¾‹"></a>ä¸‰ ç®€å•ç¤ºä¾‹</h1><h2 id="1-å¯¼å…¥æ¡†æ¶-import-lt-AVKit-AVKit-h-gt"><a href="#1-å¯¼å…¥æ¡†æ¶-import-lt-AVKit-AVKit-h-gt" class="headerlink" title="1. å¯¼å…¥æ¡†æ¶`#import &lt;AVKit/AVKit.h&gt;`"></a>1. å¯¼å…¥æ¡†æ¶`#import &lt;AVKit/AVKit.h&gt;`</h2><h2 id="2-åˆ›å»ºç”»ä¸­ç”»å¯¹è±¡"><a href="#2-åˆ›å»ºç”»ä¸­ç”»å¯¹è±¡" class="headerlink" title="2. åˆ›å»ºç”»ä¸­ç”»å¯¹è±¡"></a>2. åˆ›å»ºç”»ä¸­ç”»å¯¹è±¡</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1.åˆ¤æ–­æ˜¯å¦æ”¯æŒç”»ä¸­ç”»åŠŸèƒ½</span></span><br><span class="line"><span class="keyword">if</span> ([<span class="built_in">AVPictureInPictureController</span> isPictureInPictureSupported]) &#123;</span><br><span class="line">    <span class="comment">//2.å¼€å¯æƒé™</span></span><br><span class="line">    <span class="keyword">@try</span> &#123;</span><br><span class="line">        <span class="built_in">NSError</span> *error = <span class="literal">nil</span>;</span><br><span class="line">        [[<span class="built_in">AVAudioSession</span> sharedInstance] setCategory:<span class="built_in">AVAudioSessionCategoryPlayback</span> error:&amp;error];</span><br><span class="line">        [[<span class="built_in">AVAudioSession</span> sharedInstance] setActive:<span class="literal">YES</span> error:&amp;error];</span><br><span class="line">    &#125; <span class="keyword">@catch</span> (<span class="built_in">NSException</span> *exception) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;AVAudioSessioné”™è¯¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">self</span>.pip = [[<span class="built_in">AVPictureInPictureController</span> alloc] initWithPlayerLayer:<span class="keyword">self</span>.player];</span><br><span class="line">    <span class="keyword">self</span>.pip.delegate = <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong>ä¸Šè¿°ä»£ç é‡Œçš„<code>self.player</code>å¿…é¡»æ˜¯<code>AVPlayerLayer</code>ç±»å‹ã€‚</p><h2 id="3-å¼€å¯-å…³é—­"><a href="#3-å¼€å¯-å…³é—­" class="headerlink" title="3. å¼€å¯/å…³é—­"></a>3. å¼€å¯/å…³é—­</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.pip.isPictureInPictureActive) &#123;</span><br><span class="line">    [<span class="keyword">self</span>.pip stopPictureInPicture];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    [<span class="keyword">self</span>.pip startPictureInPicture];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-å®ç°AVPictureInPictureControllerDelegateä»£ç†"><a href="#4-å®ç°AVPictureInPictureControllerDelegateä»£ç†" class="headerlink" title="4. å®ç°AVPictureInPictureControllerDelegateä»£ç†"></a>4. å®ç°<code>AVPictureInPictureControllerDelegate</code>ä»£ç†</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å³å°†å¼€å¯ç”»ä¸­ç”»</span></span><br><span class="line">- (<span class="keyword">void</span>)pictureInPictureControllerWillStartPictureInPicture:(<span class="built_in">AVPictureInPictureController</span> *)pictureInPictureController &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å·²ç»å¼€å¯ç”»ä¸­ç”»</span></span><br><span class="line">- (<span class="keyword">void</span>)pictureInPictureControllerDidStartPictureInPicture:(<span class="built_in">AVPictureInPictureController</span> *)pictureInPictureController &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¼€å¯ç”»ä¸­ç”»å¤±è´¥</span></span><br><span class="line">- (<span class="keyword">void</span>)pictureInPictureController:(<span class="built_in">AVPictureInPictureController</span> *)pictureInPictureController failedToStartPictureInPictureWithError:(<span class="built_in">NSError</span> *)error &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å³å°†å…³é—­ç”»ä¸­ç”»</span></span><br><span class="line">- (<span class="keyword">void</span>)pictureInPictureControllerWillStopPictureInPicture:(<span class="built_in">AVPictureInPictureController</span> *)pictureInPictureController &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å·²ç»å…³é—­ç”»ä¸­ç”»</span></span><br><span class="line">- (<span class="keyword">void</span>)pictureInPictureControllerDidStopPictureInPicture:(<span class="built_in">AVPictureInPictureController</span> *)pictureInPictureController &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å…³é—­ç”»ä¸­ç”»ä¸”æ¢å¤æ’­æ”¾ç•Œé¢</span></span><br><span class="line">- (<span class="keyword">void</span>)pictureInPictureController:(<span class="built_in">AVPictureInPictureController</span> *)pictureInPictureController restoreUserInterfaceForPictureInPictureStopWithCompletionHandler:(<span class="keyword">void</span> (^)(<span class="built_in">BOOL</span> restored))completionHandler &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;ä¸€-ç®€è¿°&quot;&gt;&lt;a href=&quot;#ä¸€-ç®€è¿°&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ ç®€è¿°&quot;&gt;&lt;/a&gt;ä¸€ ç®€è¿°&lt;/h1&gt;&lt;p&gt;ä¸€ç§æ§åˆ¶å™¨ï¼Œç”¨äºåœ¨æµ®åŠ¨çš„å¯è°ƒæ•´å¤§å°çš„çª—å£ä¸­å“åº”ç”¨æˆ·å¯åŠ¨çš„ç”»ä¸­ç”»è§†é¢‘æ’­æ”¾ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;API_AVAILABLE(ios(&lt;span class=&quot;number&quot;&gt;9.0&lt;/span&gt;), macos(&lt;span class=&quot;number&quot;&gt;10.15&lt;/span&gt;), tvos(&lt;span class=&quot;number&quot;&gt;14.0&lt;/span&gt;)) API_UNAVAILABLE(watchos)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;AVPictureInPictureController&lt;/span&gt; : &lt;span class=&quot;title&quot;&gt;NSObject&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç”»ä¸­ç”»ï¼ˆPiPï¼‰æ˜¯Appleå¸Œæœ›å§‹ç»ˆåœ¨ç”¨æˆ·æ§åˆ¶ä¸‹çš„ä¸€é¡¹ç”¨æˆ·åŠŸèƒ½ã€‚ä»…åœ¨å“åº”ç”¨æˆ·çš„æ˜ç¡®è¯·æ±‚æ—¶æ‰è°ƒç”¨PiPã€‚å¦‚æœæŸä¸ªåº”ç”¨ä»¥éç”¨æˆ·ç›´æ¥æŒ‡å¯¼çš„æ–¹å¼è°ƒç”¨PiPï¼Œåˆ™App Storeå®¡æ ¸å°ç»„å°†æ‹’ç»å®ƒã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¦åœ¨iOSä¸­ä½¿ç”¨ç”»ä¸­ç”»ï¼Œè¦åœ¨Xcodeä¸­æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ‰“å¼€åå°æ¨¡å¼å¼€å¯ Audio, AirPlay, and Picture in Picture&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/0081Kckwly1gklbwh7jzpj30no07d3z7.jpg&quot; alt=&quot;image-20201111164716519&quot;&gt;&lt;/p&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;ä¸ºéŸ³é¢‘ä¼šè¯é…ç½®åˆé€‚çš„ç±»åˆ«ï¼Œå¦‚&lt;code&gt;AVAudioSessionCategoryPlayback&lt;/code&gt; ã€&lt;code&gt;AVAudioSessionCategoryPlayAndRecord&lt;/code&gt;ç­‰&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;é‡è¦&lt;/p&gt;
&lt;p&gt;ä¸æ”¯æŒå­ç±»åŒ–å’Œé‡å†™å…¶æ–¹æ³•ï¼Œè¿™ä¼šå¯¼è‡´æœªå®šä¹‰çš„è¡Œä¸ºã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;äºŒ-å®˜æ–¹å±æ€§æ–¹æ³•&quot;&gt;&lt;a href=&quot;#äºŒ-å®˜æ–¹å±æ€§æ–¹æ³•&quot; class=&quot;headerlink&quot; title=&quot;äºŒ å®˜æ–¹å±æ€§æ–¹æ³•&quot;&gt;&lt;/a&gt;äºŒ å®˜æ–¹å±æ€§æ–¹æ³•&lt;/h1&gt;</summary>
    
    
    
    <category term="OC" scheme="https://forgetsou.github.io/categories/OC/"/>
    
    
    <category term="OC" scheme="https://forgetsou.github.io/tags/OC/"/>
    
    <category term="iOS" scheme="https://forgetsou.github.io/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>iOSå¼€å‘-AudioUnitå®æ—¶å½•éŸ³(OC)</title>
    <link href="https://forgetsou.github.io/2020/11/11/iOS%E5%BC%80%E5%8F%91-AudioUnit%E5%AE%9E%E6%97%B6%E5%BD%95%E9%9F%B3-OC/"/>
    <id>https://forgetsou.github.io/2020/11/11/iOS%E5%BC%80%E5%8F%91-AudioUnit%E5%AE%9E%E6%97%B6%E5%BD%95%E9%9F%B3-OC/</id>
    <published>2020-11-11T07:52:54.000Z</published>
    <updated>2020-11-11T07:52:54.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-å•å£°é“å½•éŸ³"><a href="#1-å•å£°é“å½•éŸ³" class="headerlink" title="1.å•å£°é“å½•éŸ³"></a>1.å•å£°é“å½•éŸ³</h1><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  FSUnitRecorder.h</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;AVFoundation/AVFoundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NS_ASSUME_NONNULL_BEGIN</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">void</span> (^kAudioUnitRecorderOnputBlock)(AudioBufferList *bufferList);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">FSUnitRecorder</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="keyword">double</span> sampleRate;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">BOOL</span> isRecording;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>, <span class="keyword">nonatomic</span>) kAudioUnitRecorderOnputBlock bufferListBlock;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)start;</span><br><span class="line">- (<span class="keyword">void</span>)stop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NS_ASSUME_NONNULL_END</span></span><br></pre></td></tr></table></figure><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  FSUnitRecorder.m</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;FSUnitRecorder.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">FSUnitRecorder</span> ()</span></span><br><span class="line">&#123;</span><br><span class="line">    AudioUnit audioUnit;</span><br><span class="line">    <span class="built_in">BOOL</span> audioComponentInitialized;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>) AudioStreamBasicDescription inputStreamDesc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">FSUnitRecorder</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)init &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">            [<span class="keyword">self</span> defaultSetting];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)defaultSetting &#123;</span><br><span class="line">  <span class="comment">// ä¼˜å…ˆ16000ï¼Œå¦‚æœè®¾å¤‡ä¸æ”¯æŒä½¿ç”¨å…¶å®ƒé‡‡æ ·ç‡</span></span><br><span class="line">    <span class="built_in">NSArray</span> *sampleRates = @[@<span class="number">16000</span>, @<span class="number">11025</span>, @<span class="number">22050</span>, @<span class="number">44100</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSNumber</span> *sampleRate <span class="keyword">in</span> sampleRates) &#123;</span><br><span class="line">        OSStatus status = [<span class="keyword">self</span> prepareRecord:sampleRate.doubleValue];</span><br><span class="line">        <span class="keyword">if</span> (status == noErr) &#123;</span><br><span class="line">            <span class="keyword">self</span>.sampleRate = [sampleRate doubleValue];</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (OSStatus)prepareRecord:(<span class="keyword">double</span>)sampleRate &#123;</span><br><span class="line">    OSStatus status = noErr;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSError</span> *error;</span><br><span class="line">    [[<span class="built_in">AVAudioSession</span> sharedInstance] setCategory:<span class="built_in">AVAudioSessionCategoryPlayAndRecord</span> withOptions:<span class="built_in">AVAudioSessionCategoryOptionMixWithOthers</span> | <span class="built_in">AVAudioSessionCategoryOptionAllowBluetooth</span>  error:&amp;error];</span><br><span class="line">    [[<span class="built_in">AVAudioSession</span> sharedInstance] setActive:<span class="literal">YES</span> error:&amp;error];</span><br><span class="line">  <span class="comment">// This doesn&#x27;t seem to really indicate a problem (iPhone 6s Plus)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> IGNORE</span></span><br><span class="line">    <span class="built_in">NSInteger</span> inputChannels = session.inputNumberOfChannels;</span><br><span class="line">    <span class="keyword">if</span> (!inputChannels) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;ERROR: NO AUDIO INPUT DEVICE&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!audioComponentInitialized) &#123;</span><br><span class="line">        audioComponentInitialized = <span class="literal">YES</span>;</span><br><span class="line">        <span class="comment">// Describe the RemoteIO unit</span></span><br><span class="line">        AudioComponentDescription audioComponentDescription;</span><br><span class="line">        audioComponentDescription.componentType = kAudioUnitType_Output;</span><br><span class="line">        audioComponentDescription.componentSubType = kAudioUnitSubType_RemoteIO;</span><br><span class="line">        audioComponentDescription.componentManufacturer = kAudioUnitManufacturer_Apple;</span><br><span class="line">        audioComponentDescription.componentFlags = <span class="number">0</span>;</span><br><span class="line">        audioComponentDescription.componentFlagsMask = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get the RemoteIO unit</span></span><br><span class="line">        AudioComponent remoteIOComponent = AudioComponentFindNext(<span class="literal">NULL</span>,&amp;audioComponentDescription);</span><br><span class="line">        status = AudioComponentInstanceNew(remoteIOComponent,&amp;(<span class="keyword">self</span>-&gt;audioUnit));</span><br><span class="line">        <span class="keyword">if</span> (CheckError(status, <span class="string">&quot;Couldn&#x27;t get RemoteIO unit instance&quot;</span>)) &#123;</span><br><span class="line">          <span class="keyword">return</span> status;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">UInt32</span> oneFlag = <span class="number">1</span>;</span><br><span class="line">      AudioUnitElement bus0 = <span class="number">0</span>;</span><br><span class="line">      AudioUnitElement bus1 = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> ((<span class="literal">NO</span>)) &#123;</span><br><span class="line">        <span class="comment">// Configure the RemoteIO unit for playback</span></span><br><span class="line">        status = AudioUnitSetProperty (<span class="keyword">self</span>-&gt;audioUnit,</span><br><span class="line">                                       kAudioOutputUnitProperty_EnableIO,</span><br><span class="line">                                       kAudioUnitScope_Output,</span><br><span class="line">                                       bus0,</span><br><span class="line">                                       &amp;oneFlag,</span><br><span class="line">                                       <span class="keyword">sizeof</span>(oneFlag));</span><br><span class="line">        <span class="keyword">if</span> (CheckError(status, <span class="string">&quot;Couldn&#x27;t enable RemoteIO output&quot;</span>)) &#123;</span><br><span class="line">          <span class="keyword">return</span> status;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Configure the RemoteIO unit for input</span></span><br><span class="line">      status = AudioUnitSetProperty(<span class="keyword">self</span>-&gt;audioUnit,</span><br><span class="line">                                    kAudioOutputUnitProperty_EnableIO,</span><br><span class="line">                                    kAudioUnitScope_Input,</span><br><span class="line">                                    bus1,</span><br><span class="line">                                    &amp;oneFlag,</span><br><span class="line">                                    <span class="keyword">sizeof</span>(oneFlag));</span><br><span class="line">      <span class="keyword">if</span> (CheckError(status, <span class="string">&quot;Couldn&#x27;t enable RemoteIO input&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      AudioStreamBasicDescription asbd;</span><br><span class="line">      memset(&amp;asbd, <span class="number">0</span>, <span class="keyword">sizeof</span>(asbd));</span><br><span class="line">      asbd.mSampleRate = sampleRate; <span class="comment">// é‡‡æ ·ç‡</span></span><br><span class="line">      asbd.mFormatID = kAudioFormatLinearPCM;</span><br><span class="line">      asbd.mFormatFlags = kAudioFormatFlagIsSignedInteger | kAudioFormatFlagIsPacked;</span><br><span class="line">      asbd.mBytesPerPacket = <span class="number">2</span>;</span><br><span class="line">      asbd.mFramesPerPacket = <span class="number">1</span>;</span><br><span class="line">      asbd.mBytesPerFrame = <span class="number">2</span>;</span><br><span class="line">      asbd.mChannelsPerFrame = <span class="number">2</span>;</span><br><span class="line">      asbd.mBitsPerChannel = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Set format for output (bus 0) on the RemoteIO&#x27;s input scope</span></span><br><span class="line">      status = AudioUnitSetProperty(<span class="keyword">self</span>-&gt;audioUnit,</span><br><span class="line">                                    kAudioUnitProperty_StreamFormat,</span><br><span class="line">                                    kAudioUnitScope_Input,</span><br><span class="line">                                    bus0,</span><br><span class="line">                                    &amp;asbd,</span><br><span class="line">                                    <span class="keyword">sizeof</span>(asbd));</span><br><span class="line">      <span class="keyword">if</span> (CheckError(status, <span class="string">&quot;Couldn&#x27;t set the ASBD for RemoteIO on input scope/bus 0&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Set format for mic input (bus 1) on RemoteIO&#x27;s output scope</span></span><br><span class="line">      status = AudioUnitSetProperty(<span class="keyword">self</span>-&gt;audioUnit,</span><br><span class="line">                                    kAudioUnitProperty_StreamFormat,</span><br><span class="line">                                    kAudioUnitScope_Output,</span><br><span class="line">                                    bus1,</span><br><span class="line">                                    &amp;asbd,</span><br><span class="line">                                    <span class="keyword">sizeof</span>(asbd));</span><br><span class="line">      <span class="keyword">if</span> (CheckError(status, <span class="string">&quot;Couldn&#x27;t set the ASBD for RemoteIO on output scope/bus 1&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Set the recording callback</span></span><br><span class="line">      AURenderCallbackStruct callbackStruct;</span><br><span class="line">      callbackStruct.inputProc = inputCallBackFun;</span><br><span class="line">      callbackStruct.inputProcRefCon = (__bridge <span class="keyword">void</span> *) <span class="keyword">self</span>;</span><br><span class="line">      status = AudioUnitSetProperty(<span class="keyword">self</span>-&gt;audioUnit,</span><br><span class="line">                                    kAudioOutputUnitProperty_SetInputCallback,</span><br><span class="line">                                    kAudioUnitScope_Global,</span><br><span class="line">                                    bus1,</span><br><span class="line">                                    &amp;callbackStruct,</span><br><span class="line">                                    <span class="keyword">sizeof</span> (callbackStruct));</span><br><span class="line">      <span class="keyword">if</span> (CheckError(status, <span class="string">&quot;Couldn&#x27;t set RemoteIO&#x27;s render callback on bus 0&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> ((<span class="literal">NO</span>)) &#123;</span><br><span class="line">        <span class="comment">// Set the playback callback</span></span><br><span class="line">        AURenderCallbackStruct callbackStruct;</span><br><span class="line">        callbackStruct.inputProc = playbackCallback;</span><br><span class="line">        callbackStruct.inputProcRefCon = (__bridge <span class="keyword">void</span> *) <span class="keyword">self</span>;</span><br><span class="line">        status = AudioUnitSetProperty(<span class="keyword">self</span>-&gt;audioUnit,</span><br><span class="line">                                      kAudioUnitProperty_SetRenderCallback,</span><br><span class="line">                                      kAudioUnitScope_Global,</span><br><span class="line">                                      bus0,</span><br><span class="line">                                      &amp;callbackStruct,</span><br><span class="line">                                      <span class="keyword">sizeof</span> (callbackStruct));</span><br><span class="line">        <span class="keyword">if</span> (CheckError(status, <span class="string">&quot;Couldn&#x27;t set RemoteIO&#x27;s render callback on bus 0&quot;</span>)) &#123;</span><br><span class="line">          <span class="keyword">return</span> status;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Initialize the RemoteIO unit</span></span><br><span class="line">      status = AudioUnitInitialize(<span class="keyword">self</span>-&gt;audioUnit);</span><br><span class="line">      <span class="keyword">if</span> (CheckError(status, <span class="string">&quot;Couldn&#x27;t initialize the RemoteIO unit&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)start &#123;</span><br><span class="line">    [<span class="keyword">self</span> deleteAudioFile];</span><br><span class="line">    CheckError(AudioOutputUnitStart(audioUnit), <span class="string">&quot;AudioOutputUnitStop failed&quot;</span>);</span><br><span class="line">    _isRecording = <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)stop &#123;</span><br><span class="line">    CheckError(AudioOutputUnitStop(audioUnit),</span><br><span class="line">    <span class="string">&quot;AudioOutputUnitStop failed&quot;</span>);</span><br><span class="line">    _isRecording = <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)deleteAudioFile &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *pcmPath = [<span class="built_in">NSSearchPathForDirectoriesInDomains</span>(<span class="built_in">NSDocumentDirectory</span>, <span class="built_in">NSUserDomainMask</span>, <span class="literal">YES</span>).firstObject stringByAppendingPathComponent:<span class="string">@&quot;record.mp3&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> ([[<span class="built_in">NSFileManager</span> defaultManager] fileExistsAtPath:pcmPath]) &#123;</span><br><span class="line">        [[<span class="built_in">NSFileManager</span> defaultManager] removeItemAtPath:pcmPath error:<span class="literal">nil</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span><br><span class="line">    CheckError(AudioComponentInstanceDispose(audioUnit),</span><br><span class="line">               <span class="string">&quot;AudioComponentInstanceDispose failed&quot;</span>);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;UnitRecorderé”€æ¯&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> OSStatus CheckError(OSStatus error, <span class="keyword">const</span> <span class="keyword">char</span> *operation) &#123;</span><br><span class="line">  <span class="keyword">if</span> (error == noErr) &#123;</span><br><span class="line">    <span class="keyword">return</span> error;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">char</span> errorString[<span class="number">20</span>] = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="comment">// See if it appears to be a 4-char-code</span></span><br><span class="line">  *(<span class="built_in">UInt32</span> *)(errorString + <span class="number">1</span>) = <span class="built_in">CFSwapInt32HostToBig</span>(error);</span><br><span class="line">  <span class="keyword">if</span> (isprint(errorString[<span class="number">1</span>]) &amp;&amp; isprint(errorString[<span class="number">2</span>]) &amp;&amp;</span><br><span class="line">      isprint(errorString[<span class="number">3</span>]) &amp;&amp; isprint(errorString[<span class="number">4</span>])) &#123;</span><br><span class="line">    errorString[<span class="number">0</span>] = errorString[<span class="number">5</span>] = <span class="string">&#x27;\&#x27;&#x27;</span>;</span><br><span class="line">    errorString[<span class="number">6</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// No, format it as an integer</span></span><br><span class="line">    sprintf(errorString, <span class="string">&quot;%d&quot;</span>, (<span class="keyword">int</span>)error);</span><br><span class="line">  &#125;</span><br><span class="line">  fprintf(stderr, <span class="string">&quot;Error: %s (%s)\n&quot;</span>, operation, errorString);</span><br><span class="line">  <span class="keyword">return</span> error;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> OSStatus playbackCallback(<span class="keyword">void</span> *inRefCon,</span><br><span class="line">                                 AudioUnitRenderActionFlags *ioActionFlags,</span><br><span class="line">                                 <span class="keyword">const</span> AudioTimeStamp *inTimeStamp,</span><br><span class="line">                                 <span class="built_in">UInt32</span> inBusNumber,</span><br><span class="line">                                 <span class="built_in">UInt32</span> inNumberFrames,</span><br><span class="line">                                 AudioBufferList *ioData) &#123;</span><br><span class="line">  OSStatus status = noErr;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Notes: ioData contains buffers (may be more than one!)</span></span><br><span class="line">  <span class="comment">// Fill them up as much as you can. Remember to set the size value in each buffer to match how</span></span><br><span class="line">  <span class="comment">// much data is in the buffer.</span></span><br><span class="line">  FSUnitRecorder *recorder = (__bridge FSUnitRecorder *) inRefCon;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">UInt32</span> bus1 = <span class="number">1</span>;</span><br><span class="line">  status = AudioUnitRender(recorder-&gt;audioUnit,</span><br><span class="line">                           ioActionFlags,</span><br><span class="line">                           inTimeStamp,</span><br><span class="line">                           bus1,</span><br><span class="line">                           inNumberFrames,</span><br><span class="line">                           ioData);</span><br><span class="line">  CheckError(status, <span class="string">&quot;Couldn&#x27;t render from RemoteIO unit&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> OSStatus inputCallBackFun(<span class="keyword">void</span> *inRefCon,</span><br><span class="line">                    AudioUnitRenderActionFlags *ioActionFlags,</span><br><span class="line">                    <span class="keyword">const</span> AudioTimeStamp *inTimeStamp,</span><br><span class="line">                    <span class="built_in">UInt32</span> inBusNumber,</span><br><span class="line">                    <span class="built_in">UInt32</span> inNumberFrames,</span><br><span class="line">                    AudioBufferList * __<span class="keyword">nullable</span> ioData)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    FSUnitRecorder *recorder = (__bridge FSUnitRecorder *)(inRefCon);</span><br><span class="line">    </span><br><span class="line">    AudioBufferList bufferList;</span><br><span class="line">    bufferList.mNumberBuffers = <span class="number">1</span>;</span><br><span class="line">    bufferList.mBuffers[<span class="number">0</span>].mData = <span class="literal">NULL</span>;</span><br><span class="line">    bufferList.mBuffers[<span class="number">0</span>].mDataByteSize = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    AudioUnitRender(recorder-&gt;audioUnit,</span><br><span class="line">                    ioActionFlags,</span><br><span class="line">                    inTimeStamp,</span><br><span class="line">                    <span class="number">1</span>,</span><br><span class="line">                    inNumberFrames,</span><br><span class="line">                    &amp;bufferList);</span><br><span class="line">    <span class="keyword">if</span> (recorder.bufferListBlock) &#123;</span><br><span class="line">        recorder.bufferListBlock(&amp;bufferList);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> noErr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨</p><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">- (FSUnitRecorder *)recorder &#123;</span><br><span class="line">    <span class="keyword">if</span> (!_recorder) &#123;</span><br><span class="line">        _recorder = [[FSUnitRecorder alloc] init];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _recorder;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@weakify(<span class="keyword">self</span>);</span><br><span class="line"><span class="keyword">self</span>.recorder.bufferListBlock = ^(AudioBufferList * _Nonnull bufferList) &#123;</span><br><span class="line">    @strongify(<span class="keyword">self</span>);</span><br><span class="line">    AudioBuffer buffer = bufferList-&gt;mBuffers[<span class="number">0</span>];</span><br><span class="line">    <span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithBytes:buffer.mData length:buffer.mDataByteSize];</span><br><span class="line">  <span class="comment">// å¤„ç†æ•°æ®</span></span><br><span class="line">    [<span class="keyword">self</span> processSampleData:data];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="2-åŒå£°é“å½•éŸ³"><a href="#2-åŒå£°é“å½•éŸ³" class="headerlink" title="2.åŒå£°é“å½•éŸ³"></a>2.åŒå£°é“å½•éŸ³</h1><p><strong>è¯´æ˜ï¼š</strong><br>å…¬å¸æ–°ä¸šåŠ¡è¦æ¥å…¥è“ç‰™è€³æœºï¼Œæ”¯æŒè“ç‰™è€³æœºï¼Œå·¦å³è€³æœºåˆ†åˆ«è¿›è¡Œè¯­éŸ³è¯†åˆ«ç­‰åŠŸèƒ½ã€‚è¯¥ä¸šåŠ¡ç‰µæ‰¯åˆ°å®æ—¶åŒé€šé“å½•éŸ³ï¼Œåˆ†åˆ«æå–å·¦å³bufferï¼Œç±»ä¼¼çš„ä¸šåŠ¡éœ€æ±‚å¸‚åœºä¸Šä¹Ÿæ˜¯æœ‰çš„ï¼Œæ¯”å¦‚AirPodsï¼Œç™¾åº¦çš„ä¸€æ¬¾è“ç‰™è€³æœºï¼ˆå°åº¦APPâ€œæµæµªåœ°çƒæ¨¡å¼â€ï¼Œå…·ä½“å¯ä»¥ä¹°ä¸€ä¸ªä¸ªè¯•ç”¨ä¸‹ï¼‰ã€‚<br>åºŸè¯ä¸å¤šè¯´äº†ï¼Œç›´æ¥çœ‹ä»£ç å°±è¡Œã€‚</p><p><strong>ZDUnitRecorder.h</strong></p><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;AVFoundation/AVFoundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NS_ASSUME_NONNULL_BEGIN</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">void</span> (^kAudioUnitRecorderOnputBlock)(AudioBufferList *bufferList);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ZDUnitRecorder</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="keyword">double</span> sampleRate;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">BOOL</span> isRecording;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>, <span class="keyword">nonatomic</span>) kAudioUnitRecorderOnputBlock bufferListBlock;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)start;</span><br><span class="line">- (<span class="keyword">void</span>)stop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NS_ASSUME_NONNULL_END</span></span><br></pre></td></tr></table></figure><p><strong>ZDUnitRecorder.m</strong></p><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&quot;ZDUnitRecorder.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ZDUnitRecorder</span> ()</span></span><br><span class="line">&#123;</span><br><span class="line">    AudioUnit audioUnit;</span><br><span class="line">    <span class="built_in">BOOL</span> audioComponentInitialized;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>) AudioStreamBasicDescription inputStreamDesc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ZDUnitRecorder</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)init &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">            [<span class="keyword">self</span> defaultSetting];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)defaultSetting &#123;</span><br><span class="line">    <span class="built_in">NSArray</span> *sampleRates = @[@<span class="number">16000</span>, @<span class="number">11025</span>, @<span class="number">22050</span>, @<span class="number">44100</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSNumber</span> *sampleRate <span class="keyword">in</span> sampleRates) &#123;</span><br><span class="line">        OSStatus status = [<span class="keyword">self</span> prepareRecord:sampleRate.doubleValue];</span><br><span class="line">        <span class="keyword">if</span> (status == noErr) &#123;</span><br><span class="line">            <span class="keyword">self</span>.sampleRate = [sampleRate doubleValue];</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (OSStatus)prepareRecord:(<span class="keyword">double</span>)sampleRate &#123;</span><br><span class="line">    OSStatus status = noErr;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSError</span> *error;</span><br><span class="line">    <span class="built_in">AVAudioSessionCategoryOptions</span> options = <span class="built_in">AVAudioSessionCategoryOptionMixWithOthers</span></span><br><span class="line">    | <span class="built_in">AVAudioSessionCategoryOptionAllowBluetooth</span></span><br><span class="line">    | <span class="built_in">AVAudioSessionCategoryOptionDefaultToSpeaker</span></span><br><span class="line">    | <span class="built_in">AVAudioSessionCategoryOptionAllowAirPlay</span></span><br><span class="line">    | <span class="built_in">AVAudioSessionCategoryOptionAllowBluetoothA2DP</span>;</span><br><span class="line">    </span><br><span class="line">    [[<span class="built_in">AVAudioSession</span> sharedInstance] setCategory:<span class="built_in">AVAudioSessionCategoryPlayAndRecord</span></span><br><span class="line">                                     withOptions:options</span><br><span class="line">                                           error:&amp;error];</span><br><span class="line">    [[<span class="built_in">AVAudioSession</span> sharedInstance] setActive:<span class="literal">YES</span> error:&amp;error];</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> IGNORE</span></span><br><span class="line">    <span class="built_in">NSInteger</span> inputChannels = session.inputNumberOfChannels;</span><br><span class="line">    <span class="keyword">if</span> (!inputChannels) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;ERROR: NO AUDIO INPUT DEVICE&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!audioComponentInitialized) &#123;</span><br><span class="line">        audioComponentInitialized = <span class="literal">YES</span>;</span><br><span class="line">        <span class="comment">// æè¿°éŸ³é¢‘ç»„ä»¶</span></span><br><span class="line">        AudioComponentDescription audioComponentDescription;</span><br><span class="line">        audioComponentDescription.componentType = kAudioUnitType_Output;</span><br><span class="line">        audioComponentDescription.componentSubType = kAudioUnitSubType_RemoteIO;</span><br><span class="line">        audioComponentDescription.componentManufacturer = kAudioUnitManufacturer_Apple;</span><br><span class="line">        audioComponentDescription.componentFlags = <span class="number">0</span>;</span><br><span class="line">        audioComponentDescription.componentFlagsMask = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŸ¥æ‰¾éŸ³é¢‘å•å…ƒ</span></span><br><span class="line">        AudioComponent remoteIOComponent = AudioComponentFindNext(<span class="literal">NULL</span>, &amp;audioComponentDescription);</span><br><span class="line">        <span class="comment">// åˆ›å»ºéŸ³é¢‘å•å…ƒå®ä¾‹</span></span><br><span class="line">        status = AudioComponentInstanceNew(remoteIOComponent, &amp;(<span class="keyword">self</span>-&gt;audioUnit));</span><br><span class="line">        <span class="keyword">if</span> (CheckError(status, <span class="string">&quot;Couldn&#x27;t get RemoteIO unit instance&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> status;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">UInt32</span> oneFlag = <span class="number">1</span>;</span><br><span class="line">      AudioUnitElement bus0 = <span class="number">0</span>;</span><br><span class="line">      AudioUnitElement bus1 = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> ((<span class="literal">NO</span>)) &#123;</span><br><span class="line">        <span class="comment">// Configure the RemoteIO unit for playback</span></span><br><span class="line">        status = AudioUnitSetProperty (<span class="keyword">self</span>-&gt;audioUnit,</span><br><span class="line">                                       kAudioOutputUnitProperty_EnableIO,</span><br><span class="line">                                       kAudioUnitScope_Output,</span><br><span class="line">                                       bus0,</span><br><span class="line">                                       &amp;oneFlag,</span><br><span class="line">                                       <span class="keyword">sizeof</span>(oneFlag));</span><br><span class="line">        <span class="keyword">if</span> (CheckError(status, <span class="string">&quot;Couldn&#x27;t enable RemoteIO output&quot;</span>)) &#123;</span><br><span class="line">          <span class="keyword">return</span> status;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Configure the RemoteIO unit for input</span></span><br><span class="line">      status = AudioUnitSetProperty(<span class="keyword">self</span>-&gt;audioUnit,</span><br><span class="line">                                    kAudioOutputUnitProperty_EnableIO,</span><br><span class="line">                                    kAudioUnitScope_Input,</span><br><span class="line">                                    bus1,</span><br><span class="line">                                    &amp;oneFlag,</span><br><span class="line">                                    <span class="keyword">sizeof</span>(oneFlag));</span><br><span class="line">      <span class="keyword">if</span> (CheckError(status, <span class="string">&quot;Couldn&#x27;t enable RemoteIO input&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="comment">// éŸ³é¢‘æµåŸºç¡€æè¿°</span></span><br><span class="line">    AudioStreamBasicDescription asbd = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    asbd.mSampleRate = sampleRate;<span class="comment">//é‡‡æ ·ç‡</span></span><br><span class="line">    asbd.mFormatID = kAudioFormatLinearPCM;<span class="comment">//åŸå§‹æ•°æ®ä¸ºPCMæ ¼å¼</span></span><br><span class="line">    asbd.mFormatFlags = kAudioFormatFlagIsSignedInteger | kAudioFormatFlagIsNonInterleaved;</span><br><span class="line">    asbd.mChannelsPerFrame = <span class="number">2</span>;<span class="comment">//æ¯å¸§çš„å£°é“æ•°é‡</span></span><br><span class="line">    asbd.mFramesPerPacket = <span class="number">1</span>;<span class="comment">//æ¯ä¸ªæ•°æ®åŒ…å¤šå°‘å¸§</span></span><br><span class="line">    asbd.mBitsPerChannel = <span class="number">16</span>;<span class="comment">//16ä½</span></span><br><span class="line">    asbd.mBytesPerFrame = asbd.mChannelsPerFrame * asbd.mBitsPerChannel / <span class="number">8</span>;<span class="comment">//æ¯å¸§å¤šå°‘å­—èŠ‚ bytes -&gt; bit / 8</span></span><br><span class="line">    asbd.mBytesPerPacket = asbd.mFramesPerPacket * asbd.mBytesPerFrame;<span class="comment">//æ¯ä¸ªåŒ…å¤šå°‘å­—èŠ‚</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// Set format for output (bus 0) on the RemoteIO&#x27;s input scope</span></span><br><span class="line">      status = AudioUnitSetProperty(<span class="keyword">self</span>-&gt;audioUnit,</span><br><span class="line">                                    kAudioUnitProperty_StreamFormat,</span><br><span class="line">                                    kAudioUnitScope_Input,</span><br><span class="line">                                    bus0,</span><br><span class="line">                                    &amp;asbd,</span><br><span class="line">                                    <span class="keyword">sizeof</span>(asbd));</span><br><span class="line">      <span class="keyword">if</span> (CheckError(status, <span class="string">&quot;Couldn&#x27;t set the ASBD for RemoteIO on input scope/bus 0&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Set format for mic input (bus 1) on RemoteIO&#x27;s output scope</span></span><br><span class="line">      status = AudioUnitSetProperty(<span class="keyword">self</span>-&gt;audioUnit,</span><br><span class="line">                                    kAudioUnitProperty_StreamFormat,</span><br><span class="line">                                    kAudioUnitScope_Output,</span><br><span class="line">                                    bus1,</span><br><span class="line">                                    &amp;asbd,</span><br><span class="line">                                    <span class="keyword">sizeof</span>(asbd));</span><br><span class="line">      <span class="keyword">if</span> (CheckError(status, <span class="string">&quot;Couldn&#x27;t set the ASBD for RemoteIO on output scope/bus 1&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Set the recording callback</span></span><br><span class="line">      AURenderCallbackStruct callbackStruct;</span><br><span class="line">      callbackStruct.inputProc = inputCallBackFun;</span><br><span class="line">      callbackStruct.inputProcRefCon = (__bridge <span class="keyword">void</span> *) <span class="keyword">self</span>;</span><br><span class="line">      status = AudioUnitSetProperty(<span class="keyword">self</span>-&gt;audioUnit,</span><br><span class="line">                                    kAudioOutputUnitProperty_SetInputCallback,</span><br><span class="line">                                    kAudioUnitScope_Global,</span><br><span class="line">                                    bus1,</span><br><span class="line">                                    &amp;callbackStruct,</span><br><span class="line">                                    <span class="keyword">sizeof</span> (callbackStruct));</span><br><span class="line">      <span class="keyword">if</span> (CheckError(status, <span class="string">&quot;Couldn&#x27;t set RemoteIO&#x27;s render callback on bus 0&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> ((<span class="literal">NO</span>)) &#123;</span><br><span class="line">        <span class="comment">// Set the playback callback</span></span><br><span class="line">        AURenderCallbackStruct callbackStruct;</span><br><span class="line">        callbackStruct.inputProc = playbackCallback;</span><br><span class="line">        callbackStruct.inputProcRefCon = (__bridge <span class="keyword">void</span> *) <span class="keyword">self</span>;</span><br><span class="line">        status = AudioUnitSetProperty(<span class="keyword">self</span>-&gt;audioUnit,</span><br><span class="line">                                      kAudioUnitProperty_SetRenderCallback,</span><br><span class="line">                                      kAudioUnitScope_Global,</span><br><span class="line">                                      bus0,</span><br><span class="line">                                      &amp;callbackStruct,</span><br><span class="line">                                      <span class="keyword">sizeof</span> (callbackStruct));</span><br><span class="line">        <span class="keyword">if</span> (CheckError(status, <span class="string">&quot;Couldn&#x27;t set RemoteIO&#x27;s render callback on bus 0&quot;</span>)) &#123;</span><br><span class="line">          <span class="keyword">return</span> status;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Initialize the RemoteIO unit</span></span><br><span class="line">      status = AudioUnitInitialize(<span class="keyword">self</span>-&gt;audioUnit);</span><br><span class="line">      <span class="keyword">if</span> (CheckError(status, <span class="string">&quot;Couldn&#x27;t initialize the RemoteIO unit&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)start &#123;</span><br><span class="line">    [<span class="keyword">self</span> deleteAudioFile];</span><br><span class="line">    CheckError(AudioOutputUnitStart(audioUnit), <span class="string">&quot;AudioOutputUnitStop failed&quot;</span>);</span><br><span class="line">    _isRecording = <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)stop &#123;</span><br><span class="line">    CheckError(AudioOutputUnitStop(audioUnit),</span><br><span class="line">    <span class="string">&quot;AudioOutputUnitStop failed&quot;</span>);</span><br><span class="line">    _isRecording = <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)deleteAudioFile &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *pcmPath = [<span class="built_in">NSSearchPathForDirectoriesInDomains</span>(<span class="built_in">NSDocumentDirectory</span>, <span class="built_in">NSUserDomainMask</span>, <span class="literal">YES</span>).firstObject stringByAppendingPathComponent:<span class="string">@&quot;record.mp3&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> ([[<span class="built_in">NSFileManager</span> defaultManager] fileExistsAtPath:pcmPath]) &#123;</span><br><span class="line">        [[<span class="built_in">NSFileManager</span> defaultManager] removeItemAtPath:pcmPath error:<span class="literal">nil</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span><br><span class="line">    CheckError(AudioComponentInstanceDispose(audioUnit),</span><br><span class="line">               <span class="string">&quot;AudioComponentInstanceDispose failed&quot;</span>);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;UnitRecorderé”€æ¯&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> OSStatus CheckError(OSStatus error, <span class="keyword">const</span> <span class="keyword">char</span> *operation) &#123;</span><br><span class="line">  <span class="keyword">if</span> (error == noErr) &#123;</span><br><span class="line">    <span class="keyword">return</span> error;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">char</span> errorString[<span class="number">20</span>] = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="comment">// See if it appears to be a 4-char-code</span></span><br><span class="line">  *(<span class="built_in">UInt32</span> *)(errorString + <span class="number">1</span>) = <span class="built_in">CFSwapInt32HostToBig</span>(error);</span><br><span class="line">  <span class="keyword">if</span> (isprint(errorString[<span class="number">1</span>]) &amp;&amp; isprint(errorString[<span class="number">2</span>]) &amp;&amp;</span><br><span class="line">      isprint(errorString[<span class="number">3</span>]) &amp;&amp; isprint(errorString[<span class="number">4</span>])) &#123;</span><br><span class="line">    errorString[<span class="number">0</span>] = errorString[<span class="number">5</span>] = <span class="string">&#x27;\&#x27;&#x27;</span>;</span><br><span class="line">    errorString[<span class="number">6</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// No, format it as an integer</span></span><br><span class="line">    sprintf(errorString, <span class="string">&quot;%d&quot;</span>, (<span class="keyword">int</span>)error);</span><br><span class="line">  &#125;</span><br><span class="line">  fprintf(stderr, <span class="string">&quot;Error: %s (%s)\n&quot;</span>, operation, errorString);</span><br><span class="line">  <span class="keyword">return</span> error;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> OSStatus playbackCallback(<span class="keyword">void</span> *inRefCon,</span><br><span class="line">                                 AudioUnitRenderActionFlags *ioActionFlags,</span><br><span class="line">                                 <span class="keyword">const</span> AudioTimeStamp *inTimeStamp,</span><br><span class="line">                                 <span class="built_in">UInt32</span> inBusNumber,</span><br><span class="line">                                 <span class="built_in">UInt32</span> inNumberFrames,</span><br><span class="line">                                 AudioBufferList *ioData) &#123;</span><br><span class="line">  OSStatus status = noErr;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Notes: ioData contains buffers (may be more than one!)</span></span><br><span class="line">  <span class="comment">// Fill them up as much as you can. Remember to set the size value in each buffer to match how</span></span><br><span class="line">  <span class="comment">// much data is in the buffer.</span></span><br><span class="line">  ZDUnitRecorder *recorder = (__bridge ZDUnitRecorder *) inRefCon;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">UInt32</span> bus1 = <span class="number">1</span>;</span><br><span class="line">  status = AudioUnitRender(recorder-&gt;audioUnit,</span><br><span class="line">                           ioActionFlags,</span><br><span class="line">                           inTimeStamp,</span><br><span class="line">                           bus1,</span><br><span class="line">                           inNumberFrames,</span><br><span class="line">                           ioData);</span><br><span class="line">  CheckError(status, <span class="string">&quot;Couldn&#x27;t render from RemoteIO unit&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> OSStatus inputCallBackFun(<span class="keyword">void</span> *inRefCon,</span><br><span class="line">                    AudioUnitRenderActionFlags *ioActionFlags,</span><br><span class="line">                    <span class="keyword">const</span> AudioTimeStamp *inTimeStamp,</span><br><span class="line">                    <span class="built_in">UInt32</span> inBusNumber,</span><br><span class="line">                    <span class="built_in">UInt32</span> inNumberFrames,</span><br><span class="line">                    AudioBufferList * __<span class="keyword">nullable</span> ioData)</span><br><span class="line">&#123;</span><br><span class="line">    ZDUnitRecorder *recorder = (__bridge ZDUnitRecorder *)(inRefCon);</span><br><span class="line">    </span><br><span class="line">    AudioBuffer buffer;</span><br><span class="line">    buffer.mData = <span class="literal">NULL</span>;</span><br><span class="line">    buffer.mDataByteSize = <span class="number">0</span>;</span><br><span class="line">    buffer.mNumberChannels = <span class="number">2</span>;</span><br><span class="line">    </span><br><span class="line">    AudioBuffer buffer2;</span><br><span class="line">    buffer2.mData = <span class="literal">NULL</span>;</span><br><span class="line">    buffer2.mDataByteSize = <span class="number">0</span>;</span><br><span class="line">    buffer2.mNumberChannels = <span class="number">2</span>;</span><br><span class="line">            </span><br><span class="line">    AudioBufferList bufferList;</span><br><span class="line">    bufferList.mNumberBuffers = <span class="number">2</span>;</span><br><span class="line">    bufferList.mBuffers[<span class="number">0</span>] = buffer;</span><br><span class="line">    bufferList.mBuffers[<span class="number">1</span>] = buffer2;</span><br><span class="line">    </span><br><span class="line">    AudioUnitRender(recorder-&gt;audioUnit,</span><br><span class="line">                    ioActionFlags,</span><br><span class="line">                    inTimeStamp,</span><br><span class="line">                    inBusNumber,</span><br><span class="line">                    inNumberFrames,</span><br><span class="line">                    &amp;bufferList);</span><br><span class="line">    <span class="keyword">if</span> (recorder.bufferListBlock) &#123;</span><br><span class="line">        recorder.bufferListBlock(&amp;bufferList);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> noErr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¦‚ä½•ä½¿ç”¨ï¼Ÿ</p><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&quot;ViewController.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) ZDUnitRecorder *recorder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.recorder.isRecording) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.recorder stop];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        [<span class="keyword">self</span>.recorder start];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#prama mark - Lazy Load</span></span><br><span class="line">- (ZDUnitRecorder *)recorder &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!_recorder) &#123;</span><br><span class="line">        _recorder = [[ZDUnitRecorder alloc] init];</span><br><span class="line">        _recorder.bufferListBlock = ^(AudioBufferList * _Nonnull bufferList) &#123;</span><br><span class="line">            AudioBuffer left = bufferList-&gt;mBuffers[<span class="number">0</span>];<span class="comment">// å·¦è€³æœºbuffer</span></span><br><span class="line">            AudioBuffer right = bufferList-&gt;mBuffers[<span class="number">1</span>];<span class="comment">// å³è€³æœºbuffer</span></span><br><span class="line">            <span class="built_in">NSData</span> *leftData = [<span class="built_in">NSData</span> dataWithBytes:left.mData length:left.mDataByteSize];</span><br><span class="line">            <span class="built_in">NSData</span> *rightData = [<span class="built_in">NSData</span> dataWithBytes:right.mData length:right.mDataByteSize];</span><br><span class="line">            <span class="comment">// ä¿å­˜åˆ°æ²™ç›’/ç›´æ¥æ’­æŠ¥çœ‹ä¸šåŠ¡éœ€æ±‚å†³å®š</span></span><br><span class="line">            <span class="comment">// éŸ³é¢‘æ–‡ä»¶è½¬MP3/AACæ ¼å¼ï¼Œç½‘ä¸Šå¾ˆå¤šèµ„æ–™ä¸å†ç»§ç»­å™è¿°äº†ã€‚</span></span><br><span class="line">            [<span class="keyword">self</span> handleAudioData:leftData rightData:rightData];</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _recorder;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>//<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>****</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>//<br><strong>Best Regard!</strong><br><strong>ç”Ÿå‘½ä¸æ­¢ï¼Œå¥‹æ–—ä¸æ¯</strong></p><p>//<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>****</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>//</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;1-å•å£°é“å½•éŸ³&quot;&gt;&lt;a href=&quot;#1-å•å£°é“å½•éŸ³&quot; class=&quot;headerlink&quot; title=&quot;1.å•å£°é“å½•éŸ³&quot;&gt;&lt;/a&gt;1.å•å£°é“å½•éŸ³&lt;/h1&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//  FSUnitRecorder.h&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#import &lt;span class=&quot;meta-string&quot;&gt;&amp;lt;Foundation/Foundation.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#import &lt;span class=&quot;meta-string&quot;&gt;&amp;lt;AVFoundation/AVFoundation.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NS_ASSUME_NONNULL_BEGIN&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; (^kAudioUnitRecorderOnputBlock)(AudioBufferList *bufferList);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;FSUnitRecorder&lt;/span&gt; : &lt;span class=&quot;title&quot;&gt;NSObject&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;assign&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;double&lt;/span&gt; sampleRate;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;assign&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;readonly&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; isRecording;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;copy&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;) kAudioUnitRecorderOnputBlock bufferListBlock;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)start;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)stop;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NS_ASSUME_NONNULL_END&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//  FSUnitRecorder.m&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#import &lt;span class=&quot;meta-string&quot;&gt;&amp;quot;FSUnitRecorder.h&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;FSUnitRecorder&lt;/span&gt; ()&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    AudioUnit audioUnit;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; audioComponentInitialized;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;assign&lt;/span&gt;) AudioStreamBasicDescription inputStreamDesc;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;FSUnitRecorder&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;instancetype&lt;/span&gt;)init &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; = [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; = [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; defaultSetting];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)defaultSetting &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// ä¼˜å…ˆ16000ï¼Œå¦‚æœè®¾å¤‡ä¸æ”¯æŒä½¿ç”¨å…¶å®ƒé‡‡æ ·ç‡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *sampleRates = @[@&lt;span class=&quot;number&quot;&gt;16000&lt;/span&gt;, @&lt;span class=&quot;number&quot;&gt;11025&lt;/span&gt;, @&lt;span class=&quot;number&quot;&gt;22050&lt;/span&gt;, @&lt;span class=&quot;number&quot;&gt;44100&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;NSNumber&lt;/span&gt; *sampleRate &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; sampleRates) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        OSStatus status = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; prepareRecord:sampleRate.doubleValue];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (status == noErr) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.sampleRate = [sampleRate doubleValue];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (OSStatus)prepareRecord:(&lt;span class=&quot;keyword&quot;&gt;double&lt;/span&gt;)sampleRate &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    OSStatus status = noErr;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt; *error;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [[&lt;span class=&quot;built_in&quot;&gt;AVAudioSession&lt;/span&gt; sharedInstance] setCategory:&lt;span class=&quot;built_in&quot;&gt;AVAudioSessionCategoryPlayAndRecord&lt;/span&gt; withOptions:&lt;span class=&quot;built_in&quot;&gt;AVAudioSessionCategoryOptionMixWithOthers&lt;/span&gt; | &lt;span class=&quot;built_in&quot;&gt;AVAudioSessionCategoryOptionAllowBluetooth&lt;/span&gt;  error:&amp;amp;error];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [[&lt;span class=&quot;built_in&quot;&gt;AVAudioSession&lt;/span&gt; sharedInstance] setActive:&lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt; error:&amp;amp;error];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// This doesn&amp;#x27;t seem to really indicate a problem (iPhone 6s Plus)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;ifdef&lt;/span&gt; IGNORE&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt; inputChannels = session.inputNumberOfChannels;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!inputChannels) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&amp;quot;ERROR: NO AUDIO INPUT DEVICE&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!audioComponentInitialized) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        audioComponentInitialized = &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// Describe the RemoteIO unit&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        AudioComponentDescription audioComponentDescription;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        audioComponentDescription.componentType = kAudioUnitType_Output;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        audioComponentDescription.componentSubType = kAudioUnitSubType_RemoteIO;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        audioComponentDescription.componentManufacturer = kAudioUnitManufacturer_Apple;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        audioComponentDescription.componentFlags = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        audioComponentDescription.componentFlagsMask = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// Get the RemoteIO unit&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        AudioComponent remoteIOComponent = AudioComponentFindNext(&lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;,&amp;amp;audioComponentDescription);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        status = AudioComponentInstanceNew(remoteIOComponent,&amp;amp;(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;-&amp;gt;audioUnit));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (CheckError(status, &lt;span class=&quot;string&quot;&gt;&amp;quot;Couldn&amp;#x27;t get RemoteIO unit instance&amp;quot;&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; status;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;built_in&quot;&gt;UInt32&lt;/span&gt; oneFlag = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      AudioUnitElement bus0 = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      AudioUnitElement bus1 = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ((&lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// Configure the RemoteIO unit for playback&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        status = AudioUnitSetProperty (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;-&amp;gt;audioUnit,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                       kAudioOutputUnitProperty_EnableIO,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                       kAudioUnitScope_Output,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                       bus0,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                       &amp;amp;oneFlag,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                       &lt;span class=&quot;keyword&quot;&gt;sizeof&lt;/span&gt;(oneFlag));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (CheckError(status, &lt;span class=&quot;string&quot;&gt;&amp;quot;Couldn&amp;#x27;t enable RemoteIO output&amp;quot;&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; status;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// Configure the RemoteIO unit for input&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      status = AudioUnitSetProperty(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;-&amp;gt;audioUnit,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    kAudioOutputUnitProperty_EnableIO,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    kAudioUnitScope_Input,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    bus1,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    &amp;amp;oneFlag,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    &lt;span class=&quot;keyword&quot;&gt;sizeof&lt;/span&gt;(oneFlag));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (CheckError(status, &lt;span class=&quot;string&quot;&gt;&amp;quot;Couldn&amp;#x27;t enable RemoteIO input&amp;quot;&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; status;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      AudioStreamBasicDescription asbd;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      memset(&amp;amp;asbd, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;sizeof&lt;/span&gt;(asbd));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      asbd.mSampleRate = sampleRate; &lt;span class=&quot;comment&quot;&gt;// é‡‡æ ·ç‡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      asbd.mFormatID = kAudioFormatLinearPCM;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      asbd.mFormatFlags = kAudioFormatFlagIsSignedInteger | kAudioFormatFlagIsPacked;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      asbd.mBytesPerPacket = &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      asbd.mFramesPerPacket = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      asbd.mBytesPerFrame = &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      asbd.mChannelsPerFrame = &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      asbd.mBitsPerChannel = &lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// Set format for output (bus 0) on the RemoteIO&amp;#x27;s input scope&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      status = AudioUnitSetProperty(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;-&amp;gt;audioUnit,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    kAudioUnitProperty_StreamFormat,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    kAudioUnitScope_Input,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    bus0,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    &amp;amp;asbd,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    &lt;span class=&quot;keyword&quot;&gt;sizeof&lt;/span&gt;(asbd));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (CheckError(status, &lt;span class=&quot;string&quot;&gt;&amp;quot;Couldn&amp;#x27;t set the ASBD for RemoteIO on input scope/bus 0&amp;quot;&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; status;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// Set format for mic input (bus 1) on RemoteIO&amp;#x27;s output scope&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      status = AudioUnitSetProperty(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;-&amp;gt;audioUnit,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    kAudioUnitProperty_StreamFormat,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    kAudioUnitScope_Output,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    bus1,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    &amp;amp;asbd,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    &lt;span class=&quot;keyword&quot;&gt;sizeof&lt;/span&gt;(asbd));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (CheckError(status, &lt;span class=&quot;string&quot;&gt;&amp;quot;Couldn&amp;#x27;t set the ASBD for RemoteIO on output scope/bus 1&amp;quot;&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; status;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// Set the recording callback&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      AURenderCallbackStruct callbackStruct;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      callbackStruct.inputProc = inputCallBackFun;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      callbackStruct.inputProcRefCon = (__bridge &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; *) &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      status = AudioUnitSetProperty(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;-&amp;gt;audioUnit,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    kAudioOutputUnitProperty_SetInputCallback,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    kAudioUnitScope_Global,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    bus1,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    &amp;amp;callbackStruct,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    &lt;span class=&quot;keyword&quot;&gt;sizeof&lt;/span&gt; (callbackStruct));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (CheckError(status, &lt;span class=&quot;string&quot;&gt;&amp;quot;Couldn&amp;#x27;t set RemoteIO&amp;#x27;s render callback on bus 0&amp;quot;&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; status;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ((&lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// Set the playback callback&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        AURenderCallbackStruct callbackStruct;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        callbackStruct.inputProc = playbackCallback;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        callbackStruct.inputProcRefCon = (__bridge &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; *) &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        status = AudioUnitSetProperty(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;-&amp;gt;audioUnit,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                      kAudioUnitProperty_SetRenderCallback,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                      kAudioUnitScope_Global,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                      bus0,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                      &amp;amp;callbackStruct,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                      &lt;span class=&quot;keyword&quot;&gt;sizeof&lt;/span&gt; (callbackStruct));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (CheckError(status, &lt;span class=&quot;string&quot;&gt;&amp;quot;Couldn&amp;#x27;t set RemoteIO&amp;#x27;s render callback on bus 0&amp;quot;&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; status;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// Initialize the RemoteIO unit&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      status = AudioUnitInitialize(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;-&amp;gt;audioUnit);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (CheckError(status, &lt;span class=&quot;string&quot;&gt;&amp;quot;Couldn&amp;#x27;t initialize the RemoteIO unit&amp;quot;&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; status;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; status;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)start &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; deleteAudioFile];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    CheckError(AudioOutputUnitStart(audioUnit), &lt;span class=&quot;string&quot;&gt;&amp;quot;AudioOutputUnitStop failed&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    _isRecording = &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)stop &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    CheckError(AudioOutputUnitStop(audioUnit),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&amp;quot;AudioOutputUnitStop failed&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    _isRecording = &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)deleteAudioFile &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *pcmPath = [&lt;span class=&quot;built_in&quot;&gt;NSSearchPathForDirectoriesInDomains&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;NSDocumentDirectory&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;NSUserDomainMask&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;).firstObject stringByAppendingPathComponent:&lt;span class=&quot;string&quot;&gt;@&amp;quot;record.mp3&amp;quot;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([[&lt;span class=&quot;built_in&quot;&gt;NSFileManager&lt;/span&gt; defaultManager] fileExistsAtPath:pcmPath]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [[&lt;span class=&quot;built_in&quot;&gt;NSFileManager&lt;/span&gt; defaultManager] removeItemAtPath:pcmPath error:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)dealloc &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    CheckError(AudioComponentInstanceDispose(audioUnit),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               &lt;span class=&quot;string&quot;&gt;&amp;quot;AudioComponentInstanceDispose failed&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&amp;quot;UnitRecorderé”€æ¯&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; OSStatus CheckError(OSStatus error, &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; *operation) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (error == noErr) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; error;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; errorString[&lt;span class=&quot;number&quot;&gt;20&lt;/span&gt;] = &lt;span class=&quot;string&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// See if it appears to be a 4-char-code&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  *(&lt;span class=&quot;built_in&quot;&gt;UInt32&lt;/span&gt; *)(errorString + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) = &lt;span class=&quot;built_in&quot;&gt;CFSwapInt32HostToBig&lt;/span&gt;(error);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (isprint(errorString[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]) &amp;amp;&amp;amp; isprint(errorString[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;]) &amp;amp;&amp;amp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      isprint(errorString[&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;]) &amp;amp;&amp;amp; isprint(errorString[&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;])) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    errorString[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;] = errorString[&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;] = &lt;span class=&quot;string&quot;&gt;&amp;#x27;\&amp;#x27;&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    errorString[&lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;] = &lt;span class=&quot;string&quot;&gt;&amp;#x27;\0&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// No, format it as an integer&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sprintf(errorString, &lt;span class=&quot;string&quot;&gt;&amp;quot;%d&amp;quot;&lt;/span&gt;, (&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;)error);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  fprintf(stderr, &lt;span class=&quot;string&quot;&gt;&amp;quot;Error: %s (%s)\n&amp;quot;&lt;/span&gt;, operation, errorString);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; error;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; OSStatus playbackCallback(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; *inRefCon,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                 AudioUnitRenderActionFlags *ioActionFlags,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                 &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; AudioTimeStamp *inTimeStamp,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                 &lt;span class=&quot;built_in&quot;&gt;UInt32&lt;/span&gt; inBusNumber,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                 &lt;span class=&quot;built_in&quot;&gt;UInt32&lt;/span&gt; inNumberFrames,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                 AudioBufferList *ioData) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  OSStatus status = noErr;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// Notes: ioData contains buffers (may be more than one!)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// Fill them up as much as you can. Remember to set the size value in each buffer to match how&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// much data is in the buffer.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  FSUnitRecorder *recorder = (__bridge FSUnitRecorder *) inRefCon;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;UInt32&lt;/span&gt; bus1 = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  status = AudioUnitRender(recorder-&amp;gt;audioUnit,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                           ioActionFlags,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                           inTimeStamp,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                           bus1,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                           inNumberFrames,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                           ioData);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  CheckError(status, &lt;span class=&quot;string&quot;&gt;&amp;quot;Couldn&amp;#x27;t render from RemoteIO unit&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; status;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; OSStatus inputCallBackFun(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; *inRefCon,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    AudioUnitRenderActionFlags *ioActionFlags,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; AudioTimeStamp *inTimeStamp,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;built_in&quot;&gt;UInt32&lt;/span&gt; inBusNumber,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;built_in&quot;&gt;UInt32&lt;/span&gt; inNumberFrames,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    AudioBufferList * __&lt;span class=&quot;keyword&quot;&gt;nullable&lt;/span&gt; ioData)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    FSUnitRecorder *recorder = (__bridge FSUnitRecorder *)(inRefCon);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    AudioBufferList bufferList;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    bufferList.mNumberBuffers = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    bufferList.mBuffers[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;].mData = &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    bufferList.mBuffers[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;].mDataByteSize = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    AudioUnitRender(recorder-&amp;gt;audioUnit,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    ioActionFlags,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    inTimeStamp,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    inNumberFrames,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;amp;bufferList);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (recorder.bufferListBlock) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        recorder.bufferListBlock(&amp;amp;bufferList);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; noErr;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;ä½¿ç”¨&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (FSUnitRecorder *)recorder &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!_recorder) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _recorder = [[FSUnitRecorder alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; _recorder;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@weakify(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.recorder.bufferListBlock = ^(AudioBufferList * _Nonnull bufferList) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @strongify(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    AudioBuffer buffer = bufferList-&amp;gt;mBuffers[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; *data = [&lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; dataWithBytes:buffer.mData length:buffer.mDataByteSize];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// å¤„ç†æ•°æ®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; processSampleData:data];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h1 id=&quot;2-åŒå£°é“å½•éŸ³&quot;&gt;&lt;a href=&quot;#2-åŒå£°é“å½•éŸ³&quot; class=&quot;headerlink&quot; title=&quot;2.åŒå£°é“å½•éŸ³&quot;&gt;&lt;/a&gt;2.åŒå£°é“å½•éŸ³&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;è¯´æ˜ï¼š&lt;/strong&gt;&lt;br&gt;å…¬å¸æ–°ä¸šåŠ¡è¦æ¥å…¥è“ç‰™è€³æœºï¼Œæ”¯æŒè“ç‰™è€³æœºï¼Œå·¦å³è€³æœºåˆ†åˆ«è¿›è¡Œè¯­éŸ³è¯†åˆ«ç­‰åŠŸèƒ½ã€‚è¯¥ä¸šåŠ¡ç‰µæ‰¯åˆ°å®æ—¶åŒé€šé“å½•éŸ³ï¼Œåˆ†åˆ«æå–å·¦å³bufferï¼Œç±»ä¼¼çš„ä¸šåŠ¡éœ€æ±‚å¸‚åœºä¸Šä¹Ÿæ˜¯æœ‰çš„ï¼Œæ¯”å¦‚AirPodsï¼Œç™¾åº¦çš„ä¸€æ¬¾è“ç‰™è€³æœºï¼ˆå°åº¦APPâ€œæµæµªåœ°çƒæ¨¡å¼â€ï¼Œå…·ä½“å¯ä»¥ä¹°ä¸€ä¸ªä¸ªè¯•ç”¨ä¸‹ï¼‰ã€‚&lt;br&gt;åºŸè¯ä¸å¤šè¯´äº†ï¼Œç›´æ¥çœ‹ä»£ç å°±è¡Œã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ZDUnitRecorder.h&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#import &lt;span class=&quot;meta-string&quot;&gt;&amp;lt;Foundation/Foundation.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#import &lt;span class=&quot;meta-string&quot;&gt;&amp;lt;AVFoundation/AVFoundation.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NS_ASSUME_NONNULL_BEGIN&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; (^kAudioUnitRecorderOnputBlock)(AudioBufferList *bufferList);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ZDUnitRecorder&lt;/span&gt; : &lt;span class=&quot;title&quot;&gt;NSObject&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;assign&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;double&lt;/span&gt; sampleRate;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;assign&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;readonly&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; isRecording;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;copy&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;) kAudioUnitRecorderOnputBlock bufferListBlock;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)start;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)stop;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NS_ASSUME_NONNULL_END&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;ZDUnitRecorder.m&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="OC" scheme="https://forgetsou.github.io/categories/OC/"/>
    
    
    <category term="OC" scheme="https://forgetsou.github.io/tags/OC/"/>
    
    <category term="iOS" scheme="https://forgetsou.github.io/tags/iOS/"/>
    
    <category term="AudioUnit" scheme="https://forgetsou.github.io/tags/AudioUnit/"/>
    
  </entry>
  
  <entry>
    <title>macoså¼€å‘-NSCollectionView</title>
    <link href="https://forgetsou.github.io/2020/11/09/macos%E5%BC%80%E5%8F%91-NSCollectionView/"/>
    <id>https://forgetsou.github.io/2020/11/09/macos%E5%BC%80%E5%8F%91-NSCollectionView/</id>
    <published>2020-11-09T08:37:21.000Z</published>
    <updated>2020-11-09T08:37:21.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸€-ç®€è¿°"><a href="#ä¸€-ç®€è¿°" class="headerlink" title="ä¸€. ç®€è¿°"></a>ä¸€. ç®€è¿°</h1><p>ä»¥å¯è‡ªå®šä¹‰çš„å¸ƒå±€æ˜¾ç¤ºçš„æ•°æ®é¡¹çš„æœ‰åºé›†åˆã€‚</p><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSCollectionView</span> : <span class="title">NSView</span></span></span><br></pre></td></tr></table></figure><p><img src="https://docs-assets.developer.apple.com/published/cce637a738/cv_objects_2x_37439bb5-da91-4db6-a7f0-03c4046877f4.png" alt="Merging content and layout to create the final appearance"></p><h1 id="äºŒ-å®˜æ–¹å±æ€§æ–¹æ³•"><a href="#äºŒ-å®˜æ–¹å±æ€§æ–¹æ³•" class="headerlink" title="äºŒ. å®˜æ–¹å±æ€§æ–¹æ³•"></a>äºŒ. å®˜æ–¹å±æ€§æ–¹æ³•</h1><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸ºæ”¶é›†è§†å›¾æä¾›æ•°æ®çš„å¯¹è±¡</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">weak</span>) <span class="keyword">id</span>&lt;<span class="built_in">NSCollectionViewDataSource</span>&gt; dataSource API_AVAILABLE(macos(<span class="number">10.11</span>)); </span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">weak</span>) <span class="keyword">id</span>&lt;<span class="built_in">NSCollectionViewPrefetching</span>&gt; prefetchDataSource API_AVAILABLE(macos(<span class="number">10.13</span>));</span><br><span class="line"><span class="comment">// å§”æ‰˜å¯¹è±¡</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">weak</span>) <span class="keyword">id</span>&lt;<span class="built_in">NSCollectionViewDelegate</span>&gt; delegate;</span><br><span class="line"><span class="comment">// ä¸ºæ”¶é›†è§†å›¾æä¾›æ•°æ®çš„æ•°ç»„</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>) <span class="built_in">NSArray</span>&lt;<span class="keyword">id</span>&gt; *content;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">strong</span>) <span class="built_in">NSView</span> *backgroundView API_AVAILABLE(macos(<span class="number">10.11</span>));</span><br><span class="line"><span class="comment">// èƒŒæ™¯è‰²æ•°ç»„</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">null_resettable</span>, <span class="keyword">copy</span>) <span class="built_in">NSArray</span>&lt;<span class="built_in">NSColor</span> *&gt; *backgroundColors;</span><br><span class="line"><span class="comment">// èƒŒæ™¯è§†å›¾æ˜¯å¦éšé¡¹ç›®åŠå…¶ä»–å†…å®¹æ»šåŠ¨</span></span><br><span class="line"><span class="keyword">@property</span> <span class="built_in">BOOL</span> backgroundViewScrollsWithContent API_AVAILABLE(macos(<span class="number">10.12</span>));</span><br><span class="line"><span class="comment">// æ„å»ºé›†åˆè§†å›¾å†…å®¹çš„å¸ƒå±€å¯¹è±¡</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">strong</span>) __kindof <span class="built_in">NSCollectionViewLayout</span> *collectionViewLayout API_AVAILABLE(macos(<span class="number">10.11</span>));</span><br></pre></td></tr></table></figure><p><strong>!!! ä¹‹åå†è¡¥å…… !!!</strong></p><h1 id="ä¸‰-ç¤ºä¾‹"><a href="#ä¸‰-ç¤ºä¾‹" class="headerlink" title="ä¸‰. ç¤ºä¾‹"></a>ä¸‰. ç¤ºä¾‹</h1><h2 id="1-æ•ˆæœå›¾"><a href="#1-æ•ˆæœå›¾" class="headerlink" title="1. æ•ˆæœå›¾"></a>1. æ•ˆæœå›¾</h2><p>è¦è¾¾åˆ°çš„æ•ˆæœ:</p><ul><li>æ˜¾ç¤ºå·¦ä¾§èŠå¤©åˆ—è¡¨</li><li>Splitæ»‘åŠ¨itemå†…æ§ä»¶ä½ç½®ä¸å˜åŠ¨</li><li>å…¨å±ä¸‹çš„æ˜¾ç¤º</li><li>ç‚¹å‡»itemè°ƒæ•´é€‰ä¸­è‰²</li></ul><p>å¦‚ä¸‹å›¾</p><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gkj0kyt20vj31e00u00um.jpg" alt="æ•ˆæœå›¾"></p><h2 id="2-å…·ä½“ä»£ç "><a href="#2-å…·ä½“ä»£ç " class="headerlink" title="2. å…·ä½“ä»£ç "></a>2. å…·ä½“ä»£ç </h2><h3 id="2-1-åˆ›å»ºNSCollectionView"><a href="#2-1-åˆ›å»ºNSCollectionView" class="headerlink" title="2.1 åˆ›å»ºNSCollectionView"></a>2.1 åˆ›å»º<code>NSCollectionView</code></h3><p>æ­¤å¤„ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨<code>Storyboard</code>åˆ›å»º</p><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gkj0ricw9hj30oo0lmgmi.jpg" alt="åˆ›å»ºCollectionView"></p><h3 id="2-2-é…ç½®flowLayout-å¯ä»¥åˆ›å»ºæˆ–è€…ä»£ç†è®¾ç½®"><a href="#2-2-é…ç½®flowLayout-å¯ä»¥åˆ›å»ºæˆ–è€…ä»£ç†è®¾ç½®" class="headerlink" title="2.2 é…ç½®flowLayout(å¯ä»¥åˆ›å»ºæˆ–è€…ä»£ç†è®¾ç½®)"></a>2.2 é…ç½®flowLayout(å¯ä»¥åˆ›å»ºæˆ–è€…ä»£ç†è®¾ç½®)</h3><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="keyword">self</span>.flowLayout = [[<span class="built_in">NSCollectionViewFlowLayout</span> alloc] init];</span><br><span class="line"><span class="keyword">self</span>.flowLayout.itemSize = <span class="built_in">NSMakeSize</span>(<span class="keyword">self</span>.collectionView.frame.size.width, <span class="number">60</span>); <span class="comment">// itemå¤§å°</span></span><br><span class="line"><span class="keyword">self</span>.flowLayout.minimumLineSpacing = <span class="number">0</span>; <span class="comment">// æœ€å°æ¨ªå‘é—´è·</span></span><br><span class="line"><span class="keyword">self</span>.flowLayout.minimumInteritemSpacing = <span class="number">0</span>; <span class="comment">// æœ€å°ç«–å‘é—´è·</span></span><br><span class="line"><span class="keyword">self</span>.collectionView.collectionViewLayout = <span class="keyword">self</span>.flowLayout;</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜</strong>: è¿™é‡Œä¸ä½¿ç”¨<code>Storyboard</code>æˆ–è€…ä»£ç†é…ç½®flowLayoutçš„åŸå› æ˜¯åœ¨æ»‘åŠ¨SplitViewçš„æ—¶å€™è¦è°ƒæ•´<code>itemSize</code>ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼æ›´æ–¹ä¾¿è®¾ç½®<code>itemSize</code>ã€‚</p><h3 id="2-3-è®¾ç½®ä»£ç†"><a href="#2-3-è®¾ç½®ä»£ç†" class="headerlink" title="2.3 è®¾ç½®ä»£ç†"></a>2.3 è®¾ç½®ä»£ç†</h3><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">FSMessageVC</span> ()</span></span><br><span class="line">&lt;</span><br><span class="line"><span class="built_in">NSSplitViewDelegate</span>,</span><br><span class="line"><span class="built_in">NSCollectionViewDelegate</span>,</span><br><span class="line"><span class="built_in">NSCollectionViewDataSource</span>,</span><br><span class="line"><span class="built_in">NSCollectionViewDelegateFlowLayout</span></span><br><span class="line">&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">self</span>.collectionView.delegate = <span class="keyword">self</span>;</span><br><span class="line"><span class="keyword">self</span>.collectionView.dataSource = <span class="keyword">self</span>;</span><br></pre></td></tr></table></figure><h3 id="2-4-è®¾ç½®CollectionViewå±æ€§"><a href="#2-4-è®¾ç½®CollectionViewå±æ€§" class="headerlink" title="2.4 è®¾ç½®CollectionViewå±æ€§"></a>2.4 è®¾ç½®CollectionViewå±æ€§</h3><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®CollectionViewçš„èƒŒæ™¯è‰²</span></span><br><span class="line"><span class="keyword">self</span>.collectionView.layer.backgroundColor = <span class="built_in">NSColor</span>.whiteColor.CGColor;</span><br><span class="line"><span class="keyword">self</span>.collectionView.wantsLayer = <span class="literal">YES</span>;</span><br><span class="line"><span class="comment">// è®¾ç½®å¯é€‰æ‹© ï¼ï¼ï¼æ³¨æ„ï¼ï¼ï¼ä¸è®¾ç½®ä¸ºYESä¼šå¯¼è‡´ç‚¹å‡»itemæ— æ•ˆæœ</span></span><br><span class="line"><span class="keyword">self</span>.collectionView.selectable = <span class="literal">YES</span>;</span><br></pre></td></tr></table></figure><h3 id="2-5-æ³¨å†Œè‡ªå®šä¹‰çš„Item"><a href="#2-5-æ³¨å†Œè‡ªå®šä¹‰çš„Item" class="headerlink" title="2.5 æ³¨å†Œè‡ªå®šä¹‰çš„Item"></a>2.5 æ³¨å†Œè‡ªå®šä¹‰çš„Item</h3><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">[<span class="keyword">self</span>.collectionView registerNib:[[<span class="built_in">NSNib</span> alloc] initWithNibNamed:<span class="string">@&quot;FSChatCell&quot;</span> bundle:<span class="literal">nil</span>]</span><br><span class="line">               forItemWithIdentifier:<span class="string">@&quot;kChatItem&quot;</span>];</span><br></pre></td></tr></table></figure><h3 id="2-6-å®ç°ä»£ç†æ–¹æ³•"><a href="#2-6-å®ç°ä»£ç†æ–¹æ³•" class="headerlink" title="2.6 å®ç°ä»£ç†æ–¹æ³•"></a>2.6 å®ç°ä»£ç†æ–¹æ³•</h3><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŒºæ•°</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfSectionsInCollectionView:(<span class="built_in">NSCollectionView</span> *)collectionView &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// itemæ•°é‡</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)collectionView:(<span class="built_in">NSCollectionView</span> *)collectionView numberOfItemsInSection:(<span class="built_in">NSInteger</span>)section &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.dataSource.count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// FSChatCellç»§æ‰¿è‡ªNSCollectionViewItem</span></span><br><span class="line">- (<span class="keyword">nonnull</span> <span class="built_in">NSCollectionViewItem</span> *)collectionView:(<span class="keyword">nonnull</span> <span class="built_in">NSCollectionView</span> *)collectionView itemForRepresentedObjectAtIndexPath:(<span class="keyword">nonnull</span> <span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    FSChatCell *cell = (FSChatCell *)[collectionView makeItemWithIdentifier:<span class="string">@&quot;kChatItem&quot;</span> forIndexPath:indexPath];</span><br><span class="line">    cell.name = <span class="keyword">self</span>.dataSource[indexPath.item];</span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)commitEditingAndReturnError:(<span class="built_in">NSError</span> *__autoreleasing  _Nullable * _Nullable)error &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)encodeWithCoder:(<span class="keyword">nonnull</span> <span class="built_in">NSCoder</span> *)coder &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-7-Splitæ»‘åŠ¨itemå†…æ§ä»¶ä½ç½®ä¸å˜åŠ¨"><a href="#2-7-Splitæ»‘åŠ¨itemå†…æ§ä»¶ä½ç½®ä¸å˜åŠ¨" class="headerlink" title="2.7 Splitæ»‘åŠ¨itemå†…æ§ä»¶ä½ç½®ä¸å˜åŠ¨"></a>2.7 Splitæ»‘åŠ¨itemå†…æ§ä»¶ä½ç½®ä¸å˜åŠ¨</h3><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. æ·»åŠ NSSplitViewDelegate</span></span><br><span class="line"><span class="keyword">self</span>.splitView.delegate = <span class="keyword">self</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ€å°å¯æ»‘åŠ¨çš„ç‚¹</span></span><br><span class="line">- (<span class="built_in">CGFloat</span>)splitView:(<span class="built_in">NSSplitView</span> *)splitView constrainMinCoordinate:(<span class="built_in">CGFloat</span>)proposedMinimumPosition ofSubviewAt:(<span class="built_in">NSInteger</span>)dividerIndex &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">200</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æœ€å¤§å¯æ»‘åŠ¨çš„ç‚¹</span></span><br><span class="line">- (<span class="built_in">CGFloat</span>)splitView:(<span class="built_in">NSSplitView</span> *)splitView constrainMaxCoordinate:(<span class="built_in">CGFloat</span>)proposedMaximumPosition ofSubviewAt:(<span class="built_in">NSInteger</span>)dividerIndex &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">300</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ»‘åŠ¨æ—¶çš„é€šçŸ¥ä»£ç†, è®¾ç½®itemSize</span></span><br><span class="line">- (<span class="keyword">void</span>)splitViewDidResizeSubviews:(<span class="built_in">NSNotification</span> *)notification &#123;</span><br><span class="line">    <span class="keyword">self</span>.flowLayout.itemSize = <span class="built_in">NSMakeSize</span>(<span class="keyword">self</span>.collectionView.frame.size.width, <span class="number">60</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-8-å…¨å±ä¸‹çš„æ˜¾ç¤º"><a href="#2-8-å…¨å±ä¸‹çš„æ˜¾ç¤º" class="headerlink" title="2.8 å…¨å±ä¸‹çš„æ˜¾ç¤º"></a>2.8 å…¨å±ä¸‹çš„æ˜¾ç¤º</h3><p>æ·»åŠ å…¨å±é€šçŸ¥åœ¨é€šçŸ¥çš„å›è°ƒæ–¹æ³•é‡Œè°ƒç”¨ <code>self.flowLayout.itemSize = NSMakeSize(self.collectionView.frame.size.width, 60);</code> ï¼Œæ¯”è¾ƒç®€å•ä¸å†ç´¯è¿°ã€‚</p><h3 id="2-9-ç‚¹å‡»itemè°ƒæ•´é€‰ä¸­èƒŒæ™¯è‰²"><a href="#2-9-ç‚¹å‡»itemè°ƒæ•´é€‰ä¸­èƒŒæ™¯è‰²" class="headerlink" title="2.9 ç‚¹å‡»itemè°ƒæ•´é€‰ä¸­èƒŒæ™¯è‰²"></a>2.9 ç‚¹å‡»itemè°ƒæ•´é€‰ä¸­èƒŒæ™¯è‰²</h3><p>æœ‰ä¸¤ç§æ–¹å¼å®ç°ï¼š</p><ul><li><code>didSelectItemsAtIndexPaths</code>å’Œ<code>didDeselectItemsAtIndexPaths</code>ä¿®æ”¹itemèƒŒæ™¯è‰²</li><li>åœ¨è‡ªå®šä¹‰itemä¸­é‡å†™<code>selected</code>æ–¹æ³•</li></ul><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ–¹å¼ 1</span></span><br><span class="line">- (<span class="keyword">void</span>)collectionView:(<span class="built_in">NSCollectionView</span> *)collectionView didSelectItemsAtIndexPaths:(<span class="built_in">NSSet</span>&lt;<span class="built_in">NSIndexPath</span> *&gt; *)indexPaths &#123;</span><br><span class="line">    <span class="built_in">NSIndexPath</span> *indexPath = indexPaths.allObjects.firstObject;</span><br><span class="line">    FSChatCell *cell = (FSChatCell *)[collectionView itemAtIndexPath:indexPath];</span><br><span class="line">    cell.view.wantsLayer = <span class="literal">YES</span>;</span><br><span class="line">    cell.view.layer.backgroundColor = <span class="built_in">NSColor</span>.lightGrayColor.CGColor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)collectionView:(<span class="built_in">NSCollectionView</span> *)collectionView didDeselectItemsAtIndexPaths:(<span class="built_in">NSSet</span>&lt;<span class="built_in">NSIndexPath</span> *&gt; *)indexPaths &#123;</span><br><span class="line">    <span class="built_in">NSIndexPath</span> *indexPath = indexPaths.allObjects.firstObject;</span><br><span class="line">    FSChatCell *cell = (FSChatCell *)[collectionView itemAtIndexPath:indexPath];</span><br><span class="line">    cell.view.wantsLayer = <span class="literal">YES</span>;</span><br><span class="line">    cell.view.layer.backgroundColor = <span class="built_in">NSColor</span>.whiteColor.CGColor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼ 2 </span></span><br><span class="line"><span class="comment">//  FSChatCell.m</span></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="keyword">self</span>.view.wantsLayer = <span class="literal">YES</span>;</span><br><span class="line">  <span class="keyword">self</span>.view.layer.backgroundColor = <span class="built_in">NSColor</span>.whiteColor.CGColor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setSelected:(<span class="built_in">BOOL</span>)selected &#123;</span><br><span class="line">    <span class="keyword">super</span>.selected = selected;</span><br><span class="line">    [<span class="keyword">self</span> changeBgViewColor];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)changeBgViewColor &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.selected) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.highlightState == <span class="built_in">NSCollectionViewItemHighlightForSelection</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.view.layer.backgroundColor = <span class="built_in">NSColor</span>.lightGrayColor.CGColor;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">self</span>.highlightState == <span class="built_in">NSCollectionViewItemHighlightNone</span> ||</span><br><span class="line">                   <span class="keyword">self</span>.highlightState == <span class="built_in">NSCollectionViewItemHighlightForDeselection</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.view.layer.backgroundColor = <span class="built_in">NSColor</span>.whiteColor.CGColor;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.view.layer.backgroundColor = <span class="built_in">NSColor</span>.whiteColor.CGColor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-10-FSChatCell-xib"><a href="#2-10-FSChatCell-xib" class="headerlink" title="2.10 FSChatCell.xib"></a>2.10 FSChatCell.xib</h3><p><strong>è¯´æ˜ï¼š</strong></p><ul><li>åˆ›å»º<code>Object</code>å¯¹è±¡å¹¶ç»‘å®š<code>FSChatCell</code></li></ul><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gkj37m11xlj307a0c3wf5.jpg" alt="image-20201109174544750"></p><ul><li>è¿çº¿æ—¶æœ€å¥½å°†æ§ä»¶è¿åœ¨åˆ›å»ºçš„Objects-ChatCellä¸Š</li></ul><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gkj2dzvgayj30s30gjtax.jpg" alt="image-20201109174737345"></p><h3 id="2-11-æ·»åŠ å¤´-å°¾"><a href="#2-11-æ·»åŠ å¤´-å°¾" class="headerlink" title="2.11 æ·»åŠ å¤´/å°¾"></a>2.11 æ·»åŠ å¤´/å°¾</h3><ul><li><p>åˆ›å»º<code>FSChatHeaderView</code></p><p><code>FSChatHeaderView</code>ç»§æ‰¿è‡ª<code>NSView</code></p></li><li><p>æ³¨å†ŒHeaderView</p><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">[<span class="keyword">self</span>.collectionView registerNib:[[<span class="built_in">NSNib</span> alloc] initWithNibNamed:<span class="string">@&quot;FSChatHeaderView&quot;</span> bundle:<span class="literal">nil</span>]</span><br><span class="line">          forSupplementaryViewOfKind:<span class="built_in">NSCollectionElementKindSectionHeader</span></span><br><span class="line">                      withIdentifier:<span class="string">@&quot;kChatHeader&quot;</span>];</span><br></pre></td></tr></table></figure></li><li><p>å®ç°ä»£ç†</p></li></ul><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">- (<span class="built_in">NSSize</span>)collectionView:(<span class="built_in">NSCollectionView</span> *)collectionView layout:(<span class="built_in">NSCollectionViewLayout</span> *)collectionViewLayout referenceSizeForHeaderInSection:(<span class="built_in">NSInteger</span>)section &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">NSMakeSize</span>(<span class="keyword">self</span>.collectionView.frame.size.width, <span class="number">40</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSView</span> *)collectionView:(<span class="built_in">NSCollectionView</span> *)collectionView</span><br><span class="line">viewForSupplementaryElementOfKind:(<span class="built_in">NSCollectionViewSupplementaryElementKind</span>)kind</span><br><span class="line">               atIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    FSChatHeaderView *headerView = [collectionView makeSupplementaryViewOfKind:<span class="built_in">NSCollectionElementKindSectionHeader</span></span><br><span class="line">                                                                withIdentifier:<span class="string">@&quot;kChatHeader&quot;</span></span><br><span class="line">                                                                  forIndexPath:indexPath];</span><br><span class="line">    <span class="keyword">return</span> headerView;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><a href="https://github.com/ForgetSou/FSToolBarDemo.git">Github Demo</a></p><p><strong>è¯´æ˜ï¼š</strong></p><ul><li><p><code>registerNib</code>/<code>registerClass</code>å¯ä»¥å†™æˆå®ï¼Œä»£ç å¯ä»¥æ›´æ•´æ´ã€‚</p><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> mark - æ³¨å†ŒNib</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> kRegisterNibCollectionView(collectionView, cell, indetifier)    [collectionView registerNib:[[NSNib alloc] initWithNibNamed:NSStringFromClass([cell class]) bundle:nil] forItemWithIdentifier:indetifier]</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> kRegisterNibTableView(tableView, cell, indetifier)              [tableView registerNib:[[NSNib alloc] initWithNibNamed:NSStringFromClass([cell class]) bundle:nil] forCellReuseIdentifier:indetifier]</span></span><br></pre></td></tr></table></figure></li><li><p>identifierå¯ä»¥å†™æˆé™æ€å¸¸é‡</p><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="built_in">NSString</span> *<span class="keyword">const</span> kChatItemID = <span class="string">@&quot;chatItemID&quot;</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="built_in">NSString</span> *<span class="keyword">const</span> kChatHeaderID = <span class="string">@&quot;chatHeaderID&quot;</span>;</span><br></pre></td></tr></table></figure></li><li><p>MVC/MVP/MVVMæ¨¡å¼è‡ªå·±é€‰æ‹©ï¼ŒDemoä½¿ç”¨MVCå®Œæˆã€‚</p></li><li><p>Demoåªè®¾ç½®äº†å¤´éƒ¨ï¼Œå°¾éƒ¨åŒç†ã€‚</p></li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;ä¸€-ç®€è¿°&quot;&gt;&lt;a href=&quot;#ä¸€-ç®€è¿°&quot; class=&quot;headerlink&quot; title=&quot;ä¸€. ç®€è¿°&quot;&gt;&lt;/a&gt;ä¸€. ç®€è¿°&lt;/h1&gt;&lt;p&gt;ä»¥å¯è‡ªå®šä¹‰çš„å¸ƒå±€æ˜¾ç¤ºçš„æ•°æ®é¡¹çš„æœ‰åºé›†åˆã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;NSCollectionView&lt;/span&gt; : &lt;span class=&quot;title&quot;&gt;NSView&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&quot;https://docs-assets.developer.apple.com/published/cce637a738/cv_objects_2x_37439bb5-da91-4db6-a7f0-03c4046877f4.png&quot; alt=&quot;Merging content and layout to create the final appearance&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;äºŒ-å®˜æ–¹å±æ€§æ–¹æ³•&quot;&gt;&lt;a href=&quot;#äºŒ-å®˜æ–¹å±æ€§æ–¹æ³•&quot; class=&quot;headerlink&quot; title=&quot;äºŒ. å®˜æ–¹å±æ€§æ–¹æ³•&quot;&gt;&lt;/a&gt;äºŒ. å®˜æ–¹å±æ€§æ–¹æ³•&lt;/h1&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// ä¸ºæ”¶é›†è§†å›¾æä¾›æ•°æ®çš„å¯¹è±¡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;nullable&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;weak&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;NSCollectionViewDataSource&lt;/span&gt;&amp;gt; dataSource API_AVAILABLE(macos(&lt;span class=&quot;number&quot;&gt;10.11&lt;/span&gt;)); &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;nullable&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;weak&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;NSCollectionViewPrefetching&lt;/span&gt;&amp;gt; prefetchDataSource API_AVAILABLE(macos(&lt;span class=&quot;number&quot;&gt;10.13&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// å§”æ‰˜å¯¹è±¡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;nullable&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;weak&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;NSCollectionViewDelegate&lt;/span&gt;&amp;gt; delegate;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// ä¸ºæ”¶é›†è§†å›¾æä¾›æ•°æ®çš„æ•°ç»„&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;copy&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt;&amp;lt;&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;&amp;gt; *content;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;nullable&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;strong&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;NSView&lt;/span&gt; *backgroundView API_AVAILABLE(macos(&lt;span class=&quot;number&quot;&gt;10.11&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// èƒŒæ™¯è‰²æ•°ç»„&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;null_resettable&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;copy&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;NSColor&lt;/span&gt; *&amp;gt; *backgroundColors;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// èƒŒæ™¯è§†å›¾æ˜¯å¦éšé¡¹ç›®åŠå…¶ä»–å†…å®¹æ»šåŠ¨&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; backgroundViewScrollsWithContent API_AVAILABLE(macos(&lt;span class=&quot;number&quot;&gt;10.12&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// æ„å»ºé›†åˆè§†å›¾å†…å®¹çš„å¸ƒå±€å¯¹è±¡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;nullable&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;strong&lt;/span&gt;) __kindof &lt;span class=&quot;built_in&quot;&gt;NSCollectionViewLayout&lt;/span&gt; *collectionViewLayout API_AVAILABLE(macos(&lt;span class=&quot;number&quot;&gt;10.11&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;!!! ä¹‹åå†è¡¥å…… !!!&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id=&quot;ä¸‰-ç¤ºä¾‹&quot;&gt;&lt;a href=&quot;#ä¸‰-ç¤ºä¾‹&quot; class=&quot;headerlink&quot; title=&quot;ä¸‰. ç¤ºä¾‹&quot;&gt;&lt;/a&gt;ä¸‰. ç¤ºä¾‹&lt;/h1&gt;&lt;h2 id=&quot;1-æ•ˆæœå›¾&quot;&gt;&lt;a href=&quot;#1-æ•ˆæœå›¾&quot; class=&quot;headerlink&quot; title=&quot;1. æ•ˆæœå›¾&quot;&gt;&lt;/a&gt;1. æ•ˆæœå›¾&lt;/h2&gt;&lt;p&gt;è¦è¾¾åˆ°çš„æ•ˆæœ:&lt;/p&gt;</summary>
    
    
    
    <category term="OC" scheme="https://forgetsou.github.io/categories/OC/"/>
    
    
    <category term="OC" scheme="https://forgetsou.github.io/tags/OC/"/>
    
    <category term="macOS" scheme="https://forgetsou.github.io/tags/macOS/"/>
    
    <category term="AppKit" scheme="https://forgetsou.github.io/tags/AppKit/"/>
    
  </entry>
  
  <entry>
    <title>macOSå¼€å‘-å…³é—­/æœ€å°åŒ–/å…¨å±å±…ä¸­å¤„ç†(ä»¿Mac QQ)</title>
    <link href="https://forgetsou.github.io/2020/11/06/macos%E5%BC%80%E5%8F%91-%E5%85%B3%E9%97%AD-%E6%9C%80%E5%B0%8F%E5%8C%96-%E5%85%A8%E5%B1%8F%E5%B1%85%E4%B8%AD%E5%A4%84%E7%90%86(%E4%BB%BFMac%20QQ)/"/>
    <id>https://forgetsou.github.io/2020/11/06/macos%E5%BC%80%E5%8F%91-%E5%85%B3%E9%97%AD-%E6%9C%80%E5%B0%8F%E5%8C%96-%E5%85%A8%E5%B1%8F%E5%B1%85%E4%B8%AD%E5%A4%84%E7%90%86(%E4%BB%BFMac%20QQ)/</id>
    <published>2020-11-06T06:10:49.000Z</published>
    <updated>2020-11-06T06:10:49.000Z</updated>
    
    <content type="html"><![CDATA[<p>å…³é—­/æœ€å°åŒ–/å…¨å±å±…ä¸­å¤„ç†(ä»¿Mac QQ)ï¼Œæ•ˆæœå¦‚ä¸‹</p><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gkffxnzk8aj31e00u0gn3.jpg" alt="image-20201106143307906"></p><p>åœ¨<code>WindowController</code>ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼Œç›´æ¥å¤åˆ¶åˆ°æ§åˆ¶å™¨å¹¶ä¿®æ”¹æ§åˆ¶å™¨åç§°å°±å¯ä»¥äº†ã€‚</p><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  FSWindowCtl.m</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">FSWindowCtl</span> ()&lt;<span class="title">NSWindowDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">FSWindowCtl</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)windowDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> windowDidLoad];</span><br><span class="line">    [<span class="keyword">self</span> settingWindowStyle];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è®¾ç½®windowæ ·å¼</span></span><br><span class="line">- (<span class="keyword">void</span>)settingWindowStyle &#123;</span><br><span class="line">    <span class="keyword">self</span>.window.titlebarAppearsTransparent = <span class="literal">YES</span>;</span><br><span class="line">    <span class="keyword">self</span>.window.titleVisibility = <span class="built_in">NSWindowTitleHidden</span>;</span><br><span class="line">    <span class="keyword">self</span>.window.styleMask = <span class="built_in">NSWindowStyleMaskClosable</span> | <span class="built_in">NSWindowStyleMaskResizable</span> | <span class="built_in">NSWindowStyleMaskTitled</span> | <span class="built_in">NSWindowStyleMaskMiniaturizable</span> | <span class="built_in">NSWindowStyleMaskFullSizeContentView</span>;</span><br><span class="line">    [<span class="keyword">self</span>.window setMovableByWindowBackground:<span class="literal">YES</span>];</span><br><span class="line">    [<span class="keyword">self</span> updateTitleBarOfWindow:<span class="literal">NO</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿®æ”¹å…³é—­ã€æœ€å°åŒ–ã€å…¨å±çš„ä½ç½®</span></span><br><span class="line">- (<span class="keyword">void</span>)updateTitleBarOfWindow:(<span class="built_in">BOOL</span>)fullScreen &#123;</span><br><span class="line">    <span class="built_in">CGFloat</span> kTitlebarH = <span class="number">54.0</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> kFullScreenButtonYOrigin = <span class="number">3.0</span>;</span><br><span class="line">    <span class="built_in">NSRect</span> windowFrame = <span class="keyword">self</span>.window.frame;</span><br><span class="line">    <span class="built_in">NSView</span> *titlebarContainerView = [<span class="keyword">self</span>.window standardWindowButton:<span class="built_in">NSWindowCloseButton</span>].superview.superview;</span><br><span class="line">    <span class="built_in">NSRect</span> titlebarContainerFrame = titlebarContainerView.frame;</span><br><span class="line">    titlebarContainerFrame.origin.y = windowFrame.size.height - kTitlebarH;</span><br><span class="line">    titlebarContainerFrame.size.height = (<span class="built_in">CGFloat</span>)kTitlebarH;</span><br><span class="line">    titlebarContainerView.frame = titlebarContainerFrame;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGFloat</span> buttonX = <span class="number">12.0</span>;</span><br><span class="line">    <span class="built_in">NSButton</span> *closeBtn = [<span class="keyword">self</span>.window standardWindowButton:<span class="built_in">NSWindowCloseButton</span>];</span><br><span class="line">    <span class="built_in">NSButton</span> *minimizeBtn = [<span class="keyword">self</span>.window standardWindowButton:<span class="built_in">NSWindowMiniaturizeButton</span>];</span><br><span class="line">    <span class="built_in">NSButton</span> *zoomBtn = [<span class="keyword">self</span>.window standardWindowButton:<span class="built_in">NSWindowZoomButton</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSButton</span> *buttonView <span class="keyword">in</span> @[closeBtn, minimizeBtn, zoomBtn]) &#123;</span><br><span class="line">        <span class="built_in">NSRect</span> buttonFrame = buttonView.frame;</span><br><span class="line">        buttonFrame.origin.y = fullScreen ? kFullScreenButtonYOrigin : round((kTitlebarH - buttonFrame.size.height)/<span class="number">2.0</span>);</span><br><span class="line">        buttonFrame.origin.x = (<span class="built_in">CGFloat</span>)buttonX;</span><br><span class="line">        buttonX = buttonFrame.size.width + buttonX + <span class="number">6</span>;</span><br><span class="line">        [buttonView setFrameOrigin:buttonFrame.origin];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> mark - NSWindowDelegate</span></span><br><span class="line">- (<span class="keyword">void</span>)windowDidEnterFullScreen:(<span class="built_in">NSNotification</span> *)notification &#123;</span><br><span class="line">    [<span class="keyword">self</span> updateTitleBarOfWindow:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)windowDidExitFullScreen:(<span class="built_in">NSNotification</span> *)notification &#123;</span><br><span class="line">    [<span class="keyword">self</span> updateTitleBarOfWindow:<span class="literal">NO</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)windowDidResize:(<span class="built_in">NSNotification</span> *)notification &#123;</span><br><span class="line">    [<span class="keyword">self</span> updateTitleBarOfWindow:<span class="literal">NO</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;å…³é—­/æœ€å°åŒ–/å…¨å±å±…ä¸­å¤„ç†(ä»¿Mac QQ)ï¼Œæ•ˆæœå¦‚ä¸‹&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/0081Kckwly1gkffxnzk8aj31e00u0gn3.jpg&quot; alt=&quot;image-20201106143307906&quot;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨&lt;code&gt;WindowController&lt;/code&gt;ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼Œç›´æ¥å¤åˆ¶åˆ°æ§åˆ¶å™¨å¹¶ä¿®æ”¹æ§åˆ¶å™¨åç§°å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//  FSWindowCtl.m&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;FSWindowCtl&lt;/span&gt; ()&amp;lt;&lt;span class=&quot;title&quot;&gt;NSWindowDelegate&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;FSWindowCtl&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)windowDidLoad &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; windowDidLoad];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; settingWindowStyle];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// è®¾ç½®windowæ ·å¼&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)settingWindowStyle &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.window.titlebarAppearsTransparent = &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.window.titleVisibility = &lt;span class=&quot;built_in&quot;&gt;NSWindowTitleHidden&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.window.styleMask = &lt;span class=&quot;built_in&quot;&gt;NSWindowStyleMaskClosable&lt;/span&gt; | &lt;span class=&quot;built_in&quot;&gt;NSWindowStyleMaskResizable&lt;/span&gt; | &lt;span class=&quot;built_in&quot;&gt;NSWindowStyleMaskTitled&lt;/span&gt; | &lt;span class=&quot;built_in&quot;&gt;NSWindowStyleMaskMiniaturizable&lt;/span&gt; | &lt;span class=&quot;built_in&quot;&gt;NSWindowStyleMaskFullSizeContentView&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.window setMovableByWindowBackground:&lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; updateTitleBarOfWindow:&lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// ä¿®æ”¹å…³é—­ã€æœ€å°åŒ–ã€å…¨å±çš„ä½ç½®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)updateTitleBarOfWindow:(&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)fullScreen &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt; kTitlebarH = &lt;span class=&quot;number&quot;&gt;54.0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt; kFullScreenButtonYOrigin = &lt;span class=&quot;number&quot;&gt;3.0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSRect&lt;/span&gt; windowFrame = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.window.frame;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSView&lt;/span&gt; *titlebarContainerView = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.window standardWindowButton:&lt;span class=&quot;built_in&quot;&gt;NSWindowCloseButton&lt;/span&gt;].superview.superview;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSRect&lt;/span&gt; titlebarContainerFrame = titlebarContainerView.frame;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    titlebarContainerFrame.origin.y = windowFrame.size.height - kTitlebarH;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    titlebarContainerFrame.size.height = (&lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt;)kTitlebarH;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    titlebarContainerView.frame = titlebarContainerFrame;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt; buttonX = &lt;span class=&quot;number&quot;&gt;12.0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSButton&lt;/span&gt; *closeBtn = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.window standardWindowButton:&lt;span class=&quot;built_in&quot;&gt;NSWindowCloseButton&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSButton&lt;/span&gt; *minimizeBtn = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.window standardWindowButton:&lt;span class=&quot;built_in&quot;&gt;NSWindowMiniaturizeButton&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSButton&lt;/span&gt; *zoomBtn = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.window standardWindowButton:&lt;span class=&quot;built_in&quot;&gt;NSWindowZoomButton&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;NSButton&lt;/span&gt; *buttonView &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; @[closeBtn, minimizeBtn, zoomBtn]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSRect&lt;/span&gt; buttonFrame = buttonView.frame;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        buttonFrame.origin.y = fullScreen ? kFullScreenButtonYOrigin : round((kTitlebarH - buttonFrame.size.height)/&lt;span class=&quot;number&quot;&gt;2.0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        buttonFrame.origin.x = (&lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt;)buttonX;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        buttonX = buttonFrame.size.width + buttonX + &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [buttonView setFrameOrigin:buttonFrame.origin];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;pragma&lt;/span&gt; mark - NSWindowDelegate&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)windowDidEnterFullScreen:(&lt;span class=&quot;built_in&quot;&gt;NSNotification&lt;/span&gt; *)notification &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; updateTitleBarOfWindow:&lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)windowDidExitFullScreen:(&lt;span class=&quot;built_in&quot;&gt;NSNotification&lt;/span&gt; *)notification &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; updateTitleBarOfWindow:&lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)windowDidResize:(&lt;span class=&quot;built_in&quot;&gt;NSNotification&lt;/span&gt; *)notification &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; updateTitleBarOfWindow:&lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

</summary>
    
    
    
    <category term="OC" scheme="https://forgetsou.github.io/categories/OC/"/>
    
    
    <category term="OC" scheme="https://forgetsou.github.io/tags/OC/"/>
    
    <category term="macOS" scheme="https://forgetsou.github.io/tags/macOS/"/>
    
    <category term="æ—¥å¸¸æ”¶é›†" scheme="https://forgetsou.github.io/tags/%E6%97%A5%E5%B8%B8%E6%94%B6%E9%9B%86/"/>
    
  </entry>
  
  <entry>
    <title>macOSå¼€å‘-NSOpenPanel</title>
    <link href="https://forgetsou.github.io/2020/11/05/macOS%E5%BC%80%E5%8F%91-NSOpenPanel/"/>
    <id>https://forgetsou.github.io/2020/11/05/macOS%E5%BC%80%E5%8F%91-NSOpenPanel/</id>
    <published>2020-11-05T03:29:01.000Z</published>
    <updated>2020-11-05T03:29:01.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸€-å‰è¨€"><a href="#ä¸€-å‰è¨€" class="headerlink" title="ä¸€. å‰è¨€"></a>ä¸€. å‰è¨€</h1><p><strong>æ‰“å¼€é¢æ¿</strong>ï¼Œæç¤ºç”¨æˆ·é€‰æ‹©è¦æ‰“å¼€çš„æ–‡ä»¶ã€‚</p><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSOpenPanel</span> : <span class="title">NSSavePanel</span></span></span><br></pre></td></tr></table></figure><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gke553cxmxj318e0owjyl.jpg" alt="image-20201105113305295" style="zoom:50%;" /><blockquote><h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a><a href="https://developer.apple.com/documentation/appkit/nsopenpanel?language=objc">Overview</a></h2><p>Apps use the Open panel as a convenient way to query the user for the name of a file to open. In macOS 10.15 and later, the system always draws Open panels in a separate process, regardless of whether the app is sandboxed. When the user chooses a file to open, macOS adds that file to the appâ€™s sandbox. Prior to macOS 10.15, the system drew the panels in a separate process only for sandboxed apps.</p><p>åº”ç”¨ç¨‹åºä½¿ç”¨â€œæ‰“å¼€â€é¢æ¿ä½œä¸ºæ–¹ä¾¿çš„æ–¹æ³•æ¥æŸ¥è¯¢ç”¨æˆ·è¦æ‰“å¼€çš„æ–‡ä»¶çš„åç§°ã€‚åœ¨macOS 10.15åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œç³»ç»Ÿå§‹ç»ˆåœ¨å•ç‹¬çš„è¿‡ç¨‹ä¸­ç»˜åˆ¶â€œæ‰“å¼€â€é¢æ¿ï¼Œè€Œä¸ç®¡è¯¥åº”ç”¨ç¨‹åºæ˜¯å¦è¢«æ²™ç®±åŒ–ã€‚å½“ç”¨æˆ·é€‰æ‹©è¦æ‰“å¼€çš„æ–‡ä»¶æ—¶ï¼ŒmacOSå°†è¯¥æ–‡ä»¶æ·»åŠ åˆ°åº”ç”¨çš„æ²™ç®±ä¸­ã€‚åœ¨macOS 10.15ä¹‹å‰ï¼Œç³»ç»Ÿä»…åœ¨æ²™ç›’åº”ç”¨ç¨‹åºçš„å•ç‹¬è¿‡ç¨‹ä¸­ç»˜åˆ¶é¢æ¿ã€‚</p></blockquote><h1 id="äºŒ-å®˜æ–¹å±æ€§æ–¹æ³•"><a href="#äºŒ-å®˜æ–¹å±æ€§æ–¹æ³•" class="headerlink" title="äºŒ. å®˜æ–¹å±æ€§æ–¹æ³•"></a>äºŒ. å®˜æ–¹å±æ€§æ–¹æ³•</h1><h2 id="1-åˆ›å»ºæ‰“å¼€é¢æ¿"><a href="#1-åˆ›å»ºæ‰“å¼€é¢æ¿" class="headerlink" title="1. åˆ›å»ºæ‰“å¼€é¢æ¿"></a>1. åˆ›å»ºæ‰“å¼€é¢æ¿</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">+ (<span class="built_in">NSOpenPanel</span> *)openPanel; <span class="comment">// åˆ›å»ºNSOpenPanelå®ä¾‹å¯¹è±¡ï¼Œä½†æ˜¯è¿™ä¸ªç±»ä¸æ˜¯å•ä¾‹ã€‚</span></span><br></pre></td></tr></table></figure><h2 id="2-é…ç½®æ‰“å¼€é¢æ¿"><a href="#2-é…ç½®æ‰“å¼€é¢æ¿" class="headerlink" title="2. é…ç½®æ‰“å¼€é¢æ¿"></a>2. é…ç½®æ‰“å¼€é¢æ¿</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ˜¯å¦è§£æåˆ«å</span></span><br><span class="line"><span class="keyword">@property</span> <span class="built_in">BOOL</span> resolvesAliases;</span><br><span class="line"><span class="comment">// æ˜¯å¦å¯ä»¥é€‰æ‹©ç›®å½•</span></span><br><span class="line"><span class="keyword">@property</span> <span class="built_in">BOOL</span> canChooseDirectories;</span><br><span class="line"><span class="comment">// æ˜¯å¦å¯ä»¥é€‰æ‹©å¤šä¸ªæ–‡ä»¶æˆ–ç›®å½•</span></span><br><span class="line"><span class="keyword">@property</span> <span class="built_in">BOOL</span> allowsMultipleSelection;</span><br><span class="line"><span class="comment">// æ˜¯å¦é€‰æ‹©æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">@property</span> <span class="built_in">BOOL</span> canChooseFiles;</span><br><span class="line"><span class="comment">// é™„ä»¶è§†å›¾æ˜¯å¦å¯è§</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">getter</span>=isAccessoryViewDisclosed) <span class="built_in">BOOL</span> accessoryViewDisclosed API_AVAILABLE(macos(<span class="number">10.11</span>)); </span><br></pre></td></tr></table></figure><h2 id="3-iCloud"><a href="#3-iCloud" class="headerlink" title="3. iCloud"></a>3. iCloud</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æŒ‡ç¤ºé¢æ¿å¦‚ä½•å“åº”å…·æœ‰å†²çªç‰ˆæœ¬çš„iCloudæ–‡æ¡£</span></span><br><span class="line"><span class="keyword">@property</span> <span class="built_in">BOOL</span> canResolveUbiquitousConflicts API_AVAILABLE(macos(<span class="number">10.10</span>));</span><br><span class="line"><span class="comment">// æŒ‡ç¤ºé¢æ¿å¦‚ä½•å“åº”æœªå®Œå…¨æœ¬åœ°ä¸‹è½½çš„iCloudæ–‡æ¡£</span></span><br><span class="line"><span class="keyword">@property</span> <span class="built_in">BOOL</span> canDownloadUbiquitousContents API_AVAILABLE(macos(<span class="number">10.10</span>));</span><br></pre></td></tr></table></figure><h2 id="4-è®¿é—®ç”¨æˆ·é€‰æ‹©"><a href="#4-è®¿é—®ç”¨æˆ·é€‰æ‹©" class="headerlink" title="4. è®¿é—®ç”¨æˆ·é€‰æ‹©"></a>4. è®¿é—®ç”¨æˆ·é€‰æ‹©</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// URLæ•°ç»„ï¼Œæ¯ä¸ªURLåŒ…å«æ‰€é€‰æ–‡ä»¶æˆ–ç›®å½•çš„å®Œæ•´æŒ‡å®šä½ç½®ã€‚</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="built_in">NSArray</span>&lt;<span class="built_in">NSURL</span> *&gt; *URLs;</span><br></pre></td></tr></table></figure><h1 id="ä¸‰-çˆ¶ç±»NSSavePanelä¿å­˜é¢æ¿"><a href="#ä¸‰-çˆ¶ç±»NSSavePanelä¿å­˜é¢æ¿" class="headerlink" title="ä¸‰. çˆ¶ç±»NSSavePanelä¿å­˜é¢æ¿"></a>ä¸‰. çˆ¶ç±»NSSavePanelä¿å­˜é¢æ¿</h1><h2 id="1-åˆ›å»ºä¿å­˜é¢æ¿"><a href="#1-åˆ›å»ºä¿å­˜é¢æ¿" class="headerlink" title="1. åˆ›å»ºä¿å­˜é¢æ¿"></a>1. åˆ›å»ºä¿å­˜é¢æ¿</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">+ (<span class="built_in">NSSavePanel</span> *)savePanel; <span class="comment">// åˆ›å»ºNSSavePanelå®ä¾‹å¯¹è±¡ï¼Œä½†æ˜¯è¿™ä¸ªç±»ä¸æ˜¯å•ä¾‹ã€‚</span></span><br></pre></td></tr></table></figure><h2 id="2-å“åº”äº¤äº’"><a href="#2-å“åº”äº¤äº’" class="headerlink" title="2. å“åº”äº¤äº’"></a>2. å“åº”äº¤äº’</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">weak</span>) <span class="keyword">id</span>&lt;<span class="built_in">NSOpenSavePanelDelegate</span>&gt; delegate;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜¯å¦åº”åœ¨â€œæ‰“å¼€â€é¢æ¿ä¸­å¯ç”¨æŒ‡å®šçš„URL</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)panel:(<span class="keyword">id</span>)sender shouldEnableURL:(<span class="built_in">NSURL</span> *)url API_AVAILABLE(macos(<span class="number">10.6</span>));</span><br><span class="line"><span class="comment">// ç”¨äºä¿å­˜å’Œæ‰“å¼€æ–‡ä»¶çš„URLéªŒè¯ã€‚</span></span><br><span class="line"><span class="comment">//    NSSavePanelï¼šå½“ç”¨æˆ·é€‰æ‹©â€œä¿å­˜â€æŒ‰é’®æ—¶ï¼Œä¿å­˜é¢æ¿ä¼šè°ƒç”¨è¯¥æ–¹æ³•ä¸€æ¬¡ã€‚ç”¨æˆ·æ‰“ç®—å°†æ–‡ä»¶ä¿å­˜åœ¨â€œ urlâ€å¤„ã€‚å¦‚æœ&#x27;url&#x27;æ˜¯è¦ä¿å­˜çš„æœ‰æ•ˆä½ç½®ï¼Œåˆ™è¿”å›YESã€‚è¯·æ³¨æ„ï¼Œé™¤éç”¨æˆ·å†³å®šè¦†ç›–ç°æœ‰é¡¹ç›®ï¼Œå¦åˆ™â€œ urlâ€ä¸­çš„é¡¹ç›®å¯èƒ½å®é™…ä¸Šè¿˜ä¸å­˜åœ¨ã€‚è¿”å›â€œå¦â€ï¼Œå¹¶åœ¨â€œ outErrorâ€ä¸­å¡«å†™ç”¨æˆ·å¯æ˜¾ç¤ºçš„é”™è¯¯æ¶ˆæ¯ï¼Œä»¥è¯´æ˜â€œ URLâ€æ— æ•ˆçš„åŸå› ã€‚å¦‚æœé”™è¯¯æä¾›äº†æ¢å¤é€‰é¡¹ï¼Œå¹¶ä¸”æ¢å¤æˆåŠŸï¼Œåˆ™é¢æ¿å°†å°è¯•å†æ¬¡å…³é—­ã€‚</span></span><br><span class="line"><span class="comment">//    NSOpenPanelï¼šå½“ç”¨æˆ·é€‰æ‹©â€œæ‰“å¼€â€æŒ‰é’®æ—¶ï¼Œå°†ä¸ºæ¯ä¸ªé€‰å®šçš„æ–‡ä»¶åï¼ˆæˆ–ç›®å½•ï¼‰è°ƒç”¨ä¸€æ¬¡è¯¥æ–¹æ³•ã€‚å¦‚æœå¯ä»¥æ‰“å¼€â€œ URLâ€ï¼Œåˆ™è¿”å›YESã€‚è¿”å›NOå¹¶åœ¨ç”¨æˆ·æ˜¾ç¤ºçš„æ¶ˆæ¯ä¸­å¡«å†™â€œ outErrorâ€ï¼Œä»¥è¯´æ˜ä¸ºä»€ä¹ˆâ€œ urlâ€å¯¹äºæ‰“å¼€æ— æ•ˆã€‚å¦‚æœå¯¹é€‰å®šé¡¹ç›®çš„å¤„ç†éœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œåˆ™å¯ä»¥åœ¨panelï¼šshouldEnableURLï¼šä¸Šä½¿ç”¨æ­¤æ–¹æ³•ã€‚å¦‚æœé”™è¯¯æä¾›äº†æ¢å¤é€‰é¡¹ï¼Œå¹¶ä¸”æ¢å¤æˆåŠŸï¼Œåˆ™é¢æ¿å°†å°è¯•å†æ¬¡å…³é—­ã€‚</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)panel:(<span class="keyword">id</span>)sender validateURL:(<span class="built_in">NSURL</span> *)url error:(<span class="built_in">NSError</span> **)outError API_AVAILABLE(macos(<span class="number">10.6</span>));</span><br><span class="line"><span class="comment">// ç”¨æˆ·å°†æ‰€é€‰ç›®å½•æ›´æ”¹ä¸ºä½äºæŒ‡å®šURLçš„ç›®å½•ã€‚</span></span><br><span class="line">- (<span class="keyword">void</span>)panel:(<span class="keyword">id</span>)sender didChangeToDirectoryURL:(<span class="keyword">nullable</span> <span class="built_in">NSURL</span> *)url API_AVAILABLE(macos(<span class="number">10.6</span>));</span><br><span class="line"><span class="comment">// é€šè¿‡åœ¨â€œä¿å­˜â€é¢æ¿ä¸­å•å‡»â€œä¿å­˜â€ï¼Œå‘ŠçŸ¥ä»£è¡¨ç”¨æˆ·ç”¨æˆ·å·²ç¡®è®¤æ–‡ä»¶åé€‰æ‹©ã€‚</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)panel:(<span class="keyword">id</span>)sender userEnteredFilename:(<span class="built_in">NSString</span> *)filename confirmed:(<span class="built_in">BOOL</span>)okFlag;</span><br><span class="line"><span class="comment">// â€œä¿å­˜â€é¢æ¿å³å°†å±•å¼€æˆ–æŠ˜å ï¼Œå› ä¸ºç”¨æˆ·å•å‡»äº†æ˜¾ç¤ºæˆ–éšè—æ–‡ä»¶æµè§ˆå™¨çš„æ˜¾ç¤ºä¸‰è§’å½¢ã€‚</span></span><br><span class="line">- (<span class="keyword">void</span>)panel:(<span class="keyword">id</span>)sender willExpand:(<span class="built_in">BOOL</span>)expanding;</span><br><span class="line"><span class="comment">// ç”¨æˆ·åœ¨æŒ‡å®šçš„â€œä¿å­˜â€é¢æ¿ä¸­æ›´æ”¹äº†é€‰æ‹©ã€‚</span></span><br><span class="line">- (<span class="keyword">void</span>)panelSelectionDidChange:(<span class="keyword">nullable</span> <span class="keyword">id</span>)sender;</span><br></pre></td></tr></table></figure><h2 id="3-æ˜¾ç¤ºé¢æ¿"><a href="#3-æ˜¾ç¤ºé¢æ¿" class="headerlink" title="3. æ˜¾ç¤ºé¢æ¿"></a>3. æ˜¾ç¤ºé¢æ¿</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å°†é¢æ¿æ˜¾ç¤ºä¸ºæŒ‡å®šçª—å£çš„æ¨¡æ€é¢æ¿</span></span><br><span class="line">- (<span class="keyword">void</span>)beginSheetModalForWindow:(<span class="built_in">NSWindow</span> *)window completionHandler:(<span class="keyword">void</span> (^)(<span class="built_in">NSModalResponse</span> result))handler API_AVAILABLE(macos(<span class="number">10.6</span>));</span><br><span class="line"><span class="comment">// å°†é¢æ¿æ˜¾ç¤ºä¸ºæ— æ¨¡å¼çª—å£ã€‚</span></span><br><span class="line">- (<span class="keyword">void</span>)beginWithCompletionHandler:(<span class="keyword">void</span> (^)(<span class="built_in">NSModalResponse</span> result))handler API_AVAILABLE(macos(<span class="number">10.6</span>));</span><br><span class="line"><span class="comment">// æ˜¾ç¤ºé¢æ¿å¹¶ä»¥å½“å‰å·¥ä½œï¼ˆæˆ–ä¸Šæ¬¡é€‰æ‹©çš„ï¼‰ç›®å½•ä½œä¸ºé»˜è®¤èµ·ç‚¹å¼€å§‹å…¶äº‹ä»¶å¾ªç¯ã€‚</span></span><br><span class="line">- (<span class="built_in">NSModalResponse</span>)runModal;</span><br><span class="line"><span class="comment">// éªŒè¯å¹¶é‡æ–°åŠ è½½é¢æ¿ä¸­å¯è§çš„æµè§ˆå™¨åˆ—ã€‚</span></span><br></pre></td></tr></table></figure><h2 id="4-è·å–æ‰€é€‰URL"><a href="#4-è·å–æ‰€é€‰URL" class="headerlink" title="4. è·å–æ‰€é€‰URL"></a>4. è·å–æ‰€é€‰URL</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®Œæ•´æŒ‡å®šä½ç½®</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="built_in">NSURL</span> *URL;</span><br></pre></td></tr></table></figure><h2 id="5-é…ç½®å¤–è§‚"><a href="#5-é…ç½®å¤–è§‚" class="headerlink" title="5. é…ç½®å¤–è§‚"></a>5. é…ç½®å¤–è§‚</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é¢æ¿æ ‡é¢˜</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">null_resettable</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *title;</span><br><span class="line"><span class="comment">// é»˜è®¤æŒ‰é’®ä¸­çš„æ–‡æœ¬</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">null_resettable</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *prompt;</span><br><span class="line"><span class="comment">// æ¶ˆæ¯æ–‡æœ¬</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">null_resettable</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *message;</span><br><span class="line"><span class="comment">// æ ‡ç­¾æ–‡æœ¬æ˜¾ç¤ºåœ¨æ–‡ä»¶åæ–‡æœ¬å­—æ®µçš„å‰é¢ã€‚</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">null_resettable</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *nameFieldLabel;</span><br><span class="line"><span class="comment">// å½“å‰æ˜¾ç¤ºåœ¨åç§°å­—æ®µä¸­çš„ç”¨æˆ·å¯ç¼–è¾‘æ–‡ä»¶åã€‚</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>) <span class="built_in">NSString</span> *nameFieldStringValue API_AVAILABLE(macos(<span class="number">10.6</span>));</span><br><span class="line"><span class="comment">// é¢æ¿æ˜¾ç¤ºçš„å½“å‰ç›®å½•</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">copy</span>) <span class="built_in">NSURL</span> *directoryURL API_AVAILABLE(macos(<span class="number">10.6</span>));</span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰é™„ä»¶è§†å›¾</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">strong</span>) <span class="built_in">NSView</span> *accessoryView;</span><br><span class="line"><span class="comment">// æ˜¯å¦æ˜¾ç¤ºæ ‡ç­¾å­—æ®µ</span></span><br><span class="line"><span class="keyword">@property</span> <span class="built_in">BOOL</span> showsTagField API_AVAILABLE(macos(<span class="number">10.9</span>));</span><br><span class="line"><span class="comment">// æ ‡ç­¾åç§°</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">copy</span>) <span class="built_in">NSArray</span>&lt;<span class="built_in">NSString</span> *&gt; *tagNames API_AVAILABLE(macos(<span class="number">10.9</span>));</span><br></pre></td></tr></table></figure><h2 id="6-é¢æ¿è¡Œä¸º"><a href="#6-é¢æ¿è¡Œä¸º" class="headerlink" title="6. é¢æ¿è¡Œä¸º"></a>6. é¢æ¿è¡Œä¸º</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ˜¯å¦æ˜¾ç¤ºåˆ›å»ºç›®å½•çš„UI</span></span><br><span class="line"><span class="keyword">@property</span> <span class="built_in">BOOL</span> canCreateDirectories;</span><br><span class="line"><span class="comment">// æ˜¯å¦æ˜¾ç¤ºæ–‡ä»¶æ‹“å±•åçš„UI</span></span><br><span class="line"><span class="keyword">@property</span> <span class="built_in">BOOL</span> canSelectHiddenExtension;</span><br><span class="line"><span class="comment">// æ˜¯å¦æ˜¾ç¤ºéšè—æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">@property</span> <span class="built_in">BOOL</span> showsHiddenFiles;</span><br><span class="line"><span class="comment">// æ˜¯å¦éšè—æŒ‡ç¤ºå’Œæ‹“å±•å¤é€‰æ¡†</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">getter</span>=isExtensionHidden) <span class="built_in">BOOL</span> extensionHidden;</span><br><span class="line"><span class="comment">// æ˜¯å¦æ‹“å±•é¢æ¿</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">getter</span>=isExpanded, <span class="keyword">readonly</span>) <span class="built_in">BOOL</span> expanded;</span><br><span class="line"><span class="comment">// æ˜¯å¦å…è®¸ç”¨æˆ·ä¿å­˜æ–‡ä»¶åæ‰©å±•åä¸åœ¨å…è®¸çš„ç±»å‹åˆ—è¡¨ä¸­çš„æ–‡ä»¶ã€‚</span></span><br><span class="line"><span class="keyword">@property</span> <span class="built_in">BOOL</span> allowsOtherFileTypes;</span><br><span class="line"><span class="comment">// æ˜¯å¦å°†æ–‡ä»¶åŒ…æ˜¾ç¤ºä¸ºç›®å½•ã€‚</span></span><br><span class="line"><span class="keyword">@property</span> <span class="built_in">BOOL</span> treatsFilePackagesAsDirectories;</span><br></pre></td></tr></table></figure><h2 id="7-Action"><a href="#7-Action" class="headerlink" title="7. Action"></a>7. Action</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">IBAction</span>)ok:(<span class="keyword">nullable</span> <span class="keyword">id</span>)sender; <span class="comment">// ç‚¹å‡»ç¡®å®š</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)cancel:(<span class="keyword">nullable</span> <span class="keyword">id</span>)sender; <span class="comment">// ç‚¹å‡»å–æ¶ˆ</span></span><br></pre></td></tr></table></figure><h1 id="å››-ç®€å•ç¤ºä¾‹"><a href="#å››-ç®€å•ç¤ºä¾‹" class="headerlink" title="å››. ç®€å•ç¤ºä¾‹"></a>å››. ç®€å•ç¤ºä¾‹</h1><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">IBAction</span>)openPanelClick:(<span class="built_in">NSButton</span> *)sender &#123;</span><br><span class="line">    <span class="built_in">NSOpenPanel</span> *openPanel = [<span class="built_in">NSOpenPanel</span> openPanel];</span><br><span class="line">    openPanel.prompt = <span class="string">@&quot;é€‰æ‹©&quot;</span>;</span><br><span class="line">    openPanel.title = <span class="string">@&quot;NSSplitView Demo&quot;</span>;</span><br><span class="line">    openPanel.message = <span class="string">@&quot;ä½ æ˜¯è°çš„è°&quot;</span>;</span><br><span class="line">    openPanel.canChooseFiles = <span class="literal">YES</span>;</span><br><span class="line">    openPanel.canChooseDirectories = <span class="literal">YES</span>;</span><br><span class="line">    [openPanel beginSheetModalForWindow:<span class="keyword">self</span>.view.window completionHandler:^(<span class="built_in">NSModalResponse</span> result) &#123;</span><br><span class="line">        <span class="keyword">if</span> (result == <span class="built_in">NSModalResponseOK</span>) &#123;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>, openPanel.URL.path);</span><br><span class="line">        &#125;</span><br><span class="line">        sender.state = <span class="built_in">NSControlStateValueOff</span>;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;ä¸€-å‰è¨€&quot;&gt;&lt;a href=&quot;#ä¸€-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;ä¸€. å‰è¨€&quot;&gt;&lt;/a&gt;ä¸€. å‰è¨€&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;æ‰“å¼€é¢æ¿&lt;/strong&gt;ï¼Œæç¤ºç”¨æˆ·é€‰æ‹©è¦æ‰“å¼€çš„æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;NSOpenPanel&lt;/span&gt; : &lt;span class=&quot;title&quot;&gt;NSSavePanel&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;img src=&quot;https://tva1.sinaimg.cn/large/0081Kckwly1gke553cxmxj318e0owjyl.jpg&quot; alt=&quot;image-20201105113305295&quot; style=&quot;zoom:50%;&quot;&gt;

&lt;blockquote&gt;
&lt;h2 id=&quot;Overview&quot;&gt;&lt;a href=&quot;#Overview&quot; class=&quot;headerlink&quot; title=&quot;Overview&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://developer.apple.com/documentation/appkit/nsopenpanel?language=objc&quot;&gt;Overview&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Apps use the Open panel as a convenient way to query the user for the name of a file to open. In macOS 10.15 and later, the system always draws Open panels in a separate process, regardless of whether the app is sandboxed. When the user chooses a file to open, macOS adds that file to the appâ€™s sandbox. Prior to macOS 10.15, the system drew the panels in a separate process only for sandboxed apps.&lt;/p&gt;
&lt;p&gt;åº”ç”¨ç¨‹åºä½¿ç”¨â€œæ‰“å¼€â€é¢æ¿ä½œä¸ºæ–¹ä¾¿çš„æ–¹æ³•æ¥æŸ¥è¯¢ç”¨æˆ·è¦æ‰“å¼€çš„æ–‡ä»¶çš„åç§°ã€‚åœ¨macOS 10.15åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œç³»ç»Ÿå§‹ç»ˆåœ¨å•ç‹¬çš„è¿‡ç¨‹ä¸­ç»˜åˆ¶â€œæ‰“å¼€â€é¢æ¿ï¼Œè€Œä¸ç®¡è¯¥åº”ç”¨ç¨‹åºæ˜¯å¦è¢«æ²™ç®±åŒ–ã€‚å½“ç”¨æˆ·é€‰æ‹©è¦æ‰“å¼€çš„æ–‡ä»¶æ—¶ï¼ŒmacOSå°†è¯¥æ–‡ä»¶æ·»åŠ åˆ°åº”ç”¨çš„æ²™ç®±ä¸­ã€‚åœ¨macOS 10.15ä¹‹å‰ï¼Œç³»ç»Ÿä»…åœ¨æ²™ç›’åº”ç”¨ç¨‹åºçš„å•ç‹¬è¿‡ç¨‹ä¸­ç»˜åˆ¶é¢æ¿ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;äºŒ-å®˜æ–¹å±æ€§æ–¹æ³•&quot;&gt;&lt;a href=&quot;#äºŒ-å®˜æ–¹å±æ€§æ–¹æ³•&quot; class=&quot;headerlink&quot; title=&quot;äºŒ. å®˜æ–¹å±æ€§æ–¹æ³•&quot;&gt;&lt;/a&gt;äºŒ. å®˜æ–¹å±æ€§æ–¹æ³•&lt;/h1&gt;&lt;h2 id=&quot;1-åˆ›å»ºæ‰“å¼€é¢æ¿&quot;&gt;&lt;a href=&quot;#1-åˆ›å»ºæ‰“å¼€é¢æ¿&quot; class=&quot;headerlink&quot; title=&quot;1. åˆ›å»ºæ‰“å¼€é¢æ¿&quot;&gt;&lt;/a&gt;1. åˆ›å»ºæ‰“å¼€é¢æ¿&lt;/h2&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;+ (&lt;span class=&quot;built_in&quot;&gt;NSOpenPanel&lt;/span&gt; *)openPanel; &lt;span class=&quot;comment&quot;&gt;// åˆ›å»ºNSOpenPanelå®ä¾‹å¯¹è±¡ï¼Œä½†æ˜¯è¿™ä¸ªç±»ä¸æ˜¯å•ä¾‹ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;2-é…ç½®æ‰“å¼€é¢æ¿&quot;&gt;&lt;a href=&quot;#2-é…ç½®æ‰“å¼€é¢æ¿&quot; class=&quot;headerlink&quot; title=&quot;2. é…ç½®æ‰“å¼€é¢æ¿&quot;&gt;&lt;/a&gt;2. é…ç½®æ‰“å¼€é¢æ¿&lt;/h2&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// æ˜¯å¦è§£æåˆ«å&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; resolvesAliases;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// æ˜¯å¦å¯ä»¥é€‰æ‹©ç›®å½•&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; canChooseDirectories;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// æ˜¯å¦å¯ä»¥é€‰æ‹©å¤šä¸ªæ–‡ä»¶æˆ–ç›®å½•&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; allowsMultipleSelection;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// æ˜¯å¦é€‰æ‹©æ–‡ä»¶&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; canChooseFiles;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// é™„ä»¶è§†å›¾æ˜¯å¦å¯è§&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;getter&lt;/span&gt;=isAccessoryViewDisclosed) &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; accessoryViewDisclosed API_AVAILABLE(macos(&lt;span class=&quot;number&quot;&gt;10.11&lt;/span&gt;)); &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="OC" scheme="https://forgetsou.github.io/categories/OC/"/>
    
    
    <category term="OC" scheme="https://forgetsou.github.io/tags/OC/"/>
    
    <category term="macOS" scheme="https://forgetsou.github.io/tags/macOS/"/>
    
    <category term="AppKit" scheme="https://forgetsou.github.io/tags/AppKit/"/>
    
  </entry>
  
  <entry>
    <title>iOS æœ¬åœ°æ¨é€ Local Push</title>
    <link href="https://forgetsou.github.io/2020/11/05/iOS-%E6%9C%AC%E5%9C%B0%E6%8E%A8%E9%80%81-Local-Push/"/>
    <id>https://forgetsou.github.io/2020/11/05/iOS-%E6%9C%AC%E5%9C%B0%E6%8E%A8%E9%80%81-Local-Push/</id>
    <published>2020-11-05T01:30:15.000Z</published>
    <updated>2020-11-05T01:30:15.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸€-å‰è¨€"><a href="#ä¸€-å‰è¨€" class="headerlink" title="ä¸€. å‰è¨€"></a>ä¸€. å‰è¨€</h1><blockquote><p>æ¨é€æ˜¯æˆ‘ä»¬å¹³æ—¶å¼€å‘ä¸­å¸¸ç”¨çš„ä¸€ç§æœºåˆ¶ï¼Œæ— è®ºiOSè¿˜æ˜¯Androidç³»ç»Ÿéƒ½æœ‰æ¨é€ï¼Œæ¨é€å¯ä»¥è®©ä¸åœ¨å‰å°è¿è¡Œçš„app,å‘ŠçŸ¥ç”¨æˆ·appå†…éƒ¨å‘ç”Ÿçš„äº‹æƒ…ï¼Œå¯ä»¥æé«˜appçš„æ‰“å¼€æ¬¡æ•°ï¼Œå¢åŠ æ—¥æ´»ã€‚</p></blockquote><p>iOSä¸­çš„æ¨é€åˆ†ä¸º</p><p>ï¼ˆ1ï¼‰æœ¬åœ°æ¨é€é€šçŸ¥(Local Notification)</p><p>ï¼ˆ2ï¼‰è¿œç¨‹æ¨é€é€šçŸ¥(Remote Notification)</p><blockquote><p>æˆ‘ä»¬åœ¨å¹³æ—¶çš„å¼€å‘ä¸­ï¼Œä½¿ç”¨è¿œç¨‹æ¨é€å¯èƒ½æ¯”è¾ƒå¤šï¼Œè¿œç¨‹æ¨é€ä¾èµ–äºæœåŠ¡å™¨ï¼Œéœ€è¦è”ç½‘æ‰èƒ½æ”¶åˆ°ï¼Œæœ¬åœ°æ¨é€æ— éœ€è”ç½‘ï¼Œæ·»åŠ å¥½å®šæ—¶å™¨å³å¯åœ¨æŒ‡å®šæ—¶é—´å‘é€æ¨é€ï¼Œå¹³æ—¶ä½¿ç”¨åœºæ™¯å¤šæ˜¯é—¹é’Ÿï¼Œæé†’ç­‰ã€‚</p></blockquote><h1 id="2-æœ¬åœ°æ¨é€ï¼ˆLocal-Pushï¼‰"><a href="#2-æœ¬åœ°æ¨é€ï¼ˆLocal-Pushï¼‰" class="headerlink" title="2. æœ¬åœ°æ¨é€ï¼ˆLocal Pushï¼‰"></a>2. æœ¬åœ°æ¨é€ï¼ˆLocal Pushï¼‰</h1><ul><li><p>æ— éœ€è”ç½‘å³å¯æ¨é€</p></li><li><p>ä¸éœ€è¦åˆ›å»ºæ¨é€è¯ä¹¦</p></li></ul><h1 id="3-pushäº¤äº’ï¼ˆç¤ºä¾‹åŸºäºiOS8-0åŠä»¥ä¸Šï¼‰"><a href="#3-pushäº¤äº’ï¼ˆç¤ºä¾‹åŸºäºiOS8-0åŠä»¥ä¸Šï¼‰" class="headerlink" title="3. pushäº¤äº’ï¼ˆç¤ºä¾‹åŸºäºiOS8.0åŠä»¥ä¸Šï¼‰"></a>3. pushäº¤äº’ï¼ˆç¤ºä¾‹åŸºäºiOS8.0åŠä»¥ä¸Šï¼‰</h1><h2 id="ï¼ˆ1ï¼‰æ³¨å†Œé€šçŸ¥ï¼Œè·å–ç”¨æˆ·æˆæƒ"><a href="#ï¼ˆ1ï¼‰æ³¨å†Œé€šçŸ¥ï¼Œè·å–ç”¨æˆ·æˆæƒ" class="headerlink" title="ï¼ˆ1ï¼‰æ³¨å†Œé€šçŸ¥ï¼Œè·å–ç”¨æˆ·æˆæƒ"></a>ï¼ˆ1ï¼‰æ³¨å†Œé€šçŸ¥ï¼Œè·å–ç”¨æˆ·æˆæƒ</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœ¨AppDelegate.mä¸­</span></span><br><span class="line"><span class="comment">// iOS10.0 éœ€è¦å¯¼å…¥</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;UserNotifications/UserNotifications.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</span><br><span class="line">    [<span class="keyword">self</span> registerAPN];</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ³¨å†Œé€šçŸ¥</span></span><br><span class="line">- (<span class="keyword">void</span>)registerAPN &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (@available(iOS <span class="number">10.0</span>, *)) &#123; <span class="comment">// iOS10 ä»¥ä¸Š</span></span><br><span class="line">        UNUserNotificationCenter *center = [UNUserNotificationCenter currentNotificationCenter];</span><br><span class="line">        [center requestAuthorizationWithOptions:(UNAuthorizationOptionAlert + UNAuthorizationOptionSound) completionHandler:^(<span class="built_in">BOOL</span> granted, <span class="built_in">NSError</span> * _Nullable error) &#123;</span><br><span class="line">            </span><br><span class="line">        &#125;];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;<span class="comment">// iOS8.0 ä»¥ä¸Š</span></span><br><span class="line">        <span class="built_in">UIUserNotificationSettings</span> *setting = [<span class="built_in">UIUserNotificationSettings</span> settingsForTypes:<span class="built_in">UIUserNotificationTypeBadge</span> | <span class="built_in">UIUserNotificationTypeSound</span> | <span class="built_in">UIUserNotificationTypeAlert</span> categories:<span class="literal">nil</span>];</span><br><span class="line">        [[<span class="built_in">UIApplication</span> sharedApplication] registerUserNotificationSettings:setting];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ï¼ˆ2ï¼‰æ·»åŠ é€šçŸ¥"><a href="#ï¼ˆ2ï¼‰æ·»åŠ é€šçŸ¥" class="headerlink" title="ï¼ˆ2ï¼‰æ·»åŠ é€šçŸ¥"></a>ï¼ˆ2ï¼‰æ·»åŠ é€šçŸ¥</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)addLocalNotice &#123;</span><br><span class="line">    <span class="keyword">if</span> (@available(iOS <span class="number">10.0</span>, *)) &#123;</span><br><span class="line">        UNUserNotificationCenter *center = [UNUserNotificationCenter currentNotificationCenter];</span><br><span class="line">        UNMutableNotificationContent *content = [[UNMutableNotificationContent alloc] init];</span><br><span class="line">        <span class="comment">// æ ‡é¢˜</span></span><br><span class="line">        content.title = <span class="string">@&quot;æµ‹è¯•æ ‡é¢˜&quot;</span>;</span><br><span class="line">        content.subtitle = <span class="string">@&quot;æµ‹è¯•é€šçŸ¥å‰¯æ ‡é¢˜&quot;</span>;</span><br><span class="line">        <span class="comment">// å†…å®¹</span></span><br><span class="line">        content.body = <span class="string">@&quot;æµ‹è¯•é€šçŸ¥çš„å…·ä½“å†…å®¹&quot;</span>;</span><br><span class="line">        <span class="comment">// å£°éŸ³</span></span><br><span class="line">       <span class="comment">// é»˜è®¤å£°éŸ³</span></span><br><span class="line">     <span class="comment">//    content.sound = [UNNotificationSound defaultSound];</span></span><br><span class="line">     <span class="comment">// æ·»åŠ è‡ªå®šä¹‰å£°éŸ³</span></span><br><span class="line">       content.sound = [UNNotificationSound soundNamed:<span class="string">@&quot;Alert_ActivityGoalAttained_Salient_Haptic.caf&quot;</span>];</span><br><span class="line">        <span class="comment">// è§’æ ‡ ï¼ˆæˆ‘è¿™é‡Œæµ‹è¯•çš„è§’æ ‡æ— æ•ˆï¼Œæš‚æ—¶æ²¡æ‰¾åˆ°åŸå› ï¼‰</span></span><br><span class="line">        content.badge = @<span class="number">1</span>;</span><br><span class="line">        <span class="comment">// å¤šå°‘ç§’åå‘é€,å¯ä»¥å°†å›ºå®šçš„æ—¥æœŸè½¬åŒ–ä¸ºæ—¶é—´</span></span><br><span class="line">        <span class="built_in">NSTimeInterval</span> time = [[<span class="built_in">NSDate</span> dateWithTimeIntervalSinceNow:<span class="number">10</span>] timeIntervalSinceNow];</span><br><span class="line"><span class="comment">//        NSTimeInterval time = 10;</span></span><br><span class="line">        <span class="comment">// repeatsï¼Œæ˜¯å¦é‡å¤ï¼Œå¦‚æœé‡å¤çš„è¯æ—¶é—´å¿…é¡»å¤§äº60sï¼Œè¦ä¸ä¼šæŠ¥é”™</span></span><br><span class="line">        UNTimeIntervalNotificationTrigger *trigger = [UNTimeIntervalNotificationTrigger triggerWithTimeInterval:time repeats:<span class="literal">NO</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        //å¦‚æœæƒ³é‡å¤å¯ä»¥ä½¿ç”¨è¿™ä¸ª,æŒ‰æ—¥æœŸ</span></span><br><span class="line"><span class="comment">        // å‘¨ä¸€æ—©ä¸Š 8ï¼š00 ä¸Šç­</span></span><br><span class="line"><span class="comment">        NSDateComponents *components = [[NSDateComponents alloc] init];</span></span><br><span class="line"><span class="comment">        // æ³¨æ„ï¼Œweekdayé»˜è®¤æ˜¯ä»å‘¨æ—¥å¼€å§‹</span></span><br><span class="line"><span class="comment">        components.weekday = 2;</span></span><br><span class="line"><span class="comment">        components.hour = 8;</span></span><br><span class="line"><span class="comment">        UNCalendarNotificationTrigger *calendarTrigger = [UNCalendarNotificationTrigger triggerWithDateMatchingComponents:components repeats:YES];</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="comment">// æ·»åŠ é€šçŸ¥çš„æ ‡è¯†ç¬¦ï¼Œå¯ä»¥ç”¨äºç§»é™¤ï¼Œæ›´æ–°ç­‰æ“ä½œ</span></span><br><span class="line">        <span class="built_in">NSString</span> *identifier = <span class="string">@&quot;noticeId&quot;</span>;</span><br><span class="line">        UNNotificationRequest *request = [UNNotificationRequest requestWithIdentifier:identifier content:content trigger:trigger];</span><br><span class="line">        </span><br><span class="line">        [center addNotificationRequest:request withCompletionHandler:^(<span class="built_in">NSError</span> *_Nullable error) &#123;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;æˆåŠŸæ·»åŠ æ¨é€&quot;</span>);</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">UILocalNotification</span> *notif = [[<span class="built_in">UILocalNotification</span> alloc] init];</span><br><span class="line">        <span class="comment">// å‘å‡ºæ¨é€çš„æ—¥æœŸ</span></span><br><span class="line">        notif.fireDate = [<span class="built_in">NSDate</span> dateWithTimeIntervalSinceNow:<span class="number">10</span>];</span><br><span class="line">        <span class="comment">// æ¨é€çš„å†…å®¹</span></span><br><span class="line">        notif.alertBody = <span class="string">@&quot;ä½ å·²ç»10ç§’æ²¡å‡ºç°äº†&quot;</span>;</span><br><span class="line">        <span class="comment">// å¯ä»¥æ·»åŠ ç‰¹å®šä¿¡æ¯</span></span><br><span class="line">        notif.userInfo = @&#123;<span class="string">@&quot;noticeId&quot;</span>:<span class="string">@&quot;00001&quot;</span>&#125;;</span><br><span class="line">        <span class="comment">// è§’æ ‡</span></span><br><span class="line">        notif.applicationIconBadgeNumber = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// æç¤ºéŸ³</span></span><br><span class="line">        notif.soundName = <span class="built_in">UILocalNotificationDefaultSoundName</span>;</span><br><span class="line">        <span class="comment">// æ¯å‘¨å¾ªç¯æé†’</span></span><br><span class="line">        notif.repeatInterval = <span class="built_in">NSCalendarUnitWeekOfYear</span>;</span><br><span class="line">        </span><br><span class="line">        [[<span class="built_in">UIApplication</span> sharedApplication] scheduleLocalNotification:notif];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ï¼ˆ3ï¼‰ç§»é™¤é€šçŸ¥"><a href="#ï¼ˆ3ï¼‰ç§»é™¤é€šçŸ¥" class="headerlink" title="ï¼ˆ3ï¼‰ç§»é™¤é€šçŸ¥"></a>ï¼ˆ3ï¼‰ç§»é™¤é€šçŸ¥</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç§»é™¤æŸä¸€ä¸ªæŒ‡å®šçš„é€šçŸ¥</span></span><br><span class="line">- (<span class="keyword">void</span>)removeOneNotificationWithID:(<span class="built_in">NSString</span> *)noticeId &#123;</span><br><span class="line">    <span class="keyword">if</span> (@available(iOS <span class="number">10.0</span>, *)) &#123;</span><br><span class="line">        UNUserNotificationCenter *center = [UNUserNotificationCenter currentNotificationCenter];</span><br><span class="line">        [center getPendingNotificationRequestsWithCompletionHandler:^(<span class="built_in">NSArray</span>&lt;UNNotificationRequest *&gt; * _Nonnull requests) &#123;</span><br><span class="line">            <span class="keyword">for</span> (UNNotificationRequest *req <span class="keyword">in</span> requests)&#123;</span><br><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@&quot;å­˜åœ¨çš„ID:%@\n&quot;</span>,req.identifier);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;ç§»é™¤currentID:%@&quot;</span>,noticeId);</span><br><span class="line">        &#125;];</span><br><span class="line">        </span><br><span class="line">        [center removePendingNotificationRequestsWithIdentifiers:@[noticeId]];</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">NSArray</span> *array=[[<span class="built_in">UIApplication</span> sharedApplication] scheduledLocalNotifications];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">UILocalNotification</span> *localNotification <span class="keyword">in</span> array)&#123;</span><br><span class="line">            <span class="built_in">NSDictionary</span> *userInfo = localNotification.userInfo;</span><br><span class="line">            <span class="built_in">NSString</span> *obj = [userInfo objectForKey:<span class="string">@&quot;noticeId&quot;</span>];</span><br><span class="line">            <span class="keyword">if</span> ([obj isEqualToString:noticeId]) &#123;</span><br><span class="line">                [[<span class="built_in">UIApplication</span> sharedApplication] cancelLocalNotification:localNotification];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç§»é™¤æ‰€æœ‰é€šçŸ¥</span></span><br><span class="line">- (<span class="keyword">void</span>)removeAllNotification &#123;</span><br><span class="line">    <span class="keyword">if</span> (@available(iOS <span class="number">10.0</span>, *)) &#123;</span><br><span class="line">        UNUserNotificationCenter *center = [UNUserNotificationCenter currentNotificationCenter];</span><br><span class="line">        [center removeAllPendingNotificationRequests];</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        [[<span class="built_in">UIApplication</span> sharedApplication] cancelAllLocalNotifications];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ï¼ˆ4ï¼‰æ£€æŸ¥æˆæƒæƒ…å†µ"><a href="#ï¼ˆ4ï¼‰æ£€æŸ¥æˆæƒæƒ…å†µ" class="headerlink" title="ï¼ˆ4ï¼‰æ£€æŸ¥æˆæƒæƒ…å†µ"></a>ï¼ˆ4ï¼‰æ£€æŸ¥æˆæƒæƒ…å†µ</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)checkUserNotificationEnable &#123; <span class="comment">// åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å…è®¸æ¥æ”¶é€šçŸ¥</span></span><br><span class="line">    <span class="keyword">if</span> (@available(iOS <span class="number">10.0</span>, *)) &#123;</span><br><span class="line">        __block <span class="built_in">BOOL</span> isOn = <span class="literal">NO</span>;</span><br><span class="line">        UNUserNotificationCenter *center = [UNUserNotificationCenter currentNotificationCenter];</span><br><span class="line">        [center getNotificationSettingsWithCompletionHandler:^(UNNotificationSettings * _Nonnull settings) &#123;</span><br><span class="line">            <span class="keyword">if</span> (settings.notificationCenterSetting == UNNotificationSettingEnabled) &#123;</span><br><span class="line">                isOn = <span class="literal">YES</span>;</span><br><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@&quot;æ‰“å¼€äº†é€šçŸ¥&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                isOn = <span class="literal">NO</span>;</span><br><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@&quot;å…³é—­äº†é€šçŸ¥&quot;</span>);</span><br><span class="line">               [<span class="keyword">self</span> showAlertView];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ([[<span class="built_in">UIApplication</span> sharedApplication] currentUserNotificationSettings].types == <span class="built_in">UIUserNotificationTypeNone</span>)&#123;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;å…³é—­äº†é€šçŸ¥&quot;</span>);</span><br><span class="line">            [<span class="keyword">self</span> showAlertView];</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;æ‰“å¼€äº†é€šçŸ¥&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)showAlertView &#123;</span><br><span class="line">    <span class="built_in">UIAlertController</span> *alert = [<span class="built_in">UIAlertController</span> alertControllerWithTitle:<span class="string">@&quot;é€šçŸ¥&quot;</span> message:<span class="string">@&quot;æœªè·å¾—é€šçŸ¥æƒé™ï¼Œè¯·å‰å»è®¾ç½®&quot;</span> preferredStyle:<span class="built_in">UIAlertControllerStyleAlert</span>];</span><br><span class="line">    [alert addAction:[<span class="built_in">UIAlertAction</span> actionWithTitle:<span class="string">@&quot;å–æ¶ˆ&quot;</span> style:<span class="built_in">UIAlertActionStyleCancel</span> handler:<span class="literal">nil</span>]];</span><br><span class="line">    [alert addAction:[<span class="built_in">UIAlertAction</span> actionWithTitle:<span class="string">@&quot;è®¾ç½®&quot;</span> style:<span class="built_in">UIAlertActionStyleDefault</span> handler:^(<span class="built_in">UIAlertAction</span> * _Nonnull action) &#123;</span><br><span class="line">         [<span class="keyword">self</span> goToAppSystemSetting];</span><br><span class="line">    &#125;]];</span><br><span class="line">    [<span class="keyword">self</span> presentViewController:alert animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœç”¨æˆ·å…³é—­äº†æ¥æ”¶é€šçŸ¥åŠŸèƒ½ï¼Œè¯¥æ–¹æ³•å¯ä»¥è·³è½¬åˆ°APPè®¾ç½®é¡µé¢è¿›è¡Œä¿®æ”¹</span></span><br><span class="line">- (<span class="keyword">void</span>)goToAppSystemSetting &#123;</span><br><span class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        <span class="built_in">UIApplication</span> *application = [<span class="built_in">UIApplication</span> sharedApplication];</span><br><span class="line">        <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="built_in">UIApplicationOpenSettingsURLString</span>];</span><br><span class="line">        <span class="keyword">if</span> ([application canOpenURL:url]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (@available(iOS <span class="number">10.0</span>, *)) &#123;</span><br><span class="line">                <span class="keyword">if</span> ([application respondsToSelector:<span class="keyword">@selector</span>(openURL:options:completionHandler:)]) &#123;</span><br><span class="line">                    [application openURL:url options:@&#123;&#125; completionHandler:<span class="literal">nil</span>];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                [application openURL:url];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="4-å‚è€ƒæ–‡ç« ï¼š"><a href="#4-å‚è€ƒæ–‡ç« ï¼š" class="headerlink" title="4. å‚è€ƒæ–‡ç« ï¼š"></a>4. å‚è€ƒæ–‡ç« ï¼š</h1><blockquote><p><a href="https://www.jianshu.com/p/9b1fa25a0712">https://www.jianshu.com/p/9b1fa25a0712</a><br><a href="https://www.jianshu.com/p/4a23bd5e1b00">https://www.jianshu.com/p/4a23bd5e1b00</a></p></blockquote>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;ä¸€-å‰è¨€&quot;&gt;&lt;a href=&quot;#ä¸€-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;ä¸€. å‰è¨€&quot;&gt;&lt;/a&gt;ä¸€. å‰è¨€&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;æ¨é€æ˜¯æˆ‘ä»¬å¹³æ—¶å¼€å‘ä¸­å¸¸ç”¨çš„ä¸€ç§æœºåˆ¶ï¼Œæ— è®ºiOSè¿˜æ˜¯Androidç³»ç»Ÿéƒ½æœ‰æ¨é€ï¼Œæ¨é€å¯ä»¥è®©ä¸åœ¨å‰å°è¿è¡Œçš„app,å‘ŠçŸ¥ç”¨æˆ·appå†…éƒ¨å‘ç”Ÿçš„äº‹æƒ…ï¼Œå¯ä»¥æé«˜appçš„æ‰“å¼€æ¬¡æ•°ï¼Œå¢åŠ æ—¥æ´»ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;iOSä¸­çš„æ¨é€åˆ†ä¸º&lt;/p&gt;
&lt;p&gt;ï¼ˆ1ï¼‰æœ¬åœ°æ¨é€é€šçŸ¥(Local Notification)&lt;/p&gt;
&lt;p&gt;ï¼ˆ2ï¼‰è¿œç¨‹æ¨é€é€šçŸ¥(Remote Notification)&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨å¹³æ—¶çš„å¼€å‘ä¸­ï¼Œä½¿ç”¨è¿œç¨‹æ¨é€å¯èƒ½æ¯”è¾ƒå¤šï¼Œè¿œç¨‹æ¨é€ä¾èµ–äºæœåŠ¡å™¨ï¼Œéœ€è¦è”ç½‘æ‰èƒ½æ”¶åˆ°ï¼Œæœ¬åœ°æ¨é€æ— éœ€è”ç½‘ï¼Œæ·»åŠ å¥½å®šæ—¶å™¨å³å¯åœ¨æŒ‡å®šæ—¶é—´å‘é€æ¨é€ï¼Œå¹³æ—¶ä½¿ç”¨åœºæ™¯å¤šæ˜¯é—¹é’Ÿï¼Œæé†’ç­‰ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;2-æœ¬åœ°æ¨é€ï¼ˆLocal-Pushï¼‰&quot;&gt;&lt;a href=&quot;#2-æœ¬åœ°æ¨é€ï¼ˆLocal-Pushï¼‰&quot; class=&quot;headerlink&quot; title=&quot;2. æœ¬åœ°æ¨é€ï¼ˆLocal Pushï¼‰&quot;&gt;&lt;/a&gt;2. æœ¬åœ°æ¨é€ï¼ˆLocal Pushï¼‰&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;æ— éœ€è”ç½‘å³å¯æ¨é€&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ä¸éœ€è¦åˆ›å»ºæ¨é€è¯ä¹¦&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;3-pushäº¤äº’ï¼ˆç¤ºä¾‹åŸºäºiOS8-0åŠä»¥ä¸Šï¼‰&quot;&gt;&lt;a href=&quot;#3-pushäº¤äº’ï¼ˆç¤ºä¾‹åŸºäºiOS8-0åŠä»¥ä¸Šï¼‰&quot; class=&quot;headerlink&quot; title=&quot;3. pushäº¤äº’ï¼ˆç¤ºä¾‹åŸºäºiOS8.0åŠä»¥ä¸Šï¼‰&quot;&gt;&lt;/a&gt;3. pushäº¤äº’ï¼ˆç¤ºä¾‹åŸºäºiOS8.0åŠä»¥ä¸Šï¼‰&lt;/h1&gt;&lt;h2 id=&quot;ï¼ˆ1ï¼‰æ³¨å†Œé€šçŸ¥ï¼Œè·å–ç”¨æˆ·æˆæƒ&quot;&gt;&lt;a href=&quot;#ï¼ˆ1ï¼‰æ³¨å†Œé€šçŸ¥ï¼Œè·å–ç”¨æˆ·æˆæƒ&quot; class=&quot;headerlink&quot; title=&quot;ï¼ˆ1ï¼‰æ³¨å†Œé€šçŸ¥ï¼Œè·å–ç”¨æˆ·æˆæƒ&quot;&gt;&lt;/a&gt;ï¼ˆ1ï¼‰æ³¨å†Œé€šçŸ¥ï¼Œè·å–ç”¨æˆ·æˆæƒ&lt;/h2&gt;</summary>
    
    
    
    <category term="OC" scheme="https://forgetsou.github.io/categories/OC/"/>
    
    
    <category term="OC" scheme="https://forgetsou.github.io/tags/OC/"/>
    
    <category term="iOS" scheme="https://forgetsou.github.io/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>macOS-google gRPCçš„ç®€å•ä½¿ç”¨</title>
    <link href="https://forgetsou.github.io/2020/11/04/macOS%E5%BC%80%E5%8F%91-google-gRPC%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
    <id>https://forgetsou.github.io/2020/11/04/macOS%E5%BC%80%E5%8F%91-google-gRPC%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/</id>
    <published>2020-11-04T10:11:13.000Z</published>
    <updated>2020-11-04T10:22:13.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="google-gRPCåœ¨macOSä¸­çš„ç®€å•ä½¿ç”¨"><a href="#google-gRPCåœ¨macOSä¸­çš„ç®€å•ä½¿ç”¨" class="headerlink" title="google gRPCåœ¨macOSä¸­çš„ç®€å•ä½¿ç”¨"></a>google gRPCåœ¨macOSä¸­çš„ç®€å•ä½¿ç”¨</h1><blockquote><p><a href="http://doc.oschina.net/grpc?t=56831">gRPC å®˜æ–¹æ–‡æ¡£ä¸­æ–‡ç‰ˆ</a></p></blockquote><h2 id="1-ç®€è¿°"><a href="#1-ç®€è¿°" class="headerlink" title="1. ç®€è¿°"></a>1. ç®€è¿°</h2><blockquote><p>A high-performance, open-source universal RPC framework</p></blockquote><p><a href="http://www.oschina.net/p/grpc-framework">gRPC</a> æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€å¼€æºå’Œé€šç”¨çš„ RPC æ¡†æ¶ï¼Œé¢å‘ç§»åŠ¨å’Œ HTTP/2 è®¾è®¡ã€‚ç›®å‰æä¾› Cã€Java å’Œ Go è¯­è¨€ç‰ˆæœ¬ï¼Œåˆ†åˆ«æ˜¯ï¼šgrpc, grpc-java, grpc-go. å…¶ä¸­ C ç‰ˆæœ¬æ”¯æŒ C, C++, Node.js, Python, Ruby, Objective-C, PHP å’Œ C# æ”¯æŒã€‚</p><p>gRPC åŸºäº HTTP/2 æ ‡å‡†è®¾è®¡ï¼Œå¸¦æ¥è¯¸å¦‚åŒå‘æµã€æµæ§ã€å¤´éƒ¨å‹ç¼©ã€å• TCP è¿æ¥ä¸Šçš„å¤šå¤ç”¨è¯·æ±‚ç­‰ç‰¹ã€‚è¿™äº›ç‰¹æ€§ä½¿å¾—å…¶åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šè¡¨ç°æ›´å¥½ï¼Œæ›´çœç”µå’ŒèŠ‚çœç©ºé—´å ç”¨ã€‚</p><p>RPCï¼ˆRemote Procedure Callï¼‰è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œç®€å•çš„ç†è§£æ˜¯ä¸€ä¸ªèŠ‚ç‚¹è¯·æ±‚å¦ä¸€ä¸ªèŠ‚ç‚¹æä¾›çš„æœåŠ¡ï¼Œä½¿åº”ç”¨ç¨‹åºä¹‹é—´å¯ä»¥è¿›è¡Œé€šä¿¡ï¼Œè€Œä¸”ä¹Ÿéµå¾ªservice/clientæ¨¡å‹ã€‚åœ¨å®¢æˆ·ç«¯è°ƒç”¨serviceç«¯æä¾›çš„æ¥å£å°±åƒæ˜¯è°ƒç”¨æœ¬åœ°å‡½æ•°ä¸€æ ·ï¼Œä¸€èˆ¬ä½¿ç”¨å®¢æˆ·ç«¯å¿«é€Ÿèƒ½è·å–åˆ°æœåŠ¡å™¨æ¥å£æ•°æ®çš„æ—¶å€™ï¼Œå¦‚ï¼šå®æ—¶è¯­éŸ³è¯†åˆ«ã€ç¿»è¯‘ã€è¯­éŸ³åˆæˆç­‰ã€‚</p><p><img src="https://www.grpc.io/img/grpc_concept_diagram_00.png" alt="img"></p><p><strong>ä¸‹é¢è¯¦è§£<code>googleapis</code>é‡Œçš„gRPCçš„ä½¿ç”¨</strong></p><h2 id="2-cocopodsæ·»åŠ gRPC"><a href="#2-cocopodsæ·»åŠ gRPC" class="headerlink" title="2. cocopodsæ·»åŠ gRPC"></a>2. <code>cocopods</code>æ·»åŠ <code>gRPC</code></h2><blockquote><ul><li><a href="https://github.com/GoogleCloudPlatform/ios-docs-samples.git">ios-docs-samples</a> ä¸‹è½½googleapisåº“</li><li>æ‰¾åˆ°å¹¶å¤åˆ¶ios-docs-samples/speech-to-speechç›®å½•ä¸‹çš„googleæ–‡ä»¶å¤¹å’Œgoogleapis.podspecæ–‡ä»¶</li><li>å°†ä¸Šè¿°ä¸¤ä¸ªæ–‡ä»¶å¤åˆ¶åˆ°è‡ªå·±å·¥ç¨‹ä¸»ç›®å½•</li><li>cd åˆ°è‡ªå·±å·¥ç¨‹</li><li>pod install â€“verbose æˆ– pod update â€“verbose (è¿‡ç¨‹è¾ƒæ…¢ï¼Œéœ€è¦ç¿»å¢™)</li></ul></blockquote><h2 id="3-ç¤ºä¾‹"><a href="#3-ç¤ºä¾‹" class="headerlink" title="3. ç¤ºä¾‹"></a>3. ç¤ºä¾‹</h2><p>å®¢æˆ·ç«¯ä»£ç ã€ä¸ä¼šæœåŠ¡å™¨&lt;å¯ä»¥è‡ªè¡Œç ”ç©¶&gt;</p><p><a href="https://github.com/GoogleCloudPlatform">google å®˜æ–¹API</a></p><h3 id="3-1-è¯­éŸ³è¯†åˆ«"><a href="#3-1-è¯­éŸ³è¯†åˆ«" class="headerlink" title="3.1 è¯­éŸ³è¯†åˆ«"></a>3.1 è¯­éŸ³è¯†åˆ«</h3><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  ZDASRService.h</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;google/cloud/speech/v1p1beta1/CloudSpeech.pbobjc.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NS_ASSUME_NONNULL_BEGIN</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">void</span> (^SpeechRecognitionCompletionHandler)(<span class="built_in">BOOL</span> done, StreamingRecognizeResponse *object, <span class="built_in">NSError</span> *error);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ZDASRService</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)streamAudioData:(<span class="built_in">NSData</span> *)audioData</span><br><span class="line">           languageCode:(<span class="built_in">NSString</span> *)languageCode</span><br><span class="line">         withCompletion:(SpeechRecognitionCompletionHandler)completion;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)stopStreaming;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)isStreaming;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">//  ZDASRService.m</span></span><br><span class="line"><span class="built_in">NS_ASSUME_NONNULL_END</span></span><br><span class="line">  </span><br><span class="line"> <span class="meta">#import <span class="meta-string">&quot;ZDASRService.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;GRPCClient/GRPCCall.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;RxLibrary/GRXBufferedPipe.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;ProtoRPC/ProtoRPC.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;google/cloud/speech/v1p1beta1/CloudSpeech.pbrpc.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ZDASRService</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Speech *client;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) GRXBufferedPipe *writer;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) GRPCProtoCall *call;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> streaming;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ZDASRService</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)init &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        [<span class="keyword">self</span> defaultSetting];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)defaultSetting &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)streamAudioData:(<span class="built_in">NSData</span> *)audioData</span><br><span class="line">           languageCode:(<span class="built_in">NSString</span> *)languageCode</span><br><span class="line">         withCompletion:(SpeechRecognitionCompletionHandler)completion &#123;</span><br><span class="line">    <span class="keyword">if</span> (!_streaming) &#123;</span><br><span class="line">        _client = [[Speech alloc] initWithHost:[ZDDogAPIService shared].dogApis];</span><br><span class="line">        _writer = [[GRXBufferedPipe alloc] init];</span><br><span class="line">        _call = [_client RPCToStreamingRecognizeWithRequestsWriter:_writer eventHandler:^(<span class="built_in">BOOL</span> done, StreamingRecognizeResponse * _Nullable response, <span class="built_in">NSError</span> * _Nullable error) &#123;</span><br><span class="line">            completion(done, response, error);</span><br><span class="line">        &#125;];</span><br><span class="line">        _call.requestHeaders[<span class="string">@&quot;Authorization&quot;</span>] = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;Bearer %@&quot;</span>, [[<span class="built_in">NSUserDefaults</span> standardUserDefaults] valueForKey:kDeviceTokenKey]];</span><br><span class="line">        _call.requestHeaders[<span class="string">@&quot;appId&quot;</span>] = kAppId;</span><br><span class="line">        _call.requestHeaders[<span class="string">@&quot;userId&quot;</span>] = [[<span class="built_in">NSUserDefaults</span> standardUserDefaults] valueForKey:kUserId];</span><br><span class="line">        [_call start];</span><br><span class="line">        _streaming = <span class="literal">YES</span>;</span><br><span class="line">        </span><br><span class="line">        RecognitionConfig *recognitionConfig = [RecognitionConfig message];</span><br><span class="line">        recognitionConfig.encoding = RecognitionConfig_AudioEncoding_Linear16;</span><br><span class="line">        recognitionConfig.sampleRateHertz = <span class="number">16000</span>;</span><br><span class="line">        recognitionConfig.languageCode = languageCode;</span><br><span class="line">        recognitionConfig.maxAlternatives = <span class="number">30</span>;</span><br><span class="line">        recognitionConfig.enableAutomaticPunctuation = <span class="literal">YES</span>;</span><br><span class="line">        recognitionConfig.audioChannelCount = <span class="number">1</span>;</span><br><span class="line">        </span><br><span class="line">        StreamingRecognitionConfig *streamingRecognitionConfig = [StreamingRecognitionConfig message];</span><br><span class="line">        streamingRecognitionConfig.config = recognitionConfig;</span><br><span class="line">        streamingRecognitionConfig.singleUtterance = <span class="literal">NO</span>;</span><br><span class="line">        streamingRecognitionConfig.interimResults = <span class="literal">YES</span>;</span><br><span class="line">        </span><br><span class="line">        StreamingRecognizeRequest *streamingRecognizeRequest = [StreamingRecognizeRequest message];</span><br><span class="line">        streamingRecognizeRequest.streamingConfig = streamingRecognitionConfig;</span><br><span class="line">        [_writer writeValue:streamingRecognizeRequest];</span><br><span class="line">    &#125;</span><br><span class="line">    StreamingRecognizeRequest *streamingRecognizeRequest = [StreamingRecognizeRequest message];</span><br><span class="line">    streamingRecognizeRequest.audioContent = audioData;</span><br><span class="line">    [_writer writeValue:streamingRecognizeRequest];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)stopStreaming &#123;</span><br><span class="line">    <span class="keyword">if</span> (!_streaming) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    StreamingRecognizeRequest *streamingRecognizeRequest = [StreamingRecognizeRequest message];</span><br><span class="line">    streamingRecognizeRequest.audioContent = [<span class="built_in">NSData</span> data];</span><br><span class="line">    [_writer writeValue:streamingRecognizeRequest];</span><br><span class="line">    [_writer finishWithError:<span class="literal">nil</span>];</span><br><span class="line">    _streaming = <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)isStreaming &#123;</span><br><span class="line">    <span class="keyword">return</span> _streaming;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><h3 id="3-2-è¯­éŸ³åˆæˆ"><a href="#3-2-è¯­éŸ³åˆæˆ" class="headerlink" title="3.2 è¯­éŸ³åˆæˆ"></a>3.2 è¯­éŸ³åˆæˆ</h3><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  ZDTTSService.h</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;google/cloud/texttospeech/v1beta1/CloudTts.pbobjc.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NS_ASSUME_NONNULL_BEGIN</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">void</span> (^TTSRecognitionCompletionHandler)(<span class="built_in">NSData</span> *__<span class="keyword">nullable</span> data, <span class="built_in">NSString</span> *__<span class="keyword">nullable</span> error);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ZDTTSService</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)ttsRecognition:(<span class="built_in">NSString</span> *)text</span><br><span class="line">              language:(<span class="built_in">NSString</span> *)language</span><br><span class="line">     completionHandler:(TTSRecognitionCompletionHandler)handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NS_ASSUME_NONNULL_END</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">//  ZDTTSService.m</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;ZDTTSService.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;RxLibrary/GRXBufferedPipe.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;AVFoundation/AVFoundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;google/cloud/texttospeech/v1beta1/CloudTts.pbrpc.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ZDTTSService</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) TextToSpeech *client;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) GRXBufferedPipe *writer;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) GRPCProtoCall *call;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">BOOL</span> mGoogleTimeout;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ZDTTSService</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)init &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        [<span class="keyword">self</span> defaultSetting];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)defaultSetting &#123;</span><br><span class="line">    <span class="keyword">self</span>.mGoogleTimeout = <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)ttsRecognition:(<span class="built_in">NSString</span> *)text</span><br><span class="line">              language:(<span class="keyword">nonnull</span> <span class="built_in">NSString</span> *)language</span><br><span class="line">     completionHandler:(TTSRecognitionCompletionHandler)handler &#123;</span><br><span class="line">    <span class="built_in">NSArray</span> *sIflyteks = @[<span class="string">@&quot;zh-CN&quot;</span>, <span class="string">@&quot;zh-TW&quot;</span>, <span class="string">@&quot;zh-HK&quot;</span>];</span><br><span class="line">    <span class="built_in">NSArray</span> *sMicrosofts = @[<span class="string">@&quot;ms-MY&quot;</span>, <span class="string">@&quot;bg-BG&quot;</span>, <span class="string">@&quot;sl-SI&quot;</span>, <span class="string">@&quot;he_IL&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> ([sIflyteks containsObject:language] || [sMicrosofts containsObject:language] || <span class="keyword">self</span>.mGoogleTimeout) &#123;</span><br><span class="line">        [<span class="keyword">self</span> ttsDogRecognition:text language:language completionHandler:handler];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        [<span class="keyword">self</span> ttsGoogleRecognition:text language:language completionHandler:handler];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// google apiåˆæˆ</span></span><br><span class="line">- (<span class="keyword">void</span>)ttsGoogleRecognition:(<span class="built_in">NSString</span> *)text</span><br><span class="line">                    language:(<span class="built_in">NSString</span> *)language</span><br><span class="line">           completionHandler:(TTSRecognitionCompletionHandler)handler &#123;</span><br><span class="line">    text = [text stringByAddingPercentEncodingWithAllowedCharacters:[<span class="built_in">NSCharacterSet</span> URLQueryAllowedCharacterSet]];</span><br><span class="line">    <span class="built_in">NSMutableString</span> *urlString = [<span class="built_in">NSMutableString</span> stringWithString:[ZDDogAPIService shared].mGoogleUrl];</span><br><span class="line">    [urlString appendFormat:<span class="string">@&quot;&amp;total=1&quot;</span>];</span><br><span class="line">    [urlString appendFormat:<span class="string">@&quot;&amp;idx=0&quot;</span>];</span><br><span class="line">    [urlString appendFormat:<span class="string">@&quot;&amp;textlen=%lu&quot;</span>, (<span class="keyword">unsigned</span> <span class="keyword">long</span>)text.length];</span><br><span class="line">    [urlString appendFormat:<span class="string">@&quot;&amp;q=%@&quot;</span>, text];</span><br><span class="line">    [urlString appendFormat:<span class="string">@&quot;&amp;tl=%@&quot;</span>, language];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSMutableURLRequest</span> *request = [<span class="built_in">NSMutableURLRequest</span> requestWithURL:[<span class="built_in">NSURL</span> URLWithString:urlString]</span><br><span class="line">                                                           cachePolicy:<span class="built_in">NSURLRequestUseProtocolCachePolicy</span></span><br><span class="line">                                                       timeoutInterval:<span class="number">10.0</span>];</span><br><span class="line">    [request setHTTPMethod:<span class="string">@&quot;GET&quot;</span>];</span><br><span class="line">    <span class="built_in">NSURLSession</span> *session = [<span class="built_in">NSURLSession</span> sharedSession];</span><br><span class="line">    <span class="built_in">NSURLSessionDataTask</span> *dataTask = [session dataTaskWithRequest:request</span><br><span class="line">                                                completionHandler:^(<span class="built_in">NSData</span> *data, <span class="built_in">NSURLResponse</span> *response, <span class="built_in">NSError</span> *error) &#123;</span><br><span class="line">                                                    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">                                                        <span class="keyword">if</span> (error.code == <span class="number">-1001</span>) &#123;</span><br><span class="line">                                                            <span class="keyword">self</span>.mGoogleTimeout = <span class="literal">YES</span>;</span><br><span class="line">                                                        &#125;</span><br><span class="line">                                                        handler(<span class="literal">nil</span>, error.localizedDescription);</span><br><span class="line">                                                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                                        <span class="built_in">NSHTTPURLResponse</span> *httpResponse = (<span class="built_in">NSHTTPURLResponse</span> *) response;</span><br><span class="line">                                                        <span class="keyword">if</span> (httpResponse.statusCode == <span class="number">200</span>) &#123;</span><br><span class="line">                                                            handler(data, <span class="string">@&quot;&quot;</span>);</span><br><span class="line">                                                        &#125;</span><br><span class="line">                                                    &#125;</span><br><span class="line">                                                &#125;];</span><br><span class="line">    [dataTask resume];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// dog RPC</span></span><br><span class="line">- (<span class="keyword">void</span>)ttsDogRecognition:(<span class="built_in">NSString</span> *)text</span><br><span class="line">             language:(<span class="built_in">NSString</span> *)language</span><br><span class="line">        completionHandler:(TTSRecognitionCompletionHandler)handler &#123;</span><br><span class="line">    _client = [[TextToSpeech alloc] initWithHost:[ZDDogAPIService shared].dogApis];</span><br><span class="line">    _writer = [[GRXBufferedPipe alloc] init];</span><br><span class="line">        </span><br><span class="line">    SynthesisInput *input = [[SynthesisInput alloc] init];</span><br><span class="line">    input.text = text;</span><br><span class="line"></span><br><span class="line">    VoiceSelectionParams *params = [[VoiceSelectionParams alloc] init];</span><br><span class="line">    params.languageCode =  language;</span><br><span class="line">    params.ssmlGender = SsmlVoiceGender_Female;</span><br><span class="line">    </span><br><span class="line">    AudioConfig *config = [[AudioConfig alloc] init];</span><br><span class="line">    config.audioEncoding = AudioEncoding_Mp3;</span><br><span class="line">    </span><br><span class="line">    SynthesizeSpeechRequest *speechRequest = [[SynthesizeSpeechRequest alloc] init];</span><br><span class="line">    speechRequest.audioConfig = config;</span><br><span class="line">    speechRequest.input = input;</span><br><span class="line">    speechRequest.voice = params;</span><br><span class="line">    </span><br><span class="line">    _call = [_client RPCToSynthesizeSpeechWithRequest:speechRequest handler:^(SynthesizeSpeechResponse * _Nullable response, <span class="built_in">NSError</span> * _Nullable error) &#123;</span><br><span class="line">        handler(response.audioContent, error.localizedDescription);</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    _call.requestHeaders[<span class="string">@&quot;Authorization&quot;</span>] = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;Bearer %@&quot;</span>, [[<span class="built_in">NSUserDefaults</span> standardUserDefaults] valueForKey:kDeviceTokenKey]];</span><br><span class="line">    _call.requestHeaders[<span class="string">@&quot;appId&quot;</span>] = kAppId;</span><br><span class="line">    [_call start];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><h3 id="3-3-ç¿»è¯‘"><a href="#3-3-ç¿»è¯‘" class="headerlink" title="3.3 ç¿»è¯‘"></a>3.3 ç¿»è¯‘</h3><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  ZDTranslateService.h</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;google/cloud/translate/v3beta1/TranslationService.pbobjc.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NS_ASSUME_NONNULL_BEGIN</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">void</span> (^TranslationCompletionHandler)(TranslateTextResponse *object, <span class="built_in">NSError</span> *error);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ZDTranslateService</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)translateText:(<span class="built_in">NSString</span> *)text</span><br><span class="line">            sourceLan:(<span class="built_in">NSString</span> *)sourceLan</span><br><span class="line">            targetLan:(<span class="built_in">NSString</span> *)targetLan</span><br><span class="line">    completionHandler:(TranslationCompletionHandler)handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NS_ASSUME_NONNULL_END</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">//  ZDTranslateService.m</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;ZDTranslateService.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;google/cloud/translate/v3beta1/TranslationService.pbrpc.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ZDTranslateService</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) TranslationService *client;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) GRPCProtoCall *call;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ZDTranslateService</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)init &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        [<span class="keyword">self</span> defaultSetting];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)defaultSetting &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)translateText:(<span class="built_in">NSString</span> *)text</span><br><span class="line">            sourceLan:(<span class="built_in">NSString</span> *)sourceLan</span><br><span class="line">            targetLan:(<span class="built_in">NSString</span> *)targetLan</span><br><span class="line">    completionHandler:(TranslationCompletionHandler)handler &#123;</span><br><span class="line">    _client = [[TranslationService alloc] initWithHost:[ZDDogAPIService shared].dogApis];</span><br><span class="line">    TranslateTextRequest *translateRequest = [[TranslateTextRequest alloc] init];</span><br><span class="line">    translateRequest.contentsArray = [<span class="built_in">NSMutableArray</span> arrayWithArray:@[text]];</span><br><span class="line">    translateRequest.mimeType = <span class="string">@&quot;text/plain&quot;</span>;</span><br><span class="line">    translateRequest.sourceLanguageCode = sourceLan;</span><br><span class="line">    translateRequest.targetLanguageCode = targetLan;</span><br><span class="line">    </span><br><span class="line">    _call = [_client RPCToTranslateTextWithRequest:translateRequest handler:^(TranslateTextResponse * _Nullable response, <span class="built_in">NSError</span> * _Nullable error) &#123;</span><br><span class="line">        handler(response, error);</span><br><span class="line">    &#125;];</span><br><span class="line">    _call.requestHeaders[<span class="string">@&quot;Authorization&quot;</span>] = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;Bearer %@&quot;</span>, [[<span class="built_in">NSUserDefaults</span> standardUserDefaults] valueForKey:kDeviceTokenKey]];</span><br><span class="line">    _call.requestHeaders[<span class="string">@&quot;appId&quot;</span>] = kAppId;</span><br><span class="line">    _call.requestHeaders[<span class="string">@&quot;userId&quot;</span>] = [[<span class="built_in">NSUserDefaults</span> standardUserDefaults] valueForKey:kUserId];</span><br><span class="line">    [_call start];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;google-gRPCåœ¨macOSä¸­çš„ç®€å•ä½¿ç”¨&quot;&gt;&lt;a href=&quot;#google-gRPCåœ¨macOSä¸­çš„ç®€å•ä½¿ç”¨&quot; class=&quot;headerlink&quot; title=&quot;google gRPCåœ¨macOSä¸­çš„ç®€å•ä½¿ç”¨&quot;&gt;&lt;/a&gt;google gRPCåœ¨macOSä¸­çš„ç®€å•ä½¿ç”¨&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;http://doc.oschina.net/grpc?t=56831&quot;&gt;gRPC å®˜æ–¹æ–‡æ¡£ä¸­æ–‡ç‰ˆ&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;1-ç®€è¿°&quot;&gt;&lt;a href=&quot;#1-ç®€è¿°&quot; class=&quot;headerlink&quot; title=&quot;1. ç®€è¿°&quot;&gt;&lt;/a&gt;1. ç®€è¿°&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;A high-performance, open-source universal RPC framework&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;http://www.oschina.net/p/grpc-framework&quot;&gt;gRPC&lt;/a&gt; æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€å¼€æºå’Œé€šç”¨çš„ RPC æ¡†æ¶ï¼Œé¢å‘ç§»åŠ¨å’Œ HTTP/2 è®¾è®¡ã€‚ç›®å‰æä¾› Cã€Java å’Œ Go è¯­è¨€ç‰ˆæœ¬ï¼Œåˆ†åˆ«æ˜¯ï¼šgrpc, grpc-java, grpc-go. å…¶ä¸­ C ç‰ˆæœ¬æ”¯æŒ C, C++, Node.js, Python, Ruby, Objective-C, PHP å’Œ C# æ”¯æŒã€‚&lt;/p&gt;
&lt;p&gt;gRPC åŸºäº HTTP/2 æ ‡å‡†è®¾è®¡ï¼Œå¸¦æ¥è¯¸å¦‚åŒå‘æµã€æµæ§ã€å¤´éƒ¨å‹ç¼©ã€å• TCP è¿æ¥ä¸Šçš„å¤šå¤ç”¨è¯·æ±‚ç­‰ç‰¹ã€‚è¿™äº›ç‰¹æ€§ä½¿å¾—å…¶åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šè¡¨ç°æ›´å¥½ï¼Œæ›´çœç”µå’ŒèŠ‚çœç©ºé—´å ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;RPCï¼ˆRemote Procedure Callï¼‰è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œç®€å•çš„ç†è§£æ˜¯ä¸€ä¸ªèŠ‚ç‚¹è¯·æ±‚å¦ä¸€ä¸ªèŠ‚ç‚¹æä¾›çš„æœåŠ¡ï¼Œä½¿åº”ç”¨ç¨‹åºä¹‹é—´å¯ä»¥è¿›è¡Œé€šä¿¡ï¼Œè€Œä¸”ä¹Ÿéµå¾ªservice/clientæ¨¡å‹ã€‚åœ¨å®¢æˆ·ç«¯è°ƒç”¨serviceç«¯æä¾›çš„æ¥å£å°±åƒæ˜¯è°ƒç”¨æœ¬åœ°å‡½æ•°ä¸€æ ·ï¼Œä¸€èˆ¬ä½¿ç”¨å®¢æˆ·ç«¯å¿«é€Ÿèƒ½è·å–åˆ°æœåŠ¡å™¨æ¥å£æ•°æ®çš„æ—¶å€™ï¼Œå¦‚ï¼šå®æ—¶è¯­éŸ³è¯†åˆ«ã€ç¿»è¯‘ã€è¯­éŸ³åˆæˆç­‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.grpc.io/img/grpc_concept_diagram_00.png&quot; alt=&quot;img&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸‹é¢è¯¦è§£&lt;code&gt;googleapis&lt;/code&gt;é‡Œçš„gRPCçš„ä½¿ç”¨&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&quot;2-cocopodsæ·»åŠ gRPC&quot;&gt;&lt;a href=&quot;#2-cocopodsæ·»åŠ gRPC&quot; class=&quot;headerlink&quot; title=&quot;2. cocopodsæ·»åŠ gRPC&quot;&gt;&lt;/a&gt;2. &lt;code&gt;cocopods&lt;/code&gt;æ·»åŠ &lt;code&gt;gRPC&lt;/code&gt;&lt;/h2&gt;</summary>
    
    
    
    <category term="OC" scheme="https://forgetsou.github.io/categories/OC/"/>
    
    
    <category term="OC" scheme="https://forgetsou.github.io/tags/OC/"/>
    
    <category term="macOS" scheme="https://forgetsou.github.io/tags/macOS/"/>
    
    <category term="google" scheme="https://forgetsou.github.io/tags/google/"/>
    
    <category term="gPRC" scheme="https://forgetsou.github.io/tags/gPRC/"/>
    
  </entry>
  
  <entry>
    <title>macOSå¼€å‘-NSSplitView</title>
    <link href="https://forgetsou.github.io/2020/11/03/macOS%E5%BC%80%E5%8F%91-NSSplitView/"/>
    <id>https://forgetsou.github.io/2020/11/03/macOS%E5%BC%80%E5%8F%91-NSSplitView/</id>
    <published>2020-11-03T08:26:55.000Z</published>
    <updated>2020-11-03T08:26:55.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸€-ç®€è¿°"><a href="#ä¸€-ç®€è¿°" class="headerlink" title="ä¸€. ç®€è¿°"></a>ä¸€. ç®€è¿°</h1><p><strong>æ‹†åˆ†è§†å›¾</strong>ï¼Œåœ¨æ°´å¹³æˆ–å‚ç›´è¿è¡Œçš„çº¿æ€§å †æ ˆä¸­æ’åˆ—ä¸¤ä¸ªæˆ–å¤šä¸ªè§†å›¾çš„è§†å›¾ã€‚</p><p>é»˜è®¤ä¸ºæ°´å¹³æ–¹å‘</p><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSSplitView</span> : <span class="title">NSView</span></span></span><br></pre></td></tr></table></figure><h1 id="äºŒ-å®˜æ–¹å±æ€§æ–¹æ³•"><a href="#äºŒ-å®˜æ–¹å±æ€§æ–¹æ³•" class="headerlink" title="äºŒ. å®˜æ–¹å±æ€§æ–¹æ³•"></a>äºŒ. å®˜æ–¹å±æ€§æ–¹æ³•</h1><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä»£ç†</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">weak</span>) <span class="keyword">id</span>&lt;<span class="built_in">NSSplitViewDelegate</span>&gt; delegate;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)splitView:(<span class="built_in">NSSplitView</span> *)splitView canCollapseSubview:(<span class="built_in">NSView</span> *)subview; <span class="comment">// æ˜¯å¦å…è®¸ç”¨æˆ·å¯ä»¥æŠ˜å å’Œå±•å¼€æŒ‡å®šå­è§†å›¾</span></span><br><span class="line">- (<span class="keyword">void</span>)splitView:(<span class="built_in">NSSplitView</span> *)splitView resizeSubviewsWithOldSize:(<span class="built_in">NSSize</span>)oldSize; <span class="comment">// å­è§†å›¾æŒ‰è‡ªå®šä¹‰å¤§å°</span></span><br><span class="line">- (<span class="keyword">void</span>)splitViewWillResizeSubviews:(<span class="built_in">NSNotification</span> *)notification;<span class="comment">// å³å°†è°ƒæ•´å­è§†å›¾å¤§å°æ—¶çš„é€šçŸ¥å§”æ‰˜</span></span><br><span class="line">- (<span class="keyword">void</span>)splitViewDidResizeSubviews:(<span class="built_in">NSNotification</span> *)notification;<span class="comment">// è°ƒæ•´å­è§†å›¾å¤§å°æ—¶çš„é€šçŸ¥å§”æ‰˜</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)splitView:(<span class="built_in">NSSplitView</span> *)splitView canCollapseSubview:(<span class="built_in">NSView</span> *)subview;<span class="comment">// æ˜¯å¦è°ƒæ•´å­è§†å›¾çš„å¤§å°</span></span><br><span class="line"> </span><br><span class="line">- (<span class="built_in">CGFloat</span>)splitView:(<span class="built_in">NSSplitView</span> *)splitView constrainMinCoordinate:(<span class="built_in">CGFloat</span>)proposedMinimumPosition ofSubviewAt:(<span class="built_in">NSInteger</span>)dividerIndex; <span class="comment">// å…è®¸å§”æ‰˜äººåœ¨ç”¨æˆ·æ‹–åŠ¨åˆ†éš”çº¿æ—¶é™åˆ¶å…¶æœ€å°åæ ‡é™åˆ¶ã€‚</span></span><br><span class="line">- (<span class="built_in">CGFloat</span>)splitView:(<span class="built_in">NSSplitView</span> *)splitView constrainMaxCoordinate:(<span class="built_in">CGFloat</span>)proposedMaximumPosition ofSubviewAt:(<span class="built_in">NSInteger</span>)dividerIndex; <span class="comment">// å…è®¸å§”æ‰˜äººåœ¨ç”¨æˆ·æ‹–åŠ¨åˆ†éš”çº¿æ—¶é™åˆ¶å…¶æœ€å°åæ ‡é™åˆ¶ã€‚</span></span><br><span class="line">- (<span class="built_in">CGFloat</span>)splitView:(<span class="built_in">NSSplitView</span> *)splitView constrainSplitPosition:(<span class="built_in">CGFloat</span>)proposedPosition ofSubviewAt:(<span class="built_in">NSInteger</span>)dividerIndex; <span class="comment">// å…è®¸ä»£è¡¨å°†åˆ†éš”çº¿é™åˆ¶åœ¨æŸäº›ä½ç½®ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å­è§†å›¾</span></span><br><span class="line"><span class="keyword">@property</span> <span class="built_in">BOOL</span> arrangesAllSubviews API_AVAILABLE(macos(<span class="number">10.11</span>)); <span class="comment">// æ˜¯å¦å°†æ‰€æœ‰å­è§†å›¾æ’åˆ—ä¸ºæ‹†åˆ†çª—æ ¼</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="built_in">NSArray</span>&lt;__kindof <span class="built_in">NSView</span> *&gt; *arrangedSubviews API_AVAILABLE(macos(<span class="number">10.11</span>)); <span class="comment">// æ‹†åˆ†è§†å›¾ä½œä¸ºæ‹†åˆ†çª—æ ¼æ’åˆ—çš„è§†å›¾æ•°ç»„</span></span><br><span class="line">- (<span class="keyword">void</span>)addArrangedSubview:(<span class="built_in">NSView</span> *)view API_AVAILABLE(macos(<span class="number">10.11</span>));<span class="comment">// æ·»åŠ æ‹†åˆ†çª—æ ¼</span></span><br><span class="line">- (<span class="keyword">void</span>)insertArrangedSubview:(<span class="built_in">NSView</span> *)view atIndex:(<span class="built_in">NSInteger</span>)index API_AVAILABLE(macos(<span class="number">10.11</span>)); <span class="comment">// å°†æ‹†åˆ†çª—æ ¼æ’å…¥åˆ°æŒ‡å®šçš„ç´¢å¼•å¤„</span></span><br><span class="line">- (<span class="keyword">void</span>)removeArrangedSubview:(<span class="built_in">NSView</span> *)view API_AVAILABLE(macos(<span class="number">10.11</span>));<span class="comment">// åˆ é™¤å·²æ’åˆ—çš„æ‹†åˆ†çª—æ ¼</span></span><br><span class="line">- (<span class="keyword">void</span>)adjustSubviews; <span class="comment">// è°ƒæ•´å­è§†å›¾å¤§å°</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)isSubviewCollapsed:(<span class="built_in">NSView</span> *)subview;<span class="comment">// è¿”å›æ˜¯å¦å¤„äºæŠ˜å çŠ¶æ€</span></span><br><span class="line">- (<span class="built_in">NSLayoutPriority</span>)holdingPriorityForSubviewAtIndex:(<span class="built_in">NSInteger</span>)subviewIndex API_AVAILABLE(macos(<span class="number">10.8</span>)); <span class="comment">// è°ƒæ•´å­è§†å›¾å¤§å°æ—¶ï¼Œè¿”å›å®½åº¦æˆ–é«˜åº¦çš„ä¼˜å…ˆçº§</span></span><br><span class="line">- (<span class="keyword">void</span>)setHoldingPriority:(<span class="built_in">NSLayoutPriority</span>)priority forSubviewAtIndex:(<span class="built_in">NSInteger</span>)subviewIndex API_AVAILABLE(macos(<span class="number">10.8</span>)); <span class="comment">// è®¾ç½®å­è§†å›¾ä¼˜å…ˆçº§</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">copy</span>) <span class="built_in">NSSplitViewAutosaveName</span> autosaveName API_AVAILABLE(macos(<span class="number">10.5</span>)); <span class="comment">// ç³»ç»Ÿè‡ªåŠ¨ä¿å­˜æ‹†åˆ†è§†å›¾çš„åˆ†éš”å™¨é…ç½®æ—¶ä½¿ç”¨çš„åç§°ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‹†åˆ†è§†å›¾æ–¹å‘</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">getter</span>=isVertical) <span class="built_in">BOOL</span> vertical; <span class="comment">// ç¡®å®šæ‹†åˆ†è§†å›¾åˆ†å‰²çº¿æ–¹å‘</span></span><br><span class="line"><span class="keyword">@property</span> <span class="built_in">NSSplitViewDividerStyle</span> dividerStyle API_AVAILABLE(macos(<span class="number">10.5</span>)); <span class="comment">// åˆ†å‰²çº¿æ ·å¼,å¦‚ä¸‹</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, <span class="built_in">NSSplitViewDividerStyle</span>) &#123;</span><br><span class="line">    <span class="built_in">NSSplitViewDividerStyleThick</span> = <span class="number">1</span>,</span><br><span class="line">    <span class="built_in">NSSplitViewDividerStyleThin</span> = <span class="number">2</span>,</span><br><span class="line">    <span class="built_in">NSSplitViewDividerStylePaneSplitter</span> API_AVAILABLE(macos(<span class="number">10.6</span>)) = <span class="number">3</span>,</span><br><span class="line">&#125; API_AVAILABLE(macos(<span class="number">10.5</span>));</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="built_in">NSColor</span> *dividerColor API_AVAILABLE(macos(<span class="number">10.5</span>)); <span class="comment">// åˆ†å‰²çº¿é¢œè‰²</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="built_in">CGFloat</span> dividerThickness; <span class="comment">// åˆ†å‰²çº¿åšåº¦</span></span><br><span class="line">- (<span class="keyword">void</span>)drawDividerInRect:(<span class="built_in">NSRect</span>)rect; <span class="comment">// ç»˜åˆ¶åˆ†å‰²çº¿</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é™åˆ¶æ‹†åˆ†ä½ç½®&lt;å·¦å³(æˆ–ä¸Šä¸‹)å¯æ»‘åŠ¨åŒºåŸŸ&gt;</span></span><br><span class="line">- (<span class="built_in">CGFloat</span>)minPossiblePositionOfDividerAtIndex:(<span class="built_in">NSInteger</span>)dividerIndex API_AVAILABLE(macos(<span class="number">10.5</span>)); <span class="comment">// ç´¢å¼•å¤„æœ€å°ä½ç½® </span></span><br><span class="line">- (<span class="built_in">CGFloat</span>)maxPossiblePositionOfDividerAtIndex:(<span class="built_in">NSInteger</span>)dividerIndex API_AVAILABLE(macos(<span class="number">10.5</span>)); <span class="comment">// ç´¢å¼•å¤„æœ€å¤§ä½ç½®</span></span><br><span class="line">- (<span class="keyword">void</span>)setPosition:(<span class="built_in">CGFloat</span>)position ofDividerAtIndex:(<span class="built_in">NSInteger</span>)dividerIndex API_AVAILABLE(macos(<span class="number">10.5</span>)); <span class="comment">// è®¾ç½®åˆ†å‰²çº¿åœ¨æŒ‡å®šç´¢å¼•å¤„çš„ä½ç½®</span></span><br></pre></td></tr></table></figure><h1 id="ä¸‰-ç¤ºä¾‹-lt-ä»£ç -gt"><a href="#ä¸‰-ç¤ºä¾‹-lt-ä»£ç -gt" class="headerlink" title="ä¸‰. ç¤ºä¾‹&lt;ä»£ç &gt;"></a>ä¸‰. ç¤ºä¾‹&lt;ä»£ç &gt;</h1><p>ä½¿ç”¨ä»£ç åˆ›å»º<code>NSSplitView</code>ï¼Œæƒ³è¦ç”¨<code>Storyboard</code>åˆ›å»ºçš„è‡ªè¡Œç ”ç©¶ï¼Œæ¯”è¾ƒç®€å•</p><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">- (<span class="built_in">NSSplitView</span> *)splitView &#123;</span><br><span class="line">    <span class="keyword">if</span> (!_splitView) &#123;</span><br><span class="line">        _splitView = [[<span class="built_in">NSSplitView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">100</span>, <span class="number">600</span>, <span class="number">400</span>)];</span><br><span class="line">        _splitView.delegate = <span class="keyword">self</span>;</span><br><span class="line">        _splitView.vertical = <span class="literal">YES</span>;</span><br><span class="line">        _splitView.dividerStyle = <span class="built_in">NSSplitViewDividerStylePaneSplitter</span>;</span><br><span class="line">        _splitView.wantsLayer = <span class="literal">YES</span>;</span><br><span class="line">        _splitView.layer.backgroundColor = <span class="built_in">NSColor</span>.whiteColor.CGColor;</span><br><span class="line">        _splitView.toolTip = <span class="string">@&quot;ä»£ç åˆ›å»ºSplitView&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _splitView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do view setup here.</span></span><br><span class="line">    <span class="keyword">self</span>.view.wantsLayer = <span class="literal">YES</span>;</span><br><span class="line">    <span class="keyword">self</span>.view.layer.backgroundColor = <span class="built_in">NSColor</span>.lightGrayColor.CGColor;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span> addSplitView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)addSplitView &#123;</span><br><span class="line">    <span class="built_in">NSView</span> *leftView = [[<span class="built_in">NSView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">400</span>)];</span><br><span class="line">    [<span class="keyword">self</span>.splitView addArrangedSubview:leftView];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSView</span> *rightView = [[<span class="built_in">NSView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">0</span>, <span class="number">500</span>, <span class="number">400</span>)];</span><br><span class="line">    [<span class="keyword">self</span>.splitView addArrangedSubview:rightView];</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.splitView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">CGFloat</span>)splitView:(<span class="built_in">NSSplitView</span> *)splitView constrainMinCoordinate:(<span class="built_in">CGFloat</span>)proposedMinimumPosition ofSubviewAt:(<span class="built_in">NSInteger</span>)dividerIndex &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">CGFloat</span>)splitView:(<span class="built_in">NSSplitView</span> *)splitView constrainMaxCoordinate:(<span class="built_in">CGFloat</span>)proposedMaximumPosition ofSubviewAt:(<span class="built_in">NSInteger</span>)dividerIndex &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">200</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// èƒ½å¦æŠ˜å å­è§†å›¾</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)splitView:(<span class="built_in">NSSplitView</span> *)splitView canCollapseSubview:(<span class="built_in">NSView</span> *)subview &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;ä¸€-ç®€è¿°&quot;&gt;&lt;a href=&quot;#ä¸€-ç®€è¿°&quot; class=&quot;headerlink&quot; title=&quot;ä¸€. ç®€è¿°&quot;&gt;&lt;/a&gt;ä¸€. ç®€è¿°&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;æ‹†åˆ†è§†å›¾&lt;/strong&gt;ï¼Œåœ¨æ°´å¹³æˆ–å‚ç›´è¿è¡Œçš„çº¿æ€§å †æ ˆä¸­æ’åˆ—ä¸¤ä¸ªæˆ–å¤šä¸ªè§†å›¾çš„è§†å›¾ã€‚&lt;/p&gt;
&lt;p&gt;é»˜è®¤ä¸ºæ°´å¹³æ–¹å‘&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;NSSplitView&lt;/span&gt; : &lt;span class=&quot;title&quot;&gt;NSView&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h1 id=&quot;äºŒ-å®˜æ–¹å±æ€§æ–¹æ³•&quot;&gt;&lt;a href=&quot;#äºŒ-å®˜æ–¹å±æ€§æ–¹æ³•&quot; class=&quot;headerlink&quot; title=&quot;äºŒ. å®˜æ–¹å±æ€§æ–¹æ³•&quot;&gt;&lt;/a&gt;äºŒ. å®˜æ–¹å±æ€§æ–¹æ³•&lt;/h1&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// ä»£ç†&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;nullable&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;weak&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;NSSplitViewDelegate&lt;/span&gt;&amp;gt; delegate;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)splitView:(&lt;span class=&quot;built_in&quot;&gt;NSSplitView&lt;/span&gt; *)splitView canCollapseSubview:(&lt;span class=&quot;built_in&quot;&gt;NSView&lt;/span&gt; *)subview; &lt;span class=&quot;comment&quot;&gt;// æ˜¯å¦å…è®¸ç”¨æˆ·å¯ä»¥æŠ˜å å’Œå±•å¼€æŒ‡å®šå­è§†å›¾&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)splitView:(&lt;span class=&quot;built_in&quot;&gt;NSSplitView&lt;/span&gt; *)splitView resizeSubviewsWithOldSize:(&lt;span class=&quot;built_in&quot;&gt;NSSize&lt;/span&gt;)oldSize; &lt;span class=&quot;comment&quot;&gt;// å­è§†å›¾æŒ‰è‡ªå®šä¹‰å¤§å°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)splitViewWillResizeSubviews:(&lt;span class=&quot;built_in&quot;&gt;NSNotification&lt;/span&gt; *)notification;&lt;span class=&quot;comment&quot;&gt;// å³å°†è°ƒæ•´å­è§†å›¾å¤§å°æ—¶çš„é€šçŸ¥å§”æ‰˜&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)splitViewDidResizeSubviews:(&lt;span class=&quot;built_in&quot;&gt;NSNotification&lt;/span&gt; *)notification;&lt;span class=&quot;comment&quot;&gt;// è°ƒæ•´å­è§†å›¾å¤§å°æ—¶çš„é€šçŸ¥å§”æ‰˜&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)splitView:(&lt;span class=&quot;built_in&quot;&gt;NSSplitView&lt;/span&gt; *)splitView canCollapseSubview:(&lt;span class=&quot;built_in&quot;&gt;NSView&lt;/span&gt; *)subview;&lt;span class=&quot;comment&quot;&gt;// æ˜¯å¦è°ƒæ•´å­è§†å›¾çš„å¤§å°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt;)splitView:(&lt;span class=&quot;built_in&quot;&gt;NSSplitView&lt;/span&gt; *)splitView constrainMinCoordinate:(&lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt;)proposedMinimumPosition ofSubviewAt:(&lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt;)dividerIndex; &lt;span class=&quot;comment&quot;&gt;// å…è®¸å§”æ‰˜äººåœ¨ç”¨æˆ·æ‹–åŠ¨åˆ†éš”çº¿æ—¶é™åˆ¶å…¶æœ€å°åæ ‡é™åˆ¶ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt;)splitView:(&lt;span class=&quot;built_in&quot;&gt;NSSplitView&lt;/span&gt; *)splitView constrainMaxCoordinate:(&lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt;)proposedMaximumPosition ofSubviewAt:(&lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt;)dividerIndex; &lt;span class=&quot;comment&quot;&gt;// å…è®¸å§”æ‰˜äººåœ¨ç”¨æˆ·æ‹–åŠ¨åˆ†éš”çº¿æ—¶é™åˆ¶å…¶æœ€å°åæ ‡é™åˆ¶ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt;)splitView:(&lt;span class=&quot;built_in&quot;&gt;NSSplitView&lt;/span&gt; *)splitView constrainSplitPosition:(&lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt;)proposedPosition ofSubviewAt:(&lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt;)dividerIndex; &lt;span class=&quot;comment&quot;&gt;// å…è®¸ä»£è¡¨å°†åˆ†éš”çº¿é™åˆ¶åœ¨æŸäº›ä½ç½®ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// å­è§†å›¾&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; arrangesAllSubviews API_AVAILABLE(macos(&lt;span class=&quot;number&quot;&gt;10.11&lt;/span&gt;)); &lt;span class=&quot;comment&quot;&gt;// æ˜¯å¦å°†æ‰€æœ‰å­è§†å›¾æ’åˆ—ä¸ºæ‹†åˆ†çª—æ ¼&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;readonly&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;copy&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt;&amp;lt;__kindof &lt;span class=&quot;built_in&quot;&gt;NSView&lt;/span&gt; *&amp;gt; *arrangedSubviews API_AVAILABLE(macos(&lt;span class=&quot;number&quot;&gt;10.11&lt;/span&gt;)); &lt;span class=&quot;comment&quot;&gt;// æ‹†åˆ†è§†å›¾ä½œä¸ºæ‹†åˆ†çª—æ ¼æ’åˆ—çš„è§†å›¾æ•°ç»„&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)addArrangedSubview:(&lt;span class=&quot;built_in&quot;&gt;NSView&lt;/span&gt; *)view API_AVAILABLE(macos(&lt;span class=&quot;number&quot;&gt;10.11&lt;/span&gt;));&lt;span class=&quot;comment&quot;&gt;// æ·»åŠ æ‹†åˆ†çª—æ ¼&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)insertArrangedSubview:(&lt;span class=&quot;built_in&quot;&gt;NSView&lt;/span&gt; *)view atIndex:(&lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt;)index API_AVAILABLE(macos(&lt;span class=&quot;number&quot;&gt;10.11&lt;/span&gt;)); &lt;span class=&quot;comment&quot;&gt;// å°†æ‹†åˆ†çª—æ ¼æ’å…¥åˆ°æŒ‡å®šçš„ç´¢å¼•å¤„&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)removeArrangedSubview:(&lt;span class=&quot;built_in&quot;&gt;NSView&lt;/span&gt; *)view API_AVAILABLE(macos(&lt;span class=&quot;number&quot;&gt;10.11&lt;/span&gt;));&lt;span class=&quot;comment&quot;&gt;// åˆ é™¤å·²æ’åˆ—çš„æ‹†åˆ†çª—æ ¼&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)adjustSubviews; &lt;span class=&quot;comment&quot;&gt;// è°ƒæ•´å­è§†å›¾å¤§å°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)isSubviewCollapsed:(&lt;span class=&quot;built_in&quot;&gt;NSView&lt;/span&gt; *)subview;&lt;span class=&quot;comment&quot;&gt;// è¿”å›æ˜¯å¦å¤„äºæŠ˜å çŠ¶æ€&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;NSLayoutPriority&lt;/span&gt;)holdingPriorityForSubviewAtIndex:(&lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt;)subviewIndex API_AVAILABLE(macos(&lt;span class=&quot;number&quot;&gt;10.8&lt;/span&gt;)); &lt;span class=&quot;comment&quot;&gt;// è°ƒæ•´å­è§†å›¾å¤§å°æ—¶ï¼Œè¿”å›å®½åº¦æˆ–é«˜åº¦çš„ä¼˜å…ˆçº§&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)setHoldingPriority:(&lt;span class=&quot;built_in&quot;&gt;NSLayoutPriority&lt;/span&gt;)priority forSubviewAtIndex:(&lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt;)subviewIndex API_AVAILABLE(macos(&lt;span class=&quot;number&quot;&gt;10.8&lt;/span&gt;)); &lt;span class=&quot;comment&quot;&gt;// è®¾ç½®å­è§†å›¾ä¼˜å…ˆçº§&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;nullable&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;copy&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;NSSplitViewAutosaveName&lt;/span&gt; autosaveName API_AVAILABLE(macos(&lt;span class=&quot;number&quot;&gt;10.5&lt;/span&gt;)); &lt;span class=&quot;comment&quot;&gt;// ç³»ç»Ÿè‡ªåŠ¨ä¿å­˜æ‹†åˆ†è§†å›¾çš„åˆ†éš”å™¨é…ç½®æ—¶ä½¿ç”¨çš„åç§°ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// æ‹†åˆ†è§†å›¾æ–¹å‘&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;getter&lt;/span&gt;=isVertical) &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; vertical; &lt;span class=&quot;comment&quot;&gt;// ç¡®å®šæ‹†åˆ†è§†å›¾åˆ†å‰²çº¿æ–¹å‘&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;NSSplitViewDividerStyle&lt;/span&gt; dividerStyle API_AVAILABLE(macos(&lt;span class=&quot;number&quot;&gt;10.5&lt;/span&gt;)); &lt;span class=&quot;comment&quot;&gt;// åˆ†å‰²çº¿æ ·å¼,å¦‚ä¸‹&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;NS_ENUM&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;NSSplitViewDividerStyle&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSSplitViewDividerStyleThick&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSSplitViewDividerStyleThin&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSSplitViewDividerStylePaneSplitter&lt;/span&gt; API_AVAILABLE(macos(&lt;span class=&quot;number&quot;&gt;10.6&lt;/span&gt;)) = &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; API_AVAILABLE(macos(&lt;span class=&quot;number&quot;&gt;10.5&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;readonly&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;copy&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;NSColor&lt;/span&gt; *dividerColor API_AVAILABLE(macos(&lt;span class=&quot;number&quot;&gt;10.5&lt;/span&gt;)); &lt;span class=&quot;comment&quot;&gt;// åˆ†å‰²çº¿é¢œè‰²&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;readonly&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt; dividerThickness; &lt;span class=&quot;comment&quot;&gt;// åˆ†å‰²çº¿åšåº¦&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)drawDividerInRect:(&lt;span class=&quot;built_in&quot;&gt;NSRect&lt;/span&gt;)rect; &lt;span class=&quot;comment&quot;&gt;// ç»˜åˆ¶åˆ†å‰²çº¿&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// é™åˆ¶æ‹†åˆ†ä½ç½®&amp;lt;å·¦å³(æˆ–ä¸Šä¸‹)å¯æ»‘åŠ¨åŒºåŸŸ&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt;)minPossiblePositionOfDividerAtIndex:(&lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt;)dividerIndex API_AVAILABLE(macos(&lt;span class=&quot;number&quot;&gt;10.5&lt;/span&gt;)); &lt;span class=&quot;comment&quot;&gt;// ç´¢å¼•å¤„æœ€å°ä½ç½® &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt;)maxPossiblePositionOfDividerAtIndex:(&lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt;)dividerIndex API_AVAILABLE(macos(&lt;span class=&quot;number&quot;&gt;10.5&lt;/span&gt;)); &lt;span class=&quot;comment&quot;&gt;// ç´¢å¼•å¤„æœ€å¤§ä½ç½®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)setPosition:(&lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt;)position ofDividerAtIndex:(&lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt;)dividerIndex API_AVAILABLE(macos(&lt;span class=&quot;number&quot;&gt;10.5&lt;/span&gt;)); &lt;span class=&quot;comment&quot;&gt;// è®¾ç½®åˆ†å‰²çº¿åœ¨æŒ‡å®šç´¢å¼•å¤„çš„ä½ç½®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h1 id=&quot;ä¸‰-ç¤ºä¾‹-lt-ä»£ç -gt&quot;&gt;&lt;a href=&quot;#ä¸‰-ç¤ºä¾‹-lt-ä»£ç -gt&quot; class=&quot;headerlink&quot; title=&quot;ä¸‰. ç¤ºä¾‹&amp;lt;ä»£ç &amp;gt;&quot;&gt;&lt;/a&gt;ä¸‰. ç¤ºä¾‹&amp;lt;ä»£ç &amp;gt;&lt;/h1&gt;&lt;p&gt;ä½¿ç”¨ä»£ç åˆ›å»º&lt;code&gt;NSSplitView&lt;/code&gt;ï¼Œæƒ³è¦ç”¨&lt;code&gt;Storyboard&lt;/code&gt;åˆ›å»ºçš„è‡ªè¡Œç ”ç©¶ï¼Œæ¯”è¾ƒç®€å•&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;NSSplitView&lt;/span&gt; *)splitView &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!_splitView) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _splitView = [[&lt;span class=&quot;built_in&quot;&gt;NSSplitView&lt;/span&gt; alloc] initWithFrame:&lt;span class=&quot;built_in&quot;&gt;CGRectMake&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;600&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;400&lt;/span&gt;)];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _splitView.delegate = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _splitView.vertical = &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _splitView.dividerStyle = &lt;span class=&quot;built_in&quot;&gt;NSSplitViewDividerStylePaneSplitter&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _splitView.wantsLayer = &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _splitView.layer.backgroundColor = &lt;span class=&quot;built_in&quot;&gt;NSColor&lt;/span&gt;.whiteColor.CGColor;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _splitView.toolTip = &lt;span class=&quot;string&quot;&gt;@&amp;quot;ä»£ç åˆ›å»ºSplitView&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; _splitView;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)viewDidLoad &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; viewDidLoad];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// Do view setup here.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.view.wantsLayer = &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.view.layer.backgroundColor = &lt;span class=&quot;built_in&quot;&gt;NSColor&lt;/span&gt;.lightGrayColor.CGColor;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; addSplitView];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)addSplitView &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSView&lt;/span&gt; *leftView = [[&lt;span class=&quot;built_in&quot;&gt;NSView&lt;/span&gt; alloc] initWithFrame:&lt;span class=&quot;built_in&quot;&gt;CGRectMake&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;400&lt;/span&gt;)];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.splitView addArrangedSubview:leftView];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSView&lt;/span&gt; *rightView = [[&lt;span class=&quot;built_in&quot;&gt;NSView&lt;/span&gt; alloc] initWithFrame:&lt;span class=&quot;built_in&quot;&gt;CGRectMake&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;500&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;400&lt;/span&gt;)];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.splitView addArrangedSubview:rightView];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.view addSubview:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.splitView];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt;)splitView:(&lt;span class=&quot;built_in&quot;&gt;NSSplitView&lt;/span&gt; *)splitView constrainMinCoordinate:(&lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt;)proposedMinimumPosition ofSubviewAt:(&lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt;)dividerIndex &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt;)splitView:(&lt;span class=&quot;built_in&quot;&gt;NSSplitView&lt;/span&gt; *)splitView constrainMaxCoordinate:(&lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt;)proposedMaximumPosition ofSubviewAt:(&lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt;)dividerIndex &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;200&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/// èƒ½å¦æŠ˜å å­è§†å›¾&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)splitView:(&lt;span class=&quot;built_in&quot;&gt;NSSplitView&lt;/span&gt; *)splitView canCollapseSubview:(&lt;span class=&quot;built_in&quot;&gt;NSView&lt;/span&gt; *)subview &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

</summary>
    
    
    
    <category term="OC" scheme="https://forgetsou.github.io/categories/OC/"/>
    
    
    <category term="OC" scheme="https://forgetsou.github.io/tags/OC/"/>
    
    <category term="macOS" scheme="https://forgetsou.github.io/tags/macOS/"/>
    
    <category term="AppKit" scheme="https://forgetsou.github.io/tags/AppKit/"/>
    
  </entry>
  
</feed>
